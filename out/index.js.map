{
  "version": 3,
  "sources": ["../node_modules/reflect-metadata/Reflect.js", "../node_modules/sprotty/src/base/actions/action.ts", "../node_modules/inversify/lib/constants/metadata_keys.js", "../node_modules/inversify/lib/constants/literal_types.js", "../node_modules/inversify/lib/utils/id.js", "../node_modules/inversify/lib/bindings/binding.js", "../node_modules/inversify/lib/constants/error_msgs.js", "../node_modules/inversify/lib/planning/metadata_reader.js", "../node_modules/inversify/lib/bindings/binding_count.js", "../node_modules/inversify/lib/utils/exceptions.js", "../node_modules/inversify/lib/utils/serialization.js", "../node_modules/inversify/lib/planning/context.js", "../node_modules/inversify/lib/planning/metadata.js", "../node_modules/inversify/lib/planning/plan.js", "../node_modules/inversify/lib/annotation/lazy_service_identifier.js", "../node_modules/inversify/lib/planning/queryable_string.js", "../node_modules/inversify/lib/planning/target.js", "../node_modules/inversify/lib/planning/reflection_utils.js", "../node_modules/inversify/lib/planning/request.js", "../node_modules/inversify/lib/planning/planner.js", "../node_modules/inversify/lib/utils/async.js", "../node_modules/inversify/lib/scope/scope.js", "../node_modules/inversify/lib/utils/factory_type.js", "../node_modules/inversify/lib/utils/binding_utils.js", "../node_modules/inversify/lib/resolution/instantiation.js", "../node_modules/inversify/lib/resolution/resolver.js", "../node_modules/inversify/lib/syntax/constraint_helpers.js", "../node_modules/inversify/lib/syntax/binding_when_syntax.js", "../node_modules/inversify/lib/syntax/binding_on_syntax.js", "../node_modules/inversify/lib/syntax/binding_when_on_syntax.js", "../node_modules/inversify/lib/syntax/binding_in_syntax.js", "../node_modules/inversify/lib/syntax/binding_in_when_on_syntax.js", "../node_modules/inversify/lib/syntax/binding_to_syntax.js", "../node_modules/inversify/lib/container/container_snapshot.js", "../node_modules/inversify/lib/utils/clonable.js", "../node_modules/inversify/lib/container/lookup.js", "../node_modules/inversify/lib/container/module_activation_store.js", "../node_modules/inversify/lib/container/container.js", "../node_modules/inversify/lib/container/container_module.js", "../node_modules/inversify/lib/utils/js.js", "../node_modules/inversify/lib/annotation/decorator_utils.js", "../node_modules/inversify/lib/annotation/injectable.js", "../node_modules/inversify/lib/annotation/tagged.js", "../node_modules/inversify/lib/annotation/named.js", "../node_modules/inversify/lib/annotation/inject_base.js", "../node_modules/inversify/lib/annotation/inject.js", "../node_modules/inversify/lib/annotation/optional.js", "../node_modules/inversify/lib/annotation/unmanaged.js", "../node_modules/inversify/lib/annotation/multi_inject.js", "../node_modules/inversify/lib/annotation/target_name.js", "../node_modules/inversify/lib/annotation/property_event_decorator.js", "../node_modules/inversify/lib/annotation/post_construct.js", "../node_modules/inversify/lib/annotation/pre_destroy.js", "../node_modules/inversify/lib/interfaces/interfaces.js", "../node_modules/inversify/lib/inversify.js", "../node_modules/sprotty-protocol/src/utils/object.ts", "../node_modules/sprotty-protocol/src/actions.ts", "../node_modules/sprotty-protocol/src/utils/async.ts", "../node_modules/sprotty/src/base/types.ts", "../node_modules/sprotty/src/utils/registry.ts", "../node_modules/sprotty-protocol/src/utils/geometry.ts", "../node_modules/sprotty/src/utils/iterable.ts", "../node_modules/sprotty/src/base/model/smodel.ts", "../node_modules/sprotty/src/base/model/smodel-factory.ts", "../node_modules/sprotty/src/base/animations/animation-frame-syncer.ts", "../node_modules/sprotty/src/base/actions/action-dispatcher.ts", "../node_modules/sprotty/src/utils/inversify.ts", "../node_modules/sprotty/src/base/actions/action-handler.ts", "../node_modules/sprotty/src/base/actions/diagram-locker.ts", "../node_modules/sprotty/src/base/animations/easing.ts", "../node_modules/sprotty/src/base/animations/animation.ts", "../node_modules/sprotty/src/base/commands/command.ts", "../node_modules/sprotty/src/base/commands/command-registration.ts", "../node_modules/sprotty/src/base/commands/command-stack-options.ts", "../node_modules/sprotty/src/base/commands/command-stack.ts", "../node_modules/sprotty-protocol/src/action-handler.ts", "../node_modules/sprotty-protocol/src/utils/model-utils.ts", "../node_modules/sprotty-protocol/src/diagram-server.ts", "../node_modules/sprotty-protocol/src/model.ts", "../node_modules/sprotty-protocol/src/index.ts", "../node_modules/sprotty/src/utils/browser.ts", "../node_modules/sprotty/src/base/features/initialize-canvas.ts", "../node_modules/sprotty/src/base/features/set-model.ts", "../node_modules/sprotty/src/base/model/smodel-utils.ts", "../node_modules/sprotty/src/base/ui-extensions/ui-extension-registry.ts", "../node_modules/sprotty/src/base/ui-extensions/ui-extension.ts", "../node_modules/sprotty/src/base/views/vnode-utils.ts", "../node_modules/sprotty/src/base/views/key-tool.ts", "../node_modules/sprotty/src/base/views/dom-helper.ts", "../node_modules/sprotty/src/base/views/mouse-tool.ts", "../node_modules/snabbdom/src/htmldomapi.ts", "../node_modules/snabbdom/src/vnode.ts", "../node_modules/snabbdom/src/is.ts", "../node_modules/snabbdom/src/init.ts", "../node_modules/snabbdom/src/h.ts", "../node_modules/snabbdom/src/thunk.ts", "../node_modules/snabbdom/src/helpers/attachto.ts", "../node_modules/snabbdom/src/tovnode.ts", "../node_modules/snabbdom/build/hooks.js", "../node_modules/snabbdom/src/modules/attributes.ts", "../node_modules/snabbdom/src/modules/class.ts", "../node_modules/snabbdom/src/modules/dataset.ts", "../node_modules/snabbdom/src/modules/eventlisteners.ts", "../node_modules/snabbdom/src/modules/props.ts", "../node_modules/snabbdom/src/modules/style.ts", "../node_modules/snabbdom/src/jsx.ts", "../node_modules/snabbdom/src/index.ts", "../node_modules/sprotty/src/base/views/thunk-view.ts", "../node_modules/sprotty/src/lib/jsx.ts", "../node_modules/sprotty/src/base/views/view.tsx", "../node_modules/sprotty/src/base/views/viewer-cache.ts", "../node_modules/sprotty/src/base/views/viewer-options.ts", "../node_modules/sprotty/src/base/views/viewer.tsx", "../node_modules/sprotty/src/base/views/vnode-postprocessor.ts", "../node_modules/sprotty/src/utils/logging.ts", "../node_modules/sprotty/src/base/views/id-postprocessor.ts", "../node_modules/sprotty/src/base/views/css-class-postprocessor.ts", "../node_modules/sprotty/src/base/di.config.ts", "../node_modules/sprotty/src/features/bounds/model.ts", "../node_modules/sprotty/src/features/bounds/bounds-manipulation.ts", "../node_modules/sprotty/src/features/bounds/layout.ts", "../node_modules/sprotty/src/features/bounds/hidden-bounds-updater.ts", "../node_modules/sprotty/src/features/bounds/abstract-layout.ts", "../node_modules/sprotty/src/features/bounds/vbox-layout.ts", "../node_modules/sprotty/src/features/bounds/hbox-layout.ts", "../node_modules/sprotty/src/features/bounds/stack-layout.ts", "../node_modules/sprotty/src/features/bounds/views.ts", "../node_modules/sprotty/src/features/button/button-handler.ts", "../node_modules/sprotty/src/features/fade/model.ts", "../node_modules/sprotty/src/features/button/model.ts", "../node_modules/sprotty/src/features/nameable/model.ts", "../node_modules/sprotty/src/features/command-palette/action-providers.ts", "../node_modules/sprotty/src/utils/codicon.ts", "../node_modules/sprotty/src/utils/keyboard.ts", "../node_modules/sprotty/src/features/select/model.ts", "../node_modules/autocompleter/autocomplete.ts", "../node_modules/sprotty/src/features/command-palette/command-palette.ts", "../node_modules/sprotty/src/features/context-menu/context-menu-service.ts", "../node_modules/sprotty/src/features/edit/delete.ts", "../node_modules/sprotty/src/features/context-menu/menu-providers.ts", "../node_modules/sprotty/src/features/context-menu/mouse-listener.ts", "../node_modules/sprotty/src/features/hover/model.ts", "../node_modules/sprotty/src/features/move/model.ts", "../node_modules/sprotty/src/features/routing/model.ts", "../node_modules/sprotty/src/features/edge-layout/model.ts", "../node_modules/sprotty/src/features/edit/model.ts", "../node_modules/sprotty/src/utils/geometry.ts", "../node_modules/sprotty/src/features/viewport/model.ts", "../node_modules/sprotty/src/features/export/model.ts", "../node_modules/sprotty/src/features/viewport/viewport-root.ts", "../node_modules/sprotty/src/graph/sgraph.ts", "../node_modules/sprotty/src/features/routing/anchor.ts", "../node_modules/sprotty/src/features/routing/abstract-edge-router.ts", "../node_modules/sprotty/src/features/routing/polyline-edge-router.ts", "../node_modules/sprotty/src/features/routing/routing.ts", "../node_modules/sprotty/src/features/edge-layout/edge-layout.ts", "../node_modules/sprotty/src/features/edge-layout/di.config.ts", "../node_modules/sprotty/src/features/edit/create.ts", "../node_modules/sprotty/src/features/edit/create-on-drag.ts", "../node_modules/sprotty/src/lib/svg-views.tsx", "../node_modules/sprotty/src/features/edit/edit-label.ts", "../node_modules/sprotty/src/features/export/svg-exporter.ts", "../node_modules/sprotty/src/model-source/model-source.ts", "../node_modules/sprotty/src/model-source/commit-model.ts", "../node_modules/sprotty/src/features/viewport/zoom.ts", "../node_modules/sprotty/src/features/edit/edit-label-ui.ts", "../node_modules/sprotty/src/features/edit/edit-routing.ts", "../node_modules/sprotty/src/features/edit/reconnect.ts", "../node_modules/sprotty/src/features/edit/di.config.ts", "../node_modules/sprotty/src/features/expand/model.ts", "../node_modules/sprotty/src/features/expand/expand.ts", "../node_modules/sprotty/src/features/expand/views.tsx", "../node_modules/sprotty/src/features/export/export.ts", "../node_modules/sprotty/src/features/fade/fade.ts", "../node_modules/sprotty/src/features/hover/hover.ts", "../node_modules/sprotty/src/features/decoration/model.ts", "../node_modules/sprotty/src/features/decoration/views.tsx", "../node_modules/sprotty/src/features/decoration/decoration-placer.ts", "../node_modules/tinyqueue/tinyqueue.js", "../node_modules/sprotty/src/features/edge-intersection/sweepline.ts", "../node_modules/sprotty/src/features/edge-intersection/intersection-finder.ts", "../node_modules/sprotty/src/features/move/move.ts", "../node_modules/sprotty/src/features/move/snap.ts", "../node_modules/sprotty/src/features/open/model.ts", "../node_modules/sprotty/src/features/open/open.ts", "../node_modules/sprotty/src/features/projection/model.ts", "../node_modules/sprotty/src/features/projection/views.tsx", "../node_modules/sprotty/src/features/routing/polyline-anchors.ts", "../node_modules/sprotty/src/features/routing/bezier-edge-router.ts", "../node_modules/sprotty/src/features/routing/bezier-anchors.ts", "../node_modules/sprotty/src/features/routing/manhattan-edge-router.ts", "../node_modules/sprotty/src/features/routing/manhattan-anchors.ts", "../node_modules/sprotty/src/features/routing/views.ts", "../node_modules/sprotty/src/base/commands/request-command.ts", "../node_modules/sprotty/src/features/viewport/scroll.ts", "../node_modules/sprotty/src/features/select/select.ts", "../node_modules/sprotty/src/features/undo-redo/undo-redo.ts", "../node_modules/sprotty/src/features/update/model-matching.ts", "../node_modules/sprotty/src/features/bounds/resize.ts", "../node_modules/sprotty/src/features/update/update-model.ts", "../node_modules/sprotty/src/features/viewport/viewport.ts", "../node_modules/sprotty/src/features/viewport/center-fit.ts", "../node_modules/sprotty/src/features/zorder/zorder.ts", "../node_modules/sprotty/src/features/bounds/di.config.ts", "../node_modules/sprotty/src/features/button/di.config.ts", "../node_modules/sprotty/src/features/command-palette/di.config.ts", "../node_modules/sprotty/src/features/context-menu/di.config.ts", "../node_modules/sprotty/src/features/decoration/di.config.ts", "../node_modules/sprotty/src/features/edge-intersection/di.config.ts", "../node_modules/sprotty/src/features/expand/di.config.ts", "../node_modules/sprotty/src/features/export/di.config.ts", "../node_modules/sprotty/src/features/fade/di.config.ts", "../node_modules/sprotty/src/features/hover/popup-position-updater.ts", "../node_modules/sprotty/src/features/hover/di.config.ts", "../node_modules/sprotty/src/features/move/di.config.ts", "../node_modules/sprotty/src/features/open/di.config.ts", "../node_modules/sprotty/src/features/routing/di.config.ts", "../node_modules/sprotty/src/features/select/di.config.ts", "../node_modules/sprotty/src/features/undo-redo/di.config.ts", "../node_modules/sprotty/src/features/update/di.config.ts", "../node_modules/sprotty/src/features/viewport/di.config.ts", "../node_modules/sprotty/src/features/zorder/di.config.ts", "../node_modules/sprotty/src/graph/views.tsx", "../node_modules/sprotty/src/model-source/di.config.ts", "../node_modules/sprotty/src/lib/modules.ts", "../node_modules/sprotty/src/lib/virtualize.ts", "../node_modules/sprotty/src/lib/model.ts", "../node_modules/sprotty/src/lib/generic-views.tsx", "../node_modules/sprotty/src/lib/html-views.tsx", "../node_modules/file-saver/src/FileSaver.js", "../node_modules/sprotty/src/model-source/diagram-server.ts", "../node_modules/sprotty/src/model-source/local-model-source.ts", "../node_modules/sprotty/src/model-source/logging.ts", "../node_modules/sprotty/src/model-source/websocket.ts", "../node_modules/sprotty/src/utils/color.ts", "../node_modules/sprotty/src/index.ts", "../index.ts", "../di.config.ts", "../view/portView.tsx", "../model-source.ts", "../util/addNode.ts", "../util/drawEdge.ts"],
  "sourcesContent": ["/*! *****************************************************************************\r\nCopyright (C) Microsoft. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\nvar Reflect;\r\n(function (Reflect) {\r\n    // Metadata Proposal\r\n    // https://rbuckton.github.io/reflect-metadata/\r\n    (function (factory) {\r\n        var root = typeof global === \"object\" ? global :\r\n            typeof self === \"object\" ? self :\r\n                typeof this === \"object\" ? this :\r\n                    Function(\"return this;\")();\r\n        var exporter = makeExporter(Reflect);\r\n        if (typeof root.Reflect === \"undefined\") {\r\n            root.Reflect = Reflect;\r\n        }\r\n        else {\r\n            exporter = makeExporter(root.Reflect, exporter);\r\n        }\r\n        factory(exporter);\r\n        function makeExporter(target, previous) {\r\n            return function (key, value) {\r\n                if (typeof target[key] !== \"function\") {\r\n                    Object.defineProperty(target, key, { configurable: true, writable: true, value: value });\r\n                }\r\n                if (previous)\r\n                    previous(key, value);\r\n            };\r\n        }\r\n    })(function (exporter) {\r\n        var hasOwn = Object.prototype.hasOwnProperty;\r\n        // feature test for Symbol support\r\n        var supportsSymbol = typeof Symbol === \"function\";\r\n        var toPrimitiveSymbol = supportsSymbol && typeof Symbol.toPrimitive !== \"undefined\" ? Symbol.toPrimitive : \"@@toPrimitive\";\r\n        var iteratorSymbol = supportsSymbol && typeof Symbol.iterator !== \"undefined\" ? Symbol.iterator : \"@@iterator\";\r\n        var supportsCreate = typeof Object.create === \"function\"; // feature test for Object.create support\r\n        var supportsProto = { __proto__: [] } instanceof Array; // feature test for __proto__ support\r\n        var downLevel = !supportsCreate && !supportsProto;\r\n        var HashMap = {\r\n            // create an object in dictionary mode (a.k.a. \"slow\" mode in v8)\r\n            create: supportsCreate\r\n                ? function () { return MakeDictionary(Object.create(null)); }\r\n                : supportsProto\r\n                    ? function () { return MakeDictionary({ __proto__: null }); }\r\n                    : function () { return MakeDictionary({}); },\r\n            has: downLevel\r\n                ? function (map, key) { return hasOwn.call(map, key); }\r\n                : function (map, key) { return key in map; },\r\n            get: downLevel\r\n                ? function (map, key) { return hasOwn.call(map, key) ? map[key] : undefined; }\r\n                : function (map, key) { return map[key]; },\r\n        };\r\n        // Load global or shim versions of Map, Set, and WeakMap\r\n        var functionPrototype = Object.getPrototypeOf(Function);\r\n        var usePolyfill = typeof process === \"object\" && process[\"env\" + \"\"] && process[\"env\" + \"\"][\"REFLECT_METADATA_USE_MAP_POLYFILL\"] === \"true\";\r\n        var _Map = !usePolyfill && typeof Map === \"function\" && typeof Map.prototype.entries === \"function\" ? Map : CreateMapPolyfill();\r\n        var _Set = !usePolyfill && typeof Set === \"function\" && typeof Set.prototype.entries === \"function\" ? Set : CreateSetPolyfill();\r\n        var _WeakMap = !usePolyfill && typeof WeakMap === \"function\" ? WeakMap : CreateWeakMapPolyfill();\r\n        // [[Metadata]] internal slot\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinary-object-internal-methods-and-internal-slots\r\n        var Metadata = new _WeakMap();\r\n        /**\r\n         * Applies a set of decorators to a property of a target object.\r\n         * @param decorators An array of decorators.\r\n         * @param target The target object.\r\n         * @param propertyKey (Optional) The property key to decorate.\r\n         * @param attributes (Optional) The property descriptor for the target key.\r\n         * @remarks Decorators are applied in reverse order.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     Example = Reflect.decorate(decoratorsArray, Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     Reflect.decorate(decoratorsArray, Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     Reflect.decorate(decoratorsArray, Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     Object.defineProperty(Example, \"staticMethod\",\r\n         *         Reflect.decorate(decoratorsArray, Example, \"staticMethod\",\r\n         *             Object.getOwnPropertyDescriptor(Example, \"staticMethod\")));\r\n         *\r\n         *     // method (on prototype)\r\n         *     Object.defineProperty(Example.prototype, \"method\",\r\n         *         Reflect.decorate(decoratorsArray, Example.prototype, \"method\",\r\n         *             Object.getOwnPropertyDescriptor(Example.prototype, \"method\")));\r\n         *\r\n         */\r\n        function decorate(decorators, target, propertyKey, attributes) {\r\n            if (!IsUndefined(propertyKey)) {\r\n                if (!IsArray(decorators))\r\n                    throw new TypeError();\r\n                if (!IsObject(target))\r\n                    throw new TypeError();\r\n                if (!IsObject(attributes) && !IsUndefined(attributes) && !IsNull(attributes))\r\n                    throw new TypeError();\r\n                if (IsNull(attributes))\r\n                    attributes = undefined;\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n                return DecorateProperty(decorators, target, propertyKey, attributes);\r\n            }\r\n            else {\r\n                if (!IsArray(decorators))\r\n                    throw new TypeError();\r\n                if (!IsConstructor(target))\r\n                    throw new TypeError();\r\n                return DecorateConstructor(decorators, target);\r\n            }\r\n        }\r\n        exporter(\"decorate\", decorate);\r\n        // 4.1.2 Reflect.metadata(metadataKey, metadataValue)\r\n        // https://rbuckton.github.io/reflect-metadata/#reflect.metadata\r\n        /**\r\n         * A default metadata decorator factory that can be used on a class, class member, or parameter.\r\n         * @param metadataKey The key for the metadata entry.\r\n         * @param metadataValue The value for the metadata entry.\r\n         * @returns A decorator function.\r\n         * @remarks\r\n         * If `metadataKey` is already defined for the target and target key, the\r\n         * metadataValue for that key will be overwritten.\r\n         * @example\r\n         *\r\n         *     // constructor\r\n         *     @Reflect.metadata(key, value)\r\n         *     class Example {\r\n         *     }\r\n         *\r\n         *     // property (on constructor, TypeScript only)\r\n         *     class Example {\r\n         *         @Reflect.metadata(key, value)\r\n         *         static staticProperty;\r\n         *     }\r\n         *\r\n         *     // property (on prototype, TypeScript only)\r\n         *     class Example {\r\n         *         @Reflect.metadata(key, value)\r\n         *         property;\r\n         *     }\r\n         *\r\n         *     // method (on constructor)\r\n         *     class Example {\r\n         *         @Reflect.metadata(key, value)\r\n         *         static staticMethod() { }\r\n         *     }\r\n         *\r\n         *     // method (on prototype)\r\n         *     class Example {\r\n         *         @Reflect.metadata(key, value)\r\n         *         method() { }\r\n         *     }\r\n         *\r\n         */\r\n        function metadata(metadataKey, metadataValue) {\r\n            function decorator(target, propertyKey) {\r\n                if (!IsObject(target))\r\n                    throw new TypeError();\r\n                if (!IsUndefined(propertyKey) && !IsPropertyKey(propertyKey))\r\n                    throw new TypeError();\r\n                OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\r\n            }\r\n            return decorator;\r\n        }\r\n        exporter(\"metadata\", metadata);\r\n        /**\r\n         * Define a unique metadata entry on the target.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param metadataValue A value that contains attached metadata.\r\n         * @param target The target object on which to define metadata.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     Reflect.defineMetadata(\"custom:annotation\", options, Example.prototype, \"method\");\r\n         *\r\n         *     // decorator factory as metadata-producing annotation.\r\n         *     function MyAnnotation(options): Decorator {\r\n         *         return (target, key?) => Reflect.defineMetadata(\"custom:annotation\", options, target, key);\r\n         *     }\r\n         *\r\n         */\r\n        function defineMetadata(metadataKey, metadataValue, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryDefineOwnMetadata(metadataKey, metadataValue, target, propertyKey);\r\n        }\r\n        exporter(\"defineMetadata\", defineMetadata);\r\n        /**\r\n         * Gets a value indicating whether the target object or its prototype chain has the provided metadata key defined.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns `true` if the metadata key was defined on the target object or its prototype chain; otherwise, `false`.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.hasMetadata(\"custom:annotation\", Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function hasMetadata(metadataKey, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryHasMetadata(metadataKey, target, propertyKey);\r\n        }\r\n        exporter(\"hasMetadata\", hasMetadata);\r\n        /**\r\n         * Gets a value indicating whether the target object has the provided metadata key defined.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns `true` if the metadata key was defined on the target object; otherwise, `false`.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.hasOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function hasOwnMetadata(metadataKey, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryHasOwnMetadata(metadataKey, target, propertyKey);\r\n        }\r\n        exporter(\"hasOwnMetadata\", hasOwnMetadata);\r\n        /**\r\n         * Gets the metadata value for the provided metadata key on the target object or its prototype chain.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.getMetadata(\"custom:annotation\", Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function getMetadata(metadataKey, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryGetMetadata(metadataKey, target, propertyKey);\r\n        }\r\n        exporter(\"getMetadata\", getMetadata);\r\n        /**\r\n         * Gets the metadata value for the provided metadata key on the target object.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns The metadata value for the metadata key if found; otherwise, `undefined`.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.getOwnMetadata(\"custom:annotation\", Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function getOwnMetadata(metadataKey, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryGetOwnMetadata(metadataKey, target, propertyKey);\r\n        }\r\n        exporter(\"getOwnMetadata\", getOwnMetadata);\r\n        /**\r\n         * Gets the metadata keys defined on the target object or its prototype chain.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns An array of unique metadata keys.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.getMetadataKeys(Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.getMetadataKeys(Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.getMetadataKeys(Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.getMetadataKeys(Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function getMetadataKeys(target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryMetadataKeys(target, propertyKey);\r\n        }\r\n        exporter(\"getMetadataKeys\", getMetadataKeys);\r\n        /**\r\n         * Gets the unique metadata keys defined on the target object.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns An array of unique metadata keys.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.getOwnMetadataKeys(Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.getOwnMetadataKeys(Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.getOwnMetadataKeys(Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function getOwnMetadataKeys(target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            return OrdinaryOwnMetadataKeys(target, propertyKey);\r\n        }\r\n        exporter(\"getOwnMetadataKeys\", getOwnMetadataKeys);\r\n        /**\r\n         * Deletes the metadata entry from the target object with the provided key.\r\n         * @param metadataKey A key used to store and retrieve metadata.\r\n         * @param target The target object on which the metadata is defined.\r\n         * @param propertyKey (Optional) The property key for the target.\r\n         * @returns `true` if the metadata entry was found and deleted; otherwise, false.\r\n         * @example\r\n         *\r\n         *     class Example {\r\n         *         // property declarations are not part of ES6, though they are valid in TypeScript:\r\n         *         // static staticProperty;\r\n         *         // property;\r\n         *\r\n         *         constructor(p) { }\r\n         *         static staticMethod(p) { }\r\n         *         method(p) { }\r\n         *     }\r\n         *\r\n         *     // constructor\r\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example);\r\n         *\r\n         *     // property (on constructor)\r\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticProperty\");\r\n         *\r\n         *     // property (on prototype)\r\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"property\");\r\n         *\r\n         *     // method (on constructor)\r\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example, \"staticMethod\");\r\n         *\r\n         *     // method (on prototype)\r\n         *     result = Reflect.deleteMetadata(\"custom:annotation\", Example.prototype, \"method\");\r\n         *\r\n         */\r\n        function deleteMetadata(metadataKey, target, propertyKey) {\r\n            if (!IsObject(target))\r\n                throw new TypeError();\r\n            if (!IsUndefined(propertyKey))\r\n                propertyKey = ToPropertyKey(propertyKey);\r\n            var metadataMap = GetOrCreateMetadataMap(target, propertyKey, /*Create*/ false);\r\n            if (IsUndefined(metadataMap))\r\n                return false;\r\n            if (!metadataMap.delete(metadataKey))\r\n                return false;\r\n            if (metadataMap.size > 0)\r\n                return true;\r\n            var targetMetadata = Metadata.get(target);\r\n            targetMetadata.delete(propertyKey);\r\n            if (targetMetadata.size > 0)\r\n                return true;\r\n            Metadata.delete(target);\r\n            return true;\r\n        }\r\n        exporter(\"deleteMetadata\", deleteMetadata);\r\n        function DecorateConstructor(decorators, target) {\r\n            for (var i = decorators.length - 1; i >= 0; --i) {\r\n                var decorator = decorators[i];\r\n                var decorated = decorator(target);\r\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\r\n                    if (!IsConstructor(decorated))\r\n                        throw new TypeError();\r\n                    target = decorated;\r\n                }\r\n            }\r\n            return target;\r\n        }\r\n        function DecorateProperty(decorators, target, propertyKey, descriptor) {\r\n            for (var i = decorators.length - 1; i >= 0; --i) {\r\n                var decorator = decorators[i];\r\n                var decorated = decorator(target, propertyKey, descriptor);\r\n                if (!IsUndefined(decorated) && !IsNull(decorated)) {\r\n                    if (!IsObject(decorated))\r\n                        throw new TypeError();\r\n                    descriptor = decorated;\r\n                }\r\n            }\r\n            return descriptor;\r\n        }\r\n        function GetOrCreateMetadataMap(O, P, Create) {\r\n            var targetMetadata = Metadata.get(O);\r\n            if (IsUndefined(targetMetadata)) {\r\n                if (!Create)\r\n                    return undefined;\r\n                targetMetadata = new _Map();\r\n                Metadata.set(O, targetMetadata);\r\n            }\r\n            var metadataMap = targetMetadata.get(P);\r\n            if (IsUndefined(metadataMap)) {\r\n                if (!Create)\r\n                    return undefined;\r\n                metadataMap = new _Map();\r\n                targetMetadata.set(P, metadataMap);\r\n            }\r\n            return metadataMap;\r\n        }\r\n        // 3.1.1.1 OrdinaryHasMetadata(MetadataKey, O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasmetadata\r\n        function OrdinaryHasMetadata(MetadataKey, O, P) {\r\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\r\n            if (hasOwn)\r\n                return true;\r\n            var parent = OrdinaryGetPrototypeOf(O);\r\n            if (!IsNull(parent))\r\n                return OrdinaryHasMetadata(MetadataKey, parent, P);\r\n            return false;\r\n        }\r\n        // 3.1.2.1 OrdinaryHasOwnMetadata(MetadataKey, O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryhasownmetadata\r\n        function OrdinaryHasOwnMetadata(MetadataKey, O, P) {\r\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\r\n            if (IsUndefined(metadataMap))\r\n                return false;\r\n            return ToBoolean(metadataMap.has(MetadataKey));\r\n        }\r\n        // 3.1.3.1 OrdinaryGetMetadata(MetadataKey, O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetmetadata\r\n        function OrdinaryGetMetadata(MetadataKey, O, P) {\r\n            var hasOwn = OrdinaryHasOwnMetadata(MetadataKey, O, P);\r\n            if (hasOwn)\r\n                return OrdinaryGetOwnMetadata(MetadataKey, O, P);\r\n            var parent = OrdinaryGetPrototypeOf(O);\r\n            if (!IsNull(parent))\r\n                return OrdinaryGetMetadata(MetadataKey, parent, P);\r\n            return undefined;\r\n        }\r\n        // 3.1.4.1 OrdinaryGetOwnMetadata(MetadataKey, O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinarygetownmetadata\r\n        function OrdinaryGetOwnMetadata(MetadataKey, O, P) {\r\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\r\n            if (IsUndefined(metadataMap))\r\n                return undefined;\r\n            return metadataMap.get(MetadataKey);\r\n        }\r\n        // 3.1.5.1 OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinarydefineownmetadata\r\n        function OrdinaryDefineOwnMetadata(MetadataKey, MetadataValue, O, P) {\r\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ true);\r\n            metadataMap.set(MetadataKey, MetadataValue);\r\n        }\r\n        // 3.1.6.1 OrdinaryMetadataKeys(O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinarymetadatakeys\r\n        function OrdinaryMetadataKeys(O, P) {\r\n            var ownKeys = OrdinaryOwnMetadataKeys(O, P);\r\n            var parent = OrdinaryGetPrototypeOf(O);\r\n            if (parent === null)\r\n                return ownKeys;\r\n            var parentKeys = OrdinaryMetadataKeys(parent, P);\r\n            if (parentKeys.length <= 0)\r\n                return ownKeys;\r\n            if (ownKeys.length <= 0)\r\n                return parentKeys;\r\n            var set = new _Set();\r\n            var keys = [];\r\n            for (var _i = 0, ownKeys_1 = ownKeys; _i < ownKeys_1.length; _i++) {\r\n                var key = ownKeys_1[_i];\r\n                var hasKey = set.has(key);\r\n                if (!hasKey) {\r\n                    set.add(key);\r\n                    keys.push(key);\r\n                }\r\n            }\r\n            for (var _a = 0, parentKeys_1 = parentKeys; _a < parentKeys_1.length; _a++) {\r\n                var key = parentKeys_1[_a];\r\n                var hasKey = set.has(key);\r\n                if (!hasKey) {\r\n                    set.add(key);\r\n                    keys.push(key);\r\n                }\r\n            }\r\n            return keys;\r\n        }\r\n        // 3.1.7.1 OrdinaryOwnMetadataKeys(O, P)\r\n        // https://rbuckton.github.io/reflect-metadata/#ordinaryownmetadatakeys\r\n        function OrdinaryOwnMetadataKeys(O, P) {\r\n            var keys = [];\r\n            var metadataMap = GetOrCreateMetadataMap(O, P, /*Create*/ false);\r\n            if (IsUndefined(metadataMap))\r\n                return keys;\r\n            var keysObj = metadataMap.keys();\r\n            var iterator = GetIterator(keysObj);\r\n            var k = 0;\r\n            while (true) {\r\n                var next = IteratorStep(iterator);\r\n                if (!next) {\r\n                    keys.length = k;\r\n                    return keys;\r\n                }\r\n                var nextValue = IteratorValue(next);\r\n                try {\r\n                    keys[k] = nextValue;\r\n                }\r\n                catch (e) {\r\n                    try {\r\n                        IteratorClose(iterator);\r\n                    }\r\n                    finally {\r\n                        throw e;\r\n                    }\r\n                }\r\n                k++;\r\n            }\r\n        }\r\n        // 6 ECMAScript Data Typ0es and Values\r\n        // https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values\r\n        function Type(x) {\r\n            if (x === null)\r\n                return 1 /* Null */;\r\n            switch (typeof x) {\r\n                case \"undefined\": return 0 /* Undefined */;\r\n                case \"boolean\": return 2 /* Boolean */;\r\n                case \"string\": return 3 /* String */;\r\n                case \"symbol\": return 4 /* Symbol */;\r\n                case \"number\": return 5 /* Number */;\r\n                case \"object\": return x === null ? 1 /* Null */ : 6 /* Object */;\r\n                default: return 6 /* Object */;\r\n            }\r\n        }\r\n        // 6.1.1 The Undefined Type\r\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-undefined-type\r\n        function IsUndefined(x) {\r\n            return x === undefined;\r\n        }\r\n        // 6.1.2 The Null Type\r\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-null-type\r\n        function IsNull(x) {\r\n            return x === null;\r\n        }\r\n        // 6.1.5 The Symbol Type\r\n        // https://tc39.github.io/ecma262/#sec-ecmascript-language-types-symbol-type\r\n        function IsSymbol(x) {\r\n            return typeof x === \"symbol\";\r\n        }\r\n        // 6.1.7 The Object Type\r\n        // https://tc39.github.io/ecma262/#sec-object-type\r\n        function IsObject(x) {\r\n            return typeof x === \"object\" ? x !== null : typeof x === \"function\";\r\n        }\r\n        // 7.1 Type Conversion\r\n        // https://tc39.github.io/ecma262/#sec-type-conversion\r\n        // 7.1.1 ToPrimitive(input [, PreferredType])\r\n        // https://tc39.github.io/ecma262/#sec-toprimitive\r\n        function ToPrimitive(input, PreferredType) {\r\n            switch (Type(input)) {\r\n                case 0 /* Undefined */: return input;\r\n                case 1 /* Null */: return input;\r\n                case 2 /* Boolean */: return input;\r\n                case 3 /* String */: return input;\r\n                case 4 /* Symbol */: return input;\r\n                case 5 /* Number */: return input;\r\n            }\r\n            var hint = PreferredType === 3 /* String */ ? \"string\" : PreferredType === 5 /* Number */ ? \"number\" : \"default\";\r\n            var exoticToPrim = GetMethod(input, toPrimitiveSymbol);\r\n            if (exoticToPrim !== undefined) {\r\n                var result = exoticToPrim.call(input, hint);\r\n                if (IsObject(result))\r\n                    throw new TypeError();\r\n                return result;\r\n            }\r\n            return OrdinaryToPrimitive(input, hint === \"default\" ? \"number\" : hint);\r\n        }\r\n        // 7.1.1.1 OrdinaryToPrimitive(O, hint)\r\n        // https://tc39.github.io/ecma262/#sec-ordinarytoprimitive\r\n        function OrdinaryToPrimitive(O, hint) {\r\n            if (hint === \"string\") {\r\n                var toString_1 = O.toString;\r\n                if (IsCallable(toString_1)) {\r\n                    var result = toString_1.call(O);\r\n                    if (!IsObject(result))\r\n                        return result;\r\n                }\r\n                var valueOf = O.valueOf;\r\n                if (IsCallable(valueOf)) {\r\n                    var result = valueOf.call(O);\r\n                    if (!IsObject(result))\r\n                        return result;\r\n                }\r\n            }\r\n            else {\r\n                var valueOf = O.valueOf;\r\n                if (IsCallable(valueOf)) {\r\n                    var result = valueOf.call(O);\r\n                    if (!IsObject(result))\r\n                        return result;\r\n                }\r\n                var toString_2 = O.toString;\r\n                if (IsCallable(toString_2)) {\r\n                    var result = toString_2.call(O);\r\n                    if (!IsObject(result))\r\n                        return result;\r\n                }\r\n            }\r\n            throw new TypeError();\r\n        }\r\n        // 7.1.2 ToBoolean(argument)\r\n        // https://tc39.github.io/ecma262/2016/#sec-toboolean\r\n        function ToBoolean(argument) {\r\n            return !!argument;\r\n        }\r\n        // 7.1.12 ToString(argument)\r\n        // https://tc39.github.io/ecma262/#sec-tostring\r\n        function ToString(argument) {\r\n            return \"\" + argument;\r\n        }\r\n        // 7.1.14 ToPropertyKey(argument)\r\n        // https://tc39.github.io/ecma262/#sec-topropertykey\r\n        function ToPropertyKey(argument) {\r\n            var key = ToPrimitive(argument, 3 /* String */);\r\n            if (IsSymbol(key))\r\n                return key;\r\n            return ToString(key);\r\n        }\r\n        // 7.2 Testing and Comparison Operations\r\n        // https://tc39.github.io/ecma262/#sec-testing-and-comparison-operations\r\n        // 7.2.2 IsArray(argument)\r\n        // https://tc39.github.io/ecma262/#sec-isarray\r\n        function IsArray(argument) {\r\n            return Array.isArray\r\n                ? Array.isArray(argument)\r\n                : argument instanceof Object\r\n                    ? argument instanceof Array\r\n                    : Object.prototype.toString.call(argument) === \"[object Array]\";\r\n        }\r\n        // 7.2.3 IsCallable(argument)\r\n        // https://tc39.github.io/ecma262/#sec-iscallable\r\n        function IsCallable(argument) {\r\n            // NOTE: This is an approximation as we cannot check for [[Call]] internal method.\r\n            return typeof argument === \"function\";\r\n        }\r\n        // 7.2.4 IsConstructor(argument)\r\n        // https://tc39.github.io/ecma262/#sec-isconstructor\r\n        function IsConstructor(argument) {\r\n            // NOTE: This is an approximation as we cannot check for [[Construct]] internal method.\r\n            return typeof argument === \"function\";\r\n        }\r\n        // 7.2.7 IsPropertyKey(argument)\r\n        // https://tc39.github.io/ecma262/#sec-ispropertykey\r\n        function IsPropertyKey(argument) {\r\n            switch (Type(argument)) {\r\n                case 3 /* String */: return true;\r\n                case 4 /* Symbol */: return true;\r\n                default: return false;\r\n            }\r\n        }\r\n        // 7.3 Operations on Objects\r\n        // https://tc39.github.io/ecma262/#sec-operations-on-objects\r\n        // 7.3.9 GetMethod(V, P)\r\n        // https://tc39.github.io/ecma262/#sec-getmethod\r\n        function GetMethod(V, P) {\r\n            var func = V[P];\r\n            if (func === undefined || func === null)\r\n                return undefined;\r\n            if (!IsCallable(func))\r\n                throw new TypeError();\r\n            return func;\r\n        }\r\n        // 7.4 Operations on Iterator Objects\r\n        // https://tc39.github.io/ecma262/#sec-operations-on-iterator-objects\r\n        function GetIterator(obj) {\r\n            var method = GetMethod(obj, iteratorSymbol);\r\n            if (!IsCallable(method))\r\n                throw new TypeError(); // from Call\r\n            var iterator = method.call(obj);\r\n            if (!IsObject(iterator))\r\n                throw new TypeError();\r\n            return iterator;\r\n        }\r\n        // 7.4.4 IteratorValue(iterResult)\r\n        // https://tc39.github.io/ecma262/2016/#sec-iteratorvalue\r\n        function IteratorValue(iterResult) {\r\n            return iterResult.value;\r\n        }\r\n        // 7.4.5 IteratorStep(iterator)\r\n        // https://tc39.github.io/ecma262/#sec-iteratorstep\r\n        function IteratorStep(iterator) {\r\n            var result = iterator.next();\r\n            return result.done ? false : result;\r\n        }\r\n        // 7.4.6 IteratorClose(iterator, completion)\r\n        // https://tc39.github.io/ecma262/#sec-iteratorclose\r\n        function IteratorClose(iterator) {\r\n            var f = iterator[\"return\"];\r\n            if (f)\r\n                f.call(iterator);\r\n        }\r\n        // 9.1 Ordinary Object Internal Methods and Internal Slots\r\n        // https://tc39.github.io/ecma262/#sec-ordinary-object-internal-methods-and-internal-slots\r\n        // 9.1.1.1 OrdinaryGetPrototypeOf(O)\r\n        // https://tc39.github.io/ecma262/#sec-ordinarygetprototypeof\r\n        function OrdinaryGetPrototypeOf(O) {\r\n            var proto = Object.getPrototypeOf(O);\r\n            if (typeof O !== \"function\" || O === functionPrototype)\r\n                return proto;\r\n            // TypeScript doesn't set __proto__ in ES5, as it's non-standard.\r\n            // Try to determine the superclass constructor. Compatible implementations\r\n            // must either set __proto__ on a subclass constructor to the superclass constructor,\r\n            // or ensure each class has a valid `constructor` property on its prototype that\r\n            // points back to the constructor.\r\n            // If this is not the same as Function.[[Prototype]], then this is definately inherited.\r\n            // This is the case when in ES6 or when using __proto__ in a compatible browser.\r\n            if (proto !== functionPrototype)\r\n                return proto;\r\n            // If the super prototype is Object.prototype, null, or undefined, then we cannot determine the heritage.\r\n            var prototype = O.prototype;\r\n            var prototypeProto = prototype && Object.getPrototypeOf(prototype);\r\n            if (prototypeProto == null || prototypeProto === Object.prototype)\r\n                return proto;\r\n            // If the constructor was not a function, then we cannot determine the heritage.\r\n            var constructor = prototypeProto.constructor;\r\n            if (typeof constructor !== \"function\")\r\n                return proto;\r\n            // If we have some kind of self-reference, then we cannot determine the heritage.\r\n            if (constructor === O)\r\n                return proto;\r\n            // we have a pretty good guess at the heritage.\r\n            return constructor;\r\n        }\r\n        // naive Map shim\r\n        function CreateMapPolyfill() {\r\n            var cacheSentinel = {};\r\n            var arraySentinel = [];\r\n            var MapIterator = /** @class */ (function () {\r\n                function MapIterator(keys, values, selector) {\r\n                    this._index = 0;\r\n                    this._keys = keys;\r\n                    this._values = values;\r\n                    this._selector = selector;\r\n                }\r\n                MapIterator.prototype[\"@@iterator\"] = function () { return this; };\r\n                MapIterator.prototype[iteratorSymbol] = function () { return this; };\r\n                MapIterator.prototype.next = function () {\r\n                    var index = this._index;\r\n                    if (index >= 0 && index < this._keys.length) {\r\n                        var result = this._selector(this._keys[index], this._values[index]);\r\n                        if (index + 1 >= this._keys.length) {\r\n                            this._index = -1;\r\n                            this._keys = arraySentinel;\r\n                            this._values = arraySentinel;\r\n                        }\r\n                        else {\r\n                            this._index++;\r\n                        }\r\n                        return { value: result, done: false };\r\n                    }\r\n                    return { value: undefined, done: true };\r\n                };\r\n                MapIterator.prototype.throw = function (error) {\r\n                    if (this._index >= 0) {\r\n                        this._index = -1;\r\n                        this._keys = arraySentinel;\r\n                        this._values = arraySentinel;\r\n                    }\r\n                    throw error;\r\n                };\r\n                MapIterator.prototype.return = function (value) {\r\n                    if (this._index >= 0) {\r\n                        this._index = -1;\r\n                        this._keys = arraySentinel;\r\n                        this._values = arraySentinel;\r\n                    }\r\n                    return { value: value, done: true };\r\n                };\r\n                return MapIterator;\r\n            }());\r\n            return /** @class */ (function () {\r\n                function Map() {\r\n                    this._keys = [];\r\n                    this._values = [];\r\n                    this._cacheKey = cacheSentinel;\r\n                    this._cacheIndex = -2;\r\n                }\r\n                Object.defineProperty(Map.prototype, \"size\", {\r\n                    get: function () { return this._keys.length; },\r\n                    enumerable: true,\r\n                    configurable: true\r\n                });\r\n                Map.prototype.has = function (key) { return this._find(key, /*insert*/ false) >= 0; };\r\n                Map.prototype.get = function (key) {\r\n                    var index = this._find(key, /*insert*/ false);\r\n                    return index >= 0 ? this._values[index] : undefined;\r\n                };\r\n                Map.prototype.set = function (key, value) {\r\n                    var index = this._find(key, /*insert*/ true);\r\n                    this._values[index] = value;\r\n                    return this;\r\n                };\r\n                Map.prototype.delete = function (key) {\r\n                    var index = this._find(key, /*insert*/ false);\r\n                    if (index >= 0) {\r\n                        var size = this._keys.length;\r\n                        for (var i = index + 1; i < size; i++) {\r\n                            this._keys[i - 1] = this._keys[i];\r\n                            this._values[i - 1] = this._values[i];\r\n                        }\r\n                        this._keys.length--;\r\n                        this._values.length--;\r\n                        if (key === this._cacheKey) {\r\n                            this._cacheKey = cacheSentinel;\r\n                            this._cacheIndex = -2;\r\n                        }\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                };\r\n                Map.prototype.clear = function () {\r\n                    this._keys.length = 0;\r\n                    this._values.length = 0;\r\n                    this._cacheKey = cacheSentinel;\r\n                    this._cacheIndex = -2;\r\n                };\r\n                Map.prototype.keys = function () { return new MapIterator(this._keys, this._values, getKey); };\r\n                Map.prototype.values = function () { return new MapIterator(this._keys, this._values, getValue); };\r\n                Map.prototype.entries = function () { return new MapIterator(this._keys, this._values, getEntry); };\r\n                Map.prototype[\"@@iterator\"] = function () { return this.entries(); };\r\n                Map.prototype[iteratorSymbol] = function () { return this.entries(); };\r\n                Map.prototype._find = function (key, insert) {\r\n                    if (this._cacheKey !== key) {\r\n                        this._cacheIndex = this._keys.indexOf(this._cacheKey = key);\r\n                    }\r\n                    if (this._cacheIndex < 0 && insert) {\r\n                        this._cacheIndex = this._keys.length;\r\n                        this._keys.push(key);\r\n                        this._values.push(undefined);\r\n                    }\r\n                    return this._cacheIndex;\r\n                };\r\n                return Map;\r\n            }());\r\n            function getKey(key, _) {\r\n                return key;\r\n            }\r\n            function getValue(_, value) {\r\n                return value;\r\n            }\r\n            function getEntry(key, value) {\r\n                return [key, value];\r\n            }\r\n        }\r\n        // naive Set shim\r\n        function CreateSetPolyfill() {\r\n            return /** @class */ (function () {\r\n                function Set() {\r\n                    this._map = new _Map();\r\n                }\r\n                Object.defineProperty(Set.prototype, \"size\", {\r\n                    get: function () { return this._map.size; },\r\n                    enumerable: true,\r\n                    configurable: true\r\n                });\r\n                Set.prototype.has = function (value) { return this._map.has(value); };\r\n                Set.prototype.add = function (value) { return this._map.set(value, value), this; };\r\n                Set.prototype.delete = function (value) { return this._map.delete(value); };\r\n                Set.prototype.clear = function () { this._map.clear(); };\r\n                Set.prototype.keys = function () { return this._map.keys(); };\r\n                Set.prototype.values = function () { return this._map.values(); };\r\n                Set.prototype.entries = function () { return this._map.entries(); };\r\n                Set.prototype[\"@@iterator\"] = function () { return this.keys(); };\r\n                Set.prototype[iteratorSymbol] = function () { return this.keys(); };\r\n                return Set;\r\n            }());\r\n        }\r\n        // naive WeakMap shim\r\n        function CreateWeakMapPolyfill() {\r\n            var UUID_SIZE = 16;\r\n            var keys = HashMap.create();\r\n            var rootKey = CreateUniqueKey();\r\n            return /** @class */ (function () {\r\n                function WeakMap() {\r\n                    this._key = CreateUniqueKey();\r\n                }\r\n                WeakMap.prototype.has = function (target) {\r\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\r\n                    return table !== undefined ? HashMap.has(table, this._key) : false;\r\n                };\r\n                WeakMap.prototype.get = function (target) {\r\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\r\n                    return table !== undefined ? HashMap.get(table, this._key) : undefined;\r\n                };\r\n                WeakMap.prototype.set = function (target, value) {\r\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ true);\r\n                    table[this._key] = value;\r\n                    return this;\r\n                };\r\n                WeakMap.prototype.delete = function (target) {\r\n                    var table = GetOrCreateWeakMapTable(target, /*create*/ false);\r\n                    return table !== undefined ? delete table[this._key] : false;\r\n                };\r\n                WeakMap.prototype.clear = function () {\r\n                    // NOTE: not a real clear, just makes the previous data unreachable\r\n                    this._key = CreateUniqueKey();\r\n                };\r\n                return WeakMap;\r\n            }());\r\n            function CreateUniqueKey() {\r\n                var key;\r\n                do\r\n                    key = \"@@WeakMap@@\" + CreateUUID();\r\n                while (HashMap.has(keys, key));\r\n                keys[key] = true;\r\n                return key;\r\n            }\r\n            function GetOrCreateWeakMapTable(target, create) {\r\n                if (!hasOwn.call(target, rootKey)) {\r\n                    if (!create)\r\n                        return undefined;\r\n                    Object.defineProperty(target, rootKey, { value: HashMap.create() });\r\n                }\r\n                return target[rootKey];\r\n            }\r\n            function FillRandomBytes(buffer, size) {\r\n                for (var i = 0; i < size; ++i)\r\n                    buffer[i] = Math.random() * 0xff | 0;\r\n                return buffer;\r\n            }\r\n            function GenRandomBytes(size) {\r\n                if (typeof Uint8Array === \"function\") {\r\n                    if (typeof crypto !== \"undefined\")\r\n                        return crypto.getRandomValues(new Uint8Array(size));\r\n                    if (typeof msCrypto !== \"undefined\")\r\n                        return msCrypto.getRandomValues(new Uint8Array(size));\r\n                    return FillRandomBytes(new Uint8Array(size), size);\r\n                }\r\n                return FillRandomBytes(new Array(size), size);\r\n            }\r\n            function CreateUUID() {\r\n                var data = GenRandomBytes(UUID_SIZE);\r\n                // mark as random - RFC 4122 \u00A7 4.4\r\n                data[6] = data[6] & 0x4f | 0x40;\r\n                data[8] = data[8] & 0xbf | 0x80;\r\n                var result = \"\";\r\n                for (var offset = 0; offset < UUID_SIZE; ++offset) {\r\n                    var byte = data[offset];\r\n                    if (offset === 4 || offset === 6 || offset === 8)\r\n                        result += \"-\";\r\n                    if (byte < 16)\r\n                        result += \"0\";\r\n                    result += byte.toString(16).toLowerCase();\r\n                }\r\n                return result;\r\n            }\r\n        }\r\n        // uses a heuristic used by v8 and chakra to force an object into dictionary mode.\r\n        function MakeDictionary(obj) {\r\n            obj.__ = undefined;\r\n            delete obj.__;\r\n            return obj;\r\n        }\r\n    });\r\n})(Reflect || (Reflect = {}));\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action } from 'sprotty-protocol/lib/actions';\r\n\r\n/**\r\n * A list of actions with a label.\r\n * Labeled actions are used to denote a group of actions in a user-interface context, e.g.,\r\n * to define an entry in the command palette or in the context menu.\r\n */\r\nexport class LabeledAction {\r\n    constructor(readonly label: string, readonly actions: Action[], readonly icon?: string) { }\r\n}\r\n\r\nexport function isLabeledAction(element: unknown): element is LabeledAction {\r\n    return element !== undefined\r\n        && (<LabeledAction>element).label !== undefined\r\n        && (<LabeledAction>element).actions !== undefined;\r\n}\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.NON_CUSTOM_TAG_KEYS = exports.PRE_DESTROY = exports.POST_CONSTRUCT = exports.DESIGN_PARAM_TYPES = exports.PARAM_TYPES = exports.TAGGED_PROP = exports.TAGGED = exports.MULTI_INJECT_TAG = exports.INJECT_TAG = exports.OPTIONAL_TAG = exports.UNMANAGED_TAG = exports.NAME_TAG = exports.NAMED_TAG = void 0;\r\nexports.NAMED_TAG = 'named';\r\nexports.NAME_TAG = 'name';\r\nexports.UNMANAGED_TAG = 'unmanaged';\r\nexports.OPTIONAL_TAG = 'optional';\r\nexports.INJECT_TAG = 'inject';\r\nexports.MULTI_INJECT_TAG = 'multi_inject';\r\nexports.TAGGED = 'inversify:tagged';\r\nexports.TAGGED_PROP = 'inversify:tagged_props';\r\nexports.PARAM_TYPES = 'inversify:paramtypes';\r\nexports.DESIGN_PARAM_TYPES = 'design:paramtypes';\r\nexports.POST_CONSTRUCT = 'post_construct';\r\nexports.PRE_DESTROY = 'pre_destroy';\r\nfunction getNonCustomTagKeys() {\r\n    return [\r\n        exports.INJECT_TAG,\r\n        exports.MULTI_INJECT_TAG,\r\n        exports.NAME_TAG,\r\n        exports.UNMANAGED_TAG,\r\n        exports.NAMED_TAG,\r\n        exports.OPTIONAL_TAG,\r\n    ];\r\n}\r\nexports.NON_CUSTOM_TAG_KEYS = getNonCustomTagKeys();\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.TargetTypeEnum = exports.BindingTypeEnum = exports.BindingScopeEnum = void 0;\r\nvar BindingScopeEnum = {\r\n    Request: 'Request',\r\n    Singleton: 'Singleton',\r\n    Transient: 'Transient'\r\n};\r\nexports.BindingScopeEnum = BindingScopeEnum;\r\nvar BindingTypeEnum = {\r\n    ConstantValue: 'ConstantValue',\r\n    Constructor: 'Constructor',\r\n    DynamicValue: 'DynamicValue',\r\n    Factory: 'Factory',\r\n    Function: 'Function',\r\n    Instance: 'Instance',\r\n    Invalid: 'Invalid',\r\n    Provider: 'Provider'\r\n};\r\nexports.BindingTypeEnum = BindingTypeEnum;\r\nvar TargetTypeEnum = {\r\n    ClassProperty: 'ClassProperty',\r\n    ConstructorArgument: 'ConstructorArgument',\r\n    Variable: 'Variable'\r\n};\r\nexports.TargetTypeEnum = TargetTypeEnum;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.id = void 0;\r\nvar idCounter = 0;\r\nfunction id() {\r\n    return idCounter++;\r\n}\r\nexports.id = id;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Binding = void 0;\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar id_1 = require(\"../utils/id\");\r\nvar Binding = (function () {\r\n    function Binding(serviceIdentifier, scope) {\r\n        this.id = (0, id_1.id)();\r\n        this.activated = false;\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        this.scope = scope;\r\n        this.type = literal_types_1.BindingTypeEnum.Invalid;\r\n        this.constraint = function (request) { return true; };\r\n        this.implementationType = null;\r\n        this.cache = null;\r\n        this.factory = null;\r\n        this.provider = null;\r\n        this.onActivation = null;\r\n        this.onDeactivation = null;\r\n        this.dynamicValue = null;\r\n    }\r\n    Binding.prototype.clone = function () {\r\n        var clone = new Binding(this.serviceIdentifier, this.scope);\r\n        clone.activated = (clone.scope === literal_types_1.BindingScopeEnum.Singleton) ? this.activated : false;\r\n        clone.implementationType = this.implementationType;\r\n        clone.dynamicValue = this.dynamicValue;\r\n        clone.scope = this.scope;\r\n        clone.type = this.type;\r\n        clone.factory = this.factory;\r\n        clone.provider = this.provider;\r\n        clone.constraint = this.constraint;\r\n        clone.onActivation = this.onActivation;\r\n        clone.onDeactivation = this.onDeactivation;\r\n        clone.cache = this.cache;\r\n        return clone;\r\n    };\r\n    return Binding;\r\n}());\r\nexports.Binding = Binding;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.STACK_OVERFLOW = exports.CIRCULAR_DEPENDENCY_IN_FACTORY = exports.ON_DEACTIVATION_ERROR = exports.PRE_DESTROY_ERROR = exports.POST_CONSTRUCT_ERROR = exports.ASYNC_UNBIND_REQUIRED = exports.MULTIPLE_POST_CONSTRUCT_METHODS = exports.MULTIPLE_PRE_DESTROY_METHODS = exports.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK = exports.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE = exports.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE = exports.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT = exports.ARGUMENTS_LENGTH_MISMATCH = exports.INVALID_DECORATOR_OPERATION = exports.INVALID_TO_SELF_VALUE = exports.LAZY_IN_SYNC = exports.INVALID_FUNCTION_BINDING = exports.INVALID_MIDDLEWARE_RETURN = exports.NO_MORE_SNAPSHOTS_AVAILABLE = exports.INVALID_BINDING_TYPE = exports.NOT_IMPLEMENTED = exports.CIRCULAR_DEPENDENCY = exports.UNDEFINED_INJECT_ANNOTATION = exports.MISSING_INJECT_ANNOTATION = exports.MISSING_INJECTABLE_ANNOTATION = exports.NOT_REGISTERED = exports.CANNOT_UNBIND = exports.AMBIGUOUS_MATCH = exports.KEY_NOT_FOUND = exports.NULL_ARGUMENT = exports.DUPLICATED_METADATA = exports.DUPLICATED_INJECTABLE_DECORATOR = void 0;\r\nexports.DUPLICATED_INJECTABLE_DECORATOR = 'Cannot apply @injectable decorator multiple times.';\r\nexports.DUPLICATED_METADATA = 'Metadata key was used more than once in a parameter:';\r\nexports.NULL_ARGUMENT = 'NULL argument';\r\nexports.KEY_NOT_FOUND = 'Key Not Found';\r\nexports.AMBIGUOUS_MATCH = 'Ambiguous match found for serviceIdentifier:';\r\nexports.CANNOT_UNBIND = 'Could not unbind serviceIdentifier:';\r\nexports.NOT_REGISTERED = 'No matching bindings found for serviceIdentifier:';\r\nexports.MISSING_INJECTABLE_ANNOTATION = 'Missing required @injectable annotation in:';\r\nexports.MISSING_INJECT_ANNOTATION = 'Missing required @inject or @multiInject annotation in:';\r\nvar UNDEFINED_INJECT_ANNOTATION = function (name) {\r\n    return \"@inject called with undefined this could mean that the class \" + name + \" has \" +\r\n        'a circular dependency problem. You can use a LazyServiceIdentifier to  ' +\r\n        'overcome this limitation.';\r\n};\r\nexports.UNDEFINED_INJECT_ANNOTATION = UNDEFINED_INJECT_ANNOTATION;\r\nexports.CIRCULAR_DEPENDENCY = 'Circular dependency found:';\r\nexports.NOT_IMPLEMENTED = 'Sorry, this feature is not fully implemented yet.';\r\nexports.INVALID_BINDING_TYPE = 'Invalid binding type:';\r\nexports.NO_MORE_SNAPSHOTS_AVAILABLE = 'No snapshot available to restore.';\r\nexports.INVALID_MIDDLEWARE_RETURN = 'Invalid return type in middleware. Middleware must return!';\r\nexports.INVALID_FUNCTION_BINDING = 'Value provided to function binding must be a function!';\r\nvar LAZY_IN_SYNC = function (key) { return \"You are attempting to construct '\" + key + \"' in a synchronous way\\n but it has asynchronous dependencies.\"; };\r\nexports.LAZY_IN_SYNC = LAZY_IN_SYNC;\r\nexports.INVALID_TO_SELF_VALUE = 'The toSelf function can only be applied when a constructor is ' +\r\n    'used as service identifier';\r\nexports.INVALID_DECORATOR_OPERATION = 'The @inject @multiInject @tagged and @named decorators ' +\r\n    'must be applied to the parameters of a class constructor or a class property.';\r\nvar ARGUMENTS_LENGTH_MISMATCH = function () {\r\n    var values = [];\r\n    for (var _i = 0; _i < arguments.length; _i++) {\r\n        values[_i] = arguments[_i];\r\n    }\r\n    return 'The number of constructor arguments in the derived class ' +\r\n        (values[0] + \" must be >= than the number of constructor arguments of its base class.\");\r\n};\r\nexports.ARGUMENTS_LENGTH_MISMATCH = ARGUMENTS_LENGTH_MISMATCH;\r\nexports.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT = 'Invalid Container constructor argument. Container options ' +\r\n    'must be an object.';\r\nexports.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE = 'Invalid Container option. Default scope must ' +\r\n    'be a string (\"singleton\" or \"transient\").';\r\nexports.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE = 'Invalid Container option. Auto bind injectable must ' +\r\n    'be a boolean';\r\nexports.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK = 'Invalid Container option. Skip base check must ' +\r\n    'be a boolean';\r\nexports.MULTIPLE_PRE_DESTROY_METHODS = 'Cannot apply @preDestroy decorator multiple times in the same class';\r\nexports.MULTIPLE_POST_CONSTRUCT_METHODS = 'Cannot apply @postConstruct decorator multiple times in the same class';\r\nexports.ASYNC_UNBIND_REQUIRED = 'Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)';\r\nvar POST_CONSTRUCT_ERROR = function (clazz, errorMessage) { return \"@postConstruct error in class \" + clazz + \": \" + errorMessage; };\r\nexports.POST_CONSTRUCT_ERROR = POST_CONSTRUCT_ERROR;\r\nvar PRE_DESTROY_ERROR = function (clazz, errorMessage) { return \"@preDestroy error in class \" + clazz + \": \" + errorMessage; };\r\nexports.PRE_DESTROY_ERROR = PRE_DESTROY_ERROR;\r\nvar ON_DEACTIVATION_ERROR = function (clazz, errorMessage) { return \"onDeactivation() error in class \" + clazz + \": \" + errorMessage; };\r\nexports.ON_DEACTIVATION_ERROR = ON_DEACTIVATION_ERROR;\r\nvar CIRCULAR_DEPENDENCY_IN_FACTORY = function (factoryType, serviceIdentifier) {\r\n    return \"It looks like there is a circular dependency in one of the '\" + factoryType + \"' bindings. Please investigate bindings with \" +\r\n        (\"service identifier '\" + serviceIdentifier + \"'.\");\r\n};\r\nexports.CIRCULAR_DEPENDENCY_IN_FACTORY = CIRCULAR_DEPENDENCY_IN_FACTORY;\r\nexports.STACK_OVERFLOW = 'Maximum call stack size exceeded';\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.MetadataReader = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar MetadataReader = (function () {\r\n    function MetadataReader() {\r\n    }\r\n    MetadataReader.prototype.getConstructorMetadata = function (constructorFunc) {\r\n        var compilerGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.PARAM_TYPES, constructorFunc);\r\n        var userGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.TAGGED, constructorFunc);\r\n        return {\r\n            compilerGeneratedMetadata: compilerGeneratedMetadata,\r\n            userGeneratedMetadata: userGeneratedMetadata || {}\r\n        };\r\n    };\r\n    MetadataReader.prototype.getPropertiesMetadata = function (constructorFunc) {\r\n        var userGeneratedMetadata = Reflect.getMetadata(METADATA_KEY.TAGGED_PROP, constructorFunc) || [];\r\n        return userGeneratedMetadata;\r\n    };\r\n    return MetadataReader;\r\n}());\r\nexports.MetadataReader = MetadataReader;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingCount = void 0;\r\nexports.BindingCount = {\r\n    MultipleBindingsAvailable: 2,\r\n    NoBindingsAvailable: 0,\r\n    OnlyOneBindingAvailable: 1\r\n};\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.tryAndThrowErrorIfStackOverflow = exports.isStackOverflowExeption = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nfunction isStackOverflowExeption(error) {\r\n    return (error instanceof RangeError ||\r\n        error.message === ERROR_MSGS.STACK_OVERFLOW);\r\n}\r\nexports.isStackOverflowExeption = isStackOverflowExeption;\r\nvar tryAndThrowErrorIfStackOverflow = function (fn, errorCallback) {\r\n    try {\r\n        return fn();\r\n    }\r\n    catch (error) {\r\n        if (isStackOverflowExeption(error)) {\r\n            error = errorCallback();\r\n        }\r\n        throw error;\r\n    }\r\n};\r\nexports.tryAndThrowErrorIfStackOverflow = tryAndThrowErrorIfStackOverflow;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getSymbolDescription = exports.circularDependencyToException = exports.listMetadataForTarget = exports.listRegisteredBindingsForServiceIdentifier = exports.getServiceIdentifierAsString = exports.getFunctionName = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nfunction getServiceIdentifierAsString(serviceIdentifier) {\r\n    if (typeof serviceIdentifier === 'function') {\r\n        var _serviceIdentifier = serviceIdentifier;\r\n        return _serviceIdentifier.name;\r\n    }\r\n    else if (typeof serviceIdentifier === 'symbol') {\r\n        return serviceIdentifier.toString();\r\n    }\r\n    else {\r\n        var _serviceIdentifier = serviceIdentifier;\r\n        return _serviceIdentifier;\r\n    }\r\n}\r\nexports.getServiceIdentifierAsString = getServiceIdentifierAsString;\r\nfunction listRegisteredBindingsForServiceIdentifier(container, serviceIdentifier, getBindings) {\r\n    var registeredBindingsList = '';\r\n    var registeredBindings = getBindings(container, serviceIdentifier);\r\n    if (registeredBindings.length !== 0) {\r\n        registeredBindingsList = '\\nRegistered bindings:';\r\n        registeredBindings.forEach(function (binding) {\r\n            var name = 'Object';\r\n            if (binding.implementationType !== null) {\r\n                name = getFunctionName(binding.implementationType);\r\n            }\r\n            registeredBindingsList = registeredBindingsList + \"\\n \" + name;\r\n            if (binding.constraint.metaData) {\r\n                registeredBindingsList = registeredBindingsList + \" - \" + binding.constraint.metaData;\r\n            }\r\n        });\r\n    }\r\n    return registeredBindingsList;\r\n}\r\nexports.listRegisteredBindingsForServiceIdentifier = listRegisteredBindingsForServiceIdentifier;\r\nfunction alreadyDependencyChain(request, serviceIdentifier) {\r\n    if (request.parentRequest === null) {\r\n        return false;\r\n    }\r\n    else if (request.parentRequest.serviceIdentifier === serviceIdentifier) {\r\n        return true;\r\n    }\r\n    else {\r\n        return alreadyDependencyChain(request.parentRequest, serviceIdentifier);\r\n    }\r\n}\r\nfunction dependencyChainToString(request) {\r\n    function _createStringArr(req, result) {\r\n        if (result === void 0) { result = []; }\r\n        var serviceIdentifier = getServiceIdentifierAsString(req.serviceIdentifier);\r\n        result.push(serviceIdentifier);\r\n        if (req.parentRequest !== null) {\r\n            return _createStringArr(req.parentRequest, result);\r\n        }\r\n        return result;\r\n    }\r\n    var stringArr = _createStringArr(request);\r\n    return stringArr.reverse().join(' --> ');\r\n}\r\nfunction circularDependencyToException(request) {\r\n    request.childRequests.forEach(function (childRequest) {\r\n        if (alreadyDependencyChain(childRequest, childRequest.serviceIdentifier)) {\r\n            var services = dependencyChainToString(childRequest);\r\n            throw new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY + \" \" + services);\r\n        }\r\n        else {\r\n            circularDependencyToException(childRequest);\r\n        }\r\n    });\r\n}\r\nexports.circularDependencyToException = circularDependencyToException;\r\nfunction listMetadataForTarget(serviceIdentifierString, target) {\r\n    if (target.isTagged() || target.isNamed()) {\r\n        var m_1 = '';\r\n        var namedTag = target.getNamedTag();\r\n        var otherTags = target.getCustomTags();\r\n        if (namedTag !== null) {\r\n            m_1 += namedTag.toString() + '\\n';\r\n        }\r\n        if (otherTags !== null) {\r\n            otherTags.forEach(function (tag) {\r\n                m_1 += tag.toString() + '\\n';\r\n            });\r\n        }\r\n        return \" \" + serviceIdentifierString + \"\\n \" + serviceIdentifierString + \" - \" + m_1;\r\n    }\r\n    else {\r\n        return \" \" + serviceIdentifierString;\r\n    }\r\n}\r\nexports.listMetadataForTarget = listMetadataForTarget;\r\nfunction getFunctionName(func) {\r\n    if (func.name) {\r\n        return func.name;\r\n    }\r\n    else {\r\n        var name_1 = func.toString();\r\n        var match = name_1.match(/^function\\s*([^\\s(]+)/);\r\n        return match ? match[1] : \"Anonymous function: \" + name_1;\r\n    }\r\n}\r\nexports.getFunctionName = getFunctionName;\r\nfunction getSymbolDescription(symbol) {\r\n    return symbol.toString().slice(7, -1);\r\n}\r\nexports.getSymbolDescription = getSymbolDescription;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Context = void 0;\r\nvar id_1 = require(\"../utils/id\");\r\nvar Context = (function () {\r\n    function Context(container) {\r\n        this.id = (0, id_1.id)();\r\n        this.container = container;\r\n    }\r\n    Context.prototype.addPlan = function (plan) {\r\n        this.plan = plan;\r\n    };\r\n    Context.prototype.setCurrentRequest = function (currentRequest) {\r\n        this.currentRequest = currentRequest;\r\n    };\r\n    return Context;\r\n}());\r\nexports.Context = Context;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Metadata = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar Metadata = (function () {\r\n    function Metadata(key, value) {\r\n        this.key = key;\r\n        this.value = value;\r\n    }\r\n    Metadata.prototype.toString = function () {\r\n        if (this.key === METADATA_KEY.NAMED_TAG) {\r\n            return \"named: \" + String(this.value).toString() + \" \";\r\n        }\r\n        else {\r\n            return \"tagged: { key:\" + this.key.toString() + \", value: \" + String(this.value) + \" }\";\r\n        }\r\n    };\r\n    return Metadata;\r\n}());\r\nexports.Metadata = Metadata;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Plan = void 0;\r\nvar Plan = (function () {\r\n    function Plan(parentContext, rootRequest) {\r\n        this.parentContext = parentContext;\r\n        this.rootRequest = rootRequest;\r\n    }\r\n    return Plan;\r\n}());\r\nexports.Plan = Plan;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.LazyServiceIdentifier = void 0;\r\nvar LazyServiceIdentifier = (function () {\r\n    function LazyServiceIdentifier(cb) {\r\n        this._cb = cb;\r\n    }\r\n    LazyServiceIdentifier.prototype.unwrap = function () {\r\n        return this._cb();\r\n    };\r\n    return LazyServiceIdentifier;\r\n}());\r\nexports.LazyServiceIdentifier = LazyServiceIdentifier;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.QueryableString = void 0;\r\nvar QueryableString = (function () {\r\n    function QueryableString(str) {\r\n        this.str = str;\r\n    }\r\n    QueryableString.prototype.startsWith = function (searchString) {\r\n        return this.str.indexOf(searchString) === 0;\r\n    };\r\n    QueryableString.prototype.endsWith = function (searchString) {\r\n        var reverseString = '';\r\n        var reverseSearchString = searchString.split('').reverse().join('');\r\n        reverseString = this.str.split('').reverse().join('');\r\n        return this.startsWith.call({ str: reverseString }, reverseSearchString);\r\n    };\r\n    QueryableString.prototype.contains = function (searchString) {\r\n        return (this.str.indexOf(searchString) !== -1);\r\n    };\r\n    QueryableString.prototype.equals = function (compareString) {\r\n        return this.str === compareString;\r\n    };\r\n    QueryableString.prototype.value = function () {\r\n        return this.str;\r\n    };\r\n    return QueryableString;\r\n}());\r\nexports.QueryableString = QueryableString;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Target = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar id_1 = require(\"../utils/id\");\r\nvar serialization_1 = require(\"../utils/serialization\");\r\nvar metadata_1 = require(\"./metadata\");\r\nvar queryable_string_1 = require(\"./queryable_string\");\r\nvar Target = (function () {\r\n    function Target(type, identifier, serviceIdentifier, namedOrTagged) {\r\n        this.id = (0, id_1.id)();\r\n        this.type = type;\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        var queryableName = typeof identifier === 'symbol' ? (0, serialization_1.getSymbolDescription)(identifier) : identifier;\r\n        this.name = new queryable_string_1.QueryableString(queryableName || '');\r\n        this.identifier = identifier;\r\n        this.metadata = new Array();\r\n        var metadataItem = null;\r\n        if (typeof namedOrTagged === 'string') {\r\n            metadataItem = new metadata_1.Metadata(METADATA_KEY.NAMED_TAG, namedOrTagged);\r\n        }\r\n        else if (namedOrTagged instanceof metadata_1.Metadata) {\r\n            metadataItem = namedOrTagged;\r\n        }\r\n        if (metadataItem !== null) {\r\n            this.metadata.push(metadataItem);\r\n        }\r\n    }\r\n    Target.prototype.hasTag = function (key) {\r\n        for (var _i = 0, _a = this.metadata; _i < _a.length; _i++) {\r\n            var m = _a[_i];\r\n            if (m.key === key) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    Target.prototype.isArray = function () {\r\n        return this.hasTag(METADATA_KEY.MULTI_INJECT_TAG);\r\n    };\r\n    Target.prototype.matchesArray = function (name) {\r\n        return this.matchesTag(METADATA_KEY.MULTI_INJECT_TAG)(name);\r\n    };\r\n    Target.prototype.isNamed = function () {\r\n        return this.hasTag(METADATA_KEY.NAMED_TAG);\r\n    };\r\n    Target.prototype.isTagged = function () {\r\n        return this.metadata.some(function (metadata) { return METADATA_KEY.NON_CUSTOM_TAG_KEYS.every(function (key) { return metadata.key !== key; }); });\r\n    };\r\n    Target.prototype.isOptional = function () {\r\n        return this.matchesTag(METADATA_KEY.OPTIONAL_TAG)(true);\r\n    };\r\n    Target.prototype.getNamedTag = function () {\r\n        if (this.isNamed()) {\r\n            return this.metadata.filter(function (m) { return m.key === METADATA_KEY.NAMED_TAG; })[0];\r\n        }\r\n        return null;\r\n    };\r\n    Target.prototype.getCustomTags = function () {\r\n        if (this.isTagged()) {\r\n            return this.metadata.filter(function (metadata) { return METADATA_KEY.NON_CUSTOM_TAG_KEYS.every(function (key) { return metadata.key !== key; }); });\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n    Target.prototype.matchesNamedTag = function (name) {\r\n        return this.matchesTag(METADATA_KEY.NAMED_TAG)(name);\r\n    };\r\n    Target.prototype.matchesTag = function (key) {\r\n        var _this = this;\r\n        return function (value) {\r\n            for (var _i = 0, _a = _this.metadata; _i < _a.length; _i++) {\r\n                var m = _a[_i];\r\n                if (m.key === key && m.value === value) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n    };\r\n    return Target;\r\n}());\r\nexports.Target = Target;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getFunctionName = exports.getBaseClassDependencyCount = exports.getDependencies = void 0;\r\nvar lazy_service_identifier_1 = require(\"../annotation/lazy_service_identifier\");\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar serialization_1 = require(\"../utils/serialization\");\r\nObject.defineProperty(exports, \"getFunctionName\", { enumerable: true, get: function () { return serialization_1.getFunctionName; } });\r\nvar target_1 = require(\"./target\");\r\nfunction getDependencies(metadataReader, func) {\r\n    var constructorName = (0, serialization_1.getFunctionName)(func);\r\n    return getTargets(metadataReader, constructorName, func, false);\r\n}\r\nexports.getDependencies = getDependencies;\r\nfunction getTargets(metadataReader, constructorName, func, isBaseClass) {\r\n    var metadata = metadataReader.getConstructorMetadata(func);\r\n    var serviceIdentifiers = metadata.compilerGeneratedMetadata;\r\n    if (serviceIdentifiers === undefined) {\r\n        var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" \" + constructorName + \".\";\r\n        throw new Error(msg);\r\n    }\r\n    var constructorArgsMetadata = metadata.userGeneratedMetadata;\r\n    var keys = Object.keys(constructorArgsMetadata);\r\n    var hasUserDeclaredUnknownInjections = (func.length === 0 && keys.length > 0);\r\n    var hasOptionalParameters = keys.length > func.length;\r\n    var iterations = (hasUserDeclaredUnknownInjections || hasOptionalParameters) ? keys.length : func.length;\r\n    var constructorTargets = getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations);\r\n    var propertyTargets = getClassPropsAsTargets(metadataReader, func, constructorName);\r\n    var targets = __spreadArray(__spreadArray([], constructorTargets, true), propertyTargets, true);\r\n    return targets;\r\n}\r\nfunction getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata) {\r\n    var targetMetadata = constructorArgsMetadata[index.toString()] || [];\r\n    var metadata = formatTargetMetadata(targetMetadata);\r\n    var isManaged = metadata.unmanaged !== true;\r\n    var serviceIdentifier = serviceIdentifiers[index];\r\n    var injectIdentifier = metadata.inject || metadata.multiInject;\r\n    serviceIdentifier = (injectIdentifier ? injectIdentifier : serviceIdentifier);\r\n    if (serviceIdentifier instanceof lazy_service_identifier_1.LazyServiceIdentifier) {\r\n        serviceIdentifier = serviceIdentifier.unwrap();\r\n    }\r\n    if (isManaged) {\r\n        var isObject = serviceIdentifier === Object;\r\n        var isFunction = serviceIdentifier === Function;\r\n        var isUndefined = serviceIdentifier === undefined;\r\n        var isUnknownType = isObject || isFunction || isUndefined;\r\n        if (!isBaseClass && isUnknownType) {\r\n            var msg = ERROR_MSGS.MISSING_INJECT_ANNOTATION + \" argument \" + index + \" in class \" + constructorName + \".\";\r\n            throw new Error(msg);\r\n        }\r\n        var target = new target_1.Target(literal_types_1.TargetTypeEnum.ConstructorArgument, metadata.targetName, serviceIdentifier);\r\n        target.metadata = targetMetadata;\r\n        return target;\r\n    }\r\n    return null;\r\n}\r\nfunction getConstructorArgsAsTargets(isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata, iterations) {\r\n    var targets = [];\r\n    for (var i = 0; i < iterations; i++) {\r\n        var index = i;\r\n        var target = getConstructorArgsAsTarget(index, isBaseClass, constructorName, serviceIdentifiers, constructorArgsMetadata);\r\n        if (target !== null) {\r\n            targets.push(target);\r\n        }\r\n    }\r\n    return targets;\r\n}\r\nfunction _getServiceIdentifierForProperty(inject, multiInject, propertyName, className) {\r\n    var serviceIdentifier = (inject || multiInject);\r\n    if (serviceIdentifier === undefined) {\r\n        var msg = ERROR_MSGS.MISSING_INJECTABLE_ANNOTATION + \" for property \" + String(propertyName) + \" in class \" + className + \".\";\r\n        throw new Error(msg);\r\n    }\r\n    return serviceIdentifier;\r\n}\r\nfunction getClassPropsAsTargets(metadataReader, constructorFunc, constructorName) {\r\n    var classPropsMetadata = metadataReader.getPropertiesMetadata(constructorFunc);\r\n    var targets = [];\r\n    var symbolKeys = Object.getOwnPropertySymbols(classPropsMetadata);\r\n    var stringKeys = Object.keys(classPropsMetadata);\r\n    var keys = stringKeys.concat(symbolKeys);\r\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n        var key = keys_1[_i];\r\n        var targetMetadata = classPropsMetadata[key];\r\n        var metadata = formatTargetMetadata(targetMetadata);\r\n        var identifier = metadata.targetName || key;\r\n        var serviceIdentifier = _getServiceIdentifierForProperty(metadata.inject, metadata.multiInject, key, constructorName);\r\n        var target = new target_1.Target(literal_types_1.TargetTypeEnum.ClassProperty, identifier, serviceIdentifier);\r\n        target.metadata = targetMetadata;\r\n        targets.push(target);\r\n    }\r\n    var baseConstructor = Object.getPrototypeOf(constructorFunc.prototype).constructor;\r\n    if (baseConstructor !== Object) {\r\n        var baseTargets = getClassPropsAsTargets(metadataReader, baseConstructor, constructorName);\r\n        targets = __spreadArray(__spreadArray([], targets, true), baseTargets, true);\r\n    }\r\n    return targets;\r\n}\r\nfunction getBaseClassDependencyCount(metadataReader, func) {\r\n    var baseConstructor = Object.getPrototypeOf(func.prototype).constructor;\r\n    if (baseConstructor !== Object) {\r\n        var baseConstructorName = (0, serialization_1.getFunctionName)(baseConstructor);\r\n        var targets = getTargets(metadataReader, baseConstructorName, baseConstructor, true);\r\n        var metadata = targets.map(function (t) { return t.metadata.filter(function (m) { return m.key === METADATA_KEY.UNMANAGED_TAG; }); });\r\n        var unmanagedCount = [].concat.apply([], metadata).length;\r\n        var dependencyCount = targets.length - unmanagedCount;\r\n        if (dependencyCount > 0) {\r\n            return dependencyCount;\r\n        }\r\n        else {\r\n            return getBaseClassDependencyCount(metadataReader, baseConstructor);\r\n        }\r\n    }\r\n    else {\r\n        return 0;\r\n    }\r\n}\r\nexports.getBaseClassDependencyCount = getBaseClassDependencyCount;\r\nfunction formatTargetMetadata(targetMetadata) {\r\n    var targetMetadataMap = {};\r\n    targetMetadata.forEach(function (m) {\r\n        targetMetadataMap[m.key.toString()] = m.value;\r\n    });\r\n    return {\r\n        inject: targetMetadataMap[METADATA_KEY.INJECT_TAG],\r\n        multiInject: targetMetadataMap[METADATA_KEY.MULTI_INJECT_TAG],\r\n        targetName: targetMetadataMap[METADATA_KEY.NAME_TAG],\r\n        unmanaged: targetMetadataMap[METADATA_KEY.UNMANAGED_TAG]\r\n    };\r\n}\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Request = void 0;\r\nvar id_1 = require(\"../utils/id\");\r\nvar Request = (function () {\r\n    function Request(serviceIdentifier, parentContext, parentRequest, bindings, target) {\r\n        this.id = (0, id_1.id)();\r\n        this.serviceIdentifier = serviceIdentifier;\r\n        this.parentContext = parentContext;\r\n        this.parentRequest = parentRequest;\r\n        this.target = target;\r\n        this.childRequests = [];\r\n        this.bindings = (Array.isArray(bindings) ? bindings : [bindings]);\r\n        this.requestScope = parentRequest === null\r\n            ? new Map()\r\n            : null;\r\n    }\r\n    Request.prototype.addChildRequest = function (serviceIdentifier, bindings, target) {\r\n        var child = new Request(serviceIdentifier, this.parentContext, this, bindings, target);\r\n        this.childRequests.push(child);\r\n        return child;\r\n    };\r\n    return Request;\r\n}());\r\nexports.Request = Request;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getBindingDictionary = exports.createMockRequest = exports.plan = void 0;\r\nvar binding_count_1 = require(\"../bindings/binding_count\");\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar exceptions_1 = require(\"../utils/exceptions\");\r\nvar serialization_1 = require(\"../utils/serialization\");\r\nvar context_1 = require(\"./context\");\r\nvar metadata_1 = require(\"./metadata\");\r\nvar plan_1 = require(\"./plan\");\r\nvar reflection_utils_1 = require(\"./reflection_utils\");\r\nvar request_1 = require(\"./request\");\r\nvar target_1 = require(\"./target\");\r\nfunction getBindingDictionary(cntnr) {\r\n    return cntnr._bindingDictionary;\r\n}\r\nexports.getBindingDictionary = getBindingDictionary;\r\nfunction _createTarget(isMultiInject, targetType, serviceIdentifier, name, key, value) {\r\n    var metadataKey = isMultiInject ? METADATA_KEY.MULTI_INJECT_TAG : METADATA_KEY.INJECT_TAG;\r\n    var injectMetadata = new metadata_1.Metadata(metadataKey, serviceIdentifier);\r\n    var target = new target_1.Target(targetType, name, serviceIdentifier, injectMetadata);\r\n    if (key !== undefined) {\r\n        var tagMetadata = new metadata_1.Metadata(key, value);\r\n        target.metadata.push(tagMetadata);\r\n    }\r\n    return target;\r\n}\r\nfunction _getActiveBindings(metadataReader, avoidConstraints, context, parentRequest, target) {\r\n    var bindings = getBindings(context.container, target.serviceIdentifier);\r\n    var activeBindings = [];\r\n    if (bindings.length === binding_count_1.BindingCount.NoBindingsAvailable &&\r\n        context.container.options.autoBindInjectable &&\r\n        typeof target.serviceIdentifier === 'function' &&\r\n        metadataReader.getConstructorMetadata(target.serviceIdentifier).compilerGeneratedMetadata) {\r\n        context.container.bind(target.serviceIdentifier).toSelf();\r\n        bindings = getBindings(context.container, target.serviceIdentifier);\r\n    }\r\n    if (!avoidConstraints) {\r\n        activeBindings = bindings.filter(function (binding) {\r\n            var request = new request_1.Request(binding.serviceIdentifier, context, parentRequest, binding, target);\r\n            return binding.constraint(request);\r\n        });\r\n    }\r\n    else {\r\n        activeBindings = bindings;\r\n    }\r\n    _validateActiveBindingCount(target.serviceIdentifier, activeBindings, target, context.container);\r\n    return activeBindings;\r\n}\r\nfunction _validateActiveBindingCount(serviceIdentifier, bindings, target, container) {\r\n    switch (bindings.length) {\r\n        case binding_count_1.BindingCount.NoBindingsAvailable:\r\n            if (target.isOptional()) {\r\n                return bindings;\r\n            }\r\n            else {\r\n                var serviceIdentifierString = (0, serialization_1.getServiceIdentifierAsString)(serviceIdentifier);\r\n                var msg = ERROR_MSGS.NOT_REGISTERED;\r\n                msg += (0, serialization_1.listMetadataForTarget)(serviceIdentifierString, target);\r\n                msg += (0, serialization_1.listRegisteredBindingsForServiceIdentifier)(container, serviceIdentifierString, getBindings);\r\n                throw new Error(msg);\r\n            }\r\n        case binding_count_1.BindingCount.OnlyOneBindingAvailable:\r\n            return bindings;\r\n        case binding_count_1.BindingCount.MultipleBindingsAvailable:\r\n        default:\r\n            if (!target.isArray()) {\r\n                var serviceIdentifierString = (0, serialization_1.getServiceIdentifierAsString)(serviceIdentifier);\r\n                var msg = ERROR_MSGS.AMBIGUOUS_MATCH + \" \" + serviceIdentifierString;\r\n                msg += (0, serialization_1.listRegisteredBindingsForServiceIdentifier)(container, serviceIdentifierString, getBindings);\r\n                throw new Error(msg);\r\n            }\r\n            else {\r\n                return bindings;\r\n            }\r\n    }\r\n}\r\nfunction _createSubRequests(metadataReader, avoidConstraints, serviceIdentifier, context, parentRequest, target) {\r\n    var activeBindings;\r\n    var childRequest;\r\n    if (parentRequest === null) {\r\n        activeBindings = _getActiveBindings(metadataReader, avoidConstraints, context, null, target);\r\n        childRequest = new request_1.Request(serviceIdentifier, context, null, activeBindings, target);\r\n        var thePlan = new plan_1.Plan(context, childRequest);\r\n        context.addPlan(thePlan);\r\n    }\r\n    else {\r\n        activeBindings = _getActiveBindings(metadataReader, avoidConstraints, context, parentRequest, target);\r\n        childRequest = parentRequest.addChildRequest(target.serviceIdentifier, activeBindings, target);\r\n    }\r\n    activeBindings.forEach(function (binding) {\r\n        var subChildRequest = null;\r\n        if (target.isArray()) {\r\n            subChildRequest = childRequest.addChildRequest(binding.serviceIdentifier, binding, target);\r\n        }\r\n        else {\r\n            if (binding.cache) {\r\n                return;\r\n            }\r\n            subChildRequest = childRequest;\r\n        }\r\n        if (binding.type === literal_types_1.BindingTypeEnum.Instance && binding.implementationType !== null) {\r\n            var dependencies = (0, reflection_utils_1.getDependencies)(metadataReader, binding.implementationType);\r\n            if (!context.container.options.skipBaseClassChecks) {\r\n                var baseClassDependencyCount = (0, reflection_utils_1.getBaseClassDependencyCount)(metadataReader, binding.implementationType);\r\n                if (dependencies.length < baseClassDependencyCount) {\r\n                    var error = ERROR_MSGS.ARGUMENTS_LENGTH_MISMATCH((0, reflection_utils_1.getFunctionName)(binding.implementationType));\r\n                    throw new Error(error);\r\n                }\r\n            }\r\n            dependencies.forEach(function (dependency) {\r\n                _createSubRequests(metadataReader, false, dependency.serviceIdentifier, context, subChildRequest, dependency);\r\n            });\r\n        }\r\n    });\r\n}\r\nfunction getBindings(container, serviceIdentifier) {\r\n    var bindings = [];\r\n    var bindingDictionary = getBindingDictionary(container);\r\n    if (bindingDictionary.hasKey(serviceIdentifier)) {\r\n        bindings = bindingDictionary.get(serviceIdentifier);\r\n    }\r\n    else if (container.parent !== null) {\r\n        bindings = getBindings(container.parent, serviceIdentifier);\r\n    }\r\n    return bindings;\r\n}\r\nfunction plan(metadataReader, container, isMultiInject, targetType, serviceIdentifier, key, value, avoidConstraints) {\r\n    if (avoidConstraints === void 0) { avoidConstraints = false; }\r\n    var context = new context_1.Context(container);\r\n    var target = _createTarget(isMultiInject, targetType, serviceIdentifier, '', key, value);\r\n    try {\r\n        _createSubRequests(metadataReader, avoidConstraints, serviceIdentifier, context, null, target);\r\n        return context;\r\n    }\r\n    catch (error) {\r\n        if ((0, exceptions_1.isStackOverflowExeption)(error)) {\r\n            (0, serialization_1.circularDependencyToException)(context.plan.rootRequest);\r\n        }\r\n        throw error;\r\n    }\r\n}\r\nexports.plan = plan;\r\nfunction createMockRequest(container, serviceIdentifier, key, value) {\r\n    var target = new target_1.Target(literal_types_1.TargetTypeEnum.Variable, '', serviceIdentifier, new metadata_1.Metadata(key, value));\r\n    var context = new context_1.Context(container);\r\n    var request = new request_1.Request(serviceIdentifier, context, null, [], target);\r\n    return request;\r\n}\r\nexports.createMockRequest = createMockRequest;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.isPromiseOrContainsPromise = exports.isPromise = void 0;\r\nfunction isPromise(object) {\r\n    var isObjectOrFunction = (typeof object === 'object' && object !== null) || typeof object === 'function';\r\n    return isObjectOrFunction && typeof object.then === \"function\";\r\n}\r\nexports.isPromise = isPromise;\r\nfunction isPromiseOrContainsPromise(object) {\r\n    if (isPromise(object)) {\r\n        return true;\r\n    }\r\n    return Array.isArray(object) && object.some(isPromise);\r\n}\r\nexports.isPromiseOrContainsPromise = isPromiseOrContainsPromise;\r\n", "\"use strict\";\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.saveToScope = exports.tryGetFromScope = void 0;\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar async_1 = require(\"../utils/async\");\r\nvar tryGetFromScope = function (requestScope, binding) {\r\n    if ((binding.scope === literal_types_1.BindingScopeEnum.Singleton) && binding.activated) {\r\n        return binding.cache;\r\n    }\r\n    if (binding.scope === literal_types_1.BindingScopeEnum.Request &&\r\n        requestScope.has(binding.id)) {\r\n        return requestScope.get(binding.id);\r\n    }\r\n    return null;\r\n};\r\nexports.tryGetFromScope = tryGetFromScope;\r\nvar saveToScope = function (requestScope, binding, result) {\r\n    if (binding.scope === literal_types_1.BindingScopeEnum.Singleton) {\r\n        _saveToSingletonScope(binding, result);\r\n    }\r\n    if (binding.scope === literal_types_1.BindingScopeEnum.Request) {\r\n        _saveToRequestScope(requestScope, binding, result);\r\n    }\r\n};\r\nexports.saveToScope = saveToScope;\r\nvar _saveToRequestScope = function (requestScope, binding, result) {\r\n    if (!requestScope.has(binding.id)) {\r\n        requestScope.set(binding.id, result);\r\n    }\r\n};\r\nvar _saveToSingletonScope = function (binding, result) {\r\n    binding.cache = result;\r\n    binding.activated = true;\r\n    if ((0, async_1.isPromise)(result)) {\r\n        void _saveAsyncResultToSingletonScope(binding, result);\r\n    }\r\n};\r\nvar _saveAsyncResultToSingletonScope = function (binding, asyncResult) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, ex_1;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0:\r\n                _a.trys.push([0, 2, , 3]);\r\n                return [4, asyncResult];\r\n            case 1:\r\n                result = _a.sent();\r\n                binding.cache = result;\r\n                return [3, 3];\r\n            case 2:\r\n                ex_1 = _a.sent();\r\n                binding.cache = null;\r\n                binding.activated = false;\r\n                throw ex_1;\r\n            case 3: return [2];\r\n        }\r\n    });\r\n}); };\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.FactoryType = void 0;\r\nvar FactoryType;\r\n(function (FactoryType) {\r\n    FactoryType[\"DynamicValue\"] = \"toDynamicValue\";\r\n    FactoryType[\"Factory\"] = \"toFactory\";\r\n    FactoryType[\"Provider\"] = \"toProvider\";\r\n})(FactoryType = exports.FactoryType || (exports.FactoryType = {}));\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getFactoryDetails = exports.ensureFullyBound = exports.multiBindToService = void 0;\r\nvar serialization_1 = require(\"../utils/serialization\");\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar factory_type_1 = require(\"./factory_type\");\r\nvar multiBindToService = function (container) {\r\n    return function (service) {\r\n        return function () {\r\n            var types = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                types[_i] = arguments[_i];\r\n            }\r\n            return types.forEach(function (t) { return container.bind(t).toService(service); });\r\n        };\r\n    };\r\n};\r\nexports.multiBindToService = multiBindToService;\r\nvar ensureFullyBound = function (binding) {\r\n    var boundValue = null;\r\n    switch (binding.type) {\r\n        case literal_types_1.BindingTypeEnum.ConstantValue:\r\n        case literal_types_1.BindingTypeEnum.Function:\r\n            boundValue = binding.cache;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.Constructor:\r\n        case literal_types_1.BindingTypeEnum.Instance:\r\n            boundValue = binding.implementationType;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.DynamicValue:\r\n            boundValue = binding.dynamicValue;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.Provider:\r\n            boundValue = binding.provider;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.Factory:\r\n            boundValue = binding.factory;\r\n            break;\r\n    }\r\n    if (boundValue === null) {\r\n        var serviceIdentifierAsString = (0, serialization_1.getServiceIdentifierAsString)(binding.serviceIdentifier);\r\n        throw new Error(ERROR_MSGS.INVALID_BINDING_TYPE + \" \" + serviceIdentifierAsString);\r\n    }\r\n};\r\nexports.ensureFullyBound = ensureFullyBound;\r\nvar getFactoryDetails = function (binding) {\r\n    switch (binding.type) {\r\n        case literal_types_1.BindingTypeEnum.Factory:\r\n            return { factory: binding.factory, factoryType: factory_type_1.FactoryType.Factory };\r\n        case literal_types_1.BindingTypeEnum.Provider:\r\n            return { factory: binding.provider, factoryType: factory_type_1.FactoryType.Provider };\r\n        case literal_types_1.BindingTypeEnum.DynamicValue:\r\n            return { factory: binding.dynamicValue, factoryType: factory_type_1.FactoryType.DynamicValue };\r\n        default:\r\n            throw new Error(\"Unexpected factory type \" + binding.type);\r\n    }\r\n};\r\nexports.getFactoryDetails = getFactoryDetails;\r\n", "\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.resolveInstance = void 0;\r\nvar error_msgs_1 = require(\"../constants/error_msgs\");\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar async_1 = require(\"../utils/async\");\r\nfunction _resolveRequests(childRequests, resolveRequest) {\r\n    return childRequests.reduce(function (resolvedRequests, childRequest) {\r\n        var injection = resolveRequest(childRequest);\r\n        var targetType = childRequest.target.type;\r\n        if (targetType === literal_types_1.TargetTypeEnum.ConstructorArgument) {\r\n            resolvedRequests.constructorInjections.push(injection);\r\n        }\r\n        else {\r\n            resolvedRequests.propertyRequests.push(childRequest);\r\n            resolvedRequests.propertyInjections.push(injection);\r\n        }\r\n        if (!resolvedRequests.isAsync) {\r\n            resolvedRequests.isAsync = (0, async_1.isPromiseOrContainsPromise)(injection);\r\n        }\r\n        return resolvedRequests;\r\n    }, { constructorInjections: [], propertyInjections: [], propertyRequests: [], isAsync: false });\r\n}\r\nfunction _createInstance(constr, childRequests, resolveRequest) {\r\n    var result;\r\n    if (childRequests.length > 0) {\r\n        var resolved = _resolveRequests(childRequests, resolveRequest);\r\n        var createInstanceWithInjectionsArg = __assign(__assign({}, resolved), { constr: constr });\r\n        if (resolved.isAsync) {\r\n            result = createInstanceWithInjectionsAsync(createInstanceWithInjectionsArg);\r\n        }\r\n        else {\r\n            result = createInstanceWithInjections(createInstanceWithInjectionsArg);\r\n        }\r\n    }\r\n    else {\r\n        result = new constr();\r\n    }\r\n    return result;\r\n}\r\nfunction createInstanceWithInjections(args) {\r\n    var _a;\r\n    var instance = new ((_a = args.constr).bind.apply(_a, __spreadArray([void 0], args.constructorInjections, false)))();\r\n    args.propertyRequests.forEach(function (r, index) {\r\n        var property = r.target.identifier;\r\n        var injection = args.propertyInjections[index];\r\n        if (!r.target.isOptional() || injection !== undefined) {\r\n            instance[property] = injection;\r\n        }\r\n    });\r\n    return instance;\r\n}\r\nfunction createInstanceWithInjectionsAsync(args) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var constructorInjections, propertyInjections;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4, possiblyWaitInjections(args.constructorInjections)];\r\n                case 1:\r\n                    constructorInjections = _a.sent();\r\n                    return [4, possiblyWaitInjections(args.propertyInjections)];\r\n                case 2:\r\n                    propertyInjections = _a.sent();\r\n                    return [2, createInstanceWithInjections(__assign(__assign({}, args), { constructorInjections: constructorInjections, propertyInjections: propertyInjections }))];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction possiblyWaitInjections(possiblePromiseinjections) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var injections, _i, possiblePromiseinjections_1, injection;\r\n        return __generator(this, function (_a) {\r\n            injections = [];\r\n            for (_i = 0, possiblePromiseinjections_1 = possiblePromiseinjections; _i < possiblePromiseinjections_1.length; _i++) {\r\n                injection = possiblePromiseinjections_1[_i];\r\n                if (Array.isArray(injection)) {\r\n                    injections.push(Promise.all(injection));\r\n                }\r\n                else {\r\n                    injections.push(injection);\r\n                }\r\n            }\r\n            return [2, Promise.all(injections)];\r\n        });\r\n    });\r\n}\r\nfunction _getInstanceAfterPostConstruct(constr, result) {\r\n    var postConstructResult = _postConstruct(constr, result);\r\n    if ((0, async_1.isPromise)(postConstructResult)) {\r\n        return postConstructResult.then(function () { return result; });\r\n    }\r\n    else {\r\n        return result;\r\n    }\r\n}\r\nfunction _postConstruct(constr, instance) {\r\n    var _a, _b;\r\n    if (Reflect.hasMetadata(METADATA_KEY.POST_CONSTRUCT, constr)) {\r\n        var data = Reflect.getMetadata(METADATA_KEY.POST_CONSTRUCT, constr);\r\n        try {\r\n            return (_b = (_a = instance)[data.value]) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n        }\r\n        catch (e) {\r\n            if (e instanceof Error) {\r\n                throw new Error((0, error_msgs_1.POST_CONSTRUCT_ERROR)(constr.name, e.message));\r\n            }\r\n        }\r\n    }\r\n}\r\nfunction _validateInstanceResolution(binding, constr) {\r\n    if (binding.scope !== literal_types_1.BindingScopeEnum.Singleton) {\r\n        _throwIfHandlingDeactivation(binding, constr);\r\n    }\r\n}\r\nfunction _throwIfHandlingDeactivation(binding, constr) {\r\n    var scopeErrorMessage = \"Class cannot be instantiated in \" + (binding.scope === literal_types_1.BindingScopeEnum.Request ?\r\n        'request' :\r\n        'transient') + \" scope.\";\r\n    if (typeof binding.onDeactivation === 'function') {\r\n        throw new Error((0, error_msgs_1.ON_DEACTIVATION_ERROR)(constr.name, scopeErrorMessage));\r\n    }\r\n    if (Reflect.hasMetadata(METADATA_KEY.PRE_DESTROY, constr)) {\r\n        throw new Error((0, error_msgs_1.PRE_DESTROY_ERROR)(constr.name, scopeErrorMessage));\r\n    }\r\n}\r\nfunction resolveInstance(binding, constr, childRequests, resolveRequest) {\r\n    _validateInstanceResolution(binding, constr);\r\n    var result = _createInstance(constr, childRequests, resolveRequest);\r\n    if ((0, async_1.isPromise)(result)) {\r\n        return result.then(function (resolvedResult) { return _getInstanceAfterPostConstruct(constr, resolvedResult); });\r\n    }\r\n    else {\r\n        return _getInstanceAfterPostConstruct(constr, result);\r\n    }\r\n}\r\nexports.resolveInstance = resolveInstance;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.resolve = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar planner_1 = require(\"../planning/planner\");\r\nvar scope_1 = require(\"../scope/scope\");\r\nvar async_1 = require(\"../utils/async\");\r\nvar binding_utils_1 = require(\"../utils/binding_utils\");\r\nvar exceptions_1 = require(\"../utils/exceptions\");\r\nvar instantiation_1 = require(\"./instantiation\");\r\nvar _resolveRequest = function (requestScope) {\r\n    return function (request) {\r\n        request.parentContext.setCurrentRequest(request);\r\n        var bindings = request.bindings;\r\n        var childRequests = request.childRequests;\r\n        var targetIsAnArray = request.target && request.target.isArray();\r\n        var targetParentIsNotAnArray = !request.parentRequest ||\r\n            !request.parentRequest.target ||\r\n            !request.target ||\r\n            !request.parentRequest.target.matchesArray(request.target.serviceIdentifier);\r\n        if (targetIsAnArray && targetParentIsNotAnArray) {\r\n            return childRequests.map(function (childRequest) {\r\n                var _f = _resolveRequest(requestScope);\r\n                return _f(childRequest);\r\n            });\r\n        }\r\n        else {\r\n            if (request.target.isOptional() && bindings.length === 0) {\r\n                return undefined;\r\n            }\r\n            var binding = bindings[0];\r\n            return _resolveBinding(requestScope, request, binding);\r\n        }\r\n    };\r\n};\r\nvar _resolveFactoryFromBinding = function (binding, context) {\r\n    var factoryDetails = (0, binding_utils_1.getFactoryDetails)(binding);\r\n    return (0, exceptions_1.tryAndThrowErrorIfStackOverflow)(function () { return factoryDetails.factory.bind(binding)(context); }, function () { return new Error(ERROR_MSGS.CIRCULAR_DEPENDENCY_IN_FACTORY(factoryDetails.factoryType, context.currentRequest.serviceIdentifier.toString())); });\r\n};\r\nvar _getResolvedFromBinding = function (requestScope, request, binding) {\r\n    var result;\r\n    var childRequests = request.childRequests;\r\n    (0, binding_utils_1.ensureFullyBound)(binding);\r\n    switch (binding.type) {\r\n        case literal_types_1.BindingTypeEnum.ConstantValue:\r\n        case literal_types_1.BindingTypeEnum.Function:\r\n            result = binding.cache;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.Constructor:\r\n            result = binding.implementationType;\r\n            break;\r\n        case literal_types_1.BindingTypeEnum.Instance:\r\n            result = (0, instantiation_1.resolveInstance)(binding, binding.implementationType, childRequests, _resolveRequest(requestScope));\r\n            break;\r\n        default:\r\n            result = _resolveFactoryFromBinding(binding, request.parentContext);\r\n    }\r\n    return result;\r\n};\r\nvar _resolveInScope = function (requestScope, binding, resolveFromBinding) {\r\n    var result = (0, scope_1.tryGetFromScope)(requestScope, binding);\r\n    if (result !== null) {\r\n        return result;\r\n    }\r\n    result = resolveFromBinding();\r\n    (0, scope_1.saveToScope)(requestScope, binding, result);\r\n    return result;\r\n};\r\nvar _resolveBinding = function (requestScope, request, binding) {\r\n    return _resolveInScope(requestScope, binding, function () {\r\n        var result = _getResolvedFromBinding(requestScope, request, binding);\r\n        if ((0, async_1.isPromise)(result)) {\r\n            result = result.then(function (resolved) { return _onActivation(request, binding, resolved); });\r\n        }\r\n        else {\r\n            result = _onActivation(request, binding, result);\r\n        }\r\n        return result;\r\n    });\r\n};\r\nfunction _onActivation(request, binding, resolved) {\r\n    var result = _bindingActivation(request.parentContext, binding, resolved);\r\n    var containersIterator = _getContainersIterator(request.parentContext.container);\r\n    var container;\r\n    var containersIteratorResult = containersIterator.next();\r\n    do {\r\n        container = containersIteratorResult.value;\r\n        var context_1 = request.parentContext;\r\n        var serviceIdentifier = request.serviceIdentifier;\r\n        var activationsIterator = _getContainerActivationsForService(container, serviceIdentifier);\r\n        if ((0, async_1.isPromise)(result)) {\r\n            result = _activateContainerAsync(activationsIterator, context_1, result);\r\n        }\r\n        else {\r\n            result = _activateContainer(activationsIterator, context_1, result);\r\n        }\r\n        containersIteratorResult = containersIterator.next();\r\n    } while (containersIteratorResult.done !== true && !(0, planner_1.getBindingDictionary)(container).hasKey(request.serviceIdentifier));\r\n    return result;\r\n}\r\nvar _bindingActivation = function (context, binding, previousResult) {\r\n    var result;\r\n    if (typeof binding.onActivation === 'function') {\r\n        result = binding.onActivation(context, previousResult);\r\n    }\r\n    else {\r\n        result = previousResult;\r\n    }\r\n    return result;\r\n};\r\nvar _activateContainer = function (activationsIterator, context, result) {\r\n    var activation = activationsIterator.next();\r\n    while (!activation.done) {\r\n        result = activation.value(context, result);\r\n        if ((0, async_1.isPromise)(result)) {\r\n            return _activateContainerAsync(activationsIterator, context, result);\r\n        }\r\n        activation = activationsIterator.next();\r\n    }\r\n    return result;\r\n};\r\nvar _activateContainerAsync = function (activationsIterator, context, resultPromise) { return __awaiter(void 0, void 0, void 0, function () {\r\n    var result, activation;\r\n    return __generator(this, function (_a) {\r\n        switch (_a.label) {\r\n            case 0: return [4, resultPromise];\r\n            case 1:\r\n                result = _a.sent();\r\n                activation = activationsIterator.next();\r\n                _a.label = 2;\r\n            case 2:\r\n                if (!!activation.done) return [3, 4];\r\n                return [4, activation.value(context, result)];\r\n            case 3:\r\n                result = _a.sent();\r\n                activation = activationsIterator.next();\r\n                return [3, 2];\r\n            case 4: return [2, result];\r\n        }\r\n    });\r\n}); };\r\nvar _getContainerActivationsForService = function (container, serviceIdentifier) {\r\n    var activations = container._activations;\r\n    return activations.hasKey(serviceIdentifier) ? activations.get(serviceIdentifier).values() : [].values();\r\n};\r\nvar _getContainersIterator = function (container) {\r\n    var containersStack = [container];\r\n    var parent = container.parent;\r\n    while (parent !== null) {\r\n        containersStack.push(parent);\r\n        parent = parent.parent;\r\n    }\r\n    var getNextContainer = function () {\r\n        var nextContainer = containersStack.pop();\r\n        if (nextContainer !== undefined) {\r\n            return { done: false, value: nextContainer };\r\n        }\r\n        else {\r\n            return { done: true, value: undefined };\r\n        }\r\n    };\r\n    var containersIterator = {\r\n        next: getNextContainer,\r\n    };\r\n    return containersIterator;\r\n};\r\nfunction resolve(context) {\r\n    var _f = _resolveRequest(context.plan.rootRequest.requestScope);\r\n    return _f(context.plan.rootRequest);\r\n}\r\nexports.resolve = resolve;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.typeConstraint = exports.namedConstraint = exports.taggedConstraint = exports.traverseAncerstors = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar traverseAncerstors = function (request, constraint) {\r\n    var parent = request.parentRequest;\r\n    if (parent !== null) {\r\n        return constraint(parent) ? true : traverseAncerstors(parent, constraint);\r\n    }\r\n    else {\r\n        return false;\r\n    }\r\n};\r\nexports.traverseAncerstors = traverseAncerstors;\r\nvar taggedConstraint = function (key) { return function (value) {\r\n    var constraint = function (request) {\r\n        return request !== null && request.target !== null && request.target.matchesTag(key)(value);\r\n    };\r\n    constraint.metaData = new metadata_1.Metadata(key, value);\r\n    return constraint;\r\n}; };\r\nexports.taggedConstraint = taggedConstraint;\r\nvar namedConstraint = taggedConstraint(METADATA_KEY.NAMED_TAG);\r\nexports.namedConstraint = namedConstraint;\r\nvar typeConstraint = function (type) { return function (request) {\r\n    var binding = null;\r\n    if (request !== null) {\r\n        binding = request.bindings[0];\r\n        if (typeof type === 'string') {\r\n            var serviceIdentifier = binding.serviceIdentifier;\r\n            return serviceIdentifier === type;\r\n        }\r\n        else {\r\n            var constructor = request.bindings[0].implementationType;\r\n            return type === constructor;\r\n        }\r\n    }\r\n    return false;\r\n}; };\r\nexports.typeConstraint = typeConstraint;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingWhenSyntax = void 0;\r\nvar binding_on_syntax_1 = require(\"./binding_on_syntax\");\r\nvar constraint_helpers_1 = require(\"./constraint_helpers\");\r\nvar BindingWhenSyntax = (function () {\r\n    function BindingWhenSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingWhenSyntax.prototype.when = function (constraint) {\r\n        this._binding.constraint = constraint;\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetNamed = function (name) {\r\n        this._binding.constraint = (0, constraint_helpers_1.namedConstraint)(name);\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetIsDefault = function () {\r\n        this._binding.constraint = function (request) {\r\n            if (request === null) {\r\n                return false;\r\n            }\r\n            var targetIsDefault = (request.target !== null) &&\r\n                (!request.target.isNamed()) &&\r\n                (!request.target.isTagged());\r\n            return targetIsDefault;\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        this._binding.constraint = (0, constraint_helpers_1.taggedConstraint)(tag)(value);\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenInjectedInto = function (parent) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.typeConstraint)(parent)(request.parentRequest);\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenParentNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.namedConstraint)(name)(request.parentRequest);\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.taggedConstraint)(tag)(value)(request.parentRequest);\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.typeConstraint)(ancestor));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !(0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.typeConstraint)(ancestor));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.namedConstraint)(name));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !(0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.namedConstraint)(name));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.taggedConstraint)(tag)(value));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !(0, constraint_helpers_1.traverseAncerstors)(request, (0, constraint_helpers_1.taggedConstraint)(tag)(value));\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && (0, constraint_helpers_1.traverseAncerstors)(request, constraint);\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    BindingWhenSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        this._binding.constraint = function (request) {\r\n            return request !== null && !(0, constraint_helpers_1.traverseAncerstors)(request, constraint);\r\n        };\r\n        return new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    };\r\n    return BindingWhenSyntax;\r\n}());\r\nexports.BindingWhenSyntax = BindingWhenSyntax;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingOnSyntax = void 0;\r\nvar binding_when_syntax_1 = require(\"./binding_when_syntax\");\r\nvar BindingOnSyntax = (function () {\r\n    function BindingOnSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingOnSyntax.prototype.onActivation = function (handler) {\r\n        this._binding.onActivation = handler;\r\n        return new binding_when_syntax_1.BindingWhenSyntax(this._binding);\r\n    };\r\n    BindingOnSyntax.prototype.onDeactivation = function (handler) {\r\n        this._binding.onDeactivation = handler;\r\n        return new binding_when_syntax_1.BindingWhenSyntax(this._binding);\r\n    };\r\n    return BindingOnSyntax;\r\n}());\r\nexports.BindingOnSyntax = BindingOnSyntax;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingWhenOnSyntax = void 0;\r\nvar binding_on_syntax_1 = require(\"./binding_on_syntax\");\r\nvar binding_when_syntax_1 = require(\"./binding_when_syntax\");\r\nvar BindingWhenOnSyntax = (function () {\r\n    function BindingWhenOnSyntax(binding) {\r\n        this._binding = binding;\r\n        this._bindingWhenSyntax = new binding_when_syntax_1.BindingWhenSyntax(this._binding);\r\n        this._bindingOnSyntax = new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n    }\r\n    BindingWhenOnSyntax.prototype.when = function (constraint) {\r\n        return this._bindingWhenSyntax.when(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenTargetNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetIsDefault = function () {\r\n        return this._bindingWhenSyntax.whenTargetIsDefault();\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenTargetTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenInjectedInto = function (parent) {\r\n        return this._bindingWhenSyntax.whenInjectedInto(parent);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenParentNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenParentNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenParentTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenNoAncestorIs(ancestor);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenNoAncestorNamed(name);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenNoAncestorTagged(tag, value);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenNoAncestorMatches(constraint);\r\n    };\r\n    BindingWhenOnSyntax.prototype.onActivation = function (handler) {\r\n        return this._bindingOnSyntax.onActivation(handler);\r\n    };\r\n    BindingWhenOnSyntax.prototype.onDeactivation = function (handler) {\r\n        return this._bindingOnSyntax.onDeactivation(handler);\r\n    };\r\n    return BindingWhenOnSyntax;\r\n}());\r\nexports.BindingWhenOnSyntax = BindingWhenOnSyntax;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingInSyntax = void 0;\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar binding_when_on_syntax_1 = require(\"./binding_when_on_syntax\");\r\nvar BindingInSyntax = (function () {\r\n    function BindingInSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingInSyntax.prototype.inRequestScope = function () {\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Request;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingInSyntax.prototype.inSingletonScope = function () {\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingInSyntax.prototype.inTransientScope = function () {\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Transient;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    return BindingInSyntax;\r\n}());\r\nexports.BindingInSyntax = BindingInSyntax;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingInWhenOnSyntax = void 0;\r\nvar binding_in_syntax_1 = require(\"./binding_in_syntax\");\r\nvar binding_on_syntax_1 = require(\"./binding_on_syntax\");\r\nvar binding_when_syntax_1 = require(\"./binding_when_syntax\");\r\nvar BindingInWhenOnSyntax = (function () {\r\n    function BindingInWhenOnSyntax(binding) {\r\n        this._binding = binding;\r\n        this._bindingWhenSyntax = new binding_when_syntax_1.BindingWhenSyntax(this._binding);\r\n        this._bindingOnSyntax = new binding_on_syntax_1.BindingOnSyntax(this._binding);\r\n        this._bindingInSyntax = new binding_in_syntax_1.BindingInSyntax(binding);\r\n    }\r\n    BindingInWhenOnSyntax.prototype.inRequestScope = function () {\r\n        return this._bindingInSyntax.inRequestScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.inSingletonScope = function () {\r\n        return this._bindingInSyntax.inSingletonScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.inTransientScope = function () {\r\n        return this._bindingInSyntax.inTransientScope();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.when = function (constraint) {\r\n        return this._bindingWhenSyntax.when(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenTargetNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetIsDefault = function () {\r\n        return this._bindingWhenSyntax.whenTargetIsDefault();\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenTargetTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenTargetTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenInjectedInto = function (parent) {\r\n        return this._bindingWhenSyntax.whenInjectedInto(parent);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenParentNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenParentNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenParentTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenParentTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorIs(ancestor);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorIs = function (ancestor) {\r\n        return this._bindingWhenSyntax.whenNoAncestorIs(ancestor);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorNamed = function (name) {\r\n        return this._bindingWhenSyntax.whenNoAncestorNamed(name);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorTagged = function (tag, value) {\r\n        return this._bindingWhenSyntax.whenNoAncestorTagged(tag, value);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenAnyAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenAnyAncestorMatches(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.whenNoAncestorMatches = function (constraint) {\r\n        return this._bindingWhenSyntax.whenNoAncestorMatches(constraint);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.onActivation = function (handler) {\r\n        return this._bindingOnSyntax.onActivation(handler);\r\n    };\r\n    BindingInWhenOnSyntax.prototype.onDeactivation = function (handler) {\r\n        return this._bindingOnSyntax.onDeactivation(handler);\r\n    };\r\n    return BindingInWhenOnSyntax;\r\n}());\r\nexports.BindingInWhenOnSyntax = BindingInWhenOnSyntax;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.BindingToSyntax = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar binding_in_when_on_syntax_1 = require(\"./binding_in_when_on_syntax\");\r\nvar binding_when_on_syntax_1 = require(\"./binding_when_on_syntax\");\r\nvar BindingToSyntax = (function () {\r\n    function BindingToSyntax(binding) {\r\n        this._binding = binding;\r\n    }\r\n    BindingToSyntax.prototype.to = function (constructor) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Instance;\r\n        this._binding.implementationType = constructor;\r\n        return new binding_in_when_on_syntax_1.BindingInWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toSelf = function () {\r\n        if (typeof this._binding.serviceIdentifier !== \"function\") {\r\n            throw new Error(\"\" + ERROR_MSGS.INVALID_TO_SELF_VALUE);\r\n        }\r\n        var self = this._binding.serviceIdentifier;\r\n        return this.to(self);\r\n    };\r\n    BindingToSyntax.prototype.toConstantValue = function (value) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.ConstantValue;\r\n        this._binding.cache = value;\r\n        this._binding.dynamicValue = null;\r\n        this._binding.implementationType = null;\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toDynamicValue = function (func) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.DynamicValue;\r\n        this._binding.cache = null;\r\n        this._binding.dynamicValue = func;\r\n        this._binding.implementationType = null;\r\n        return new binding_in_when_on_syntax_1.BindingInWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toConstructor = function (constructor) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Constructor;\r\n        this._binding.implementationType = constructor;\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toFactory = function (factory) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Factory;\r\n        this._binding.factory = factory;\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toFunction = function (func) {\r\n        if (typeof func !== \"function\") {\r\n            throw new Error(ERROR_MSGS.INVALID_FUNCTION_BINDING);\r\n        }\r\n        var bindingWhenOnSyntax = this.toConstantValue(func);\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Function;\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return bindingWhenOnSyntax;\r\n    };\r\n    BindingToSyntax.prototype.toAutoFactory = function (serviceIdentifier) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Factory;\r\n        this._binding.factory = function (context) {\r\n            var autofactory = function () { return context.container.get(serviceIdentifier); };\r\n            return autofactory;\r\n        };\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toAutoNamedFactory = function (serviceIdentifier) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Factory;\r\n        this._binding.factory = function (context) {\r\n            return function (named) { return context.container.getNamed(serviceIdentifier, named); };\r\n        };\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toProvider = function (provider) {\r\n        this._binding.type = literal_types_1.BindingTypeEnum.Provider;\r\n        this._binding.provider = provider;\r\n        this._binding.scope = literal_types_1.BindingScopeEnum.Singleton;\r\n        return new binding_when_on_syntax_1.BindingWhenOnSyntax(this._binding);\r\n    };\r\n    BindingToSyntax.prototype.toService = function (service) {\r\n        this.toDynamicValue(function (context) { return context.container.get(service); });\r\n    };\r\n    return BindingToSyntax;\r\n}());\r\nexports.BindingToSyntax = BindingToSyntax;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ContainerSnapshot = void 0;\r\nvar ContainerSnapshot = (function () {\r\n    function ContainerSnapshot() {\r\n    }\r\n    ContainerSnapshot.of = function (bindings, middleware, activations, deactivations, moduleActivationStore) {\r\n        var snapshot = new ContainerSnapshot();\r\n        snapshot.bindings = bindings;\r\n        snapshot.middleware = middleware;\r\n        snapshot.deactivations = deactivations;\r\n        snapshot.activations = activations;\r\n        snapshot.moduleActivationStore = moduleActivationStore;\r\n        return snapshot;\r\n    };\r\n    return ContainerSnapshot;\r\n}());\r\nexports.ContainerSnapshot = ContainerSnapshot;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.isClonable = void 0;\r\nfunction isClonable(obj) {\r\n    return (typeof obj === 'object')\r\n        && (obj !== null)\r\n        && ('clone' in obj)\r\n        && typeof obj.clone === 'function';\r\n}\r\nexports.isClonable = isClonable;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Lookup = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar clonable_1 = require(\"../utils/clonable\");\r\nvar Lookup = (function () {\r\n    function Lookup() {\r\n        this._map = new Map();\r\n    }\r\n    Lookup.prototype.getMap = function () {\r\n        return this._map;\r\n    };\r\n    Lookup.prototype.add = function (serviceIdentifier, value) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        if (value === null || value === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        var entry = this._map.get(serviceIdentifier);\r\n        if (entry !== undefined) {\r\n            entry.push(value);\r\n        }\r\n        else {\r\n            this._map.set(serviceIdentifier, [value]);\r\n        }\r\n    };\r\n    Lookup.prototype.get = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        var entry = this._map.get(serviceIdentifier);\r\n        if (entry !== undefined) {\r\n            return entry;\r\n        }\r\n        else {\r\n            throw new Error(ERROR_MSGS.KEY_NOT_FOUND);\r\n        }\r\n    };\r\n    Lookup.prototype.remove = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        if (!this._map.delete(serviceIdentifier)) {\r\n            throw new Error(ERROR_MSGS.KEY_NOT_FOUND);\r\n        }\r\n    };\r\n    Lookup.prototype.removeIntersection = function (lookup) {\r\n        var _this = this;\r\n        this.traverse(function (serviceIdentifier, value) {\r\n            var lookupActivations = lookup.hasKey(serviceIdentifier) ? lookup.get(serviceIdentifier) : undefined;\r\n            if (lookupActivations !== undefined) {\r\n                var filteredValues = value.filter(function (lookupValue) {\r\n                    return !lookupActivations.some(function (moduleActivation) { return lookupValue === moduleActivation; });\r\n                });\r\n                _this._setValue(serviceIdentifier, filteredValues);\r\n            }\r\n        });\r\n    };\r\n    Lookup.prototype.removeByCondition = function (condition) {\r\n        var _this = this;\r\n        var removals = [];\r\n        this._map.forEach(function (entries, key) {\r\n            var updatedEntries = [];\r\n            for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\r\n                var entry = entries_1[_i];\r\n                var remove = condition(entry);\r\n                if (remove) {\r\n                    removals.push(entry);\r\n                }\r\n                else {\r\n                    updatedEntries.push(entry);\r\n                }\r\n            }\r\n            _this._setValue(key, updatedEntries);\r\n        });\r\n        return removals;\r\n    };\r\n    Lookup.prototype.hasKey = function (serviceIdentifier) {\r\n        if (serviceIdentifier === null || serviceIdentifier === undefined) {\r\n            throw new Error(ERROR_MSGS.NULL_ARGUMENT);\r\n        }\r\n        return this._map.has(serviceIdentifier);\r\n    };\r\n    Lookup.prototype.clone = function () {\r\n        var copy = new Lookup();\r\n        this._map.forEach(function (value, key) {\r\n            value.forEach(function (b) { return copy.add(key, (0, clonable_1.isClonable)(b) ? b.clone() : b); });\r\n        });\r\n        return copy;\r\n    };\r\n    Lookup.prototype.traverse = function (func) {\r\n        this._map.forEach(function (value, key) {\r\n            func(key, value);\r\n        });\r\n    };\r\n    Lookup.prototype._setValue = function (serviceIdentifier, value) {\r\n        if (value.length > 0) {\r\n            this._map.set(serviceIdentifier, value);\r\n        }\r\n        else {\r\n            this._map.delete(serviceIdentifier);\r\n        }\r\n    };\r\n    return Lookup;\r\n}());\r\nexports.Lookup = Lookup;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.ModuleActivationStore = void 0;\r\nvar lookup_1 = require(\"./lookup\");\r\nvar ModuleActivationStore = (function () {\r\n    function ModuleActivationStore() {\r\n        this._map = new Map();\r\n    }\r\n    ModuleActivationStore.prototype.remove = function (moduleId) {\r\n        if (this._map.has(moduleId)) {\r\n            var handlers = this._map.get(moduleId);\r\n            this._map.delete(moduleId);\r\n            return handlers;\r\n        }\r\n        return this._getEmptyHandlersStore();\r\n    };\r\n    ModuleActivationStore.prototype.addDeactivation = function (moduleId, serviceIdentifier, onDeactivation) {\r\n        this._getModuleActivationHandlers(moduleId)\r\n            .onDeactivations.add(serviceIdentifier, onDeactivation);\r\n    };\r\n    ModuleActivationStore.prototype.addActivation = function (moduleId, serviceIdentifier, onActivation) {\r\n        this._getModuleActivationHandlers(moduleId)\r\n            .onActivations.add(serviceIdentifier, onActivation);\r\n    };\r\n    ModuleActivationStore.prototype.clone = function () {\r\n        var clone = new ModuleActivationStore();\r\n        this._map.forEach(function (handlersStore, moduleId) {\r\n            clone._map.set(moduleId, {\r\n                onActivations: handlersStore.onActivations.clone(),\r\n                onDeactivations: handlersStore.onDeactivations.clone(),\r\n            });\r\n        });\r\n        return clone;\r\n    };\r\n    ModuleActivationStore.prototype._getModuleActivationHandlers = function (moduleId) {\r\n        var moduleActivationHandlers = this._map.get(moduleId);\r\n        if (moduleActivationHandlers === undefined) {\r\n            moduleActivationHandlers = this._getEmptyHandlersStore();\r\n            this._map.set(moduleId, moduleActivationHandlers);\r\n        }\r\n        return moduleActivationHandlers;\r\n    };\r\n    ModuleActivationStore.prototype._getEmptyHandlersStore = function () {\r\n        var handlersStore = {\r\n            onActivations: new lookup_1.Lookup(),\r\n            onDeactivations: new lookup_1.Lookup()\r\n        };\r\n        return handlersStore;\r\n    };\r\n    return ModuleActivationStore;\r\n}());\r\nexports.ModuleActivationStore = ModuleActivationStore;\r\n", "\"use strict\";\r\nvar __assign = (this && this.__assign) || function () {\r\n    __assign = Object.assign || function(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\r\n                t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.Container = void 0;\r\nvar binding_1 = require(\"../bindings/binding\");\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar literal_types_1 = require(\"../constants/literal_types\");\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_reader_1 = require(\"../planning/metadata_reader\");\r\nvar planner_1 = require(\"../planning/planner\");\r\nvar resolver_1 = require(\"../resolution/resolver\");\r\nvar binding_to_syntax_1 = require(\"../syntax/binding_to_syntax\");\r\nvar async_1 = require(\"../utils/async\");\r\nvar id_1 = require(\"../utils/id\");\r\nvar serialization_1 = require(\"../utils/serialization\");\r\nvar container_snapshot_1 = require(\"./container_snapshot\");\r\nvar lookup_1 = require(\"./lookup\");\r\nvar module_activation_store_1 = require(\"./module_activation_store\");\r\nvar Container = (function () {\r\n    function Container(containerOptions) {\r\n        var options = containerOptions || {};\r\n        if (typeof options !== 'object') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);\r\n        }\r\n        if (options.defaultScope === undefined) {\r\n            options.defaultScope = literal_types_1.BindingScopeEnum.Transient;\r\n        }\r\n        else if (options.defaultScope !== literal_types_1.BindingScopeEnum.Singleton &&\r\n            options.defaultScope !== literal_types_1.BindingScopeEnum.Transient &&\r\n            options.defaultScope !== literal_types_1.BindingScopeEnum.Request) {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);\r\n        }\r\n        if (options.autoBindInjectable === undefined) {\r\n            options.autoBindInjectable = false;\r\n        }\r\n        else if (typeof options.autoBindInjectable !== 'boolean') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);\r\n        }\r\n        if (options.skipBaseClassChecks === undefined) {\r\n            options.skipBaseClassChecks = false;\r\n        }\r\n        else if (typeof options.skipBaseClassChecks !== 'boolean') {\r\n            throw new Error(\"\" + ERROR_MSGS.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);\r\n        }\r\n        this.options = {\r\n            autoBindInjectable: options.autoBindInjectable,\r\n            defaultScope: options.defaultScope,\r\n            skipBaseClassChecks: options.skipBaseClassChecks\r\n        };\r\n        this.id = (0, id_1.id)();\r\n        this._bindingDictionary = new lookup_1.Lookup();\r\n        this._snapshots = [];\r\n        this._middleware = null;\r\n        this._activations = new lookup_1.Lookup();\r\n        this._deactivations = new lookup_1.Lookup();\r\n        this.parent = null;\r\n        this._metadataReader = new metadata_reader_1.MetadataReader();\r\n        this._moduleActivationStore = new module_activation_store_1.ModuleActivationStore();\r\n    }\r\n    Container.merge = function (container1, container2) {\r\n        var containers = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            containers[_i - 2] = arguments[_i];\r\n        }\r\n        var container = new Container();\r\n        var targetContainers = __spreadArray([container1, container2], containers, true).map(function (targetContainer) { return (0, planner_1.getBindingDictionary)(targetContainer); });\r\n        var bindingDictionary = (0, planner_1.getBindingDictionary)(container);\r\n        function copyDictionary(origin, destination) {\r\n            origin.traverse(function (_key, value) {\r\n                value.forEach(function (binding) {\r\n                    destination.add(binding.serviceIdentifier, binding.clone());\r\n                });\r\n            });\r\n        }\r\n        targetContainers.forEach(function (targetBindingDictionary) {\r\n            copyDictionary(targetBindingDictionary, bindingDictionary);\r\n        });\r\n        return container;\r\n    };\r\n    Container.prototype.load = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        var getHelpers = this._getContainerModuleHelpersFactory();\r\n        for (var _a = 0, modules_1 = modules; _a < modules_1.length; _a++) {\r\n            var currentModule = modules_1[_a];\r\n            var containerModuleHelpers = getHelpers(currentModule.id);\r\n            currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction, containerModuleHelpers.unbindAsyncFunction, containerModuleHelpers.onActivationFunction, containerModuleHelpers.onDeactivationFunction);\r\n        }\r\n    };\r\n    Container.prototype.loadAsync = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getHelpers, _a, modules_2, currentModule, containerModuleHelpers;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        getHelpers = this._getContainerModuleHelpersFactory();\r\n                        _a = 0, modules_2 = modules;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(_a < modules_2.length)) return [3, 4];\r\n                        currentModule = modules_2[_a];\r\n                        containerModuleHelpers = getHelpers(currentModule.id);\r\n                        return [4, currentModule.registry(containerModuleHelpers.bindFunction, containerModuleHelpers.unbindFunction, containerModuleHelpers.isboundFunction, containerModuleHelpers.rebindFunction, containerModuleHelpers.unbindAsyncFunction, containerModuleHelpers.onActivationFunction, containerModuleHelpers.onDeactivationFunction)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _a++;\r\n                        return [3, 1];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unload = function () {\r\n        var _this = this;\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        modules.forEach(function (module) {\r\n            var deactivations = _this._removeModuleBindings(module.id);\r\n            _this._deactivateSingletons(deactivations);\r\n            _this._removeModuleHandlers(module.id);\r\n        });\r\n    };\r\n    Container.prototype.unloadAsync = function () {\r\n        var modules = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            modules[_i] = arguments[_i];\r\n        }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, modules_3, module_1, deactivations;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        _a = 0, modules_3 = modules;\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        if (!(_a < modules_3.length)) return [3, 4];\r\n                        module_1 = modules_3[_a];\r\n                        deactivations = this._removeModuleBindings(module_1.id);\r\n                        return [4, this._deactivateSingletonsAsync(deactivations)];\r\n                    case 2:\r\n                        _b.sent();\r\n                        this._removeModuleHandlers(module_1.id);\r\n                        _b.label = 3;\r\n                    case 3:\r\n                        _a++;\r\n                        return [3, 1];\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.bind = function (serviceIdentifier) {\r\n        var scope = this.options.defaultScope || literal_types_1.BindingScopeEnum.Transient;\r\n        var binding = new binding_1.Binding(serviceIdentifier, scope);\r\n        this._bindingDictionary.add(serviceIdentifier, binding);\r\n        return new binding_to_syntax_1.BindingToSyntax(binding);\r\n    };\r\n    Container.prototype.rebind = function (serviceIdentifier) {\r\n        this.unbind(serviceIdentifier);\r\n        return this.bind(serviceIdentifier);\r\n    };\r\n    Container.prototype.rebindAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, this.unbindAsync(serviceIdentifier)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2, this.bind(serviceIdentifier)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unbind = function (serviceIdentifier) {\r\n        if (this._bindingDictionary.hasKey(serviceIdentifier)) {\r\n            var bindings = this._bindingDictionary.get(serviceIdentifier);\r\n            this._deactivateSingletons(bindings);\r\n        }\r\n        this._removeServiceFromDictionary(serviceIdentifier);\r\n    };\r\n    Container.prototype.unbindAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var bindings;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this._bindingDictionary.hasKey(serviceIdentifier)) return [3, 2];\r\n                        bindings = this._bindingDictionary.get(serviceIdentifier);\r\n                        return [4, this._deactivateSingletonsAsync(bindings)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2:\r\n                        this._removeServiceFromDictionary(serviceIdentifier);\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.unbindAll = function () {\r\n        var _this = this;\r\n        this._bindingDictionary.traverse(function (_key, value) {\r\n            _this._deactivateSingletons(value);\r\n        });\r\n        this._bindingDictionary = new lookup_1.Lookup();\r\n    };\r\n    Container.prototype.unbindAllAsync = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var promises;\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        promises = [];\r\n                        this._bindingDictionary.traverse(function (_key, value) {\r\n                            promises.push(_this._deactivateSingletonsAsync(value));\r\n                        });\r\n                        return [4, Promise.all(promises)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        this._bindingDictionary = new lookup_1.Lookup();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.onActivation = function (serviceIdentifier, onActivation) {\r\n        this._activations.add(serviceIdentifier, onActivation);\r\n    };\r\n    Container.prototype.onDeactivation = function (serviceIdentifier, onDeactivation) {\r\n        this._deactivations.add(serviceIdentifier, onDeactivation);\r\n    };\r\n    Container.prototype.isBound = function (serviceIdentifier) {\r\n        var bound = this._bindingDictionary.hasKey(serviceIdentifier);\r\n        if (!bound && this.parent) {\r\n            bound = this.parent.isBound(serviceIdentifier);\r\n        }\r\n        return bound;\r\n    };\r\n    Container.prototype.isCurrentBound = function (serviceIdentifier) {\r\n        return this._bindingDictionary.hasKey(serviceIdentifier);\r\n    };\r\n    Container.prototype.isBoundNamed = function (serviceIdentifier, named) {\r\n        return this.isBoundTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.isBoundTagged = function (serviceIdentifier, key, value) {\r\n        var bound = false;\r\n        if (this._bindingDictionary.hasKey(serviceIdentifier)) {\r\n            var bindings = this._bindingDictionary.get(serviceIdentifier);\r\n            var request_1 = (0, planner_1.createMockRequest)(this, serviceIdentifier, key, value);\r\n            bound = bindings.some(function (b) { return b.constraint(request_1); });\r\n        }\r\n        if (!bound && this.parent) {\r\n            bound = this.parent.isBoundTagged(serviceIdentifier, key, value);\r\n        }\r\n        return bound;\r\n    };\r\n    Container.prototype.snapshot = function () {\r\n        this._snapshots.push(container_snapshot_1.ContainerSnapshot.of(this._bindingDictionary.clone(), this._middleware, this._activations.clone(), this._deactivations.clone(), this._moduleActivationStore.clone()));\r\n    };\r\n    Container.prototype.restore = function () {\r\n        var snapshot = this._snapshots.pop();\r\n        if (snapshot === undefined) {\r\n            throw new Error(ERROR_MSGS.NO_MORE_SNAPSHOTS_AVAILABLE);\r\n        }\r\n        this._bindingDictionary = snapshot.bindings;\r\n        this._activations = snapshot.activations;\r\n        this._deactivations = snapshot.deactivations;\r\n        this._middleware = snapshot.middleware;\r\n        this._moduleActivationStore = snapshot.moduleActivationStore;\r\n    };\r\n    Container.prototype.createChild = function (containerOptions) {\r\n        var child = new Container(containerOptions || this.options);\r\n        child.parent = this;\r\n        return child;\r\n    };\r\n    Container.prototype.applyMiddleware = function () {\r\n        var middlewares = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            middlewares[_i] = arguments[_i];\r\n        }\r\n        var initial = (this._middleware) ? this._middleware : this._planAndResolve();\r\n        this._middleware = middlewares.reduce(function (prev, curr) { return curr(prev); }, initial);\r\n    };\r\n    Container.prototype.applyCustomMetadataReader = function (metadataReader) {\r\n        this._metadataReader = metadataReader;\r\n    };\r\n    Container.prototype.get = function (serviceIdentifier) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, false);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAsync = function (serviceIdentifier) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getArgs;\r\n            return __generator(this, function (_a) {\r\n                getArgs = this._getNotAllArgs(serviceIdentifier, false);\r\n                return [2, this._get(getArgs)];\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.getTagged = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, false, key, value);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getTaggedAsync = function (serviceIdentifier, key, value) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var getArgs;\r\n            return __generator(this, function (_a) {\r\n                getArgs = this._getNotAllArgs(serviceIdentifier, false, key, value);\r\n                return [2, this._get(getArgs)];\r\n            });\r\n        });\r\n    };\r\n    Container.prototype.getNamed = function (serviceIdentifier, named) {\r\n        return this.getTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getNamedAsync = function (serviceIdentifier, named) {\r\n        return this.getTaggedAsync(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getAll = function (serviceIdentifier) {\r\n        var getArgs = this._getAllArgs(serviceIdentifier);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAllAsync = function (serviceIdentifier) {\r\n        var getArgs = this._getAllArgs(serviceIdentifier);\r\n        return this._getAll(getArgs);\r\n    };\r\n    Container.prototype.getAllTagged = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, true, key, value);\r\n        return this._getButThrowIfAsync(getArgs);\r\n    };\r\n    Container.prototype.getAllTaggedAsync = function (serviceIdentifier, key, value) {\r\n        var getArgs = this._getNotAllArgs(serviceIdentifier, true, key, value);\r\n        return this._getAll(getArgs);\r\n    };\r\n    Container.prototype.getAllNamed = function (serviceIdentifier, named) {\r\n        return this.getAllTagged(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.getAllNamedAsync = function (serviceIdentifier, named) {\r\n        return this.getAllTaggedAsync(serviceIdentifier, METADATA_KEY.NAMED_TAG, named);\r\n    };\r\n    Container.prototype.resolve = function (constructorFunction) {\r\n        var isBound = this.isBound(constructorFunction);\r\n        if (!isBound) {\r\n            this.bind(constructorFunction).toSelf();\r\n        }\r\n        var resolved = this.get(constructorFunction);\r\n        if (!isBound) {\r\n            this.unbind(constructorFunction);\r\n        }\r\n        return resolved;\r\n    };\r\n    Container.prototype._preDestroy = function (constructor, instance) {\r\n        var _a, _b;\r\n        if (Reflect.hasMetadata(METADATA_KEY.PRE_DESTROY, constructor)) {\r\n            var data = Reflect.getMetadata(METADATA_KEY.PRE_DESTROY, constructor);\r\n            return (_b = (_a = instance)[data.value]) === null || _b === void 0 ? void 0 : _b.call(_a);\r\n        }\r\n    };\r\n    Container.prototype._removeModuleHandlers = function (moduleId) {\r\n        var moduleActivationsHandlers = this._moduleActivationStore.remove(moduleId);\r\n        this._activations.removeIntersection(moduleActivationsHandlers.onActivations);\r\n        this._deactivations.removeIntersection(moduleActivationsHandlers.onDeactivations);\r\n    };\r\n    Container.prototype._removeModuleBindings = function (moduleId) {\r\n        return this._bindingDictionary.removeByCondition(function (binding) { return binding.moduleId === moduleId; });\r\n    };\r\n    Container.prototype._deactivate = function (binding, instance) {\r\n        var _this = this;\r\n        var constructor = Object.getPrototypeOf(instance).constructor;\r\n        try {\r\n            if (this._deactivations.hasKey(binding.serviceIdentifier)) {\r\n                var result = this._deactivateContainer(instance, this._deactivations.get(binding.serviceIdentifier).values());\r\n                if ((0, async_1.isPromise)(result)) {\r\n                    return this._handleDeactivationError(result.then(function () { return _this._propagateContainerDeactivationThenBindingAndPreDestroyAsync(binding, instance, constructor); }), constructor);\r\n                }\r\n            }\r\n            var propagateDeactivationResult = this._propagateContainerDeactivationThenBindingAndPreDestroy(binding, instance, constructor);\r\n            if ((0, async_1.isPromise)(propagateDeactivationResult)) {\r\n                return this._handleDeactivationError(propagateDeactivationResult, constructor);\r\n            }\r\n        }\r\n        catch (ex) {\r\n            if (ex instanceof Error) {\r\n                throw new Error(ERROR_MSGS.ON_DEACTIVATION_ERROR(constructor.name, ex.message));\r\n            }\r\n        }\r\n    };\r\n    Container.prototype._handleDeactivationError = function (asyncResult, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var ex_1;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        _a.trys.push([0, 2, , 3]);\r\n                        return [4, asyncResult];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 3];\r\n                    case 2:\r\n                        ex_1 = _a.sent();\r\n                        if (ex_1 instanceof Error) {\r\n                            throw new Error(ERROR_MSGS.ON_DEACTIVATION_ERROR(constructor.name, ex_1.message));\r\n                        }\r\n                        return [3, 3];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._deactivateContainer = function (instance, deactivationsIterator) {\r\n        var _this = this;\r\n        var deactivation = deactivationsIterator.next();\r\n        while (deactivation.value) {\r\n            var result = deactivation.value(instance);\r\n            if ((0, async_1.isPromise)(result)) {\r\n                return result.then(function () {\r\n                    return _this._deactivateContainerAsync(instance, deactivationsIterator);\r\n                });\r\n            }\r\n            deactivation = deactivationsIterator.next();\r\n        }\r\n    };\r\n    Container.prototype._deactivateContainerAsync = function (instance, deactivationsIterator) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var deactivation;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        deactivation = deactivationsIterator.next();\r\n                        _a.label = 1;\r\n                    case 1:\r\n                        if (!deactivation.value) return [3, 3];\r\n                        return [4, deactivation.value(instance)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        deactivation = deactivationsIterator.next();\r\n                        return [3, 1];\r\n                    case 3: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._getContainerModuleHelpersFactory = function () {\r\n        var _this = this;\r\n        var setModuleId = function (bindingToSyntax, moduleId) {\r\n            bindingToSyntax._binding.moduleId = moduleId;\r\n        };\r\n        var getBindFunction = function (moduleId) {\r\n            return function (serviceIdentifier) {\r\n                var bindingToSyntax = _this.bind(serviceIdentifier);\r\n                setModuleId(bindingToSyntax, moduleId);\r\n                return bindingToSyntax;\r\n            };\r\n        };\r\n        var getUnbindFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.unbind(serviceIdentifier);\r\n            };\r\n        };\r\n        var getUnbindAsyncFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.unbindAsync(serviceIdentifier);\r\n            };\r\n        };\r\n        var getIsboundFunction = function () {\r\n            return function (serviceIdentifier) {\r\n                return _this.isBound(serviceIdentifier);\r\n            };\r\n        };\r\n        var getRebindFunction = function (moduleId) {\r\n            return function (serviceIdentifier) {\r\n                var bindingToSyntax = _this.rebind(serviceIdentifier);\r\n                setModuleId(bindingToSyntax, moduleId);\r\n                return bindingToSyntax;\r\n            };\r\n        };\r\n        var getOnActivationFunction = function (moduleId) {\r\n            return function (serviceIdentifier, onActivation) {\r\n                _this._moduleActivationStore.addActivation(moduleId, serviceIdentifier, onActivation);\r\n                _this.onActivation(serviceIdentifier, onActivation);\r\n            };\r\n        };\r\n        var getOnDeactivationFunction = function (moduleId) {\r\n            return function (serviceIdentifier, onDeactivation) {\r\n                _this._moduleActivationStore.addDeactivation(moduleId, serviceIdentifier, onDeactivation);\r\n                _this.onDeactivation(serviceIdentifier, onDeactivation);\r\n            };\r\n        };\r\n        return function (mId) { return ({\r\n            bindFunction: getBindFunction(mId),\r\n            isboundFunction: getIsboundFunction(),\r\n            onActivationFunction: getOnActivationFunction(mId),\r\n            onDeactivationFunction: getOnDeactivationFunction(mId),\r\n            rebindFunction: getRebindFunction(mId),\r\n            unbindFunction: getUnbindFunction(),\r\n            unbindAsyncFunction: getUnbindAsyncFunction()\r\n        }); };\r\n    };\r\n    Container.prototype._getAll = function (getArgs) {\r\n        return Promise.all(this._get(getArgs));\r\n    };\r\n    Container.prototype._get = function (getArgs) {\r\n        var planAndResolveArgs = __assign(__assign({}, getArgs), { contextInterceptor: function (context) { return context; }, targetType: literal_types_1.TargetTypeEnum.Variable });\r\n        if (this._middleware) {\r\n            var middlewareResult = this._middleware(planAndResolveArgs);\r\n            if (middlewareResult === undefined || middlewareResult === null) {\r\n                throw new Error(ERROR_MSGS.INVALID_MIDDLEWARE_RETURN);\r\n            }\r\n            return middlewareResult;\r\n        }\r\n        return this._planAndResolve()(planAndResolveArgs);\r\n    };\r\n    Container.prototype._getButThrowIfAsync = function (getArgs) {\r\n        var result = this._get(getArgs);\r\n        if ((0, async_1.isPromiseOrContainsPromise)(result)) {\r\n            throw new Error(ERROR_MSGS.LAZY_IN_SYNC(getArgs.serviceIdentifier));\r\n        }\r\n        return result;\r\n    };\r\n    Container.prototype._getAllArgs = function (serviceIdentifier) {\r\n        var getAllArgs = {\r\n            avoidConstraints: true,\r\n            isMultiInject: true,\r\n            serviceIdentifier: serviceIdentifier,\r\n        };\r\n        return getAllArgs;\r\n    };\r\n    Container.prototype._getNotAllArgs = function (serviceIdentifier, isMultiInject, key, value) {\r\n        var getNotAllArgs = {\r\n            avoidConstraints: false,\r\n            isMultiInject: isMultiInject,\r\n            serviceIdentifier: serviceIdentifier,\r\n            key: key,\r\n            value: value,\r\n        };\r\n        return getNotAllArgs;\r\n    };\r\n    Container.prototype._planAndResolve = function () {\r\n        var _this = this;\r\n        return function (args) {\r\n            var context = (0, planner_1.plan)(_this._metadataReader, _this, args.isMultiInject, args.targetType, args.serviceIdentifier, args.key, args.value, args.avoidConstraints);\r\n            context = args.contextInterceptor(context);\r\n            var result = (0, resolver_1.resolve)(context);\r\n            return result;\r\n        };\r\n    };\r\n    Container.prototype._deactivateIfSingleton = function (binding) {\r\n        var _this = this;\r\n        if (!binding.activated) {\r\n            return;\r\n        }\r\n        if ((0, async_1.isPromise)(binding.cache)) {\r\n            return binding.cache.then(function (resolved) { return _this._deactivate(binding, resolved); });\r\n        }\r\n        return this._deactivate(binding, binding.cache);\r\n    };\r\n    Container.prototype._deactivateSingletons = function (bindings) {\r\n        for (var _i = 0, bindings_1 = bindings; _i < bindings_1.length; _i++) {\r\n            var binding = bindings_1[_i];\r\n            var result = this._deactivateIfSingleton(binding);\r\n            if ((0, async_1.isPromise)(result)) {\r\n                throw new Error(ERROR_MSGS.ASYNC_UNBIND_REQUIRED);\r\n            }\r\n        }\r\n    };\r\n    Container.prototype._deactivateSingletonsAsync = function (bindings) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _this = this;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4, Promise.all(bindings.map(function (b) { return _this._deactivateIfSingleton(b); }))];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._propagateContainerDeactivationThenBindingAndPreDestroy = function (binding, instance, constructor) {\r\n        if (this.parent) {\r\n            return this._deactivate.bind(this.parent)(binding, instance);\r\n        }\r\n        else {\r\n            return this._bindingDeactivationAndPreDestroy(binding, instance, constructor);\r\n        }\r\n    };\r\n    Container.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync = function (binding, instance, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.parent) return [3, 2];\r\n                        return [4, this._deactivate.bind(this.parent)(binding, instance)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        return [3, 4];\r\n                    case 2: return [4, this._bindingDeactivationAndPreDestroyAsync(binding, instance, constructor)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        _a.label = 4;\r\n                    case 4: return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    Container.prototype._removeServiceFromDictionary = function (serviceIdentifier) {\r\n        try {\r\n            this._bindingDictionary.remove(serviceIdentifier);\r\n        }\r\n        catch (e) {\r\n            throw new Error(ERROR_MSGS.CANNOT_UNBIND + \" \" + (0, serialization_1.getServiceIdentifierAsString)(serviceIdentifier));\r\n        }\r\n    };\r\n    Container.prototype._bindingDeactivationAndPreDestroy = function (binding, instance, constructor) {\r\n        var _this = this;\r\n        if (typeof binding.onDeactivation === 'function') {\r\n            var result = binding.onDeactivation(instance);\r\n            if ((0, async_1.isPromise)(result)) {\r\n                return result.then(function () { return _this._preDestroy(constructor, instance); });\r\n            }\r\n        }\r\n        return this._preDestroy(constructor, instance);\r\n    };\r\n    Container.prototype._bindingDeactivationAndPreDestroyAsync = function (binding, instance, constructor) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!(typeof binding.onDeactivation === 'function')) return [3, 2];\r\n                        return [4, binding.onDeactivation(instance)];\r\n                    case 1:\r\n                        _a.sent();\r\n                        _a.label = 2;\r\n                    case 2: return [4, this._preDestroy(constructor, instance)];\r\n                    case 3:\r\n                        _a.sent();\r\n                        return [2];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return Container;\r\n}());\r\nexports.Container = Container;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.AsyncContainerModule = exports.ContainerModule = void 0;\r\nvar id_1 = require(\"../utils/id\");\r\nvar ContainerModule = (function () {\r\n    function ContainerModule(registry) {\r\n        this.id = (0, id_1.id)();\r\n        this.registry = registry;\r\n    }\r\n    return ContainerModule;\r\n}());\r\nexports.ContainerModule = ContainerModule;\r\nvar AsyncContainerModule = (function () {\r\n    function AsyncContainerModule(registry) {\r\n        this.id = (0, id_1.id)();\r\n        this.registry = registry;\r\n    }\r\n    return AsyncContainerModule;\r\n}());\r\nexports.AsyncContainerModule = AsyncContainerModule;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getFirstArrayDuplicate = void 0;\r\nfunction getFirstArrayDuplicate(array) {\r\n    var seenValues = new Set();\r\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\r\n        var entry = array_1[_i];\r\n        if (seenValues.has(entry)) {\r\n            return entry;\r\n        }\r\n        else {\r\n            seenValues.add(entry);\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\nexports.getFirstArrayDuplicate = getFirstArrayDuplicate;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.createTaggedDecorator = exports.tagProperty = exports.tagParameter = exports.decorate = void 0;\r\nvar ERROR_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar js_1 = require(\"../utils/js\");\r\nfunction targetIsConstructorFunction(target) {\r\n    return target.prototype !== undefined;\r\n}\r\nfunction _throwIfMethodParameter(parameterName) {\r\n    if (parameterName !== undefined) {\r\n        throw new Error(ERROR_MSGS.INVALID_DECORATOR_OPERATION);\r\n    }\r\n}\r\nfunction tagParameter(annotationTarget, parameterName, parameterIndex, metadata) {\r\n    _throwIfMethodParameter(parameterName);\r\n    _tagParameterOrProperty(METADATA_KEY.TAGGED, annotationTarget, parameterIndex.toString(), metadata);\r\n}\r\nexports.tagParameter = tagParameter;\r\nfunction tagProperty(annotationTarget, propertyName, metadata) {\r\n    if (targetIsConstructorFunction(annotationTarget)) {\r\n        throw new Error(ERROR_MSGS.INVALID_DECORATOR_OPERATION);\r\n    }\r\n    _tagParameterOrProperty(METADATA_KEY.TAGGED_PROP, annotationTarget.constructor, propertyName, metadata);\r\n}\r\nexports.tagProperty = tagProperty;\r\nfunction _ensureNoMetadataKeyDuplicates(metadata) {\r\n    var metadatas = [];\r\n    if (Array.isArray(metadata)) {\r\n        metadatas = metadata;\r\n        var duplicate = (0, js_1.getFirstArrayDuplicate)(metadatas.map(function (md) { return md.key; }));\r\n        if (duplicate !== undefined) {\r\n            throw new Error(ERROR_MSGS.DUPLICATED_METADATA + \" \" + duplicate.toString());\r\n        }\r\n    }\r\n    else {\r\n        metadatas = [metadata];\r\n    }\r\n    return metadatas;\r\n}\r\nfunction _tagParameterOrProperty(metadataKey, annotationTarget, key, metadata) {\r\n    var metadatas = _ensureNoMetadataKeyDuplicates(metadata);\r\n    var paramsOrPropertiesMetadata = {};\r\n    if (Reflect.hasOwnMetadata(metadataKey, annotationTarget)) {\r\n        paramsOrPropertiesMetadata = Reflect.getMetadata(metadataKey, annotationTarget);\r\n    }\r\n    var paramOrPropertyMetadata = paramsOrPropertiesMetadata[key];\r\n    if (paramOrPropertyMetadata === undefined) {\r\n        paramOrPropertyMetadata = [];\r\n    }\r\n    else {\r\n        var _loop_1 = function (m) {\r\n            if (metadatas.some(function (md) { return md.key === m.key; })) {\r\n                throw new Error(ERROR_MSGS.DUPLICATED_METADATA + \" \" + m.key.toString());\r\n            }\r\n        };\r\n        for (var _i = 0, paramOrPropertyMetadata_1 = paramOrPropertyMetadata; _i < paramOrPropertyMetadata_1.length; _i++) {\r\n            var m = paramOrPropertyMetadata_1[_i];\r\n            _loop_1(m);\r\n        }\r\n    }\r\n    paramOrPropertyMetadata.push.apply(paramOrPropertyMetadata, metadatas);\r\n    paramsOrPropertiesMetadata[key] = paramOrPropertyMetadata;\r\n    Reflect.defineMetadata(metadataKey, paramsOrPropertiesMetadata, annotationTarget);\r\n}\r\nfunction createTaggedDecorator(metadata) {\r\n    return function (target, targetKey, indexOrPropertyDescriptor) {\r\n        if (typeof indexOrPropertyDescriptor === 'number') {\r\n            tagParameter(target, targetKey, indexOrPropertyDescriptor, metadata);\r\n        }\r\n        else {\r\n            tagProperty(target, targetKey, metadata);\r\n        }\r\n    };\r\n}\r\nexports.createTaggedDecorator = createTaggedDecorator;\r\nfunction _decorate(decorators, target) {\r\n    Reflect.decorate(decorators, target);\r\n}\r\nfunction _param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); };\r\n}\r\nfunction decorate(decorator, target, parameterIndexOrProperty) {\r\n    if (typeof parameterIndexOrProperty === 'number') {\r\n        _decorate([_param(parameterIndexOrProperty, decorator)], target);\r\n    }\r\n    else if (typeof parameterIndexOrProperty === 'string') {\r\n        Reflect.decorate([decorator], target, parameterIndexOrProperty);\r\n    }\r\n    else {\r\n        _decorate([decorator], target);\r\n    }\r\n}\r\nexports.decorate = decorate;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.injectable = void 0;\r\nvar ERRORS_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nfunction injectable() {\r\n    return function (target) {\r\n        if (Reflect.hasOwnMetadata(METADATA_KEY.PARAM_TYPES, target)) {\r\n            throw new Error(ERRORS_MSGS.DUPLICATED_INJECTABLE_DECORATOR);\r\n        }\r\n        var types = Reflect.getMetadata(METADATA_KEY.DESIGN_PARAM_TYPES, target) || [];\r\n        Reflect.defineMetadata(METADATA_KEY.PARAM_TYPES, types, target);\r\n        return target;\r\n    };\r\n}\r\nexports.injectable = injectable;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.tagged = void 0;\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction tagged(metadataKey, metadataValue) {\r\n    return (0, decorator_utils_1.createTaggedDecorator)(new metadata_1.Metadata(metadataKey, metadataValue));\r\n}\r\nexports.tagged = tagged;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.named = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction named(name) {\r\n    return (0, decorator_utils_1.createTaggedDecorator)(new metadata_1.Metadata(METADATA_KEY.NAMED_TAG, name));\r\n}\r\nexports.named = named;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.injectBase = void 0;\r\nvar error_msgs_1 = require(\"../constants/error_msgs\");\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction injectBase(metadataKey) {\r\n    return function (serviceIdentifier) {\r\n        return function (target, targetKey, indexOrPropertyDescriptor) {\r\n            if (serviceIdentifier === undefined) {\r\n                var className = typeof target === 'function' ? target.name : target.constructor.name;\r\n                throw new Error((0, error_msgs_1.UNDEFINED_INJECT_ANNOTATION)(className));\r\n            }\r\n            return (0, decorator_utils_1.createTaggedDecorator)(new metadata_1.Metadata(metadataKey, serviceIdentifier))(target, targetKey, indexOrPropertyDescriptor);\r\n        };\r\n    };\r\n}\r\nexports.injectBase = injectBase;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.inject = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar inject_base_1 = require(\"./inject_base\");\r\nvar inject = (0, inject_base_1.injectBase)(METADATA_KEY.INJECT_TAG);\r\nexports.inject = inject;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.optional = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction optional() {\r\n    return (0, decorator_utils_1.createTaggedDecorator)(new metadata_1.Metadata(METADATA_KEY.OPTIONAL_TAG, true));\r\n}\r\nexports.optional = optional;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.unmanaged = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction unmanaged() {\r\n    return function (target, targetKey, index) {\r\n        var metadata = new metadata_1.Metadata(METADATA_KEY.UNMANAGED_TAG, true);\r\n        (0, decorator_utils_1.tagParameter)(target, targetKey, index, metadata);\r\n    };\r\n}\r\nexports.unmanaged = unmanaged;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.multiInject = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar inject_base_1 = require(\"./inject_base\");\r\nvar multiInject = (0, inject_base_1.injectBase)(METADATA_KEY.MULTI_INJECT_TAG);\r\nexports.multiInject = multiInject;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.targetName = void 0;\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nvar decorator_utils_1 = require(\"./decorator_utils\");\r\nfunction targetName(name) {\r\n    return function (target, targetKey, index) {\r\n        var metadata = new metadata_1.Metadata(METADATA_KEY.NAME_TAG, name);\r\n        (0, decorator_utils_1.tagParameter)(target, targetKey, index, metadata);\r\n    };\r\n}\r\nexports.targetName = targetName;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.propertyEventDecorator = void 0;\r\nvar metadata_1 = require(\"../planning/metadata\");\r\nfunction propertyEventDecorator(eventKey, errorMessage) {\r\n    return function () {\r\n        return function (target, propertyKey) {\r\n            var metadata = new metadata_1.Metadata(eventKey, propertyKey);\r\n            if (Reflect.hasOwnMetadata(eventKey, target.constructor)) {\r\n                throw new Error(errorMessage);\r\n            }\r\n            Reflect.defineMetadata(eventKey, metadata, target.constructor);\r\n        };\r\n    };\r\n}\r\nexports.propertyEventDecorator = propertyEventDecorator;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.postConstruct = void 0;\r\nvar ERRORS_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar property_event_decorator_1 = require(\"./property_event_decorator\");\r\nvar postConstruct = (0, property_event_decorator_1.propertyEventDecorator)(METADATA_KEY.POST_CONSTRUCT, ERRORS_MSGS.MULTIPLE_POST_CONSTRUCT_METHODS);\r\nexports.postConstruct = postConstruct;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.preDestroy = void 0;\r\nvar ERRORS_MSGS = __importStar(require(\"../constants/error_msgs\"));\r\nvar METADATA_KEY = __importStar(require(\"../constants/metadata_keys\"));\r\nvar property_event_decorator_1 = require(\"./property_event_decorator\");\r\nvar preDestroy = (0, property_event_decorator_1.propertyEventDecorator)(METADATA_KEY.PRE_DESTROY, ERRORS_MSGS.MULTIPLE_PRE_DESTROY_METHODS);\r\nexports.preDestroy = preDestroy;\r\n", "\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.interfaces = void 0;\r\nvar interfaces;\r\n(function (interfaces) {\r\n    ;\r\n})(interfaces || (interfaces = {}));\r\nexports.interfaces = interfaces;\r\n", "\"use strict\";\r\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}));\r\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n});\r\nvar __importStar = (this && this.__importStar) || function (mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.multiBindToService = exports.getServiceIdentifierAsString = exports.typeConstraint = exports.namedConstraint = exports.taggedConstraint = exports.traverseAncerstors = exports.decorate = exports.interfaces = exports.id = exports.MetadataReader = exports.preDestroy = exports.postConstruct = exports.targetName = exports.multiInject = exports.unmanaged = exports.optional = exports.LazyServiceIdentifer = exports.LazyServiceIdentifier = exports.inject = exports.named = exports.tagged = exports.injectable = exports.createTaggedDecorator = exports.ContainerModule = exports.AsyncContainerModule = exports.TargetTypeEnum = exports.BindingTypeEnum = exports.BindingScopeEnum = exports.Container = exports.METADATA_KEY = void 0;\r\nvar keys = __importStar(require(\"./constants/metadata_keys\"));\r\nexports.METADATA_KEY = keys;\r\nvar container_1 = require(\"./container/container\");\r\nObject.defineProperty(exports, \"Container\", { enumerable: true, get: function () { return container_1.Container; } });\r\nvar literal_types_1 = require(\"./constants/literal_types\");\r\nObject.defineProperty(exports, \"BindingScopeEnum\", { enumerable: true, get: function () { return literal_types_1.BindingScopeEnum; } });\r\nObject.defineProperty(exports, \"BindingTypeEnum\", { enumerable: true, get: function () { return literal_types_1.BindingTypeEnum; } });\r\nObject.defineProperty(exports, \"TargetTypeEnum\", { enumerable: true, get: function () { return literal_types_1.TargetTypeEnum; } });\r\nvar container_module_1 = require(\"./container/container_module\");\r\nObject.defineProperty(exports, \"AsyncContainerModule\", { enumerable: true, get: function () { return container_module_1.AsyncContainerModule; } });\r\nObject.defineProperty(exports, \"ContainerModule\", { enumerable: true, get: function () { return container_module_1.ContainerModule; } });\r\nvar decorator_utils_1 = require(\"./annotation/decorator_utils\");\r\nObject.defineProperty(exports, \"createTaggedDecorator\", { enumerable: true, get: function () { return decorator_utils_1.createTaggedDecorator; } });\r\nvar injectable_1 = require(\"./annotation/injectable\");\r\nObject.defineProperty(exports, \"injectable\", { enumerable: true, get: function () { return injectable_1.injectable; } });\r\nvar tagged_1 = require(\"./annotation/tagged\");\r\nObject.defineProperty(exports, \"tagged\", { enumerable: true, get: function () { return tagged_1.tagged; } });\r\nvar named_1 = require(\"./annotation/named\");\r\nObject.defineProperty(exports, \"named\", { enumerable: true, get: function () { return named_1.named; } });\r\nvar inject_1 = require(\"./annotation/inject\");\r\nObject.defineProperty(exports, \"inject\", { enumerable: true, get: function () { return inject_1.inject; } });\r\nvar lazy_service_identifier_1 = require(\"./annotation/lazy_service_identifier\");\r\nObject.defineProperty(exports, \"LazyServiceIdentifier\", { enumerable: true, get: function () { return lazy_service_identifier_1.LazyServiceIdentifier; } });\r\nvar lazy_service_identifier_2 = require(\"./annotation/lazy_service_identifier\");\r\nObject.defineProperty(exports, \"LazyServiceIdentifer\", { enumerable: true, get: function () { return lazy_service_identifier_2.LazyServiceIdentifier; } });\r\nvar optional_1 = require(\"./annotation/optional\");\r\nObject.defineProperty(exports, \"optional\", { enumerable: true, get: function () { return optional_1.optional; } });\r\nvar unmanaged_1 = require(\"./annotation/unmanaged\");\r\nObject.defineProperty(exports, \"unmanaged\", { enumerable: true, get: function () { return unmanaged_1.unmanaged; } });\r\nvar multi_inject_1 = require(\"./annotation/multi_inject\");\r\nObject.defineProperty(exports, \"multiInject\", { enumerable: true, get: function () { return multi_inject_1.multiInject; } });\r\nvar target_name_1 = require(\"./annotation/target_name\");\r\nObject.defineProperty(exports, \"targetName\", { enumerable: true, get: function () { return target_name_1.targetName; } });\r\nvar post_construct_1 = require(\"./annotation/post_construct\");\r\nObject.defineProperty(exports, \"postConstruct\", { enumerable: true, get: function () { return post_construct_1.postConstruct; } });\r\nvar pre_destroy_1 = require(\"./annotation/pre_destroy\");\r\nObject.defineProperty(exports, \"preDestroy\", { enumerable: true, get: function () { return pre_destroy_1.preDestroy; } });\r\nvar metadata_reader_1 = require(\"./planning/metadata_reader\");\r\nObject.defineProperty(exports, \"MetadataReader\", { enumerable: true, get: function () { return metadata_reader_1.MetadataReader; } });\r\nvar id_1 = require(\"./utils/id\");\r\nObject.defineProperty(exports, \"id\", { enumerable: true, get: function () { return id_1.id; } });\r\nvar interfaces_1 = require(\"./interfaces/interfaces\");\r\nObject.defineProperty(exports, \"interfaces\", { enumerable: true, get: function () { return interfaces_1.interfaces; } });\r\nvar decorator_utils_2 = require(\"./annotation/decorator_utils\");\r\nObject.defineProperty(exports, \"decorate\", { enumerable: true, get: function () { return decorator_utils_2.decorate; } });\r\nvar constraint_helpers_1 = require(\"./syntax/constraint_helpers\");\r\nObject.defineProperty(exports, \"traverseAncerstors\", { enumerable: true, get: function () { return constraint_helpers_1.traverseAncerstors; } });\r\nObject.defineProperty(exports, \"taggedConstraint\", { enumerable: true, get: function () { return constraint_helpers_1.taggedConstraint; } });\r\nObject.defineProperty(exports, \"namedConstraint\", { enumerable: true, get: function () { return constraint_helpers_1.namedConstraint; } });\r\nObject.defineProperty(exports, \"typeConstraint\", { enumerable: true, get: function () { return constraint_helpers_1.typeConstraint; } });\r\nvar serialization_1 = require(\"./utils/serialization\");\r\nObject.defineProperty(exports, \"getServiceIdentifierAsString\", { enumerable: true, get: function () { return serialization_1.getServiceIdentifierAsString; } });\r\nvar binding_utils_1 = require(\"./utils/binding_utils\");\r\nObject.defineProperty(exports, \"multiBindToService\", { enumerable: true, get: function () { return binding_utils_1.multiBindToService; } });\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nexport function isObject(data: unknown): data is Record<PropertyKey, unknown> {\r\n    return typeof data === 'object' && data !== null;\r\n}\r\n\r\nexport type TypeOf<T> =\r\n    T extends number ? 'number'\r\n    : T extends string ? 'string'\r\n    : T extends boolean ? 'boolean'\r\n    : T extends bigint ? 'bigint'\r\n    : T extends symbol ? 'symbol'\r\n    : T extends Function ? 'function'\r\n    : T extends object ? 'object'\r\n    : 'undefined';\r\n\r\nexport function hasOwnProperty<K extends PropertyKey, T>(arg: unknown, key: K | K[], type?: TypeOf<T> | ((v: unknown) => v is T)): arg is Record<K, T> {\r\n    if (!isObject(arg)) {\r\n        return false;\r\n    }\r\n    if (Array.isArray(key)) {\r\n        for (const k of key) {\r\n            if (!Object.prototype.hasOwnProperty.call(arg, k)) {\r\n                return false;\r\n            }\r\n            if (typeof type === 'string' && typeof arg[k] !== type) {\r\n                return false;\r\n            } else if (typeof type === 'function' && !type(arg[k])) {\r\n                return false;\r\n            }\r\n        }\r\n    } else {\r\n        if (!Object.prototype.hasOwnProperty.call(arg, key)) {\r\n            return false;\r\n        }\r\n        if (typeof type === 'string') {\r\n            return typeof arg[key] === type;\r\n        }\r\n        if (typeof type === 'function') {\r\n            return type(arg[key]);\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function safeAssign<T extends {}>(target: T, partial: Partial<T>): T {\r\n    return Object.assign(target, partial);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelRoot, SModelElement, Viewport } from './model';\r\nimport { Bounds, Point, Dimension } from './utils/geometry';\r\nimport { JsonAny, JsonMap } from './utils/json';\r\nimport { hasOwnProperty } from './utils/object';\r\n\r\n/**\r\n * Wrapper for actions when transferring them between client and server.\r\n * The `clientId` is used to identify the specific diagram instance in the client.\r\n */\r\nexport interface ActionMessage {\r\n    clientId: string\r\n    action: Action\r\n}\r\n\r\nexport function isActionMessage(object: unknown): object is ActionMessage {\r\n    return hasOwnProperty(object, 'action');\r\n}\r\n\r\n/**\r\n * An action describes a change to the model declaratively.\r\n * It is a plain data structure, and as such transferable between server and client.\r\n */\r\nexport interface Action {\r\n    kind: string;\r\n}\r\n\r\nexport function isAction(object?: unknown): object is Action {\r\n    return hasOwnProperty<string, string>(object, 'kind', 'string');\r\n}\r\n\r\n/**\r\n * A request action is tied to the expectation of receiving a corresponding response action.\r\n * The `requestId` property is used to match the received response with the original request.\r\n */\r\nexport interface RequestAction<Res extends ResponseAction> extends Action {\r\n    requestId: string\r\n\r\n    /**\r\n     * Used to ensure correct typing. Clients must not use this property\r\n     */\r\n    readonly _?: Res;\r\n}\r\n\r\nexport function isRequestAction(object?: Action): object is RequestAction<ResponseAction> {\r\n    return hasOwnProperty<string, string>(object, 'requestId', 'string');\r\n}\r\n\r\nlet requestContext = '';\r\nlet nextRequestId = 1;\r\n/**\r\n * Generate a unique `requestId` for a request action.\r\n */\r\nexport function generateRequestId(): string {\r\n    return `${requestContext}_${nextRequestId++}`;\r\n}\r\n\r\n/**\r\n * Configure the context in which request actions are created. This is typically either\r\n * 'client' or 'server' to avoid collisions of request IDs.\r\n */\r\nexport function setRequestContext(context: string): void {\r\n    requestContext = context;\r\n}\r\n\r\n/**\r\n * A response action is sent to respond to a request action. The `responseId` must match\r\n * the `requestId` of the preceding request. In case the `responseId` is empty or undefined,\r\n * the action is handled as standalone, i.e. it was fired without a preceding request.\r\n */\r\nexport interface ResponseAction extends Action {\r\n    responseId: string;\r\n}\r\n\r\n/**\r\n * A response action is sent to respond to a request action. The `responseId` must match\r\n * the `requestId` of the preceding request. In case the `responseId` is empty or undefined,\r\n * the action is handled as standalone, i.e. it was fired without a preceding request.\r\n */\r\n\r\nexport function isResponseAction(object?: Action): object is ResponseAction {\r\n    return hasOwnProperty<string, string>(object, 'responseId', 'string') && object.responseId !== '';\r\n}\r\n\r\n/**\r\n * A reject action is fired to indicate that a request must be rejected.\r\n */\r\nexport interface RejectAction extends ResponseAction {\r\n    kind: typeof RejectAction.KIND\r\n    message: string\r\n    detail?: JsonAny\r\n}\r\nexport namespace RejectAction {\r\n    export const KIND = 'rejectRequest';\r\n\r\n    export function create(options: { message: string, detail?: JsonAny, requestId: string }): RejectAction {\r\n        return {\r\n            kind: KIND,\r\n            message: options.message,\r\n            detail: options.detail,\r\n            responseId: options.requestId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the client to the model source (e.g. a DiagramServer) in order to request a model. Usually this\r\n * is the first message that is sent to the source, so it is also used to initiate the communication.\r\n * The response is a SetModelAction or an UpdateModelAction.\r\n */\r\nexport interface RequestModelAction extends RequestAction<SetModelAction> {\r\n    kind: typeof RequestModelAction.KIND\r\n    options?: JsonMap\r\n}\r\nexport namespace RequestModelAction {\r\n    export const KIND = 'requestModel';\r\n\r\n    export function create(options?: JsonMap): RequestModelAction {\r\n        return {\r\n            kind: KIND,\r\n            options,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the model source to the client in order to set the model. If a model is already present, it is replaced.\r\n */\r\nexport interface SetModelAction extends ResponseAction {\r\n    kind: typeof SetModelAction.KIND\r\n    newRoot: SModelRoot\r\n}\r\nexport namespace SetModelAction {\r\n    export const KIND = 'setModel';\r\n\r\n    export function create(newRoot: SModelRoot, requestId: string = ''): SetModelAction {\r\n        return {\r\n            kind: KIND,\r\n            newRoot,\r\n            responseId: requestId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the model source to the client in order to update the model. If no model is present yet,\r\n * this behaves the same as a SetModelAction. The transition from the old model to the new one can be animated.\r\n */\r\nexport interface UpdateModelAction {\r\n    kind: typeof UpdateModelAction.KIND\r\n    newRoot?: SModelRoot\r\n    matches?: Match[]\r\n    animate?: boolean\r\n    cause?: Action\r\n}\r\nexport namespace UpdateModelAction {\r\n    export const KIND = 'updateModel';\r\n\r\n    export function create(input: SModelRoot | Match[], options: { animate?: boolean, cause?: Action } = {}): UpdateModelAction {\r\n        if (Array.isArray(input)) {\r\n            return {\r\n                kind: KIND,\r\n                matches: input,\r\n                animate: options.animate,\r\n                cause: options.cause\r\n            };\r\n        } else {\r\n            return {\r\n                kind: KIND,\r\n                newRoot: input,\r\n                animate: options.animate,\r\n                cause: options.cause\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport interface Match {\r\n    left?: SModelElement\r\n    right?: SModelElement\r\n    leftParentId?: string\r\n    rightParentId?: string\r\n}\r\n\r\n/**\r\n * Triggered when the user hovers the mouse pointer over an element to get a popup with details on\r\n * that element. This action is sent from the client to the model source, e.g. a DiagramServer.\r\n * The response is a SetPopupModelAction.\r\n */\r\nexport interface RequestPopupModelAction extends RequestAction<SetPopupModelAction> {\r\n    kind: typeof RequestPopupModelAction.KIND\r\n    elementId: string\r\n    bounds: Bounds\r\n}\r\nexport namespace RequestPopupModelAction {\r\n    export const KIND = 'requestPopupModel';\r\n\r\n    export function create(options: { elementId: string, bounds: Bounds }): RequestPopupModelAction {\r\n        return {\r\n            kind: KIND,\r\n            elementId: options.elementId,\r\n            bounds: options.bounds,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the model source to the client to display a popup in response to a RequestPopupModelAction.\r\n * This action can also be used to remove any existing popup by choosing EMPTY_ROOT as root element.\r\n */\r\nexport interface SetPopupModelAction extends ResponseAction {\r\n    kind: typeof SetPopupModelAction.KIND\r\n    newRoot: SModelRoot\r\n}\r\nexport namespace SetPopupModelAction {\r\n    export const KIND = 'setPopupModel';\r\n\r\n    export function create(newRoot: SModelRoot, requestId: string = ''): SetPopupModelAction {\r\n        return {\r\n            kind: KIND,\r\n            newRoot,\r\n            responseId: requestId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the model source (e.g. a DiagramServer) to the client to update the bounds of some\r\n * (or all) model elements.\r\n */\r\nexport interface SetBoundsAction extends Action {\r\n    kind: typeof SetBoundsAction.KIND\r\n    bounds: ElementAndBounds[]\r\n}\r\nexport namespace SetBoundsAction {\r\n    export const KIND = 'setBounds';\r\n\r\n    export function create(bounds: ElementAndBounds[]): SetBoundsAction {\r\n        return {\r\n            kind: KIND,\r\n            bounds\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the model source to the client to request bounds for the given model. The model is\r\n * rendered invisibly so the bounds can derived from the DOM. The response is a ComputedBoundsAction.\r\n * This hidden rendering round-trip is necessary if the client is responsible for parts of the layout\r\n * (see `needsClientLayout` viewer option).\r\n */\r\nexport interface RequestBoundsAction extends RequestAction<ComputedBoundsAction> {\r\n    kind: typeof RequestBoundsAction.KIND\r\n    newRoot: SModelRoot\r\n}\r\nexport namespace RequestBoundsAction {\r\n    export const KIND = 'requestBounds';\r\n\r\n    export function create(newRoot: SModelRoot): RequestBoundsAction {\r\n        return {\r\n            kind: KIND,\r\n            newRoot,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the client to the model source (e.g. a DiagramServer) to transmit the result of bounds\r\n * computation as a response to a RequestBoundsAction. If the server is responsible for parts of\r\n * the layout (see `needsServerLayout` viewer option), it can do so after applying the computed bounds\r\n * received with this action. Otherwise there is no need to send the computed bounds to the server,\r\n * so they can be processed locally by the client.\r\n */\r\nexport interface ComputedBoundsAction extends ResponseAction {\r\n    kind: typeof ComputedBoundsAction.KIND\r\n    bounds: ElementAndBounds[]\r\n    revision?: number\r\n    alignments?: ElementAndAlignment[]\r\n}\r\nexport namespace ComputedBoundsAction {\r\n    export const KIND = 'computedBounds';\r\n\r\n    export function create(bounds: ElementAndBounds[], options: { revision?: number, alignments?: ElementAndAlignment[], requestId?: string } = {}): ComputedBoundsAction {\r\n        return {\r\n            kind: KIND,\r\n            bounds,\r\n            revision: options.revision,\r\n            alignments: options.alignments,\r\n            responseId: options.requestId ?? ''\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Associates new bounds with a model element, which is referenced via its id.\r\n */\r\nexport interface ElementAndBounds {\r\n    elementId: string\r\n    newPosition?: Point\r\n    newSize: Dimension\r\n}\r\n\r\n/**\r\n * Associates a new alignment with a model element, which is referenced via its id.\r\n */\r\nexport interface ElementAndAlignment {\r\n    elementId: string\r\n    newAlignment: Point\r\n}\r\n\r\n/**\r\n * Transport logging data to be stored elsewhere.\r\n */\r\nexport interface LoggingAction extends Action {\r\n    kind: typeof LoggingAction.KIND;\r\n    severity: string\r\n    time: string\r\n    caller: string\r\n    message: string\r\n    params: string[]\r\n}\r\nexport namespace LoggingAction {\r\n    export const KIND = 'logging';\r\n\r\n    export function create(options: { severity: string, time: string, caller: string, message: string, params: string[] }): LoggingAction {\r\n        return {\r\n            kind: KIND,\r\n            ...options\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Triggered when the user changes the selection, e.g. by clicking on a selectable element. The resulting\r\n * SelectCommand changes the `selected` state accordingly, so the elements can be rendered differently.\r\n * This action is also forwarded to the diagram server, if present, so it may react on the selection change.\r\n * Furthermore, the server can send such an action to the client in order to change the selection programmatically.\r\n */\r\nexport interface SelectAction {\r\n    kind: typeof SelectAction.KIND\r\n    selectedElementsIDs: string[]\r\n    deselectedElementsIDs: string[]\r\n}\r\nexport namespace SelectAction {\r\n    export const KIND = 'elementSelected';\r\n\r\n    export function create(options: { selectedElementsIDs?: string[], deselectedElementsIDs?: string[] }): SelectAction {\r\n        return {\r\n            kind: KIND,\r\n            selectedElementsIDs: options.selectedElementsIDs ?? [],\r\n            deselectedElementsIDs: options.deselectedElementsIDs ?? []\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Programmatic action for selecting or deselecting all elements.\r\n * If `select` is true, all elements are selected, otherwise they are deselected.\r\n */\r\nexport interface SelectAllAction {\r\n    kind: typeof SelectAllAction.KIND\r\n    select: boolean\r\n}\r\nexport namespace SelectAllAction {\r\n    export const KIND = 'allSelected';\r\n\r\n    export function create(options: { select?: boolean } = {}): SelectAllAction {\r\n        return {\r\n            kind: KIND,\r\n            select: options.select ?? true\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Request action for retrieving the current selection.\r\n */\r\nexport interface GetSelectionAction extends RequestAction<SelectionResult> {\r\n    kind: typeof GetSelectionAction.KIND\r\n}\r\nexport namespace GetSelectionAction {\r\n    export const KIND = 'getSelection';\r\n\r\n    export function create(): GetSelectionAction {\r\n        return {\r\n            kind: KIND,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Result for a `GetSelectionAction`.\r\n */\r\nexport interface SelectionResult extends ResponseAction {\r\n    kind: typeof SelectionResult.KIND\r\n    selectedElementsIDs: string[]\r\n}\r\nexport namespace SelectionResult {\r\n    export const KIND = 'selectionResult';\r\n\r\n    export function create(selectedElementsIDs: string[], requestId: string): SelectionResult {\r\n        return {\r\n            kind: KIND,\r\n            selectedElementsIDs,\r\n            responseId: requestId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Sent from the client to the model source to recalculate a diagram when elements\r\n * are collapsed/expanded by the client.\r\n */\r\nexport interface CollapseExpandAction {\r\n    kind: typeof CollapseExpandAction.KIND\r\n    expandIds: string[]\r\n    collapseIds: string[]\r\n}\r\nexport namespace CollapseExpandAction {\r\n    export const KIND = 'collapseExpand';\r\n\r\n    export function create(options: { expandIds?: string[], collapseIds?: string[] }): CollapseExpandAction {\r\n        return {\r\n            kind: KIND,\r\n            expandIds: options.expandIds ?? [],\r\n            collapseIds: options.collapseIds ?? []\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Programmatic action for expanding or collapsing all elements.\r\n * If `expand` is true, all elements are expanded, otherwise they are collapsed.\r\n */\r\nexport interface CollapseExpandAllAction {\r\n    kind: typeof CollapseExpandAllAction.KIND\r\n    expand: boolean\r\n}\r\nexport namespace CollapseExpandAllAction {\r\n    export const KIND = 'collapseExpandAll';\r\n\r\n    export function create(options: { expand?: boolean } = {}): CollapseExpandAllAction {\r\n        return {\r\n            kind: KIND,\r\n            expand: options.expand ?? true\r\n        };\r\n    }\r\n}\r\n\r\nexport interface OpenAction {\r\n    kind: typeof OpenAction.KIND\r\n    elementId: string\r\n}\r\nexport namespace OpenAction {\r\n    export const KIND = 'open';\r\n\r\n    export function create(elementId: string): OpenAction {\r\n        return {\r\n            kind: KIND,\r\n            elementId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Request a layout of the diagram or the selected elements only.\r\n */\r\nexport interface LayoutAction {\r\n    kind: typeof LayoutAction.KIND\r\n    layoutType?: string\r\n    elementIds?: string[]\r\n}\r\nexport namespace LayoutAction {\r\n    export const KIND = 'layout';\r\n\r\n    export function create(options: { layoutType?: string, elementIds?: string[] } = {}): LayoutAction {\r\n        return {\r\n            kind: KIND,\r\n            layoutType: options.layoutType,\r\n            elementIds: options.elementIds\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Triggered when the user requests the viewer to center on the current model. The resulting\r\n * CenterCommand changes the scroll setting of the viewport accordingly.\r\n * It also resets the zoom to its default if retainZoom is false.\r\n * This action can also be sent from the model source to the client in order to perform such a\r\n * viewport change programmatically.\r\n */\r\nexport interface CenterAction extends Action {\r\n    kind: typeof CenterAction.KIND\r\n    elementIds: string[]\r\n    animate: boolean\r\n    retainZoom: boolean\r\n    zoomScale?: number\r\n}\r\nexport namespace CenterAction {\r\n    export const KIND = 'center';\r\n\r\n    export function create(elementIds: string[], options: { animate?: boolean, retainZoom?: boolean, zoomScale?: number } = {}): CenterAction {\r\n        return {\r\n            kind: KIND,\r\n            elementIds,\r\n            animate: options.animate ?? true,\r\n            retainZoom: options.retainZoom ?? false,\r\n            zoomScale: options.zoomScale\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Triggered when the user requests the viewer to fit its content to the available drawing area.\r\n * The resulting FitToScreenCommand changes the zoom and scroll settings of the viewport so the model\r\n * can be shown completely. This action can also be sent from the model source to the client in order\r\n * to perform such a viewport change programmatically.\r\n */\r\nexport interface FitToScreenAction extends Action {\r\n    kind: typeof FitToScreenAction.KIND;\r\n    elementIds: string[]\r\n    padding?: number\r\n    maxZoom?: number\r\n    animate: boolean\r\n}\r\nexport namespace FitToScreenAction {\r\n    export const KIND = 'fit';\r\n\r\n    export function create(elementIds: string[], options: { padding?: number, maxZoom?: number, animate?: boolean } = {}): FitToScreenAction {\r\n        return {\r\n            kind: KIND,\r\n            elementIds,\r\n            padding: options.padding,\r\n            maxZoom: options.maxZoom,\r\n            animate: options.animate ?? true\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Directly set the diagram viewport to the given scroll and zoom values.\r\n * The ID of the viewport element to manipulate must be given with the action\r\n * (usually it is the root element's ID).\r\n */\r\nexport interface SetViewportAction extends Action {\r\n    kind: typeof SetViewportAction.KIND;\r\n    elementId: string\r\n    newViewport: Viewport\r\n    animate: boolean\r\n}\r\nexport namespace SetViewportAction {\r\n    export const KIND = 'viewport';\r\n\r\n    export function create(elementId: string, newViewport: Viewport, options: { animate?: boolean } = {}): SetViewportAction {\r\n        return {\r\n            kind: KIND,\r\n            elementId,\r\n            newViewport,\r\n            animate: options.animate ?? true\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Request action for retrieving the current viewport and canvas bounds.\r\n */\r\nexport interface GetViewportAction extends RequestAction<ViewportResult> {\r\n    kind: typeof GetViewportAction.KIND;\r\n}\r\nexport namespace GetViewportAction {\r\n    export const KIND = 'getViewport';\r\n\r\n    export function create(): GetViewportAction {\r\n        return {\r\n            kind: KIND,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Response to a `GetViewportAction`.\r\n */\r\nexport interface ViewportResult extends ResponseAction {\r\n    kind: typeof ViewportResult.KIND;\r\n    viewport: Viewport\r\n    canvasBounds: Bounds\r\n}\r\nexport namespace ViewportResult {\r\n    export const KIND = 'viewportResult';\r\n\r\n    export function create(viewport: Viewport, canvasBounds: Bounds, requestId: string): ViewportResult {\r\n        return {\r\n            kind: KIND,\r\n            viewport,\r\n            canvasBounds,\r\n            responseId: requestId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Action to render the selected elements in front of others by manipulating the z-order.\r\n */\r\nexport interface BringToFrontAction extends Action {\r\n    kind: typeof BringToFrontAction.KIND;\r\n    elementIDs: string[]\r\n}\r\nexport namespace BringToFrontAction {\r\n    export const KIND = 'bringToFront';\r\n\r\n    export function create(elementIDs: string[]): BringToFrontAction {\r\n        return {\r\n            kind: KIND,\r\n            elementIDs\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Undo the previous operation on the stack of operations.\r\n */\r\nexport interface UndoAction extends Action {\r\n    kind: typeof UndoAction.KIND;\r\n}\r\nexport namespace UndoAction {\r\n    export const KIND = 'undo';\r\n\r\n    export function create(): UndoAction {\r\n        return {\r\n            kind: KIND\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Redo a previously undone operation.\r\n */\r\nexport interface RedoAction extends Action {\r\n    kind: typeof RedoAction.KIND;\r\n}\r\nexport namespace RedoAction {\r\n    export const KIND = 'redo';\r\n\r\n    export function create(): RedoAction {\r\n        return {\r\n            kind: KIND\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Move an arbitrary set of elements to new positions.\r\n */\r\nexport interface MoveAction extends Action {\r\n    kind: typeof MoveAction.KIND\r\n    moves: ElementMove[]\r\n    animate: boolean\r\n    finished: boolean\r\n}\r\nexport namespace MoveAction {\r\n    export const KIND = 'move';\r\n\r\n    export function create(moves: ElementMove[], options: { animate?: boolean, finished?: boolean } = {}): MoveAction {\r\n        return {\r\n            kind: KIND,\r\n            moves,\r\n            animate: options.animate ?? true,\r\n            finished: options.finished ?? false\r\n        };\r\n    }\r\n}\r\n\r\nexport interface ElementMove {\r\n    elementId: string\r\n    elementType?: string\r\n    fromPosition?: Point\r\n    toPosition: Point\r\n}\r\n\r\n/**\r\n * Triggered when the user puts the mouse pointer over an element.\r\n */\r\nexport interface HoverFeedbackAction extends Action {\r\n    kind: typeof HoverFeedbackAction.KIND\r\n    mouseoverElement: string\r\n    mouseIsOver: boolean\r\n}\r\nexport namespace HoverFeedbackAction {\r\n    export const KIND = 'hoverFeedback';\r\n\r\n    export function create(options: { mouseoverElement: string, mouseIsOver: boolean }): HoverFeedbackAction {\r\n        return {\r\n            kind: KIND,\r\n            mouseoverElement: options.mouseoverElement,\r\n            mouseIsOver: options.mouseIsOver\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Create an element with the given schema and add it to the diagram.\r\n */\r\nexport interface CreateElementAction extends Action {\r\n    kind: typeof CreateElementAction.KIND\r\n    containerId: string\r\n    elementSchema: SModelElement\r\n}\r\nexport namespace CreateElementAction {\r\n    export const KIND = 'createElement';\r\n\r\n    export function create(elementSchema: SModelElement, options: { containerId: string }): CreateElementAction {\r\n        return {\r\n            kind: KIND,\r\n            elementSchema,\r\n            containerId: options.containerId\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Delete a set of elements identified by their IDs.\r\n */\r\nexport interface DeleteElementAction extends Action {\r\n    kind: typeof DeleteElementAction.KIND\r\n    elementIds: string[]\r\n}\r\nexport namespace DeleteElementAction {\r\n    export const KIND = 'delete';\r\n\r\n    export function create(elementIds: string[]): DeleteElementAction {\r\n        return {\r\n            kind: KIND,\r\n            elementIds\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Apply a text change to a label element.\r\n */\r\nexport interface ApplyLabelEditAction extends Action {\r\n    kind: typeof ApplyLabelEditAction.KIND;\r\n    labelId: string,\r\n    text: string\r\n}\r\nexport namespace ApplyLabelEditAction {\r\n    export const KIND = 'applyLabelEdit';\r\n\r\n    export function create(labelId: string, text: string): ApplyLabelEditAction {\r\n        return {\r\n            kind: KIND,\r\n            labelId,\r\n            text\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Change the source or target node of a routable element (edge of a graph).\r\n */\r\nexport interface ReconnectAction extends Action {\r\n    kind: typeof ReconnectAction.KIND\r\n    routableId: string\r\n    newSourceId?: string\r\n    newTargetId?: string\r\n}\r\nexport namespace ReconnectAction {\r\n    export const KIND = 'reconnect';\r\n\r\n    export function create(options: { routableId: string, newSourceId?: string, newTargetId?: string }): ReconnectAction {\r\n        return {\r\n            kind: KIND,\r\n            routableId: options.routableId,\r\n            newSourceId: options.newSourceId,\r\n            newTargetId: options.newTargetId\r\n        };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/**\r\n * Simple implementation of the deferred pattern.\r\n * An object that exposes a promise and functions to resolve and reject it.\r\n */\r\nexport class Deferred<T> {\r\n    resolve: (value?: T | PromiseLike<T>) => void;\r\n    reject: (reason?: any) => void;\r\n    readonly promise: Promise<T>;\r\n    private _state: DeferredState = 'unresolved';\r\n\r\n\r\n    constructor() {\r\n        this.promise = new Promise<T>((resolve, reject) => {\r\n            this.resolve = resolve;\r\n            this.reject = reject;\r\n        });\r\n        this.promise.then(\r\n            res => this._state = 'resolved',\r\n            rej => this._state = 'rejected'\r\n        );\r\n    }\r\n\r\n    private set state(state: DeferredState) {\r\n        if (this._state === 'unresolved') {\r\n            this._state = state;\r\n        }\r\n    }\r\n\r\n    get state(): DeferredState {\r\n        return this._state;\r\n    }\r\n}\r\n\r\nexport type DeferredState = 'resolved' | 'rejected' | 'unresolved';\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n /* eslint-disable @typescript-eslint/naming-convention */\r\nexport const TYPES = {\r\n    Action: Symbol('Action'),\r\n    IActionDispatcher: Symbol('IActionDispatcher'),\r\n    IActionDispatcherProvider: Symbol('IActionDispatcherProvider'),\r\n    IActionHandlerInitializer: Symbol('IActionHandlerInitializer'),\r\n    ActionHandlerRegistration: Symbol('ActionHandlerRegistration'),\r\n    ActionHandlerRegistryProvider: Symbol('ActionHandlerRegistryProvider'),\r\n    IAnchorComputer: Symbol('IAnchor'),\r\n    AnimationFrameSyncer: Symbol('AnimationFrameSyncer'),\r\n    IButtonHandlerRegistration: Symbol('IButtonHandlerRegistration'),\r\n    ICommandPaletteActionProvider: Symbol('ICommandPaletteActionProvider'),\r\n    ICommandPaletteActionProviderRegistry: Symbol('ICommandPaletteActionProviderRegistry'),\r\n    CommandRegistration: Symbol('CommandRegistration'),\r\n    ICommandStack: Symbol('ICommandStack'),\r\n    CommandStackOptions: Symbol('CommandStackOptions'),\r\n    ICommandStackProvider: Symbol('ICommandStackProvider'),\r\n    IContextMenuItemProvider: Symbol.for(\"IContextMenuProvider\"),\r\n    IContextMenuProviderRegistry: Symbol.for(\"IContextMenuProviderRegistry\"),\r\n    IContextMenuService: Symbol.for(\"IContextMenuService\"),\r\n    IContextMenuServiceProvider: Symbol.for(\"IContextMenuServiceProvider\"),\r\n    DOMHelper: Symbol('DOMHelper'),\r\n    IDiagramLocker: Symbol('IDiagramLocker'),\r\n    IEdgeRouter: Symbol('IEdgeRouter'),\r\n    IEdgeRoutePostprocessor: Symbol('IEdgeRoutePostprocessor'),\r\n    IEditLabelValidationDecorator: Symbol('IEditLabelValidationDecorator'),\r\n    IEditLabelValidator: Symbol('IEditLabelValidator'),\r\n    HiddenModelViewer: Symbol('HiddenModelViewer'),\r\n    HiddenVNodePostprocessor: Symbol('HiddenVNodeDecorator'),\r\n    HoverState: Symbol('HoverState'),\r\n    KeyListener: Symbol('KeyListener'),\r\n    LayoutRegistration: Symbol('LayoutRegistration'),\r\n    LayoutRegistry: Symbol('LayoutRegistry'),\r\n    Layouter: Symbol('Layouter'),\r\n    LogLevel: Symbol('LogLevel'),\r\n    ILogger: Symbol('ILogger'),\r\n    IModelFactory: Symbol('IModelFactory'),\r\n    IModelLayoutEngine: Symbol('IModelLayoutEngine'),\r\n    ModelRendererFactory: Symbol('ModelRendererFactory'),\r\n    ModelSource: Symbol('ModelSource'),\r\n    ModelSourceProvider: Symbol('ModelSourceProvider'),\r\n    ModelViewer: Symbol('ModelViewer'),\r\n    MouseListener: Symbol('MouseListener'),\r\n    PatcherProvider: Symbol('PatcherProvider'),\r\n    IPopupModelProvider: Symbol('IPopupModelProvider'),\r\n    PopupModelViewer: Symbol('PopupModelViewer'),\r\n    PopupMouseListener: Symbol('PopupMouseListener'),\r\n    PopupVNodePostprocessor: Symbol('PopupVNodeDecorator'),\r\n    SModelElementRegistration: Symbol('SModelElementRegistration'),\r\n    SModelRegistry: Symbol('SModelRegistry'),\r\n    ISnapper: Symbol('ISnapper'),\r\n    SvgExporter: Symbol('SvgExporter'),\r\n    IUIExtension: Symbol('IUIExtension'),\r\n    UIExtensionRegistry: Symbol('UIExtensionRegistry'),\r\n    IVNodePostprocessor: Symbol('IVNodePostprocessor'),\r\n    ViewRegistration: Symbol('ViewRegistration'),\r\n    ViewRegistry: Symbol('ViewRegistry'),\r\n    IViewer: Symbol('IViewer'),\r\n    ViewerOptions: Symbol('ViewerOptions'),\r\n    IViewerProvider: Symbol('IViewerProvider'),\r\n};\r\n/* eslint-enable */\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\n\r\n@injectable()\r\nexport class ProviderRegistry<T, U> {\r\n    protected elements: Map<string, new (u: U) => T> = new Map;\r\n\r\n    register(key: string, cstr: new (u: U) => T) {\r\n        if (key === undefined)\r\n            throw new Error('Key is undefined');\r\n        if (this.hasKey(key))\r\n            throw new Error('Key is already registered: ' + key);\r\n        this.elements.set(key, cstr);\r\n    }\r\n\r\n    deregister(key: string) {\r\n        if (key === undefined)\r\n            throw new Error('Key is undefined');\r\n        this.elements.delete(key);\r\n    }\r\n\r\n    hasKey(key: string): boolean {\r\n        return this.elements.has(key);\r\n    }\r\n\r\n    get(key: string, arg: U): T {\r\n        const existingCstr = this.elements.get(key);\r\n        if (existingCstr)\r\n            return new existingCstr(arg);\r\n        else\r\n            return this.missing(key, arg);\r\n    }\r\n\r\n    protected missing(key: string, arg: U): T | never {\r\n        throw new Error('Unknown registry key: ' + key);\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class FactoryRegistry<T, U> {\r\n    protected elements: Map<string, (u: U) => T> = new Map;\r\n\r\n    register(key: string, factory: (u: U) => T) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        if (this.hasKey(key)) {\r\n            throw new Error('Key is already registered: ' + key);\r\n        }\r\n        this.elements.set(key, factory);\r\n    }\r\n\r\n    deregister(key: string) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        this.elements.delete(key);\r\n    }\r\n\r\n    hasKey(key: string): boolean {\r\n        return this.elements.has(key);\r\n    }\r\n\r\n    get(key: string, arg: U): T {\r\n        const existingFactory = this.elements.get(key);\r\n        if (existingFactory) {\r\n            return existingFactory(arg);\r\n        } else {\r\n            return this.missing(key, arg);\r\n        }\r\n    }\r\n\r\n    protected missing(key: string, arg: U): T | never {\r\n        throw new Error('Unknown registry key: ' + key);\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class InstanceRegistry<T> {\r\n    protected elements: Map<string, T> = new Map;\r\n\r\n    register(key: string, instance: T) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        if (this.hasKey(key)) {\r\n            throw new Error('Key is already registered: ' + key);\r\n        }\r\n        this.elements.set(key, instance);\r\n    }\r\n\r\n    deregister(key: string) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        this.elements.delete(key);\r\n    }\r\n\r\n    hasKey(key: string): boolean {\r\n        return this.elements.has(key);\r\n    }\r\n\r\n    get(key: string): T {\r\n        const existingInstance = this.elements.get(key);\r\n        if (existingInstance) {\r\n            return existingInstance;\r\n        } else {\r\n            return this.missing(key);\r\n        }\r\n    }\r\n\r\n    protected missing(key: string): T | never {\r\n        throw new Error('Unknown registry key: ' + key);\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class MultiInstanceRegistry<T> {\r\n    protected elements: Map<string, T[]> = new Map;\r\n\r\n    register(key: string, instance: T) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        const instances = this.elements.get(key);\r\n        if (instances !== undefined) {\r\n            instances.push(instance);\r\n        } else {\r\n            this.elements.set(key, [instance]);\r\n        }\r\n    }\r\n\r\n    deregisterAll(key: string) {\r\n        if (key === undefined) {\r\n            throw new Error('Key is undefined');\r\n        }\r\n        this.elements.delete(key);\r\n    }\r\n\r\n    get(key: string): T[] {\r\n        const existingInstances = this.elements.get(key);\r\n        if (existingInstances !== undefined) {\r\n            return existingInstances;\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { hasOwnProperty } from \"./object\";\r\n\r\n/**\r\n * A Point is composed of the (x,y) coordinates of an object.\r\n */\r\nexport interface Point {\r\n    readonly x: number\r\n    readonly y: number\r\n}\r\n\r\nexport namespace Point {\r\n    /**\r\n     * (x,y) coordinates of the origin.\r\n     */\r\n    export const ORIGIN: Point = Object.freeze({\r\n        x: 0,\r\n        y: 0\r\n    });\r\n\r\n    /**\r\n     * Adds two points.\r\n     * @param {Point} p1 - First point\r\n     * @param {Point} p2 - Second point\r\n     * @returns {Point} The sum of the two points\r\n     */\r\n    export function add(p1: Point, p2: Point): Point {\r\n        return {\r\n            x: p1.x + p2.x,\r\n            y: p1.y + p2.y\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Subtracts two points.\r\n     * @param {Point} p1 - First point\r\n     * @param {Point} p2 - Second point\r\n     * @returns {Point} The difference of the two points\r\n     */\r\n    export function subtract(p1: Point, p2: Point): Point {\r\n        return {\r\n            x: p1.x - p2.x,\r\n            y: p1.y - p2.y\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Specifies whether a point has exactly the same coordinates as another point.\r\n     * @param {Point} point1 a point\r\n     * @param {Point} point2 another point\r\n     * @returns {boolean} `true` if `point1` has exactly the same `x` and `y` values as `point2`, `false` otherwise.\r\n     */\r\n    export function equals(point1: Point, point2: Point): boolean {\r\n        return point1.x === point2.x && point1.y === point2.y;\r\n    }\r\n\r\n    /**\r\n     * Computes a point that is the original `point` shifted towards `refPoint` by the given `distance`.\r\n     * @param {Point} point - Point to shift\r\n     * @param {Point} refPoint - Point to shift towards\r\n     * @param {Point} distance - Distance to shift\r\n     */\r\n    export function shiftTowards(point: Point, refPoint: Point, distance: number): Point {\r\n        const diff = subtract(refPoint, point);\r\n        const normalized = normalize(diff);\r\n        const shift = { x: normalized.x * distance, y: normalized.y * distance };\r\n        return add(point, shift);\r\n    }\r\n\r\n    /**\r\n     * Computes the normalized vector from the vector given in `point`; that is, computing its unit vector.\r\n     * @param {Point} point - Point representing the vector to be normalized\r\n     * @returns {Point} The normalized point\r\n     */\r\n    export function normalize(point: Point): Point {\r\n        const mag = magnitude(point);\r\n        if (mag === 0 || mag === 1) {\r\n            return ORIGIN;\r\n        }\r\n        return {\r\n            x: point.x / mag,\r\n            y: point.y / mag\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Computes the magnitude of the vector given in `point`.\r\n     * @param {Point} point - Point representing the vector to compute the magnitude for\r\n     * @returns {number} The magnitude or also known as length of the `point`\r\n     */\r\n    export function magnitude(point: Point): number {\r\n        return Math.sqrt(Math.pow(point.x, 2) + Math.pow(point.y, 2));\r\n    }\r\n\r\n    /**\r\n     * Calculates a linear combination of p0 and p1 using lambda, i.e.\r\n     *   (1-lambda) * p0 + lambda * p1\r\n     */\r\n    export function linear(p0: Point, p1: Point, lambda: number): Point {\r\n        return {\r\n            x: (1 - lambda) * p0.x + lambda * p1.x,\r\n            y: (1 - lambda) * p0.y + lambda * p1.y\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Returns the \"straight line\" distance between two points.\r\n     * @param {Point} a - First point\r\n     * @param {Point} b - Second point\r\n     * @returns {number} The Eucledian distance\r\n     */\r\n    export function euclideanDistance(a: Point, b: Point): number {\r\n        const dx = b.x - a.x;\r\n        const dy = b.y - a.y;\r\n        return Math.sqrt(dx * dx + dy * dy);\r\n    }\r\n\r\n    /**\r\n     * Returns the distance between two points in a grid, using a\r\n     * strictly vertical and/or horizontal path (versus straight line).\r\n     * @param {Point} a - First point\r\n     * @param {Point} b - Second point\r\n     * @returns {number} The Manhattan distance\r\n     */\r\n    export function manhattanDistance(a: Point, b: Point): number {\r\n        return Math.abs(b.x - a.x) + Math.abs(b.y - a.y);\r\n    }\r\n\r\n    /**\r\n     * Returns the maximum of the horizontal and the vertical distance.\r\n     * @param {Point} a - First point\r\n     * @param {Point} b - Second point\r\n     * @returns {number} The maximum distance\r\n     */\r\n    export function maxDistance(a: Point, b: Point): number {\r\n        return Math.max(Math.abs(b.x - a.x), Math.abs(b.y - a.y));\r\n    }\r\n\r\n    /**\r\n     * Returns the dot product of two points.\r\n     * @param {Point} a - First point\r\n     * @param {Point} b - Second point\r\n     * @returns {number} The dot product\r\n     */\r\n    export function dotProduct(a: Point, b: Point): number {\r\n        return a.x * b.x + a.y * b.y;\r\n    }\r\n}\r\n\r\n/**\r\n * Computes the angle in radians of the given point to the x-axis of the coordinate system.\r\n * The result is in the range [-pi, pi].\r\n * @param {Point} p - A point in the Eucledian plane\r\n */\r\nexport function angleOfPoint(p: Point): number {\r\n    return Math.atan2(p.y, p.x);\r\n}\r\n\r\n/**\r\n * Computes the angle in radians between the two given points (relative to the origin of the coordinate system).\r\n * The result is in the range [0, pi]. Returns NaN if the points are equal.\r\n * @param {Point} a - First point\r\n * @param {Point} b - Second point\r\n */\r\nexport function angleBetweenPoints(a: Point, b: Point): number {\r\n    const lengthProduct = Math.sqrt((a.x * a.x + a.y * a.y) * (b.x * b.x + b.y * b.y));\r\n    if (isNaN(lengthProduct) || lengthProduct === 0)\r\n        return NaN;\r\n    const dotProduct = a.x * b.x + a.y * b.y;\r\n    return Math.acos(dotProduct / lengthProduct);\r\n}\r\n\r\n/**\r\n * Computes the center of the line segment spanned by the two given points.\r\n * @param {Point} s - Start point of the line\r\n * @param {Point} e - End point of the line\r\n */\r\nexport function centerOfLine(s: Point, e: Point): Point {\r\n    const b: Bounds = {\r\n        x: s.x > e.x ? e.x : s.x,\r\n        y: s.y > e.y ? e.y : s.y,\r\n        width: Math.abs(e.x - s.x),\r\n        height: Math.abs(e.y - s.y)\r\n    };\r\n    return Bounds.center(b);\r\n}\r\n\r\n/**\r\n * The Dimension of an object is composed of its width and height.\r\n */\r\nexport interface Dimension {\r\n    readonly width: number\r\n    readonly height: number\r\n}\r\n\r\nexport namespace Dimension {\r\n    /**\r\n     * A dimension with both width and height set to a negative value, which is considered as undefined.\r\n     */\r\n    export const EMPTY: Dimension = Object.freeze({\r\n        width: -1,\r\n        height: -1\r\n    });\r\n\r\n    /**\r\n     * Checks whether the given dimention is valid, i.e. the width and height are non-zero.\r\n     * @param {Dimension} b - Dimension object\r\n     * @returns {boolean} `true` if the dimension is valid\r\n     */\r\n    export function isValid(d: Dimension): boolean {\r\n        return d.width >= 0 && d.height >= 0;\r\n    }\r\n}\r\n\r\n/**\r\n * The bounds are the position (x, y) and dimension (width, height) of an object.\r\n */\r\nexport interface Bounds extends Point, Dimension {\r\n}\r\n\r\nexport function isBounds(element: unknown): element is Bounds {\r\n    return hasOwnProperty(element, ['x', 'y', 'width', 'height']);\r\n}\r\n\r\nexport namespace Bounds {\r\n    export const EMPTY: Bounds = Object.freeze({\r\n        x: 0,\r\n        y: 0,\r\n        width: -1,\r\n        height: -1\r\n    });\r\n\r\n    /**\r\n     * Combines the bounds of two objects into one, so that the new bounds\r\n     * are the minimum bounds that covers both of the original bounds.\r\n     * @param {Bounds} b0 - First bounds object\r\n     * @param {Bounds} b1 - Second bounds object\r\n     * @returns {Bounds} The combined bounds\r\n     */\r\n    export function combine(b0: Bounds, b1: Bounds): Bounds {\r\n        if (!Dimension.isValid(b0))\r\n            return Dimension.isValid(b1) ? b1 : EMPTY;\r\n        if (!Dimension.isValid(b1))\r\n            return b0;\r\n        const minX = Math.min(b0.x, b1.x);\r\n        const minY = Math.min(b0.y, b1.y);\r\n        const maxX = Math.max(b0.x + (b0.width >= 0 ? b0.width : 0), b1.x + (b1.width >= 0 ? b1.width : 0));\r\n        const maxY = Math.max(b0.y + (b0.height >= 0 ? b0.height : 0), b1.y + (b1.height >= 0 ? b1.height : 0));\r\n        return {\r\n            x: minX, y: minY, width: maxX - minX, height: maxY - minY\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Translates the given bounds.\r\n     * @param {Bounds} b - Bounds object\r\n     * @param {Point} p - Vector by which to translate the bounds\r\n     * @returns {Bounds} The translated bounds\r\n     */\r\n    export function translate(b: Bounds, p: Point): Bounds {\r\n        return {\r\n            x: b.x + p.x,\r\n            y: b.y + p.y,\r\n            width: b.width,\r\n            height: b.height\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Returns the center point of the bounds of an object\r\n     * @param {Bounds} b - Bounds object\r\n     * @returns {Point} the center point\r\n     */\r\n    export function center(b: Bounds): Point {\r\n        return {\r\n            x: b.x + (b.width >= 0 ? 0.5 * b.width : 0),\r\n            y: b.y + (b.height >= 0 ? 0.5 * b.height : 0)\r\n        };\r\n    }\r\n\r\n    /**\r\n    * Checks whether the point p is included in the bounds b.\r\n    */\r\n    export function includes(b: Bounds, p: Point): boolean {\r\n        return p.x >= b.x && p.x <= b.x + b.width && p.y >= b.y && p.y <= b.y + b.height;\r\n    }\r\n}\r\n\r\n/**\r\n * Converts from radians to degrees\r\n * @param {number} a - A value in radians\r\n * @returns {number} The converted value\r\n */\r\nexport function toDegrees(a: number): number {\r\n    return a * 180 / Math.PI;\r\n}\r\n\r\n/**\r\n * Converts from degrees to radians\r\n * @param {number} a - A value in degrees\r\n * @returns {number} The converted value\r\n */\r\nexport function toRadians(a: number): number {\r\n    return a * Math.PI / 180;\r\n}\r\n\r\n/**\r\n * Returns whether two numbers are almost equal, within a small margin (0.001)\r\n * @param {number} a - First number\r\n * @param {number} b - Second number\r\n * @returns {boolean} True if the two numbers are almost equal\r\n */\r\nexport function almostEquals(a: number, b: number): boolean {\r\n    return Math.abs(a - b) < 1e-3;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/**\r\n * An iterable that allows filtering, mapping values etc. with a fluent API.\r\n * Arrays conform to this interface, so an array can be passed at every place where\r\n * a FluentIterable is expected.\r\n */\r\nexport interface FluentIterable<T> extends Iterable<T> {\r\n    filter(callback: (element: T) => boolean): FluentIterable<T>\r\n    map<T2>(callback: (element: T) => T2): FluentIterable<T2>\r\n    forEach(callback: (element: T, index: number) => void): void\r\n    indexOf(element: any): number\r\n}\r\n\r\n/**\r\n * A helper class that allows to easily create fluent iterables.\r\n */\r\nexport class FluentIterableImpl<S, T> implements FluentIterable<T> {\r\n\r\n    constructor(private readonly startFn: () => S,\r\n                private readonly nextFn: (state: S) => IteratorResult<T>) {}\r\n\r\n    [Symbol.iterator]() {\r\n        const iterator = {\r\n            state: this.startFn(),\r\n            next: () => this.nextFn(iterator.state),\r\n            [Symbol.iterator]: () => iterator\r\n        };\r\n        return iterator;\r\n    }\r\n\r\n    filter(callback: (element: T) => boolean): FluentIterable<T> {\r\n        return filterIterable(this, callback);\r\n    }\r\n\r\n    map<T2>(callback: (element: T) => T2): FluentIterable<T2> {\r\n        return mapIterable(this, callback);\r\n    }\r\n\r\n    forEach(callback: (element: T, index: number) => void): void {\r\n        const iterator = this[Symbol.iterator]();\r\n        let index = 0;\r\n        let result: IteratorResult<T>;\r\n        do {\r\n            result = iterator.next();\r\n            if (result.value !== undefined)\r\n                callback(result.value, index);\r\n            index++;\r\n        } while (!result.done);\r\n    }\r\n\r\n    indexOf(element: any): number {\r\n        const iterator = this[Symbol.iterator]();\r\n        let index = 0;\r\n        let result: IteratorResult<T>;\r\n        do {\r\n            result = iterator.next();\r\n            if (result.value === element)\r\n                return index;\r\n            index++;\r\n        } while (!result.done);\r\n        return -1;\r\n    }\r\n}\r\n\r\n/**\r\n * Converts a FluentIterable into an array. If the input is an array, it is returned unchanged.\r\n */\r\nexport function toArray<T>(input: FluentIterable<T>): T[] {\r\n    if (input.constructor === Array) {\r\n        return input as T[];\r\n    }\r\n    const result: T[] = [];\r\n    input.forEach(element => result.push(element));\r\n    return result;\r\n}\r\n\r\nexport const DONE_RESULT: IteratorResult<any> = Object.freeze({ done: true, value: undefined });\r\n\r\n/**\r\n * Create a fluent iterable that filters the content of the given iterable or array.\r\n */\r\nexport function filterIterable<T>(input: Iterable<T> | ArrayLike<T>, callback: (element: T) => boolean): FluentIterable<T> {\r\n    return new FluentIterableImpl(\r\n        () => createIterator(input),\r\n        (iterator) => {\r\n            let result: IteratorResult<T>;\r\n            do {\r\n                result = iterator.next();\r\n            } while (!result.done && !callback(result.value));\r\n            return result;\r\n        }\r\n    );\r\n}\r\n\r\n/**\r\n * Create a fluent iterable that maps the content of the given iterable or array.\r\n */\r\nexport function mapIterable<T1, T2>(input: Iterable<T1> | ArrayLike<T1>, callback: (element: T1) => T2): FluentIterable<T2> {\r\n    return new FluentIterableImpl(\r\n        () => createIterator(input),\r\n        (iterator) => {\r\n            const { done, value } = iterator.next();\r\n            if (done)\r\n                return DONE_RESULT;\r\n            else\r\n                return { done: false, value: callback(value) };\r\n        }\r\n    );\r\n}\r\n\r\n/**\r\n * Create an iterator for the given iterable or array.\r\n */\r\nfunction createIterator<T>(collection: Iterable<T> | ArrayLike<T>): Iterator<T> {\r\n    const method = (collection as Iterable<T>)[Symbol.iterator];\r\n    if (typeof method === 'function') {\r\n        return method.call(collection);\r\n    }\r\n    const length = (collection as ArrayLike<T>).length;\r\n    if (typeof length === 'number' && length >= 0) {\r\n        return new ArrayIterator(collection as ArrayLike<T>);\r\n    }\r\n    return { next: () => DONE_RESULT };\r\n}\r\n\r\n/**\r\n * Iterator implementation for arrays.\r\n */\r\nclass ArrayIterator<T> implements IterableIterator<T> {\r\n    constructor(private readonly array: ArrayLike<T>) {}\r\n\r\n    private index = 0;\r\n\r\n    next(): IteratorResult<T> {\r\n        if (this.index < this.array.length)\r\n            return { done: false, value: this.array[this.index++] };\r\n        else\r\n            return DONE_RESULT;\r\n    }\r\n\r\n    [Symbol.iterator]() {\r\n        return this;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElement } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, isBounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { FluentIterable, mapIterable } from '../../utils/iterable';\r\n\r\n/**\r\n * Base class for all elements of the internal diagram model.\r\n * Each model element must have a unique ID and a type that is used to look up its view.\r\n */\r\nexport class SModelElementImpl {\r\n    type: string;\r\n    id: string;\r\n    features?: FeatureSet;\r\n    cssClasses?: string[];\r\n\r\n    get root(): SModelRootImpl {\r\n        let current: SModelElementImpl | undefined = this;\r\n        while (current) {\r\n            if (current instanceof SModelRootImpl)\r\n                return current;\r\n            else if (current instanceof SChildElementImpl)\r\n                current = current.parent;\r\n            else\r\n                current = undefined;\r\n        }\r\n        throw new Error('Element has no root');\r\n    }\r\n\r\n    get index(): ModelIndexImpl {\r\n        return this.root.index;\r\n    }\r\n\r\n    /**\r\n     * A feature is a symbol identifying some functionality that can be enabled or disabled for\r\n     * a model element. The set of supported features is determined by the `features` property.\r\n     */\r\n    hasFeature(feature: symbol): boolean {\r\n        return this.features !== undefined && this.features.has(feature);\r\n    }\r\n}\r\n\r\n\r\nexport interface FeatureSet {\r\n    has(feature: symbol): boolean\r\n}\r\n\r\nexport function isParent(element: SModelElement | SModelElementImpl):\r\n        element is SModelElement & { children: SModelElement[] } {\r\n    const children = (element as any).children;\r\n    return children !== undefined && children.constructor === Array;\r\n}\r\n\r\n/**\r\n * A parent element may contain child elements, thus the diagram model forms a tree.\r\n */\r\nexport class SParentElementImpl extends SModelElementImpl {\r\n    readonly children: ReadonlyArray<SChildElementImpl> = [];\r\n\r\n    add(child: SChildElementImpl, index?: number) {\r\n        const children = this.children as SChildElementImpl[];\r\n        if (index === undefined) {\r\n            children.push(child);\r\n        } else {\r\n            if (index < 0 || index > this.children.length) {\r\n                throw new Error(`Child index ${index} out of bounds (0..${children.length})`);\r\n            }\r\n            children.splice(index, 0, child);\r\n        }\r\n        (child as {parent: SParentElementImpl}).parent = this;\r\n        this.index.add(child);\r\n    }\r\n\r\n    remove(child: SChildElementImpl) {\r\n        const children = this.children as SChildElementImpl[];\r\n        const i = children.indexOf(child);\r\n        if (i < 0) {\r\n            throw new Error(`No such child ${child.id}`);\r\n        }\r\n        children.splice(i, 1);\r\n        this.index.remove(child);\r\n    }\r\n\r\n    removeAll(filter?: (e: SChildElementImpl) => boolean) {\r\n        const children = this.children as SChildElementImpl[];\r\n        if (filter !== undefined) {\r\n            for (let i = children.length - 1; i >= 0; i--) {\r\n                if (filter(children[i])) {\r\n                    const child = children.splice(i, 1)[0];\r\n                    this.index.remove(child);\r\n                }\r\n            }\r\n        } else {\r\n            children.forEach(child => {\r\n                this.index.remove(child);\r\n            });\r\n            children.splice(0, children.length);\r\n        }\r\n    }\r\n\r\n    move(child: SChildElementImpl, newIndex: number) {\r\n        const children = this.children as SChildElementImpl[];\r\n        const i = children.indexOf(child);\r\n        if (i === -1) {\r\n            throw new Error(`No such child ${child.id}`);\r\n        } else {\r\n            if (newIndex < 0 || newIndex > children.length - 1) {\r\n                throw new Error(`Child index ${newIndex} out of bounds (0..${children.length})`);\r\n            }\r\n            children.splice(i, 1);\r\n            children.splice(newIndex, 0, child);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Transform the given bounds from the local coordinate system of this element to the coordinate\r\n     * system of its parent. This function should consider any transformation that is applied to the\r\n     * view of this element and its contents.\r\n     * The base implementation assumes that this element does not define a local coordinate system,\r\n     * so it leaves the bounds unchanged.\r\n     */\r\n    localToParent(point: Point | Bounds): Bounds {\r\n        return isBounds(point) ? point : { x: point.x, y: point.y, width: -1, height: -1 };\r\n    }\r\n\r\n    /**\r\n     * Transform the given bounds from the coordinate system of this element's parent to its local\r\n     * coordinate system. This function should consider any transformation that is applied to the\r\n     * view of this element and its contents.\r\n     * The base implementation assumes that this element does not define a local coordinate system,\r\n     * so it leaves the bounds unchanged.\r\n     */\r\n    parentToLocal(point: Point | Bounds): Bounds {\r\n        return isBounds(point) ? point : { x: point.x, y: point.y, width: -1, height: -1 };\r\n    }\r\n}\r\n\r\n/**\r\n * A child element is contained in a parent element. All elements except the model root are child\r\n * elements. In order to keep the model class hierarchy simple, every child element is also a\r\n * parent element, although for many elements the array of children is empty (i.e. they are\r\n * leafs in the model element tree).\r\n */\r\nexport class SChildElementImpl extends SParentElementImpl {\r\n    readonly parent: SParentElementImpl;\r\n}\r\n\r\n\r\n/**\r\n * Base class for the root element of the diagram model tree.\r\n */\r\nexport class SModelRootImpl extends SParentElementImpl {\r\n    revision?: number;\r\n\r\n    canvasBounds: Bounds = Bounds.EMPTY;\r\n\r\n    constructor(index = new ModelIndexImpl()) {\r\n        super();\r\n          // Override the index property from SModelElement, which has a getter, with a data property\r\n          Object.defineProperty(this, 'index', {\r\n            value: index,\r\n            writable: false\r\n        });\r\n    }\r\n}\r\n\r\nconst ID_CHARS = '0123456789abcdefghijklmnopqrstuvwxyz';\r\nexport function createRandomId(length: number = 8): string {\r\n    let id = '';\r\n    for (let i = 0; i < length; i++) {\r\n        id += ID_CHARS.charAt(Math.floor(Math.random() * ID_CHARS.length));\r\n    }\r\n    return id;\r\n}\r\n\r\n\r\n/**\r\n * Used to speed up model element lookup by id.\r\n */\r\n export interface IModelIndex {\r\n    add(element: SModelElement): void\r\n    remove(element: SModelElement): void\r\n    contains(element: SModelElement): boolean\r\n    getById(id: string): SModelElement | undefined\r\n}\r\n\r\n/**\r\n * This index implementation is for the _internal model_ that is used for rendering.\r\n */\r\nexport class ModelIndexImpl implements IModelIndex {\r\n\r\n    private readonly id2element: Map<string, SModelElementImpl> = new Map();\r\n\r\n    add(element: SModelElementImpl): void {\r\n        if (!element.id) {\r\n            do {\r\n                element.id = createRandomId();\r\n            } while (this.contains(element));\r\n        } else if (this.contains(element)) {\r\n            throw new Error('Duplicate ID in model: ' + element.id);\r\n        }\r\n        this.id2element.set(element.id, element);\r\n        if (element instanceof SParentElementImpl) {\r\n            for (const child of element.children) {\r\n                this.add(child as any);\r\n            }\r\n        }\r\n    }\r\n\r\n    remove(element: SModelElementImpl): void {\r\n        this.id2element.delete(element.id);\r\n        if (element instanceof SParentElementImpl) {\r\n            for (const child of element.children) {\r\n                this.remove(child as any);\r\n            }\r\n        }\r\n    }\r\n\r\n    contains(element: SModelElementImpl): boolean {\r\n        return this.id2element.has(element.id);\r\n    }\r\n\r\n    getById(id: string): SModelElementImpl | undefined {\r\n        return this.id2element.get(id);\r\n    }\r\n\r\n    getAttachedElements(element: SModelElementImpl): FluentIterable<SModelElementImpl> {\r\n        return [];\r\n    }\r\n\r\n    all(): FluentIterable<SModelElementImpl> {\r\n        return mapIterable(this.id2element, ([key, value]: [string, SModelElementImpl]) => value);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject, optional, inject } from 'inversify';\r\nimport { SModelElement, SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { TYPES } from \"../types\";\r\nimport { FactoryRegistry } from '../../utils/registry';\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl, SParentElementImpl, isParent, FeatureSet } from './smodel';\r\n\r\n/**\r\n * Model element classes registered here are considered automatically when constructring a model from its schema.\r\n */\r\n@injectable()\r\nexport class SModelRegistry extends FactoryRegistry<SModelElementImpl, void> {\r\n    constructor(@multiInject(TYPES.SModelElementRegistration) @optional() registrations: SModelElementRegistration[]) {\r\n        super();\r\n\r\n        registrations.forEach(registration => {\r\n            let defaultFeatures = this.getDefaultFeatures(registration.constr);\r\n            if (!defaultFeatures && registration.features && registration.features.enable)\r\n                defaultFeatures = [];\r\n            if (defaultFeatures) {\r\n                const featureSet = createFeatureSet(defaultFeatures, registration.features);\r\n                this.register(registration.type, () => {\r\n                    const element = new registration.constr();\r\n                    element.features = featureSet;\r\n                    return element;\r\n                });\r\n            } else {\r\n                this.register(registration.type, () => new registration.constr());\r\n            }\r\n        });\r\n    }\r\n\r\n    protected getDefaultFeatures(constr: SModelElementConstructor): ReadonlyArray<symbol> | undefined {\r\n        let obj = constr;\r\n        do {\r\n            const defaultFeatures = obj.DEFAULT_FEATURES;\r\n            if (defaultFeatures)\r\n                return defaultFeatures;\r\n            obj = Object.getPrototypeOf(obj);\r\n        } while (obj);\r\n        return undefined;\r\n    }\r\n}\r\n\r\n/**\r\n * A model factory transforms a serializable model schema into the model representation that is used\r\n * internally by sprotty.\r\n */\r\nexport interface IModelFactory {\r\n    createElement(schema: SModelElement | SModelElementImpl, parent?: SParentElementImpl): SChildElementImpl\r\n\r\n    createRoot(schema: SModelRoot | SModelRootImpl): SModelRootImpl\r\n\r\n    createSchema(element: SModelElementImpl): SModelElement\r\n}\r\n\r\n/**\r\n * The default model factory creates SModelRoot for the root element and SChildElement for all other\r\n * model elements.\r\n */\r\n@injectable()\r\nexport class SModelFactory implements IModelFactory {\r\n\r\n    @inject(TYPES.SModelRegistry) protected readonly registry: SModelRegistry;\r\n\r\n    createElement(schema: SModelElement | SModelElementImpl, parent?: SParentElementImpl): SChildElementImpl {\r\n        let child: SChildElementImpl;\r\n        if (this.registry.hasKey(schema.type)) {\r\n            const regElement = this.registry.get(schema.type, undefined);\r\n            if (!(regElement instanceof SChildElementImpl))\r\n                throw new Error(`Element with type ${schema.type} was expected to be an SChildElement.`);\r\n            child = regElement;\r\n        } else {\r\n            child = new SChildElementImpl();\r\n        }\r\n        return this.initializeChild(child, schema, parent);\r\n    }\r\n\r\n    createRoot(schema: SModelRoot | SModelRootImpl): SModelRootImpl {\r\n        let root: SModelRootImpl;\r\n        if (this.registry.hasKey(schema.type)) {\r\n            const regElement = this.registry.get(schema.type, undefined);\r\n            if (!(regElement instanceof SModelRootImpl))\r\n                throw new Error(`Element with type ${schema.type} was expected to be an SModelRoot.`);\r\n            root = regElement;\r\n        } else {\r\n            root = new SModelRootImpl();\r\n        }\r\n        return this.initializeRoot(root, schema);\r\n    }\r\n\r\n    createSchema(element: SModelElementImpl): SModelElement {\r\n        const schema = {};\r\n        for (const key in element) {\r\n             if (!this.isReserved(element, key)) {\r\n                const value: any = (element as any)[key];\r\n                if (typeof value !== 'function')\r\n                    (schema as any)[key] = value;\r\n            }\r\n        }\r\n        if (element instanceof SParentElementImpl)\r\n            (schema as any)['children'] = element.children.map(child => this.createSchema(child));\r\n        return schema as SModelElement;\r\n    }\r\n\r\n    protected initializeElement(element: SModelElementImpl, schema: SModelElement | SModelElementImpl): SModelElementImpl {\r\n        for (const key in schema) {\r\n            if (!this.isReserved(element, key)) {\r\n                const value: any = (schema as any)[key];\r\n                if (typeof value !== 'function')\r\n                    (element as any)[key] = value;\r\n            }\r\n        }\r\n        return element;\r\n    }\r\n\r\n    protected isReserved(element: SModelElementImpl, propertyName: string) {\r\n        if (['children', 'parent', 'index'].indexOf(propertyName) >= 0)\r\n            return true;\r\n        let obj = element;\r\n        do {\r\n            const descriptor = Object.getOwnPropertyDescriptor(obj, propertyName);\r\n            if (descriptor !== undefined)\r\n                return descriptor.get !== undefined;\r\n            obj = Object.getPrototypeOf(obj);\r\n        } while (obj);\r\n        return false;\r\n    }\r\n\r\n    protected initializeParent(parent: SParentElementImpl, schema: SModelElement | SParentElementImpl): SParentElementImpl {\r\n        this.initializeElement(parent, schema);\r\n        if (isParent(schema)) {\r\n            (parent as any).children = schema.children.map(childSchema => this.createElement(childSchema, parent));\r\n        }\r\n        return parent;\r\n    }\r\n\r\n    protected initializeChild(child: SChildElementImpl, schema: SModelElement, parent?: SParentElementImpl): SChildElementImpl {\r\n        this.initializeParent(child, schema);\r\n        if (parent !== undefined) {\r\n            (child as any).parent = parent;\r\n        }\r\n        return child;\r\n    }\r\n\r\n    protected initializeRoot(root: SModelRootImpl, schema: SModelRoot | SModelRootImpl): SModelRootImpl {\r\n        this.initializeParent(root, schema);\r\n        root.index.add(root);\r\n        return root;\r\n    }\r\n}\r\n\r\nexport const EMPTY_ROOT: Readonly<SModelRoot> = Object.freeze({\r\n    type: 'NONE',\r\n    id: 'EMPTY'\r\n});\r\n\r\n/**\r\n * Used to bind a model element type to a class constructor in the SModelRegistry.\r\n */\r\nexport interface SModelElementRegistration {\r\n    type: string\r\n    constr: SModelElementConstructor\r\n    features?: CustomFeatures\r\n}\r\n\r\nexport interface SModelElementConstructor {\r\n    DEFAULT_FEATURES?: ReadonlyArray<symbol>\r\n    new (): SModelElementImpl\r\n}\r\n\r\nexport interface CustomFeatures {\r\n    enable?: symbol[]\r\n    disable?: symbol[]\r\n}\r\n\r\nexport function createFeatureSet(defaults: ReadonlyArray<symbol>, custom?: CustomFeatures): FeatureSet {\r\n    const featureSet = new Set<symbol>(defaults);\r\n    if (custom && custom.enable) {\r\n        for (const f of custom.enable) {\r\n            featureSet.add(f);\r\n        }\r\n    }\r\n    if (custom && custom.disable) {\r\n        for (const f of custom.disable) {\r\n            featureSet.delete(f);\r\n        }\r\n    }\r\n    return featureSet;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\n\r\n@injectable()\r\nexport class AnimationFrameSyncer {\r\n\r\n    tasks: ((x?: number) => void) [] = [];\r\n    endTasks: ((x?: number) => void) [] = [];\r\n    triggered: boolean = false;\r\n\r\n    isAvailable(): boolean {\r\n        return typeof requestAnimationFrame === \"function\";\r\n    }\r\n\r\n    onNextFrame(task: (x?: number) => void) {\r\n        this.tasks.push(task);\r\n        this.trigger();\r\n    }\r\n\r\n    onEndOfNextFrame(task: (x?: number) => void) {\r\n        this.endTasks.push(task);\r\n        this.trigger();\r\n    }\r\n\r\n    protected trigger() {\r\n        if (!this.triggered) {\r\n            this.triggered = true;\r\n            if (this.isAvailable())\r\n                requestAnimationFrame((time: number) => this.run(time));\r\n            else\r\n                setTimeout((time: number) => this.run(time));\r\n        }\r\n    }\r\n\r\n    protected run(time: number) {\r\n        const tasks = this.tasks;\r\n        const endTasks = this.endTasks;\r\n        this.triggered = false;\r\n        this.tasks = [];\r\n        this.endTasks = [];\r\n        tasks.forEach(task => task.call(undefined, time));\r\n        endTasks.forEach(task => task.call(undefined, time));\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport {\r\n    Action, isAction, isRequestAction, isResponseAction, RedoAction, RejectAction, RequestAction,\r\n    ResponseAction, SetModelAction, setRequestContext, UndoAction\r\n} from 'sprotty-protocol/lib/actions';\r\nimport { Deferred } from 'sprotty-protocol/lib/utils/async';\r\nimport { TYPES } from '../types';\r\nimport { ILogger } from '../../utils/logging';\r\nimport { EMPTY_ROOT } from '../model/smodel-factory';\r\nimport { ICommandStack } from '../commands/command-stack';\r\nimport { AnimationFrameSyncer } from '../animations/animation-frame-syncer';\r\nimport { ActionHandlerRegistry } from './action-handler';\r\nimport { IDiagramLocker } from './diagram-locker';\r\n\r\nexport interface IActionDispatcher {\r\n    dispatch(action: Action): Promise<void>\r\n    dispatchAll(actions: Action[]): Promise<void>\r\n    request<Res extends ResponseAction>(action: RequestAction<Res>): Promise<Res>\r\n}\r\n\r\n// This code should be used only in the client part of a Sprotty application.\r\n// We set the request context to 'client' to avoid collisions with requests created by the server.\r\nsetRequestContext('client');\r\n\r\n/**\r\n * Collects actions, converts them to commands and dispatches them.\r\n * Also acts as the proxy to model sources such as diagram servers.\r\n */\r\n@injectable()\r\nexport class ActionDispatcher implements IActionDispatcher {\r\n\r\n    @inject(TYPES.ActionHandlerRegistryProvider) protected actionHandlerRegistryProvider: () => Promise<ActionHandlerRegistry>;\r\n    @inject(TYPES.ICommandStack) protected commandStack: ICommandStack;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer;\r\n    @inject(TYPES.IDiagramLocker) protected diagramLocker: IDiagramLocker;\r\n\r\n    protected actionHandlerRegistry: ActionHandlerRegistry;\r\n\r\n    protected initialized: Promise<void> | undefined;\r\n    protected blockUntil?: (action: Action) => boolean;\r\n    protected postponedActions: PostponedAction[] = [];\r\n    protected readonly requests: Map<string, Deferred<ResponseAction>> = new Map();\r\n\r\n    initialize(): Promise<void> {\r\n        if (!this.initialized) {\r\n            this.initialized = this.actionHandlerRegistryProvider().then(registry => {\r\n                this.actionHandlerRegistry = registry;\r\n                this.handleAction(SetModelAction.create(EMPTY_ROOT)).catch(() => { /* Logged in handleAction method */ });\r\n            });\r\n        }\r\n        return this.initialized;\r\n    }\r\n\r\n    /**\r\n     * Dispatch an action by querying all handlers that are registered for its kind.\r\n     * The returned promise is resolved when all handler results (commands or actions)\r\n     * have been processed.\r\n     */\r\n    dispatch(action: Action): Promise<void> {\r\n        return this.initialize().then(() => {\r\n            if (this.blockUntil !== undefined) {\r\n                return this.handleBlocked(action, this.blockUntil);\r\n            } else if (this.diagramLocker.isAllowed(action)) {\r\n                return this.handleAction(action);\r\n            }\r\n            return undefined;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Calls `dispatch` on every action in the given array. The returned promise\r\n     * is resolved when the promises of all `dispatch` calls have been resolved.\r\n     */\r\n    dispatchAll(actions: Action[]): Promise<void> {\r\n        return Promise.all(actions.map(action => this.dispatch(action))) as Promise<any>;\r\n    }\r\n\r\n    /**\r\n     * Dispatch a request. The returned promise is resolved when a response with matching\r\n     * identifier is dispatched. That response is _not_ passed to the registered action\r\n     * handlers. Instead, it is the responsibility of the caller of this method to handle\r\n     * the response properly. For example, it can be sent to the registered handlers by\r\n     * passing it again to the `dispatch` method.\r\n     */\r\n    request<Res extends ResponseAction>(action: RequestAction<Res>): Promise<Res> {\r\n        if (!action.requestId) {\r\n            return Promise.reject(new Error('Request without requestId'));\r\n        }\r\n        const deferred = new Deferred<Res>();\r\n        this.requests.set(action.requestId, deferred);\r\n        this.dispatch(action).catch(() => { /* Logged in handleAction method */ });\r\n        return deferred.promise;\r\n    }\r\n\r\n    protected handleAction(action: Action): Promise<void> {\r\n        if (action.kind === UndoAction.KIND) {\r\n            return this.commandStack.undo().then(() => {});\r\n        }\r\n        if (action.kind === RedoAction.KIND) {\r\n            return this.commandStack.redo().then(() => {});\r\n        }\r\n        if (isResponseAction(action)) {\r\n            const deferred = this.requests.get(action.responseId);\r\n            if (deferred !== undefined) {\r\n                this.requests.delete(action.responseId);\r\n                if (action.kind === RejectAction.KIND) {\r\n                    const rejectAction = action as RejectAction;\r\n                    deferred.reject(new Error(rejectAction.message));\r\n                    this.logger.warn(this, `Request with id ${action.responseId} failed.`,\r\n                            rejectAction.message, rejectAction.detail);\r\n                } else {\r\n                    deferred.resolve(action);\r\n                }\r\n                return Promise.resolve();\r\n            }\r\n            this.logger.log(this, 'No matching request for response', action);\r\n        }\r\n\r\n        const handlers = this.actionHandlerRegistry.get(action.kind);\r\n        if (handlers.length === 0) {\r\n            this.logger.warn(this, 'Missing handler for action', action);\r\n            const error = new Error(`Missing handler for action '${action.kind}'`);\r\n            if (isRequestAction(action)) {\r\n                const deferred = this.requests.get(action.requestId);\r\n                if (deferred !== undefined) {\r\n                    this.requests.delete(action.requestId);\r\n                    deferred.reject(error);\r\n                }\r\n            }\r\n            return Promise.reject(error);\r\n        }\r\n        this.logger.log(this, 'Handle', action);\r\n        const promises: Promise<any>[] = [];\r\n        for (const handler of handlers) {\r\n            const result = handler.handle(action);\r\n            if (isAction(result)) {\r\n                promises.push(this.dispatch(result));\r\n            } else if (result !== undefined) {\r\n                promises.push(this.commandStack.execute(result));\r\n                this.blockUntil = result.blockUntil;\r\n            }\r\n        }\r\n        return Promise.all(promises) as Promise<any>;\r\n    }\r\n\r\n    protected handleBlocked(action: Action, predicate: (action: Action) => boolean): Promise<void> {\r\n        if (predicate(action)) {\r\n            this.blockUntil = undefined;\r\n            const result = this.handleAction(action);\r\n            const actions = this.postponedActions;\r\n            this.postponedActions = [];\r\n            for (const a of actions) {\r\n                this.dispatch(a.action).then(a.resolve, a.reject);\r\n            }\r\n            return result;\r\n        } else {\r\n            this.logger.log(this, 'Action is postponed due to block condition', action);\r\n            return new Promise((resolve, reject) => {\r\n                this.postponedActions.push({ action, resolve, reject });\r\n            });\r\n        }\r\n    }\r\n}\r\n\r\nexport interface PostponedAction {\r\n    action: Action\r\n    resolve: () => void\r\n    reject: (reason: any) => void\r\n}\r\n\r\nexport type IActionDispatcherProvider = () => Promise<IActionDispatcher>;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nexport function isInjectable(constr: new (...args: unknown[]) => unknown): boolean {\r\n    return Reflect.getMetadata('inversify:paramtypes', constr) !== undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject, optional, interfaces } from \"inversify\";\r\nimport { TYPES } from \"../types\";\r\nimport { MultiInstanceRegistry } from \"../../utils/registry\";\r\nimport { isInjectable } from \"../../utils/inversify\";\r\nimport { ICommand } from \"../commands/command\";\r\nimport { Action } from \"sprotty-protocol\";\r\n\r\n/**\r\n * An action handler accepts an action and reacts to it by returning either a command to be\r\n * executed, or another action to be dispatched.\r\n */\r\nexport interface IActionHandler {\r\n    handle(action: Action): ICommand | Action | void\r\n}\r\n\r\n/**\r\n * Used to bind an action kind to an action handler factory in the ActionHandlerRegistry.\r\n */\r\nexport interface ActionHandlerRegistration {\r\n    actionKind: string\r\n    factory: () => IActionHandler\r\n}\r\n\r\n/**\r\n * Initializes and registers an action handler for multiple action kinds. In most cases\r\n * `ActionHandlerRegistration` should be used instead.\r\n */\r\nexport interface IActionHandlerInitializer {\r\n    initialize(registry: ActionHandlerRegistry): void\r\n}\r\n\r\n/**\r\n * The action handler registry maps actions to their handlers using the Action.kind property.\r\n */\r\n@injectable()\r\nexport class ActionHandlerRegistry extends MultiInstanceRegistry<IActionHandler> {\r\n\r\n    constructor(@multiInject(TYPES.ActionHandlerRegistration) @optional() registrations: ActionHandlerRegistration[],\r\n                @multiInject(TYPES.IActionHandlerInitializer) @optional() initializers: IActionHandlerInitializer[]) {\r\n        super();\r\n        registrations.forEach(registration =>\r\n            this.register(registration.actionKind, registration.factory())\r\n        );\r\n        initializers.forEach(initializer =>\r\n            this.initializeActionHandler(initializer)\r\n        );\r\n    }\r\n\r\n    initializeActionHandler(initializer: IActionHandlerInitializer): void {\r\n        initializer.initialize(this);\r\n    }\r\n}\r\n\r\n/**\r\n * Utility function to register an action handler for an action kind.\r\n */\r\nexport function configureActionHandler(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        kind: string, constr: interfaces.ServiceIdentifier<IActionHandler>): void {\r\n    if (typeof constr === 'function') {\r\n        if (!isInjectable(constr)) {\r\n            throw new Error(`Action handlers should be @injectable: ${constr.name}`);\r\n        }\r\n        if (!context.isBound(constr)) {\r\n            context.bind(constr).toSelf();\r\n        }\r\n    }\r\n    context.bind(TYPES.ActionHandlerRegistration).toDynamicValue(ctx => ({\r\n        actionKind: kind,\r\n        factory: () => ctx.container.get(constr)\r\n    }));\r\n}\r\n\r\n/**\r\n * Utility function to register an action handler for an action kind.\r\n */\r\nexport function onAction(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        kind: string, handle: (action: Action) => ICommand | Action | void): void {\r\n    context.bind(TYPES.ActionHandlerRegistration).toConstantValue({\r\n        actionKind: kind,\r\n        factory: () => ({ handle })\r\n    });\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\n\r\n/**\r\n * Allows to lock the diagram by preventing certain actions from being\r\n * dispatched.\r\n *\r\n * This could for example be used to prevent the diagram from being modified\r\n * when the underlying model is broken or the server is unavailable.\r\n */\r\nexport interface IDiagramLocker {\r\n    isAllowed(action: Action): boolean\r\n}\r\n\r\n@injectable()\r\nexport class DefaultDiagramLocker implements IDiagramLocker {\r\n    isAllowed(action: Action): boolean {\r\n        return true;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/**\r\n * Slows down animations towards the begin and the end.\r\n *\r\n * @param x the value between 0 (start of animation) and 1 (end of\r\n *     animation) linearly interpolated in time.\r\n * @returns {number} the eased value between 0 and 1\r\n */\r\nexport function easeInOut(x: number): number {\r\n    if (x < 0.5)\r\n        return x * x * 2;\r\n    else\r\n        return 1 - (1 - x) * (1 - x) * 2;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { CommandExecutionContext } from \"../commands/command\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { easeInOut } from \"./easing\";\r\n\r\n/**\r\n * An animation uses the rendering loop of the browser to smoothly\r\n * calculate a transition between two states of a model element.\r\n */\r\nexport abstract class Animation {\r\n\r\n    constructor(protected context: CommandExecutionContext, protected ease: (x: number) => number = easeInOut) {\r\n    }\r\n\r\n    start(): Promise<SModelRootImpl> {\r\n        return new Promise<SModelRootImpl>(\r\n            (resolve: (model: SModelRootImpl) => void, reject: (model: SModelRootImpl) => void) => {\r\n                let start: number | undefined = undefined;\r\n                let frames = 0;\r\n                const lambda = (time: number) => {\r\n                    frames++;\r\n                    let dtime: number;\r\n                    if (start === undefined) {\r\n                        start = time;\r\n                        dtime = 0;\r\n                    } else {\r\n                        dtime = time - start;\r\n                    }\r\n                    const t = Math.min(1, dtime / this.context.duration);\r\n                    const current = this.tween(this.ease(t), this.context);\r\n                    this.context.modelChanged.update(current);\r\n                    if (t === 1) {\r\n                        this.context.logger.log(this, (frames * 1000 / this.context.duration) + ' fps');\r\n                        resolve(current);\r\n                    } else {\r\n                        this.context.syncer.onNextFrame(lambda);\r\n                    }\r\n                };\r\n                if (this.context.syncer.isAvailable()) {\r\n                    this.context.syncer.onNextFrame(lambda);\r\n                } else {\r\n                    const finalModel = this.tween(1, this.context);\r\n                    resolve(finalModel);\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * This method called by the animation at each rendering pass until\r\n     * the duration is reached. Implement it to interpolate the state.\r\n     *\r\n     * @param t varies between 0 (start of animation) and 1 (end of animation)\r\n     * @param context\r\n     */\r\n    abstract tween(t: number, context: CommandExecutionContext): SModelRootImpl;\r\n}\r\n\r\nexport class CompoundAnimation extends Animation {\r\n\r\n    constructor(protected model: SModelRootImpl,\r\n                protected override context: CommandExecutionContext,\r\n                public components: Animation[] = [],\r\n                protected override ease: (x: number) => number = easeInOut) {\r\n        super(context, ease);\r\n    }\r\n\r\n    include(animation: Animation): this {\r\n        this.components.push(animation);\r\n        return this;\r\n    }\r\n\r\n    tween(t: number, context: CommandExecutionContext): SModelRootImpl {\r\n        for (const a of this.components) {\r\n            a.tween(t, context);\r\n        }\r\n        return this.model;\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport 'reflect-metadata';\r\nimport { injectable } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { ILogger } from \"../../utils/logging\";\r\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { IModelFactory } from \"../model/smodel-factory\";\r\nimport { IViewer } from \"../views/viewer\";\r\n\r\n/**\r\n * A command holds the behaviour of an action.\r\n * It is executed on a command stack and can be undone / redone.\r\n *\r\n * A command should store all information it needs to undo itself at a\r\n * later stage. It typically resolves the model elements it is going\r\n * to manipulate as a first step in the execute method.\r\n *\r\n * Each command should define a static string property KIND that\r\n * matches the associated action. This is used as a key in the\r\n * ActionHandlerRegistry.\r\n *\r\n * Clients should not implement the ICommand interface directly but\r\n * rather inherit from one of its abstract implementators.\r\n */\r\nexport interface ICommand {\r\n    /**\r\n     * If this property is present, all following actions are blocked\r\n     * until the function returns `true`.\r\n     */\r\n    readonly blockUntil?: (action: Action) => boolean;\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn\r\n}\r\n\r\n/**\r\n * Commands return the changed model or a Promise for it. Promises\r\n * serve animating commands to render some intermediate states before\r\n * finishing. The CommandStack is in charge of chaining these promises,\r\n * such that they run sequentially only one at a time. Due to that\r\n * chaining, it is essential that a command does not make any assumption\r\n * on the state of the model before execute() is called.\r\n */\r\nexport type CommandReturn = SModelRootImpl | Promise<SModelRootImpl> | CommandResult;\r\n\r\n/**\r\n * The `CommandResult` allows to specify whether the model has changed\r\n * and the original action that caused the command to be executed. In case such\r\n * an action is given, it is passed to the viewer in order to link any\r\n * subsequent response action to the original request.\r\n */\r\nexport type CommandResult = { model: SModelRootImpl, modelChanged: boolean, cause?: Action };\r\n\r\n/**\r\n * Base class for all commands.\r\n *\r\n * Command instances are created via dependency injection and should take\r\n * the respective action as an injected constructor parameter. They must\r\n * also define a static <code>KIND</code> which is used to map an\r\n * <code>Action#kind</code>.\r\n *\r\n * <pre>\r\n * export class MyCommand extends Command {\r\n *   static KIND = 'MyCommand'\r\n *   constructor(@inject(TYPES.Action) action: MyAction) {\r\n *   ...\r\n * }\r\n * @inject(TYPES.Action)\r\n * </pre>\r\n */\r\n@injectable()\r\nexport abstract class Command implements ICommand {\r\n\r\n    abstract execute(context: CommandExecutionContext): CommandReturn;\r\n\r\n    abstract undo(context: CommandExecutionContext): CommandReturn;\r\n\r\n    abstract redo(context: CommandExecutionContext): CommandReturn;\r\n}\r\n\r\n/**\r\n * A mergeable command can accumulate subsequent commands of the same kind.\r\n *\r\n * For example, multiple subsequent move commands can be merged to yield a\r\n * single command, such that undo will roll them back altogether. Otherwise\r\n * the user would have to push CTRL-Z for each mouse move element that\r\n * resuted in a command.\r\n */\r\n@injectable()\r\nexport abstract class MergeableCommand extends Command {\r\n    /**\r\n     * Tries to merge the given command with this.\r\n     *\r\n     * @param command\r\n     * @param context\r\n     */\r\n    merge(command: ICommand, context: CommandExecutionContext): boolean {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * A hidden command is used to trigger the rendering of a model on a\r\n * hidden canvas.\r\n *\r\n * Some graphical elements are styled using CSS, others have bounds that\r\n * require to layout their children before being computed. In such cases\r\n * we cannot tell about the size of elements without acutally rendering\r\n * the DOM. We render them to an invisible canvas. This can be achieved\r\n * using hidden commands.\r\n *\r\n * Hidden commands do not change the model directly, and are as such\r\n * neither undoable nor redoable. The command stack does not push them on\r\n * any stack and forwards the resulting model to the invisible viewer.\r\n */\r\n@injectable()\r\nexport abstract class HiddenCommand extends Command {\r\n    abstract override execute(context: CommandExecutionContext): SModelRootImpl | CommandResult;\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        context.logger.error(this, 'Cannot undo a hidden command');\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        context.logger.error(this, 'Cannot redo a hidden command');\r\n        return context.root;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport abstract class PopupCommand extends Command {\r\n}\r\n\r\n/**\r\n * A system command is triggered by the system, e.g. in order to update bounds\r\n * in the model with data fetched from the DOM.\r\n *\r\n * As it is automatically triggered it should not count as a single command in\r\n * undo/redo operations. Into the bargain, such an automatic command could occur\r\n * after an undo and as such make the next redo command invalid because it is\r\n * based on a model state that has changed. The command stack handles system\r\n * commands in a special way to overcome these issues.\r\n */\r\n@injectable()\r\nexport abstract class SystemCommand extends Command {\r\n}\r\n\r\n/**\r\n * A reset command deletes all undo/redo stacks and cannot be undone.\r\n *\r\n * It marks a point of no return.\r\n */\r\n@injectable()\r\nexport abstract class ResetCommand extends Command {\r\n}\r\n\r\n/**\r\n * The data that is passed into the execution methods of a command to give it\r\n * access to the context.\r\n */\r\nexport interface CommandExecutionContext {\r\n    /** The current Sprotty model (i.e. the main model that is visible to the user) */\r\n    root: SModelRootImpl\r\n\r\n    /** Used to turn sprotty external model elements (e.g. from the action) into internal model elements */\r\n    modelFactory: IModelFactory\r\n\r\n    /** Allows to give some feedback to the console */\r\n    logger: ILogger\r\n\r\n    /** Used for anmiations to trigger the rendering of a new frame */\r\n    modelChanged: IViewer\r\n\r\n    /** Duration of an anmiation */\r\n    duration: number\r\n\r\n    /** Provides the ticks for animations */\r\n    syncer: AnimationFrameSyncer\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject, optional, interfaces, Container } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { isInjectable } from \"../../utils/inversify\";\r\nimport { ActionHandlerRegistry, IActionHandler, IActionHandlerInitializer } from \"../actions/action-handler\";\r\nimport { ICommand } from \"./command\";\r\nimport { TYPES } from \"../types\";\r\n\r\nexport class CommandActionHandler implements IActionHandler {\r\n    constructor(private commandRegistration: CommandRegistration) {\r\n    }\r\n\r\n    handle(action: Action): ICommand {\r\n        return this.commandRegistration.factory(action);\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class CommandActionHandlerInitializer implements IActionHandlerInitializer {\r\n\r\n    constructor(@multiInject(TYPES.CommandRegistration) @optional() protected registrations: CommandRegistration[]) {\r\n    }\r\n\r\n    initialize(registry: ActionHandlerRegistry): void {\r\n        this.registrations.forEach(registration =>\r\n            registry.register(registration.kind, new CommandActionHandler(registration))\r\n        );\r\n    }\r\n}\r\n\r\nexport interface CommandRegistration {\r\n    kind: string\r\n    factory: (a: Action) => ICommand\r\n}\r\n\r\nexport interface ICommandConstructor<T extends Action> {\r\n    KIND: string\r\n    new (a: T, ...args: any[]): ICommand\r\n}\r\n\r\n/**\r\n * Use this method in your DI configuration to register a new command to the diagram.\r\n */\r\nexport function configureCommand<T extends Action>(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        constr: ICommandConstructor<T>) {\r\n    if (!isInjectable(constr)) {\r\n        throw new Error(`Commands should be @injectable: ${constr.name}`);\r\n    }\r\n    if (!context.isBound(constr)) {\r\n        context.bind(constr).toSelf();\r\n    }\r\n    context.bind(TYPES.CommandRegistration).toDynamicValue(ctx => ({\r\n        kind: constr.KIND,\r\n        factory: (action: Action) => {\r\n            const childContainer = new Container();\r\n            childContainer.parent = ctx.container;\r\n            childContainer.bind(TYPES.Action).toConstantValue(action);\r\n            return childContainer.get<ICommand>(constr);\r\n        }\r\n    }));\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Container } from \"inversify\";\r\nimport { safeAssign } from \"sprotty-protocol/lib/utils/object\";\r\nimport { TYPES } from '../types';\r\n\r\n/**\r\n * Options for the command execution\r\n */\r\nexport interface CommandStackOptions {\r\n    /**\r\n     * The default duration of an animated command in milliseconds\r\n     */\r\n    defaultDuration: number\r\n\r\n    /**\r\n     * The maximum number of commands that can be undone. Once the undo stack\r\n     * reaches this number, any additional command that is pushed will remove\r\n     * one from the bottom of the stack.\r\n     *\r\n     * If negative, there is no limit, which results in a memory leak.\r\n     */\r\n    undoHistoryLimit: number\r\n}\r\n\r\nexport function overrideCommandStackOptions(container: Container, options: Partial<CommandStackOptions>): CommandStackOptions {\r\n    const defaultOptions = container.get<CommandStackOptions>(TYPES.CommandStackOptions);\r\n    safeAssign(defaultOptions, options);\r\n    return defaultOptions;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, postConstruct } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { TYPES } from \"../types\";\r\nimport { ILogger } from \"../../utils/logging\";\r\nimport { EMPTY_ROOT, IModelFactory } from \"../model/smodel-factory\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\r\nimport { IViewer, IViewerProvider } from \"../views/viewer\";\r\nimport { CommandStackOptions } from './command-stack-options';\r\nimport {\r\n    HiddenCommand, ICommand, CommandExecutionContext, CommandReturn, SystemCommand,\r\n    MergeableCommand, PopupCommand, ResetCommand, CommandResult\r\n} from './command';\r\n\r\n/**\r\n * The component that holds the current model and applies the commands\r\n * to change it.\r\n *\r\n * The command stack is called by the ActionDispatcher and forwards the\r\n * changed model to the Viewer that renders it.\r\n */\r\nexport interface ICommandStack {\r\n    /**\r\n     * Executes the given command on the current model and returns a\r\n     * Promise for the new result.\r\n     *\r\n     * Unless it is a special command, it is pushed to the undo stack\r\n     * such that it can be rolled back later and the redo stack is\r\n     * cleared.\r\n     */\r\n    execute(command: ICommand): Promise<SModelRootImpl>\r\n\r\n    /**\r\n     * Executes all of the given commands. As opposed to calling\r\n     * execute() multiple times, the Viewer is only updated once after\r\n     * the last command has been executed.\r\n     */\r\n    executeAll(commands: ICommand[]): Promise<SModelRootImpl>\r\n\r\n    /**\r\n     * Takes the topmost command from the undo stack, undoes its\r\n     * changes and pushes it ot the redo stack. Returns a Promise for\r\n     * the changed model.\r\n     */\r\n    undo(): Promise<SModelRootImpl>\r\n\r\n    /**\r\n     * Takes the topmost command from the redo stack, redoes its\r\n     * changes and pushes it ot the undo stack. Returns a Promise for\r\n     * the changed model.\r\n     */\r\n    redo(): Promise<SModelRootImpl>\r\n}\r\n\r\n/**\r\n * As part of the event cylce, the ICommandStack should be injected\r\n * using a provider to avoid cyclic injection dependencies.\r\n */\r\nexport type CommandStackProvider = () => Promise<ICommandStack>;\r\n\r\n/**\r\n * The implementation of the ICommandStack. Clients should not use this\r\n * class directly.\r\n *\r\n * The command stack holds the current model as the result of the current\r\n * promise. When a new command is executed/undone/redone, its execution is\r\n * chained using <code>Promise#then()</code> to the current Promise. This\r\n * way we can handle long running commands without blocking the current\r\n * thread.\r\n *\r\n * The command stack also does the special handling for special commands:\r\n *\r\n * System commands should be transparent to the user and as such be\r\n * automatically undone/redone with the next plain command. Additional care\r\n * must be taken that system commands that are executed after undo don't\r\n * break the correspondence between the topmost commands on the undo and\r\n * redo stacks.\r\n *\r\n * Hidden commands only tell the viewer to render a hidden model such that\r\n * its bounds can be extracted from the DOM and forwarded as separate actions.\r\n * Hidden commands should not leave any trace on the undo/redo/off stacks.\r\n *\r\n * Mergeable commands should be merged with their predecessor if possible,\r\n * such that e.g. multiple subsequent moves of the smae element can be undone\r\n * in one single step.\r\n */\r\n@injectable()\r\nexport class CommandStack implements ICommandStack {\r\n\r\n    @inject(TYPES.IModelFactory) protected modelFactory: IModelFactory;\r\n    @inject(TYPES.IViewerProvider) protected viewerProvider: IViewerProvider;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer;\r\n    @inject(TYPES.CommandStackOptions) protected options: CommandStackOptions;\r\n\r\n    protected currentPromise: Promise<CommandStackState>;\r\n\r\n    protected modelViewer?: IViewer;\r\n    protected hiddenModelViewer?: IViewer;\r\n    protected popupModelViewer?: IViewer;\r\n\r\n    protected undoStack: ICommand[] = [];\r\n    protected redoStack: ICommand[] = [];\r\n\r\n    /**\r\n     * System commands should be transparent to the user in undo/redo\r\n     * operations. When a system command is executed when the redo\r\n     * stack is not empty, it is pushed to offStack instead.\r\n     *\r\n     * On redo, all commands form this stack are undone such that the\r\n     * redo operation gets the exact same model as when it was executed\r\n     * first.\r\n     *\r\n     * On undo, all commands form this stack are undone as well as\r\n     * system ommands should be transparent to the user.\r\n     */\r\n    protected offStack: ICommand[] = [];\r\n\r\n    @postConstruct()\r\n    protected initialize() {\r\n        this.currentPromise = Promise.resolve({\r\n            main: {\r\n                model: this.modelFactory.createRoot(EMPTY_ROOT),\r\n                modelChanged: false,\r\n            },\r\n            hidden: {\r\n                model: this.modelFactory.createRoot(EMPTY_ROOT),\r\n                modelChanged: false,\r\n            },\r\n            popup: {\r\n                model: this.modelFactory.createRoot(EMPTY_ROOT),\r\n                modelChanged: false,\r\n            }\r\n        });\r\n    }\r\n\r\n    protected get currentModel(): Promise<SModelRootImpl> {\r\n        return this.currentPromise.then(\r\n            state => state.main.model\r\n        );\r\n    }\r\n\r\n    executeAll(commands: ICommand[]): Promise<SModelRootImpl> {\r\n        commands.forEach(\r\n            command => {\r\n                this.logger.log(this, 'Executing', command);\r\n                this.handleCommand(command, command.execute, this.mergeOrPush);\r\n            }\r\n        );\r\n        return this.thenUpdate();\r\n    }\r\n\r\n    execute(command: ICommand): Promise<SModelRootImpl> {\r\n        this.logger.log(this, 'Executing', command);\r\n        this.handleCommand(command, command.execute, this.mergeOrPush);\r\n        return this.thenUpdate();\r\n    }\r\n\r\n    undo(): Promise<SModelRootImpl> {\r\n        this.undoOffStackSystemCommands();\r\n        this.undoPreceedingSystemCommands();\r\n        const command = this.undoStack[this.undoStack.length - 1];\r\n        if (command !== undefined && !this.isBlockUndo(command)) {\r\n            this.undoStack.pop();\r\n            this.logger.log(this, 'Undoing', command);\r\n            this.handleCommand(command, command.undo, (c: ICommand, context: CommandExecutionContext) => {\r\n                this.redoStack.push(c);\r\n            });\r\n        }\r\n        return this.thenUpdate();\r\n    }\r\n\r\n    redo(): Promise<SModelRootImpl> {\r\n        this.undoOffStackSystemCommands();\r\n        const command = this.redoStack.pop();\r\n        if (command !== undefined) {\r\n            this.logger.log(this, 'Redoing', command);\r\n            this.handleCommand(command, command.redo, (c: ICommand, context: CommandExecutionContext) => {\r\n                this.pushToUndoStack(c);\r\n            });\r\n        }\r\n        this.redoFollowingSystemCommands();\r\n        return this.thenUpdate();\r\n    }\r\n\r\n    /**\r\n     * Chains the current promise with another Promise that performs the\r\n     * given operation on the given command.\r\n     *\r\n     * @param beforeResolve a function that is called directly before\r\n     *      resolving the Promise to return the new model. Usually puts the\r\n     *      command on the appropriate stack.\r\n     */\r\n    protected handleCommand(command: ICommand,\r\n                            operation: (context: CommandExecutionContext) => CommandReturn,\r\n                            beforeResolve: (command: ICommand, context: CommandExecutionContext) => void) {\r\n        this.currentPromise = this.currentPromise.then(state =>\r\n            new Promise<CommandStackState>(resolve => {\r\n                let target: 'main' | 'hidden' | 'popup';\r\n                if (command instanceof HiddenCommand)\r\n                    target = 'hidden';\r\n                else if (command instanceof PopupCommand)\r\n                    target = 'popup';\r\n                else\r\n                    target = 'main';\r\n                const context = this.createContext(state.main.model);\r\n\r\n                let commandResult: CommandReturn;\r\n                try {\r\n                    commandResult = operation.call(command, context);\r\n                } catch (error) {\r\n                    this.logger.error(this, \"Failed to execute command:\", error);\r\n                    commandResult = state[target].model;\r\n                }\r\n\r\n                const newState = copyState(state);\r\n                if (commandResult instanceof Promise) {\r\n                    commandResult.then(newModel => {\r\n                        if (target === 'main')\r\n                            beforeResolve.call(this, command, context);\r\n                        newState[target] = { model: newModel, modelChanged: true };\r\n                        resolve(newState);\r\n                    });\r\n                } else if (commandResult instanceof SModelRootImpl) {\r\n                    if (target === 'main')\r\n                        beforeResolve.call(this, command, context);\r\n                    newState[target] = { model: commandResult, modelChanged: true };\r\n                    resolve(newState);\r\n                } else {\r\n                    if (target === 'main')\r\n                        beforeResolve.call(this, command, context);\r\n                    newState[target] = {\r\n                        model: commandResult.model,\r\n                        modelChanged: state[target].modelChanged || commandResult.modelChanged,\r\n                        cause: commandResult.cause\r\n                    };\r\n                    resolve(newState);\r\n                }\r\n            })\r\n        );\r\n    }\r\n\r\n    protected pushToUndoStack(command: ICommand) {\r\n        this.undoStack.push(command);\r\n        if (this.options.undoHistoryLimit >= 0 && this.undoStack.length > this.options.undoHistoryLimit)\r\n            this.undoStack.splice(0, this.undoStack.length - this.options.undoHistoryLimit);\r\n    }\r\n\r\n    /**\r\n     * Notifies the Viewer to render the new model and/or the new hidden model\r\n     * and returns a Promise for the new model.\r\n     */\r\n    protected thenUpdate(): Promise<SModelRootImpl> {\r\n        this.currentPromise = this.currentPromise.then(state => {\r\n            const newState = copyState(state);\r\n            if (state.hidden.modelChanged) {\r\n                this.updateHidden(state.hidden.model, state.hidden.cause);\r\n                newState.hidden.modelChanged = false;\r\n                newState.hidden.cause = undefined;\r\n            }\r\n            if (state.main.modelChanged) {\r\n                this.update(state.main.model, state.main.cause);\r\n                newState.main.modelChanged = false;\r\n                newState.main.cause = undefined;\r\n            }\r\n            if (state.popup.modelChanged) {\r\n                this.updatePopup(state.popup.model, state.popup.cause);\r\n                newState.popup.modelChanged = false;\r\n                newState.popup.cause = undefined;\r\n            }\r\n            return newState;\r\n        });\r\n        return this.currentModel;\r\n    }\r\n\r\n    /**\r\n     * Notify the `ModelViewer` that the model has changed.\r\n     */\r\n    update(model: SModelRootImpl, cause?: Action): void {\r\n        if (this.modelViewer === undefined) {\r\n            this.modelViewer = this.viewerProvider.modelViewer;\r\n        }\r\n        this.modelViewer.update(model, cause);\r\n    }\r\n\r\n    /**\r\n     * Notify the `HiddenModelViewer` that the hidden model has changed.\r\n     */\r\n    updateHidden(model: SModelRootImpl, cause?: Action): void {\r\n        if (this.hiddenModelViewer === undefined) {\r\n            this.hiddenModelViewer = this.viewerProvider.hiddenModelViewer;\r\n        }\r\n        this.hiddenModelViewer.update(model, cause);\r\n    }\r\n\r\n    /**\r\n     * Notify the `PopupModelViewer` that the popup model has changed.\r\n     */\r\n    updatePopup(model: SModelRootImpl, cause?: Action): void {\r\n        if (this.popupModelViewer === undefined) {\r\n            this.popupModelViewer = this.viewerProvider.popupModelViewer;\r\n        }\r\n        this.popupModelViewer.update(model, cause);\r\n    }\r\n\r\n    /**\r\n     * Handling of commands after their execution.\r\n     *\r\n     * Hidden commands are not pushed to any stack.\r\n     *\r\n     * System commands are pushed to the <code>offStack</code> when the redo\r\n     * stack is not empty, allowing to undo the before a redo to keep the chain\r\n     * of commands consistent.\r\n     *\r\n     * Mergable commands are merged if possible.\r\n     */\r\n    protected mergeOrPush(command: ICommand, context: CommandExecutionContext): void {\r\n        if (this.isBlockUndo(command)) {\r\n            this.undoStack = [];\r\n            this.redoStack = [];\r\n            this.offStack = [];\r\n            this.pushToUndoStack(command);\r\n            return;\r\n        }\r\n        if (this.isPushToOffStack(command) && this.redoStack.length > 0) {\r\n            if (this.offStack.length > 0) {\r\n                const lastCommand = this.offStack[this.offStack.length - 1];\r\n                if (lastCommand instanceof MergeableCommand && lastCommand.merge(command, context))\r\n                    return;\r\n            }\r\n            this.offStack.push(command);\r\n            return;\r\n        }\r\n        if (this.isPushToUndoStack(command)) {\r\n            this.offStack.forEach(c => this.undoStack.push(c));\r\n            this.offStack = [];\r\n            this.redoStack = [];\r\n            if (this.undoStack.length > 0) {\r\n                const lastCommand = this.undoStack[this.undoStack.length - 1];\r\n                if (lastCommand instanceof MergeableCommand && lastCommand.merge(command, context))\r\n                    return;\r\n            }\r\n            this.pushToUndoStack(command);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reverts all system commands on the offStack.\r\n     */\r\n    protected undoOffStackSystemCommands(): void {\r\n        let command = this.offStack.pop();\r\n        while (command !== undefined) {\r\n            this.logger.log(this, 'Undoing off-stack', command);\r\n            this.handleCommand(command, command.undo, () => {});\r\n            command = this.offStack.pop();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * System commands should be transparent to the user, so this method\r\n     * is called from <code>undo()</code> to revert all system commands\r\n     * at the top of the undoStack.\r\n     */\r\n    protected undoPreceedingSystemCommands(): void {\r\n        let command = this.undoStack[this.undoStack.length - 1];\r\n        while (command !== undefined && this.isPushToOffStack(command)) {\r\n            this.undoStack.pop();\r\n            this.logger.log(this, 'Undoing', command);\r\n            this.handleCommand(command, command.undo, (c: ICommand, context: CommandExecutionContext) => {\r\n                this.redoStack.push(c);\r\n            });\r\n            command = this.undoStack[this.undoStack.length - 1];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * System commands should be transparent to the user, so this method\r\n     * is called from <code>redo()</code> to re-execute all system commands\r\n     * at the top of the redoStack.\r\n     */\r\n    protected redoFollowingSystemCommands(): void {\r\n        let command = this.redoStack[this.redoStack.length - 1];\r\n        while (command !== undefined && this.isPushToOffStack(command)) {\r\n            this.redoStack.pop();\r\n            this.logger.log(this, 'Redoing ', command);\r\n            this.handleCommand(command, command.redo, (c: ICommand, context: CommandExecutionContext) => {\r\n                this.pushToUndoStack(c);\r\n            });\r\n            command = this.redoStack[this.redoStack.length - 1];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Assembles the context object that is passed to the commands execution method.\r\n     */\r\n    protected createContext(currentModel: SModelRootImpl): CommandExecutionContext {\r\n        return {\r\n            root: currentModel,\r\n            modelChanged: this,\r\n            modelFactory: this.modelFactory,\r\n            duration: this.options.defaultDuration,\r\n            logger: this.logger,\r\n            syncer: this.syncer\r\n        };\r\n    }\r\n\r\n    protected isPushToOffStack(command: ICommand): boolean {\r\n        return command instanceof SystemCommand;\r\n    }\r\n\r\n    protected isPushToUndoStack(command: ICommand): boolean {\r\n        return !(command instanceof HiddenCommand);\r\n    }\r\n\r\n    protected isBlockUndo(command: ICommand): boolean {\r\n        return command instanceof ResetCommand;\r\n    }\r\n}\r\n\r\n/**\r\n * Internal type to pass the results between the promises in the `CommandStack`.\r\n */\r\nexport interface CommandStackState {\r\n    main: CommandResult,\r\n    hidden: CommandResult,\r\n    popup: CommandResult\r\n}\r\n\r\nfunction copyState(state: CommandStackState): CommandStackState {\r\n    return {\r\n        main: {...state.main},\r\n        hidden: {...state.hidden},\r\n        popup: {...state.popup}\r\n    };\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action } from './actions';\r\nimport { DiagramServer } from './diagram-server';\r\nimport { DiagramState } from './diagram-services';\r\n\r\nexport type ServerActionHandler<A extends Action = Action> = (action: A, state: DiagramState, server: DiagramServer) => void | Promise<void>;\r\n\r\n/**\r\n * Use this service to register handlers to specific actions. The `DiagramServer` queries this registry\r\n * when an action is received from the client, and falls back to the built-in behavior if no handlers\r\n * are found.\r\n */\r\nexport class ServerActionHandlerRegistry {\r\n\r\n    protected readonly handlers = new Map<string, ServerActionHandler[]>();\r\n\r\n    /**\r\n     * Returns the action handlers for the given action kind, or `undefined` if there are none.\r\n     */\r\n    getHandler(kind: string): ServerActionHandler[] | undefined {\r\n        return this.handlers.get(kind);\r\n    }\r\n\r\n    /**\r\n     * Add an action handler to be called when an action of the specified kind is received.\r\n     */\r\n    onAction<A extends Action>(kind: string, handler: ServerActionHandler<A>) {\r\n        if (this.handlers.has(kind)) {\r\n            this.handlers.get(kind)!.push(handler);\r\n        } else {\r\n            this.handlers.set(kind, [handler]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove an action handler that was previously added with `onAction`.\r\n     */\r\n    removeActionHandler<A extends Action>(kind: string, handler: ServerActionHandler<A>) {\r\n        const list = this.handlers.get(kind);\r\n        if (list) {\r\n            const index = list.indexOf(handler);\r\n            if (index >= 0) {\r\n                list.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Alignable, BoundsAware, SModelElement, SModelRoot } from '../model';\r\nimport { ComputedBoundsAction } from '../actions';\r\n\r\n/**\r\n * Clone a given model. This function requires that the model is serializable, so it's\r\n * free of cycles and functions.\r\n */\r\nexport function cloneModel<T extends SModelElement>(model: T): T {\r\n    return JSON.parse(JSON.stringify(model));\r\n}\r\n\r\n/**\r\n * Apply the computed bounds to the given model. This ensures that the model has complete\r\n * information about positions and sizes derived from its actual rendering in the frontend.\r\n */\r\nexport function applyBounds(root: SModelRoot, action: ComputedBoundsAction) {\r\n    const index = new SModelIndex();\r\n    index.add(root);\r\n    for (const b of action.bounds) {\r\n        const element = index.getById(b.elementId);\r\n        if (element) {\r\n            const bae = element as SModelElement & BoundsAware;\r\n            if (b.newPosition) {\r\n                bae.position = { x: b.newPosition.x, y: b.newPosition.y };\r\n            }\r\n            if (b.newSize) {\r\n                bae.size = { width: b.newSize.width, height: b.newSize.height };\r\n            }\r\n        }\r\n    }\r\n    if (action.alignments) {\r\n        for (const a of action.alignments) {\r\n            const element = index.getById(a.elementId);\r\n            if (element) {\r\n                const alignable = element as SModelElement & Alignable;\r\n                alignable.alignment = { x: a.newAlignment.x, y: a.newAlignment.y };\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Model element types can include a colon to separate the basic type and a sub-type. This function\r\n * extracts the basic type of a model element.\r\n */\r\nexport function getBasicType(element: { type: string }): string {\r\n    if (!element.type) {\r\n        return '';\r\n    }\r\n    const colonIndex = element.type.indexOf(':');\r\n    return colonIndex >= 0 ? element.type.substring(0, colonIndex) : element.type;\r\n}\r\n\r\n/**\r\n * Model element types can include a colon to separate the basic type and a sub-type. This function\r\n * extracts the sub-type of a model element.\r\n */\r\nexport function getSubType(schema: { type: string }): string {\r\n    if (!schema.type) {\r\n        return '';\r\n    }\r\n    const colonIndex = schema.type.indexOf(':');\r\n    return colonIndex >= 0 ? schema.type.substring(colonIndex + 1) : schema.type;\r\n}\r\n\r\n/**\r\n * Find the element with the given identifier. If you need to find multiple elements, using an\r\n * `SModelIndex` might be more effective.\r\n */\r\nexport function findElement(parent: SModelElement, elementId: string): SModelElement | undefined {\r\n    if (parent.id === elementId) {\r\n        return parent;\r\n    }\r\n    if (parent.children) {\r\n        for (const child of parent.children) {\r\n            const result = findElement(child, elementId);\r\n            if (result !== undefined) {\r\n                return result;\r\n            }\r\n        }\r\n    }\r\n    return undefined;\r\n}\r\n\r\n/**\r\n * Used to speed up model element lookup by id.\r\n * This index implementation is for the serializable _external model_ defined in `sprotty-protocol`.\r\n */\r\nexport class SModelIndex {\r\n\r\n    private readonly id2element: Map<string, SModelElement> = new Map();\r\n    private id2parent: Map<string, SModelElement> = new Map();\r\n\r\n    add(element: SModelElement): this {\r\n        if (!element.id) {\r\n            throw new Error(\"Model element has no ID.\");\r\n        } else if (this.contains(element)) {\r\n            throw new Error(\"Duplicate ID in model: \" + element.id);\r\n        }\r\n        this.id2element.set(element.id, element);\r\n        if (Array.isArray(element.children)) {\r\n            for (const child of element.children) {\r\n                this.add(child as any);\r\n                this.id2parent.set(child.id, element);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    remove(element: SModelElement): this {\r\n        this.id2element.delete(element.id);\r\n        if (Array.isArray(element.children)) {\r\n            for (const child of element.children) {\r\n                this.id2parent.delete(child.id);\r\n                this.remove(child as any);\r\n            }\r\n        }\r\n        return this;\r\n    }\r\n\r\n    contains(element: SModelElement): boolean {\r\n        return this.id2element.has(element.id);\r\n    }\r\n\r\n    getById(id: string): SModelElement | undefined {\r\n        return this.id2element.get(id);\r\n    }\r\n\r\n    getParent(id: string): SModelElement | undefined {\r\n        return this.id2parent.get(id);\r\n    }\r\n\r\n    getRoot(element: SModelElement): SModelRoot {\r\n        let current: SModelElement | undefined = element;\r\n        while (current) {\r\n            const parent = this.id2parent.get(current.id);\r\n            if (parent === undefined) {\r\n                return current;\r\n            }\r\n            current = parent;\r\n        }\r\n        throw new Error(\"Element has no root\");\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ServerActionHandlerRegistry } from './action-handler';\r\nimport {\r\n    Action, isResponseAction, ResponseAction, RequestModelAction, ComputedBoundsAction, LayoutAction, RequestBoundsAction,\r\n    RequestAction, generateRequestId, SetModelAction, UpdateModelAction, RejectAction, isRequestAction\r\n} from './actions';\r\nimport { DiagramServices, DiagramState, IDiagramGenerator, IModelLayoutEngine } from './diagram-services';\r\nimport { SModelRoot } from './model';\r\nimport { Deferred } from './utils/async';\r\nimport { applyBounds, cloneModel } from './utils/model-utils';\r\n\r\n/**\r\n * An instance of this class is responsible for handling a single diagram client. It holds the current\r\n * state of the diagram and manages communication with the client via actions.\r\n */\r\nexport class DiagramServer {\r\n\r\n    readonly state: DiagramState & {\r\n        lastSubmittedModelType?: string\r\n    } = {\r\n        currentRoot: {\r\n            type: 'NONE',\r\n            id: 'ROOT'\r\n        },\r\n        revision: 0\r\n    };\r\n    readonly dispatch: <A extends Action>(action: A) => Promise<void>;\r\n\r\n    protected readonly diagramGenerator: IDiagramGenerator;\r\n    protected readonly layoutEngine?: IModelLayoutEngine;\r\n    protected actionHandlerRegistry?: ServerActionHandlerRegistry;\r\n    protected readonly requests = new Map<string, Deferred<ResponseAction>>();\r\n\r\n    constructor(dispatch: <A extends Action>(action: A) => Promise<void>,\r\n                services: DiagramServices) {\r\n        this.dispatch = dispatch;\r\n        this.diagramGenerator = services.DiagramGenerator;\r\n        this.layoutEngine = services.ModelLayoutEngine;\r\n        this.actionHandlerRegistry = services.ServerActionHandlerRegistry;\r\n    }\r\n\r\n    /**\r\n     * Set the model and submit it to the client.\r\n     */\r\n    setModel(newRoot: SModelRoot): Promise<void> {\r\n        newRoot.revision = ++this.state.revision;\r\n        this.state.currentRoot = newRoot;\r\n        return this.submitModel(newRoot, false);\r\n    }\r\n\r\n    /**\r\n     * Update the model to a new state and submit it to the client.\r\n     */\r\n    updateModel(newRoot: SModelRoot): Promise<void> {\r\n        newRoot.revision = ++this.state.revision;\r\n        this.state.currentRoot = newRoot;\r\n        return this.submitModel(newRoot, true);\r\n    }\r\n\r\n    /**\r\n     * Whether the client needs to compute the layout of parts of the model. This affects the behavior\r\n     * of `submitModel`.\r\n     *\r\n     * This setting is determined by the `DiagramOptions` that are received with the `RequestModelAction`\r\n     * from the client. If the client does not specify whether it needs client layout, the default value\r\n     * is `true`.\r\n     */\r\n    get needsClientLayout(): boolean {\r\n        if (this.state.options && this.state.options.needsClientLayout !== undefined) {\r\n            return !!this.state.options.needsClientLayout;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Whether the server needs to compute the layout of parts of the model. This affects the behavior\r\n     * of `submitModel`.\r\n     *\r\n     * This setting is determined by the `DiagramOptions` that are received with the `RequestModelAction`\r\n     * from the client. If the client does not specify whether it needs server layout, the default value\r\n     * is `false`.\r\n     */\r\n    get needsServerLayout(): boolean {\r\n        if (this.state.options && this.state.options.needsServerLayout !== undefined) {\r\n            return !!this.state.options.needsServerLayout;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Called when an action is received from the client.\r\n     */\r\n    accept(action: Action): Promise<void> {\r\n        if (isResponseAction(action)) {\r\n            const id = action.responseId;\r\n            const future = this.requests.get(id);\r\n            if (future) {\r\n                this.requests.delete(id);\r\n                if (action.kind === RejectAction.KIND) {\r\n                    const rejectAction: RejectAction = action as any;\r\n                    future.reject(new Error(rejectAction.message));\r\n                    console.warn(`Request with id ${action.responseId} failed: ${rejectAction.message}`, rejectAction.detail);\r\n                } else {\r\n                    future.resolve(action);\r\n                }\r\n                return Promise.resolve();\r\n            }\r\n            console.info('No matching request for response:', action);\r\n        }\r\n        return this.handleAction(action);\r\n    }\r\n\r\n    /**\r\n     * Send a request action to the client. The resulting promise is resolved when a matching\r\n     * response is received and rejected when a `RejectAction` is received.\r\n     */\r\n    request<Res extends ResponseAction>(action: RequestAction<Res>): Promise<Res> {\r\n        if (!action.requestId) {\r\n            action.requestId = 'server_' + generateRequestId();\r\n        }\r\n        const future = new Deferred<Res>();\r\n        this.requests.set(action.requestId, future as any);\r\n        this.dispatch(action).catch(err => {\r\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\r\n            this.requests.delete(action.requestId!);\r\n            future.reject(err);\r\n        });\r\n        return future.promise;\r\n    }\r\n\r\n    /**\r\n     * Send a `RejectAction` to the client to notify that a request could not be fulfilled.\r\n     */\r\n    rejectRemoteRequest(action: Action | undefined, error: Error): void {\r\n        if (action && isRequestAction(action)) {\r\n            this.dispatch({\r\n                kind: RejectAction.KIND,\r\n                responseId: action.requestId,\r\n                message: error.message,\r\n                detail: error.stack\r\n            });\r\n        }\r\n    }\r\n\r\n    protected handleAction(action: Action): Promise<void> {\r\n        // Find a matching action handler in the registry\r\n        const handlers = this.actionHandlerRegistry?.getHandler(action.kind);\r\n        if (handlers && handlers.length === 1) {\r\n            return handlers[0](action, this.state, this) ?? Promise.resolve();\r\n        } else if (handlers && handlers.length > 1) {\r\n            return Promise.all(handlers.map(h => h(action, this.state, this) ?? Promise.resolve())) as Promise<any>;\r\n        }\r\n        // If no handler is registered, call one of the default handling methods\r\n        switch (action.kind) {\r\n            case RequestModelAction.KIND:\r\n                return this.handleRequestModel(action as RequestModelAction);\r\n            case ComputedBoundsAction.KIND:\r\n                return this.handleComputedBounds(action as ComputedBoundsAction);\r\n            case LayoutAction.KIND:\r\n                return this.handleLayout(action as LayoutAction);\r\n        }\r\n        // We don't know this action kind, sigh\r\n        console.warn(`Unhandled action from client: ${action.kind}`);\r\n        return Promise.resolve();\r\n    }\r\n\r\n    protected async handleRequestModel(action: RequestModelAction): Promise<void> {\r\n        this.state.options = action.options;\r\n        try {\r\n            const newRoot = await this.diagramGenerator.generate({\r\n                options: this.state.options ?? {},\r\n                state: this.state\r\n            });\r\n            newRoot.revision = ++this.state.revision;\r\n            this.state.currentRoot = newRoot;\r\n            await this.submitModel(this.state.currentRoot, false, action);\r\n        } catch (err) {\r\n            this.rejectRemoteRequest(action, err as Error);\r\n            console.error('Failed to generate diagram:', err);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Submit a model to the client after it has been updated in the server state.\r\n     */\r\n     protected async submitModel(newRoot: SModelRoot, update: boolean, cause?: Action): Promise<void> {\r\n        if (this.needsClientLayout) {\r\n            if (!this.needsServerLayout) {\r\n                // In this case the client won't send us the computed bounds\r\n                this.dispatch({ kind: RequestBoundsAction.KIND, newRoot });\r\n            } else {\r\n                const request = RequestBoundsAction.create(newRoot);\r\n                const response = await this.request<ComputedBoundsAction>(request);\r\n                const currentRoot = this.state.currentRoot;\r\n                if (response.revision === currentRoot.revision) {\r\n                    applyBounds(currentRoot, response);\r\n                    await this.doSubmitModel(currentRoot, update, cause);\r\n                } else {\r\n                    this.rejectRemoteRequest(cause, new Error(`Model revision does not match: ${response.revision}`));\r\n                }\r\n            }\r\n        } else {\r\n            await this.doSubmitModel(newRoot, update, cause);\r\n        }\r\n    }\r\n\r\n    private async doSubmitModel(newRoot: SModelRoot, update: boolean, cause?: Action): Promise<void> {\r\n        if (newRoot.revision !== this.state.revision) {\r\n            return;\r\n        }\r\n        if (this.needsServerLayout && this.layoutEngine) {\r\n            newRoot = await this.layoutEngine.layout(newRoot);\r\n        }\r\n        const modelType = newRoot.type;\r\n        if (cause && cause.kind === RequestModelAction.KIND) {\r\n            const requestId = (cause as RequestModelAction).requestId;\r\n            const response = SetModelAction.create(newRoot, requestId);\r\n            await this.dispatch(response);\r\n        } else if (update && modelType === this.state.lastSubmittedModelType) {\r\n            await this.dispatch({ kind: UpdateModelAction.KIND, newRoot, cause });\r\n        } else {\r\n            await this.dispatch({ kind: SetModelAction.KIND, newRoot });\r\n        }\r\n        this.state.lastSubmittedModelType = modelType;\r\n    }\r\n\r\n    protected handleComputedBounds(action: ComputedBoundsAction): Promise<void> {\r\n        if (action.revision !== this.state.currentRoot.revision) {\r\n            return Promise.reject();\r\n        }\r\n        applyBounds(this.state.currentRoot, action);\r\n        return Promise.resolve();\r\n    }\r\n\r\n    protected async handleLayout(action: LayoutAction): Promise<void> {\r\n        if (!this.layoutEngine) {\r\n            return;\r\n        }\r\n        if (!this.needsServerLayout) {\r\n            let newRoot = cloneModel(this.state.currentRoot);\r\n            newRoot = await this.layoutEngine.layout(newRoot);\r\n            newRoot.revision = ++this.state.revision;\r\n            this.state.currentRoot = newRoot;\r\n        }\r\n        await this.doSubmitModel(this.state.currentRoot, true, action);\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Bounds, Point, Dimension } from './utils/geometry';\r\nimport { hasOwnProperty } from './utils/object';\r\n\r\n/**\r\n * Base type for all elements of the diagram model.\r\n * Each model element must have a unique ID and a type that is used to look up its view.\r\n */\r\nexport interface SModelElement {\r\n    type: string\r\n    id: string\r\n    children?: SModelElement[]\r\n    cssClasses?: string[]\r\n}\r\n\r\n/**\r\n * Base type for the root element of the diagram model tree.\r\n */\r\nexport interface SModelRoot extends SModelElement {\r\n    canvasBounds?: Bounds\r\n    revision?: number\r\n}\r\n\r\n/**\r\n * Usually the root of a model is also a viewport.\r\n */\r\nexport interface ViewportRootElement extends SModelRoot, Partial<Viewport>, Partial<BoundsAware> {\r\n}\r\n\r\n/**\r\n * Root element for graph-like models.\r\n */\r\nexport interface SGraph extends ViewportRootElement, Partial<LayoutableChild> {\r\n    children: SModelElement[]\r\n\r\n    /** @deprecated Use `position` and `size` instead. */\r\n    bounds?: Bounds\r\n}\r\n\r\nexport interface SShapeElement extends SModelElement, Partial<LayoutableChild> {\r\n}\r\n\r\n/**\r\n * Model element class for nodes, which are the main entities in a graph. A node can be connected to\r\n * another node via an SEdge. Such a connection can be direct, i.e. the node is the source or target of\r\n * the edge, or indirect through a port, i.e. it contains an SPort which is the source or target of the edge.\r\n */\r\nexport interface SNode extends SShapeElement, Partial<LayoutContainer>, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\r\n    anchorKind?: string\r\n}\r\n\r\n/**\r\n * A port is a connection point for edges. It should always be contained in an SNode.\r\n */\r\nexport interface SPort extends SShapeElement, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\r\n    anchorKind?: string\r\n}\r\n\r\n/**\r\n * Model element class for edges, which are the connectors in a graph. An edge has a source and a target,\r\n * each of which can be either a node or a port. The source and target elements are referenced via their ids.\r\n */\r\nexport interface SEdge extends SModelElement, Partial<Selectable>, Partial<Hoverable>, Partial<Fadeable> {\r\n    sourceId: string\r\n    targetId: string\r\n    routerKind?: string\r\n    routingPoints?: Point[]\r\n}\r\n\r\n/**\r\n * A label can be attached to a node, edge, or port, and contains some text to be rendered in its view.\r\n */\r\nexport interface SLabel extends SShapeElement, Partial<Selectable>, Partial<Alignable> {\r\n    text: string\r\n}\r\n\r\n/**\r\n * A compartment is used to group multiple child elements such as labels of a node. Usually a `vbox`\r\n * or `hbox` layout is used to arrange these children.\r\n */\r\nexport interface SCompartment extends SShapeElement, Partial<LayoutContainer> {\r\n}\r\n\r\n/**\r\n * A viewport has a scroll position and a zoom factor. Usually these properties are\r\n * applied to the root element to enable navigating through the diagram.\r\n */\r\nexport interface Viewport extends Scrollable, Zoomable {\r\n}\r\n\r\n/**\r\n * A scrollable element has a scroll position, which indicates the top left corner of the\r\n * visible area.\r\n */\r\nexport interface Scrollable {\r\n    scroll: Point\r\n}\r\n\r\nexport function isScrollable(element: SModelElement | Scrollable): element is Scrollable {\r\n    return hasOwnProperty(element, 'scroll');\r\n}\r\n\r\n/**\r\n * A zoomable element can be scaled so it appears smaller or larger than its actual size.\r\n * The zoom value 1 is the default scale where the content is drawn with its actual size.\r\n */\r\nexport interface Zoomable {\r\n    zoom: number\r\n}\r\n\r\nexport function isZoomable(element: SModelElement | Zoomable): element is Zoomable {\r\n    return hasOwnProperty(element, 'zoom');\r\n}\r\n\r\n/**\r\n * An element that can be placed at a specific location using its position property.\r\n * Feature extension interface for `moveFeature`.\r\n */\r\nexport interface Locateable {\r\n    position: Point\r\n}\r\n\r\n/**\r\n * Model elements that implement this interface have a position and a size.\r\n */\r\nexport interface BoundsAware extends Locateable {\r\n    size: Dimension\r\n}\r\n\r\nexport type ModelLayoutOptions = { [key: string]: string | number | boolean };\r\n\r\n/**\r\n * Feature extension interface for `layoutableChildFeature`. This is used when the parent\r\n * element has a `layout` property (meaning it's a `LayoutContainer`).\r\n */\r\nexport interface LayoutableChild extends BoundsAware {\r\n    layoutOptions?: ModelLayoutOptions\r\n}\r\n\r\n/**\r\n * Used to identify model elements that specify a layout to apply to their children.\r\n */\r\nexport interface LayoutContainer extends LayoutableChild {\r\n    layout: string\r\n}\r\n\r\n/**\r\n * Feature extension interface for `alignFeature`.\r\n * Used to adjust elements whose bounding box is not at the origin, e.g. labels\r\n * or pre-rendered SVG figures.\r\n */\r\nexport interface Alignable {\r\n    alignment: Point\r\n}\r\n\r\n/**\r\n * Feature extension interface for `selectFeature`. The selection status is often considered\r\n * in the frontend views, e.g. by switching CSS classes.\r\n */\r\nexport interface Selectable {\r\n    selected: boolean\r\n}\r\n\r\n/**\r\n * Feature extension interface for `hoverFeedbackFeature`. The hover feedback status is often\r\n * considered in the frontend views, e.g. by switching CSS classes.\r\n */\r\nexport interface Hoverable {\r\n    hoverFeedback: boolean\r\n}\r\n\r\n/**\r\n * Feature extension interface for `fadeFeature`. Fading is mostly used to animate when an element\r\n * appears or disappears.\r\n */\r\nexport interface Fadeable {\r\n    opacity: number\r\n}\r\n\r\n/**\r\n * Feature extension interface for `expandFeature`.\r\n * Model elements that implement this interface can be expanded and collapsed.\r\n */\r\nexport interface Expandable {\r\n    expanded: boolean\r\n}\r\n\r\n/**\r\n * Model elements implementing this interface can be displayed on a projection bar.\r\n * _Note:_ If set, the projectedBounds property will be prefered over the model element bounds.\r\n * Otherwise model elements also have to be `BoundsAware` so their projections can be shown.\r\n */\r\nexport interface Projectable {\r\n    projectionCssClasses: string[],\r\n    projectedBounds?: Bounds,\r\n}\r\n\r\n/**\r\n * Feature extension interface for `edgeLayoutFeature`. This is often applied to\r\n * {@link SLabel} elements to specify their placement along the containing edge.\r\n */\r\nexport interface EdgeLayoutable {\r\n    edgePlacement: EdgePlacement\r\n}\r\n\r\nexport type EdgeSide = 'left' | 'right' | 'top' | 'bottom' | 'on';\r\n\r\n/**\r\n * Each label attached to an edge can be placed on the edge in different ways.\r\n * With this interface the placement of such a single label is defined.\r\n */\r\nexport interface EdgePlacement {\r\n    /**\r\n     * true, if the label should be rotated to touch the edge tangentially\r\n     */\r\n    rotate: boolean;\r\n\r\n    /**\r\n     * where is the label relative to the line's direction\r\n     */\r\n    side: EdgeSide;\r\n\r\n    /**\r\n     * between 0 (source anchor) and 1 (target anchor)\r\n     */\r\n    position: number;\r\n\r\n    /**\r\n     * space between label and edge/connected nodes\r\n     */\r\n    offset: number;\r\n\r\n    /**\r\n     * where should the label be moved when move feature is enabled.\r\n     * 'edge' means the label is moved along the edge, 'free' means the label is moved freely, 'none' means the label can not be moved.\r\n     * Default is 'edge'.\r\n     */\r\n    moveMode?: 'edge' | 'free' | 'none';\r\n}\r\n\r\n/**\r\n * Buttons are elements that can react to clicks. A button handler can be registered in the frontend.\r\n */\r\nexport interface SButton extends SShapeElement {\r\n    pressed: boolean\r\n    enabled: boolean\r\n}\r\n\r\n/**\r\n * An issue marker is used to display a symbol about an error or a warning attached to another model element.\r\n */\r\nexport interface SIssueMarker extends SShapeElement {\r\n    issues: SIssue[]\r\n}\r\n\r\nexport type SIssueSeverity = 'error' | 'warning' | 'info';\r\n\r\nexport interface SIssue {\r\n    message: string\r\n    severity: SIssueSeverity\r\n}\r\n\r\n/**\r\n * Root model element class for HTML content. Usually this is rendered with a `div` DOM element.\r\n */\r\nexport interface HtmlRoot extends SModelRoot {\r\n    classes?: string[]\r\n}\r\n\r\n/**\r\n * Pre-rendered elements contain HTML or SVG code to be transferred to the DOM. This can be useful to\r\n * render complex figures or to compute the view on the server instead of the client code.\r\n */\r\nexport interface PreRenderedElement extends SModelElement {\r\n    code: string\r\n}\r\n\r\n/**\r\n * Same as PreRenderedElement, but with a position and a size.\r\n */\r\nexport interface ShapedPreRenderedElement extends PreRenderedElement {\r\n    position?: Point\r\n    size?: Dimension\r\n}\r\n\r\n/**\r\n * A `foreignObject` element to be transferred to the DOM within the SVG.\r\n *\r\n * This can be useful to to benefit from e.g. HTML rendering features, such as line wrapping, inside of\r\n * the SVG diagram.  Note that `foreignObject` is not supported by all browsers and SVG viewers may not\r\n * support rendering the `foreignObject` content.\r\n *\r\n * If no dimensions are specified in the schema element, this element will obtain the dimension of\r\n * its parent to fill the entire available room. Thus, this element requires specified bounds itself\r\n * or bounds to be available for its parent.\r\n */\r\nexport interface ForeignObjectElement extends ShapedPreRenderedElement {\r\n    /** The namespace to be assigned to the elements inside of the `foreignObject`. */\r\n    namespace: string\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nexport * from './action-handler';\r\nexport * from './actions';\r\nexport * from './diagram-server';\r\nexport * from './diagram-services';\r\nexport * from './model';\r\nexport * from './utils/async';\r\nexport * from './utils/geometry';\r\nexport * from './utils/json';\r\nexport * from './utils/model-utils';\r\nexport * from './utils/object';\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Point } from 'sprotty-protocol';\r\n\r\n/**\r\n * Returns whether the mouse or keyboard event includes the CMD key\r\n * on Mac or CTRL key on Linux / others.\r\n */\r\nexport function isCtrlOrCmd(event: KeyboardEvent | MouseEvent) {\r\n    if (isMac())\r\n        return event.metaKey;\r\n    else\r\n        return event.ctrlKey;\r\n}\r\n\r\nexport function isMac(): boolean {\r\n    return window.navigator.userAgent.indexOf(\"Mac\") !== -1;\r\n}\r\n\r\nexport function isCrossSite(url: string): boolean {\r\n    if (url && typeof window !== 'undefined' && window.location) {\r\n        let baseURL: string = '';\r\n        if (window.location.protocol)\r\n            baseURL += window.location.protocol + '//';\r\n        if (window.location.host)\r\n            baseURL += window.location.host;\r\n        return baseURL.length > 0 && !url.startsWith(baseURL);\r\n    }\r\n    return false;\r\n}\r\n\r\n/**\r\n * Returns the amount of scroll of the browser window as a point.\r\n */\r\nexport function getWindowScroll(): Point {\r\n    if (typeof window === 'undefined') {\r\n        return Point.ORIGIN;\r\n    }\r\n    return {\r\n        x: window.pageXOffset,\r\n        y: window.pageYOffset\r\n    };\r\n}\r\n\r\n/**\r\n * Checks whether the given mouse event hits the given DOM element.\r\n */\r\nexport function hitsMouseEvent(child: Element, event: MouseEvent): boolean {\r\n    const clientRect = child.getBoundingClientRect();\r\n    return event.clientX >= clientRect.left && event.clientX <= clientRect.right\r\n        && event.clientY >= clientRect.top && event.clientY <= clientRect.bottom;\r\n}\r\n\r\n/**\r\n * Checks whether the given DOM node is an SVG element.\r\n */\r\nexport function isSVGGraphicsElement(node: Node): node is SVGGraphicsElement {\r\n    return typeof (node as SVGGraphicsElement).getBBox === 'function';\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { almostEquals, Bounds, Dimension } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { TYPES } from \"../types\";\r\nimport { IActionDispatcher } from '../actions/action-dispatcher';\r\nimport { IVNodePostprocessor } from \"../views/vnode-postprocessor\";\r\nimport { SModelElementImpl, SModelRootImpl } from \"../model/smodel\";\r\nimport { SystemCommand, CommandExecutionContext, CommandReturn } from '../commands/command';\r\nimport { getWindowScroll } from \"../../utils/browser\";\r\n\r\n/**\r\n * Grabs the bounds from the root element in page coordinates and fires a\r\n * InitializeCanvasBoundsAction. This size is needed for other actions such\r\n * as FitToScreenAction.\r\n */\r\n@injectable()\r\nexport class CanvasBoundsInitializer implements IVNodePostprocessor {\r\n\r\n    protected rootAndVnode: [SModelRootImpl, VNode] | undefined;\r\n\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (element instanceof SModelRootImpl && !Dimension.isValid(element.canvasBounds)) {\r\n            this.rootAndVnode = [element, vnode];\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate() {\r\n        if (this.rootAndVnode !== undefined) {\r\n            const domElement = this.rootAndVnode[1].elm;\r\n            const oldBounds = this.rootAndVnode[0].canvasBounds;\r\n            if (domElement !== undefined) {\r\n                const newBounds = this.getBoundsInPage(domElement as Element);\r\n                if (!(almostEquals(newBounds.x, oldBounds.x)\r\n                        && almostEquals(newBounds.y, oldBounds.y)\r\n                        && almostEquals(newBounds.width, oldBounds.width)\r\n                        && almostEquals(newBounds.height, oldBounds.width)))\r\n                    this.actionDispatcher.dispatch(InitializeCanvasBoundsAction.create(newBounds));\r\n\r\n            }\r\n            this.rootAndVnode = undefined;\r\n        }\r\n    }\r\n\r\n    protected getBoundsInPage(element: Element) {\r\n        const bounds = element.getBoundingClientRect();\r\n        const scroll = getWindowScroll();\r\n        return {\r\n            x: bounds.left + scroll.x,\r\n            y: bounds.top + scroll.y,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n    }\r\n}\r\n\r\nexport interface InitializeCanvasBoundsAction extends Action {\r\n    kind: typeof InitializeCanvasBoundsAction.KIND\r\n    newCanvasBounds: Bounds\r\n}\r\nexport namespace InitializeCanvasBoundsAction {\r\n    export const KIND = 'initializeCanvasBounds';\r\n\r\n    export function create(newCanvasBounds: Bounds): InitializeCanvasBoundsAction {\r\n        return {\r\n            kind: KIND,\r\n            newCanvasBounds\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class InitializeCanvasBoundsCommand extends SystemCommand {\r\n    static readonly KIND: string = InitializeCanvasBoundsAction.KIND;\r\n\r\n    private newCanvasBounds: Bounds;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: InitializeCanvasBoundsAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.newCanvasBounds = this.action.newCanvasBounds;\r\n        context.root.canvasBounds = this.newCanvasBounds;\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return context.root;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { Action, SetModelAction } from \"sprotty-protocol/lib/actions\";\r\nimport { CommandExecutionContext, ResetCommand } from \"../commands/command\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { TYPES } from \"../types\";\r\nimport { InitializeCanvasBoundsCommand } from './initialize-canvas';\r\n\r\n@injectable()\r\nexport class SetModelCommand extends ResetCommand {\r\n    static readonly KIND = SetModelAction.KIND;\r\n\r\n    oldRoot: SModelRootImpl;\r\n    newRoot: SModelRootImpl;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SetModelAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): SModelRootImpl {\r\n        this.oldRoot = context.modelFactory.createRoot(context.root);\r\n        this.newRoot = context.modelFactory.createRoot(this.action.newRoot);\r\n        return this.newRoot;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): SModelRootImpl {\r\n        return this.oldRoot;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): SModelRootImpl {\r\n        return this.newRoot;\r\n    }\r\n\r\n    get blockUntil(): (action: Action) => boolean {\r\n        return action => action.kind === InitializeCanvasBoundsCommand.KIND;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { interfaces } from \"inversify\";\r\nimport { Bounds, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { TYPES } from \"../types\";\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl, SParentElementImpl } from \"./smodel\";\r\nimport { SModelElementRegistration, CustomFeatures } from \"./smodel-factory\";\r\n\r\n/**\r\n * Register a model element constructor for an element type.\r\n */\r\nexport function registerModelElement(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        type: string, constr: new () => SModelElementImpl, features?: CustomFeatures): void {\r\n    context.bind<SModelElementRegistration>(TYPES.SModelElementRegistration).toConstantValue({\r\n        type, constr, features\r\n    });\r\n}\r\n\r\n/**\r\n * Find a parent element that satisfies the given predicate.\r\n */\r\nexport function findParent(element: SModelElementImpl, predicate: (e: SModelElementImpl) => boolean): SModelElementImpl | undefined {\r\n    let current: SModelElementImpl | undefined = element;\r\n    while (current !== undefined) {\r\n        if (predicate(current))\r\n            return current;\r\n        else if (current instanceof SChildElementImpl)\r\n            current = current.parent;\r\n        else\r\n            current = undefined;\r\n    }\r\n    return current;\r\n}\r\n\r\n/**\r\n * Find a parent element that implements the feature identified with the given predicate.\r\n */\r\nexport function findParentByFeature<T>(element: SModelElementImpl, predicate: (t: SModelElementImpl) => t is SModelElementImpl & T): SModelElementImpl & T | undefined {\r\n    let current: SModelElementImpl | undefined = element;\r\n    while (current !== undefined) {\r\n        if (predicate(current))\r\n            return current;\r\n        else if (current instanceof SChildElementImpl)\r\n            current = current.parent;\r\n        else\r\n            current = undefined;\r\n    }\r\n    return current;\r\n}\r\n\r\n/**\r\n * Translate a point from the coordinate system of the source element to the coordinate system\r\n * of the target element.\r\n */\r\nexport function translatePoint(point: Point, source: SModelElementImpl, target: SModelElementImpl): Point {\r\n    if (source !== target) {\r\n        // Translate from the source to the root element\r\n        while (source instanceof SChildElementImpl) {\r\n            point = source.localToParent(point);\r\n            source = source.parent;\r\n            if (source === target)\r\n                return point;\r\n        }\r\n        // Translate from the root to the target element\r\n        const targetTrace = [];\r\n        while (target instanceof SChildElementImpl) {\r\n            targetTrace.push(target);\r\n            target = target.parent;\r\n        }\r\n        if (source !== target)\r\n            throw new Error(\"Incompatible source and target: \" + source.id + \", \" + target.id);\r\n        for (let i = targetTrace.length - 1; i >= 0; i--) {\r\n            point = targetTrace[i].parentToLocal(point);\r\n        }\r\n    }\r\n    return point;\r\n}\r\n\r\n/**\r\n * Translate some bounds from the coordinate system of the source element to the coordinate system\r\n * of the target element.\r\n */\r\nexport function translateBounds(bounds: Bounds, source: SModelElementImpl, target: SModelElementImpl): Bounds {\r\n    const upperLeft = translatePoint(bounds, source, target);\r\n    const lowerRight = translatePoint({ x: bounds.x + bounds.width, y: bounds.y + bounds.height }, source, target);\r\n    return {\r\n        x: upperLeft.x,\r\n        y: upperLeft.y,\r\n        width: lowerRight.x - upperLeft.x,\r\n        height: lowerRight.y - upperLeft.y\r\n    };\r\n}\r\n\r\n/**\r\n * Tests if the given model contains an id of then given element or one of its descendants.\r\n */\r\nexport function containsSome(root: SModelRootImpl, element: SChildElementImpl): boolean {\r\n    const test = (el: SChildElementImpl) => root.index.getById(el.id) !== undefined;\r\n    const find = (elements: readonly SChildElementImpl[]): boolean => elements.some(el => test(el) || find(el.children));\r\n    return find([element]);\r\n}\r\n\r\n/**\r\n * Transforms the local bounds all the way up to the root.\r\n */\r\nexport function  transformToRootBounds(parent: SParentElementImpl, bounds: Bounds) {\r\n    while (parent instanceof SChildElementImpl) {\r\n        bounds = parent.localToParent(bounds);\r\n        parent = parent.parent;\r\n    }\r\n    return bounds;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { inject, injectable, multiInject, optional } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { InstanceRegistry } from \"../../utils/registry\";\r\nimport { CommandExecutionContext, SystemCommand, CommandReturn } from \"../commands/command\";\r\nimport { TYPES } from \"../types\";\r\nimport { IUIExtension } from \"./ui-extension\";\r\n\r\n/**\r\n * The registry maintaining UI extensions registered via `TYPES.IUIExtension`.\r\n */\r\n@injectable()\r\nexport class UIExtensionRegistry extends InstanceRegistry<IUIExtension>  {\r\n    constructor(@multiInject(TYPES.IUIExtension) @optional() extensions: (IUIExtension)[] = []) {\r\n        super();\r\n        extensions.forEach((extension) => this.register(extension.id(), extension));\r\n    }\r\n}\r\n\r\n/**\r\n * Action to set the visibility state of the UI extension with the specified `id`.\r\n */\r\nexport interface SetUIExtensionVisibilityAction extends Action {\r\n    kind: typeof SetUIExtensionVisibilityAction.KIND;\r\n    extensionId: string\r\n    visible: boolean\r\n    contextElementsId: string[]\r\n}\r\nexport namespace SetUIExtensionVisibilityAction {\r\n    export const KIND = \"setUIExtensionVisibility\";\r\n\r\n    export function create(options: { extensionId: string, visible: boolean, contextElementsId?: string[] }): SetUIExtensionVisibilityAction {\r\n        return {\r\n            kind: KIND,\r\n            extensionId: options.extensionId,\r\n            visible: options.visible,\r\n            contextElementsId: options.contextElementsId ?? []\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SetUIExtensionVisibilityCommand extends SystemCommand {\r\n    static readonly KIND = SetUIExtensionVisibilityAction.KIND;\r\n\r\n    @inject(TYPES.UIExtensionRegistry) protected readonly registry: UIExtensionRegistry;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SetUIExtensionVisibilityAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const extension = this.registry.get(this.action.extensionId);\r\n        if (extension) {\r\n            this.action.visible ? extension.show(context.root, ...this.action.contextElementsId) : extension.hide();\r\n        }\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { inject, injectable } from \"inversify\";\r\nimport { hasOwnProperty } from \"sprotty-protocol\";\r\nimport { ILogger } from \"../../utils/logging\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { TYPES } from \"../types\";\r\nimport { ViewerOptions } from \"../views/viewer-options\";\r\n\r\n/**\r\n * A UI extension displaying additional UI elements on top of a sprotty diagram.\r\n */\r\nexport interface IUIExtension {\r\n    id(): string;\r\n    show(root: Readonly<SModelRootImpl>, ...contextElementIds: string[]): void;\r\n    hide(): void;\r\n    enableOnStartup?: boolean\r\n}\r\n\r\nexport function isUIExtension(object: unknown): object is IUIExtension {\r\n    return hasOwnProperty<string, Function>(object, 'id', 'function')\r\n    && hasOwnProperty<string, Function>(object, 'show', 'function')\r\n    && hasOwnProperty<string, Function>(object, 'hide', 'function');\r\n}\r\n\r\n/**\r\n * Abstract base class for UI extensions.\r\n */\r\n@injectable()\r\nexport abstract class AbstractUIExtension implements IUIExtension {\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n\r\n    protected containerElement: HTMLElement;\r\n    protected activeElement: Element | null;\r\n\r\n    abstract id(): string;\r\n    abstract containerClass(): string;\r\n\r\n    show(root: Readonly<SModelRootImpl>, ...contextElementIds: string[]): void {\r\n        this.activeElement = document.activeElement;\r\n        if (!this.containerElement) {\r\n            if (!this.initialize()) return;\r\n        }\r\n        this.onBeforeShow(this.containerElement, root, ...contextElementIds);\r\n        this.setContainerVisible(true);\r\n    }\r\n\r\n    hide(): void {\r\n        this.setContainerVisible(false);\r\n        this.restoreFocus();\r\n        this.activeElement = null;\r\n    }\r\n\r\n    protected restoreFocus() {\r\n        const focusedElement = this.activeElement as HTMLElement;\r\n        if (focusedElement) {\r\n            focusedElement.focus();\r\n        }\r\n    }\r\n\r\n    protected initialize(): boolean {\r\n        const baseDiv = document.getElementById(this.options.baseDiv);\r\n        if (!baseDiv) {\r\n            this.logger.warn(this, `Could not obtain sprotty base container for initializing UI extension ${this.id}`, this);\r\n            return false;\r\n        }\r\n        this.containerElement = this.getOrCreateContainer(baseDiv.id);\r\n        this.initializeContents(this.containerElement);\r\n        if (baseDiv) {\r\n            baseDiv.insertBefore(this.containerElement, baseDiv.firstChild);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    protected getOrCreateContainer(baseDivId: string): HTMLElement {\r\n        let container = document.getElementById(this.id());\r\n        if (container === null) {\r\n            container = document.createElement('div');\r\n            container.id = baseDivId + \"_\" + this.id();\r\n            container.classList.add(this.containerClass());\r\n        }\r\n        return container;\r\n    }\r\n\r\n    protected setContainerVisible(visible: boolean) {\r\n        if (this.containerElement) {\r\n            if (visible) {\r\n                this.containerElement.style.visibility = 'visible';\r\n                this.containerElement.style.opacity = '1';\r\n            } else {\r\n                this.containerElement.style.visibility = 'hidden';\r\n                this.containerElement.style.opacity = '0';\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Updates the `containerElement` under the given `context` before it becomes visible.\r\n     *\r\n     * Subclasses may override this method to, for instance, modifying the position of the\r\n     * `containerElement`, add or remove elements, etc. depending on the specified `root`\r\n     * or `contextElementIds`.\r\n     */\r\n    protected onBeforeShow(containerElement: HTMLElement, root: Readonly<SModelRootImpl>, ...contextElementIds: string[]): void {\r\n        // default: do nothing\r\n    }\r\n\r\n    /**\r\n     * Initializes the contents of this UI extension.\r\n     *\r\n     * Subclasses must implement this method to initialize the UI elements of this UI extension inside the specified `containerElement`.\r\n     */\r\n    protected abstract initializeContents(containerElement: HTMLElement): void;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { VNode } from \"snabbdom\";\r\n\r\nexport function setAttr(vnode: VNode, name: string, value: any) {\r\n    getAttrs(vnode)[name] = value;\r\n}\r\n\r\nexport function setClass(vnode: VNode, name: string, value: boolean) {\r\n    getClass(vnode)[name] = value;\r\n}\r\n\r\nexport function setNamespace(node: VNode, ns: string) {\r\n    if (node.data === undefined)\r\n        node.data = {};\r\n    node.data.ns = ns;\r\n    const children = node.children;\r\n    if (children !== undefined) {\r\n        for (let i = 0; i < children.length; i++) {\r\n            const child = children[i];\r\n            if (typeof child !== 'string')\r\n                setNamespace(child, ns);\r\n        }\r\n    }\r\n}\r\n\r\nexport function copyClassesFromVNode(source: VNode, target: VNode) {\r\n    const classList = getClass(source);\r\n    Object.keys(classList).forEach(c => setClass(target, c, true));\r\n}\r\n\r\nexport function copyClassesFromElement(element: HTMLElement, target: VNode) {\r\n    const classList = element.classList;\r\n    for (let i = 0; i < classList.length; i++) {\r\n        const item = classList.item(i);\r\n        if (item)\r\n            setClass(target, item, true);\r\n    }\r\n}\r\n\r\nexport function mergeStyle(vnode: VNode, style: any) {\r\n    getData(vnode).style = {...(getData(vnode).style || {}), ...style};\r\n}\r\n\r\nexport function on(vnode: VNode, event: string, listener: (event: Event) => void) {\r\n    const val = getOn(vnode);\r\n    if (val[event]) {\r\n        throw new Error('EventListener for ' + event + ' already registered on VNode');\r\n    }\r\n    (val as any)[event] = listener;\r\n}\r\n\r\nexport function getAttrs(vnode: VNode) {\r\n    const data = getData(vnode);\r\n    if (!data.attrs)\r\n        data.attrs = {};\r\n    return data.attrs;\r\n}\r\n\r\nfunction getData(vnode: VNode) {\r\n    if (!vnode.data)\r\n        vnode.data = {};\r\n    return vnode.data;\r\n}\r\n\r\nfunction getClass(vnode: VNode) {\r\n    const data = getData(vnode);\r\n    if (!data.class)\r\n        data.class = {};\r\n    return data.class;\r\n}\r\n\r\nfunction getOn(vnode: VNode) {\r\n    const data = getData(vnode);\r\n    if (!data.on)\r\n        data.on = {};\r\n    return data.on;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, multiInject, optional } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { TYPES } from \"../types\";\r\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\r\nimport { SModelElementImpl, SModelRootImpl } from \"../model/smodel\";\r\nimport { IVNodePostprocessor } from \"./vnode-postprocessor\";\r\nimport { on } from \"./vnode-utils\";\r\n\r\n@injectable()\r\nexport class KeyTool implements IVNodePostprocessor {\r\n\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n\r\n    constructor(@multiInject(TYPES.KeyListener)@optional() protected keyListeners: KeyListener[] = []) {}\r\n\r\n    register(keyListener: KeyListener) {\r\n        this.keyListeners.push(keyListener);\r\n    }\r\n\r\n    deregister(keyListener: KeyListener) {\r\n        const index = this.keyListeners.indexOf(keyListener);\r\n        if (index >= 0)\r\n            this.keyListeners.splice(index, 1);\r\n    }\r\n\r\n    protected handleEvent<K extends keyof KeyListener>(methodName: K, model: SModelRootImpl, event: KeyboardEvent) {\r\n        const actions = this.keyListeners\r\n            .map(listener => listener[methodName].apply(listener, [model, event]))\r\n            .reduce((a, b) => a.concat(b));\r\n        if (actions.length > 0) {\r\n            event.preventDefault();\r\n            this.actionDispatcher.dispatchAll(actions);\r\n        }\r\n    }\r\n\r\n    keyDown(element: SModelRootImpl, event: KeyboardEvent): void {\r\n        this.handleEvent('keyDown', element, event);\r\n    }\r\n\r\n    keyUp(element: SModelRootImpl, event: KeyboardEvent): void {\r\n        this.handleEvent('keyUp', element, event);\r\n    }\r\n\r\n    focus() {}\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (element instanceof SModelRootImpl) {\r\n            on(vnode, 'focus', this.focus.bind(this, element));\r\n            on(vnode, 'keydown', this.keyDown.bind(this, element));\r\n            on(vnode, 'keyup', this.keyUp.bind(this, element));\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate() {\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class KeyListener {\r\n    keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        return [];\r\n    }\r\n\r\n    keyUp(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { ViewerOptions } from \"./viewer-options\";\r\nimport { TYPES } from \"../types\";\r\nimport { SModelElementImpl } from \"../model/smodel\";\r\n\r\n@injectable()\r\nexport class DOMHelper {\r\n\r\n    @inject(TYPES.ViewerOptions) private viewerOptions: ViewerOptions;\r\n\r\n    private getPrefix() {\r\n        const prefix = this.viewerOptions !== undefined && this.viewerOptions.baseDiv !== undefined ?\r\n            this.viewerOptions.baseDiv + \"_\" : \"\";\r\n        return prefix;\r\n    }\r\n\r\n    createUniqueDOMElementId(element: SModelElementImpl): string {\r\n        return this.getPrefix() + element.id;\r\n    }\r\n\r\n    findSModelIdByDOMElement(element: Element): string {\r\n        return element.id.replace(this.getPrefix(), '');\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, multiInject, optional } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { Action, isAction } from \"sprotty-protocol/lib/actions\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\r\nimport { SModelElementImpl, SModelRootImpl } from \"../model/smodel\";\r\nimport { TYPES } from \"../types\";\r\nimport { DOMHelper } from \"./dom-helper\";\r\nimport { IVNodePostprocessor } from \"./vnode-postprocessor\";\r\nimport { on } from \"./vnode-utils\";\r\n\r\n@injectable()\r\nexport class MouseTool implements IVNodePostprocessor {\r\n\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n    @inject(TYPES.DOMHelper) protected domHelper: DOMHelper;\r\n\r\n    constructor(@multiInject(TYPES.MouseListener) @optional() protected mouseListeners: MouseListener[] = []) { }\r\n\r\n    register(mouseListener: MouseListener) {\r\n        this.mouseListeners.push(mouseListener);\r\n    }\r\n\r\n    deregister(mouseListener: MouseListener) {\r\n        const index = this.mouseListeners.indexOf(mouseListener);\r\n        if (index >= 0)\r\n            this.mouseListeners.splice(index, 1);\r\n    }\r\n\r\n    protected getTargetElement(model: SModelRootImpl, event: MouseEvent): SModelElementImpl | undefined {\r\n        let target = event.target as Element;\r\n        const index = model.index;\r\n        while (target) {\r\n            if (target.id) {\r\n                const element = index.getById(this.domHelper.findSModelIdByDOMElement(target));\r\n                if (element !== undefined)\r\n                    return element;\r\n            }\r\n            target = target.parentNode as Element;\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected handleEvent(methodName: MouseEventKind, model: SModelRootImpl, event: MouseEvent) {\r\n        this.focusOnMouseEvent(methodName, model);\r\n        const element = this.getTargetElement(model, event);\r\n        if (!element)\r\n            return;\r\n        const actions = this.mouseListeners\r\n            .map(listener => listener[methodName](element, event as WheelEvent))\r\n            .reduce((a, b) => a.concat(b));\r\n        if (actions.length > 0) {\r\n            event.preventDefault();\r\n            for (const actionOrPromise of actions) {\r\n                if (isAction(actionOrPromise)) {\r\n                    this.actionDispatcher.dispatch(actionOrPromise);\r\n                } else {\r\n                    actionOrPromise.then((action: Action) => {\r\n                        this.actionDispatcher.dispatch(action);\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected focusOnMouseEvent<K extends keyof MouseListener>(methodName: K, model: SModelRootImpl) {\r\n        if (document && methodName === 'mouseDown') {\r\n            const domElement = document.getElementById(this.domHelper.createUniqueDOMElementId(model));\r\n            if (domElement !== null && typeof domElement.focus === 'function')\r\n                domElement.focus();\r\n        }\r\n    }\r\n\r\n    mouseOver(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseOver', model, event);\r\n    }\r\n\r\n    mouseOut(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseOut', model, event);\r\n    }\r\n\r\n    mouseEnter(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseEnter', model, event);\r\n    }\r\n\r\n    mouseLeave(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseLeave', model, event);\r\n    }\r\n\r\n    mouseDown(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseDown', model, event);\r\n    }\r\n\r\n    mouseMove(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseMove', model, event);\r\n    }\r\n\r\n    mouseUp(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('mouseUp', model, event);\r\n    }\r\n\r\n    wheel(model: SModelRootImpl, event: WheelEvent) {\r\n        this.handleEvent('wheel', model, event);\r\n    }\r\n\r\n    contextMenu(model: SModelRootImpl, event: MouseEvent) {\r\n        event.preventDefault();\r\n        this.handleEvent('contextMenu', model, event);\r\n    }\r\n\r\n    doubleClick(model: SModelRootImpl, event: MouseEvent) {\r\n        this.handleEvent('doubleClick', model, event);\r\n    }\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl) {\r\n        if (element instanceof SModelRootImpl) {\r\n            on(vnode, 'mouseover', this.mouseOver.bind(this, element));\r\n            on(vnode, 'mouseout', this.mouseOut.bind(this, element));\r\n            on(vnode, 'mouseenter', this.mouseEnter.bind(this, element));\r\n            on(vnode, 'mouseleave', this.mouseLeave.bind(this, element));\r\n            on(vnode, 'mousedown', this.mouseDown.bind(this, element));\r\n            on(vnode, 'mouseup', this.mouseUp.bind(this, element));\r\n            on(vnode, 'mousemove', this.mouseMove.bind(this, element));\r\n            on(vnode, 'wheel', this.wheel.bind(this, element));\r\n            on(vnode, 'contextmenu', this.contextMenu.bind(this, element));\r\n            on(vnode, 'dblclick', this.doubleClick.bind(this, element));\r\n            on(vnode, 'dragover', (event: MouseEvent) => this.handleEvent('dragOver', element, event));\r\n            on(vnode, 'drop', (event: MouseEvent) => this.handleEvent('drop', element, event));\r\n        }\r\n        vnode = this.mouseListeners.reduce(\r\n            (n: VNode, listener: MouseListener) => listener.decorate(n, element),\r\n            vnode);\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate() {\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class PopupMouseTool extends MouseTool {\r\n    constructor(@multiInject(TYPES.PopupMouseListener) @optional() protected override mouseListeners: MouseListener[] = []) {\r\n        super(mouseListeners);\r\n    }\r\n}\r\n\r\nexport type MouseEventKind =\r\n    'mouseOver' | 'mouseOut' | 'mouseEnter' | 'mouseLeave' | 'mouseDown' | 'mouseMove' | 'mouseUp'\r\n    | 'wheel' | 'doubleClick' | 'contextMenu' | 'dragOver' | 'drop';\r\n\r\n@injectable()\r\nexport class MouseListener {\r\n\r\n    mouseOver(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseOut(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseEnter(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseLeave(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseDown(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseMove(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    mouseUp(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    wheel(target: SModelElementImpl, event: WheelEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    doubleClick(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    contextMenu(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    dragOver(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    drop(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [];\r\n    }\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        return vnode;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class MousePositionTracker extends MouseListener {\r\n\r\n    protected lastPosition: Point | undefined;\r\n\r\n    override mouseMove(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        this.lastPosition = target.root.parentToLocal({ x: event.offsetX, y: event.offsetY });\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * Returns the last tracked mouse cursor position relative to the diagram root or `undefined`\r\n     * if no mouse cursor position was ever tracked yet.\r\n     */\r\n    get lastPositionOnDiagram(): Point | undefined {\r\n        return this.lastPosition;\r\n    }\r\n}\r\n", null, null, null, null, null, null, null, null, "export {};\r\n//# sourceMappingURL=hooks.js.map", null, null, null, null, null, null, null, null, "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { h, VNode, VNodeData } from \"snabbdom\";\r\nimport { SModelElementImpl } from \"../model/smodel\";\r\nimport { RenderingContext, IView } from \"./view\";\r\nimport { injectable } from \"inversify\";\r\n\r\n/**\r\n * An view that avoids calculation and patching of VNodes unless some model properties have changed.\r\n * Based on snabbdom's thunks.\r\n */\r\n@injectable()\r\nexport abstract class ThunkView implements IView {\r\n\r\n    /**\r\n     * Returns the array of values that are watched for changes.\r\n     * If they haven't change since the last rendering, the VNode is neither recalculated nor patched.\r\n     */\r\n    abstract watchedArgs(model: SModelElementImpl): any[];\r\n\r\n    /**\r\n     * Returns the selector of the VNode root, i.e. it's element type.\r\n     */\r\n    abstract selector(model: SModelElementImpl): string;\r\n\r\n    /**\r\n     * Calculate the VNode from the input data. Only called if the watched properties change.\r\n     */\r\n    abstract doRender(model: SModelElementImpl, context: RenderingContext): VNode;\r\n\r\n    render(model: SModelElementImpl, context: RenderingContext): VNode {\r\n        return h(this.selector(model), {\r\n            key: model.id,\r\n            hook: {\r\n                init: this.init.bind(this),\r\n                prepatch: this.prepatch.bind(this)},\r\n            fn: () => this.renderAndDecorate(model, context),\r\n            args: this.watchedArgs(model),\r\n            thunk: true\r\n        });\r\n    }\r\n\r\n    protected renderAndDecorate(model: SModelElementImpl, context: RenderingContext): VNode {\r\n        const vnode = this.doRender(model, context);\r\n        context.decorate(vnode, model);\r\n        return vnode;\r\n    }\r\n\r\n    protected copyToThunk(vnode: VNode, thunk: VNode): void {\r\n        thunk.elm = vnode.elm;\r\n        (vnode.data as VNodeData).fn = (thunk.data as VNodeData).fn;\r\n        (vnode.data as VNodeData).args = (thunk.data as VNodeData).args;\r\n        thunk.data = vnode.data;\r\n        thunk.children = vnode.children;\r\n        thunk.text = vnode.text;\r\n        thunk.elm = vnode.elm;\r\n    }\r\n\r\n    protected init(thunk: VNode): void {\r\n        const cur = thunk.data as VNodeData;\r\n        const vnode = (cur.fn as any).apply(undefined, cur.args);\r\n        this.copyToThunk(vnode, thunk);\r\n    }\r\n\r\n    protected prepatch(oldVnode: VNode, thunk: VNode): void {\r\n        const old = oldVnode.data as VNodeData, cur = thunk.data as VNodeData;\r\n        if (!this.equals(old.args as any[], cur.args as any[]))\r\n            this.copyToThunk((cur.fn as any).apply(undefined, cur.args), thunk);\r\n        else\r\n            this.copyToThunk(oldVnode, thunk);\r\n    }\r\n\r\n    protected equals(oldArg: any, newArg: any) {\r\n        if (Array.isArray(oldArg) && Array.isArray(newArg)) {\r\n            if (oldArg.length !== newArg.length)\r\n                return false;\r\n            for (let i = 0; i < newArg.length; ++i) {\r\n                if (!this.equals(oldArg[i], newArg[i]))\r\n                    return false;\r\n            }\r\n        } else if (typeof oldArg === 'object' && typeof newArg === 'object') {\r\n            if (Object.keys(oldArg).length !== Object.keys(newArg).length)\r\n                return false;\r\n            for (const key in oldArg) {\r\n                if (key !== 'parent' && key !== 'root' && (!(key in newArg) || !this.equals(oldArg[key], newArg[key])))\r\n                    return false;\r\n            }\r\n        } else if (oldArg !== newArg) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport interface ThunkVNode extends VNode {\r\n    thunk: boolean\r\n}\r\n\r\nexport function isThunk(vnode: VNode): vnode is ThunkVNode {\r\n    return 'thunk' in vnode;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { VNodeData, JsxVNodeChildren, JsxVNodeChild, jsx, FunctionComponent } from \"snabbdom\";\r\n\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-redeclare\r\n  namespace JSX {\r\n      // Based on the tag list in github:DefinitelyTyped/DefinitelyTyped:React\r\n      interface IntrinsicElements {\r\n          [elemName: string]: VNodeData\r\n      }\r\n  }\r\n}\r\n\r\nconst modulesNS = ['hook', 'on', 'style', 'class', 'props', 'attrs', 'dataset'];\r\nconst SVGNS = 'http://www.w3.org/2000/svg';\r\n\r\nfunction normalizeAttrs(source: VNodeData | null, defNS: string, namespace?: string) {\r\n  const data: VNodeData = {};\r\n\r\n  if (namespace) {\r\n    data.ns = namespace;\r\n  }\r\n  if (source === null) {\r\n    return data;\r\n  }\r\n\r\n  modulesNS.forEach(mod => {\r\n    if (source[mod]) {\r\n      data[mod] = source[mod];\r\n    }\r\n  });\r\n  Object.keys(source).forEach(key => {\r\n    if (key === 'key' || key === 'classNames' || key === 'selector') return;\r\n    const idx = key.indexOf('-');\r\n    if (idx > 0)\r\n      addAttr(key.slice(0, idx), key.slice(idx + 1), source[key]);\r\n    else if (!data[key])\r\n      addAttr(defNS, key, source[key]);\r\n  });\r\n  return data;\r\n\r\n  function addAttr(modname: string, key: string, val: JsxVNodeChildren) {\r\n    const mod = data[modname] || (data[modname] = {});\r\n    mod[key] = val;\r\n  }\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nfunction JSX(namespace?: string, defNS: string = 'props') {\r\n  return (tag: FunctionComponent | string, attrs: VNodeData | null, ...children: JsxVNodeChild[]) => jsx(tag, normalizeAttrs(attrs, defNS, namespace), children);\r\n}\r\n\r\nconst html = JSX();\r\nconst svg = JSX(SVGNS, 'attrs');\r\n\r\nexport { html, svg, JSX };\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { svg } from '../../lib/jsx';\r\n\r\nimport { injectable, multiInject, optional, interfaces, inject } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { TYPES } from '../types';\r\nimport { InstanceRegistry } from '../../utils/registry';\r\nimport { isInjectable } from '../../utils/inversify';\r\nimport { SModelElementImpl, SModelRootImpl, SParentElementImpl } from '../model/smodel';\r\nimport { EMPTY_ROOT, CustomFeatures } from '../model/smodel-factory';\r\nimport { registerModelElement } from '../model/smodel-utils';\r\nimport { Point } from 'sprotty-protocol';\r\nimport { ILogger } from '../../utils/logging';\r\n\r\n/**\r\n * Arguments for `IView` rendering.\r\n */\r\nexport interface IViewArgs {\r\n    parentArgs?: IViewArgs;\r\n    [key: string]: any;\r\n}\r\n\r\n/**\r\n * Searches for the property specified in `key` in the specified `args`,\r\n * including its direct or indirect `IRenderingArgs#parentArgs`.\r\n *\r\n * @param arg the rendering arguments.\r\n * @param key the key to search for.\r\n * @returns the found value or `undefined.\r\n */\r\nexport function findArgValue<T>(arg: IViewArgs | undefined, key: string): T | undefined {\r\n    while (arg !== undefined && !(key in arg) && arg.parentArgs) {\r\n        arg = arg.parentArgs;\r\n    }\r\n    return arg ? arg[key] : undefined;\r\n}\r\n\r\n/**\r\n * Base interface for the components that turn GModelElements into virtual DOM elements.\r\n */\r\nexport interface IView<A extends IViewArgs = {}> {\r\n    render(model: Readonly<SModelElementImpl>, context: RenderingContext, args?: A): VNode | undefined\r\n}\r\n\r\n/**\r\n * Indicates the target of the view rendering. `main` is the actually visible diagram,\r\n * `popup` is the mouse hover popup, and `hidden` is for computing element bounds prior\r\n * to the main rendering.\r\n */\r\nexport type RenderingTargetKind = 'main' | 'popup' | 'hidden';\r\n\r\n/**\r\n * Bundles additional data that is passed to views for VNode creation.\r\n */\r\nexport interface RenderingContext {\r\n    readonly viewRegistry: ViewRegistry\r\n    readonly targetKind: RenderingTargetKind;\r\n    readonly parentArgs?: IViewArgs;\r\n\r\n    decorate(vnode: VNode, element: Readonly<SModelElementImpl>): VNode\r\n\r\n    renderElement(element: Readonly<SModelElementImpl>): VNode | undefined\r\n\r\n    renderChildren(element: Readonly<SParentElementImpl>, args?: IViewArgs): VNode[]\r\n}\r\n\r\n/**\r\n * Used to bind a model element type to a view factory in the ViewRegistry.\r\n */\r\nexport interface ViewRegistration {\r\n    type: string\r\n    factory: () => IView\r\n}\r\n\r\nexport type ViewRegistrationFactory = () => ViewRegistration;\r\n\r\n/**\r\n * Allows to look up the IView for a given SModelElement based on its type.\r\n */\r\n@injectable()\r\nexport class ViewRegistry extends InstanceRegistry<IView> {\r\n\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n\r\n    constructor(@multiInject(TYPES.ViewRegistration) @optional() registrations: ViewRegistration[]) {\r\n        super();\r\n        this.registerDefaults();\r\n        registrations.forEach(registration =>\r\n            this.register(registration.type, registration.factory())\r\n        );\r\n    }\r\n\r\n    protected registerDefaults() {\r\n        this.register(EMPTY_ROOT.type, new EmptyView());\r\n    }\r\n\r\n    override missing(key: string): IView {\r\n        this.logger.warn(this, `no registered view for type '${key}', please configure a view in the ContainerModule`);\r\n        return new MissingView();\r\n    }\r\n}\r\n\r\n/**\r\n * Combines `registerModelElement` and `configureView`.\r\n */\r\nexport function configureModelElement(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        type: string, modelConstr: new () => SModelElementImpl, viewConstr: interfaces.ServiceIdentifier<IView>,\r\n        features?: CustomFeatures): void {\r\n    registerModelElement(context, type, modelConstr, features);\r\n    configureView(context, type, viewConstr);\r\n}\r\n\r\n/**\r\n * Utility function to register a view for a model element type.\r\n */\r\nexport function configureView(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n        type: string, constr: interfaces.ServiceIdentifier<IView>): void {\r\n    if (typeof constr === 'function') {\r\n        if (!isInjectable(constr)) {\r\n            throw new Error(`Views should be @injectable: ${constr.name}`);\r\n        }\r\n        if (!context.isBound(constr)) {\r\n            context.bind(constr).toSelf();\r\n        }\r\n    }\r\n    context.bind(TYPES.ViewRegistration).toDynamicValue(ctx => ({\r\n        type,\r\n        factory: () => ctx.container.get(constr)\r\n    }));\r\n}\r\n\r\n/**\r\n * This view is used when the model is the EMPTY_ROOT.\r\n */\r\n@injectable()\r\nexport class EmptyView implements IView {\r\n    render(model: SModelRootImpl, context: RenderingContext): VNode {\r\n        return <svg class-sprotty-empty={true} />;\r\n    }\r\n}\r\n\r\n/**\r\n * This view is used when no view has been registered for a model element type.\r\n */\r\n@injectable()\r\nexport class MissingView implements IView {\r\n    private static positionMap = new Map<string, Point>();\r\n\r\n    render(model: Readonly<SModelElementImpl>, context: RenderingContext): VNode {\r\n        const position: Point = (model as any).position || this.getPostion(model.type);\r\n        return <text class-sprotty-missing={true} x={position.x} y={position.y}>missing \"{model.type}\" view</text>;\r\n    }\r\n\r\n    getPostion(type: string) {\r\n        let position = MissingView.positionMap.get(type);\r\n        if (!position) {\r\n            position = Point.ORIGIN;\r\n            MissingView.positionMap.forEach(value => position = value.y >= position!.y ? {x: 0, y: value.y + 20} : position);\r\n            MissingView.positionMap.set(type, position);\r\n        }\r\n        return position;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { SModelRootImpl } from \"../model/smodel\";\r\nimport { TYPES } from \"../types\";\r\nimport { AnimationFrameSyncer } from \"../animations/animation-frame-syncer\";\r\nimport { IViewer } from \"./viewer\";\r\n\r\n/**\r\n * Updating the view is rather expensive, and it doesn't make sense to calculate\r\n * more then one update per animation (rendering) frame. So this class batches\r\n * all incoming model changes and only renders the last one when the next animation\r\n * frame comes.\r\n */\r\n@injectable()\r\nexport class ViewerCache implements IViewer {\r\n\r\n    @inject(TYPES.IViewer) protected delegate: IViewer;\r\n    @inject(TYPES.AnimationFrameSyncer) protected syncer: AnimationFrameSyncer;\r\n\r\n    protected cachedModel?: SModelRootImpl;\r\n\r\n    update(model: SModelRootImpl, cause?: Action): void {\r\n        if (cause !== undefined) {\r\n            // Forward the update immediately in order to pass the cause action\r\n            this.delegate.update(model, cause);\r\n            this.cachedModel = undefined;\r\n        } else {\r\n            const isCacheEmpty = this.cachedModel === undefined;\r\n            this.cachedModel = model;\r\n            if (isCacheEmpty) {\r\n                this.scheduleUpdate();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected scheduleUpdate() {\r\n        this.syncer.onEndOfNextFrame(() => {\r\n            if (this.cachedModel) {\r\n                this.delegate.update(this.cachedModel);\r\n                this.cachedModel = undefined;\r\n            }\r\n        });\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Container, interfaces } from 'inversify';\r\nimport { safeAssign } from 'sprotty-protocol/lib/utils/object';\r\nimport { Limits } from '../../utils/geometry';\r\nimport { TYPES } from '../types';\r\n\r\nexport interface ViewerOptions {\r\n    /** ID of the HTML element into which the visible diagram is rendered. */\r\n    baseDiv: string\r\n    /** CSS class added to the base element of the visible diagram. */\r\n    baseClass: string\r\n    /** ID of the HTML element into which the hidden diagram is rendered. */\r\n    hiddenDiv: string\r\n    /** CSS class added to the base element of the hidden rendering. */\r\n    hiddenClass: string\r\n    /** ID of the HTML element into which hover popup boxes are rendered. */\r\n    popupDiv: string\r\n    /** CSS class added to the base element of popup boxes. */\r\n    popupClass: string\r\n    /** CSS class added to popup boxes when they are closed. */\r\n    popupClosedClass: string\r\n    /** Whether client layouts need to be computed by Sprotty. This activates a hidden rendering cycle. */\r\n    needsClientLayout: boolean\r\n    /** Whether the model source needs to invoke a layout engine after a model update. */\r\n    needsServerLayout: boolean\r\n    /** Delay for opening a popup box after mouse hovering an element. */\r\n    popupOpenDelay: number\r\n    /** Delay for closing a popup box after leaving the corresponding element. */\r\n    popupCloseDelay: number\r\n    /** Minimum (zoom out) and maximum (zoom in) values for the zoom factor. */\r\n    zoomLimits: Limits\r\n    /** Minimum and maximum values for the horizontal scroll position. */\r\n    horizontalScrollLimits: Limits\r\n    /** Minimum and maximum values for the vertical scroll position. */\r\n    verticalScrollLimits: Limits\r\n}\r\n\r\nexport const defaultViewerOptions: () => ViewerOptions = () => ({\r\n    baseDiv: 'sprotty',\r\n    baseClass: 'sprotty',\r\n    hiddenDiv: 'sprotty-hidden',\r\n    hiddenClass: 'sprotty-hidden',\r\n    popupDiv: 'sprotty-popup',\r\n    popupClass: 'sprotty-popup',\r\n    popupClosedClass: 'sprotty-popup-closed',\r\n    needsClientLayout: true,\r\n    needsServerLayout: false,\r\n    popupOpenDelay: 1000,\r\n    popupCloseDelay: 300,\r\n    zoomLimits: { min: 0.01, max: 10 },\r\n    horizontalScrollLimits: { min: -100_000, max: 100_000 },\r\n    verticalScrollLimits: { min: -100_000, max: 100_000 }\r\n});\r\n\r\n/**\r\n * Utility function to partially set viewer options. Default values (from `defaultViewerOptions`) are used for\r\n * options that are not specified.\r\n */\r\nexport function configureViewerOptions(context: { bind: interfaces.Bind, isBound: interfaces.IsBound, rebind: interfaces.Rebind },\r\n        options: Partial<ViewerOptions>): void {\r\n    const opt: ViewerOptions = {\r\n        ...defaultViewerOptions(),\r\n        ...options\r\n    };\r\n    if (context.isBound(TYPES.ViewerOptions))\r\n        context.rebind(TYPES.ViewerOptions).toConstantValue(opt);\r\n    else\r\n        context.bind(TYPES.ViewerOptions).toConstantValue(opt);\r\n}\r\n\r\n/**\r\n * Utility function to partially override the currently configured viewer options in a DI container.\r\n */\r\nexport function overrideViewerOptions(container: Container, options: Partial<ViewerOptions>): ViewerOptions {\r\n    const opt = container.get<ViewerOptions>(TYPES.ViewerOptions);\r\n    safeAssign(opt, options);\r\n    return opt;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx html */\r\nimport { inject, injectable, multiInject, optional } from 'inversify';\r\nimport { attributesModule, classModule, eventListenersModule, init, Module, propsModule, styleModule, VNode } from 'snabbdom';\r\nimport { Action } from 'sprotty-protocol/lib/actions';\r\nimport { html } from '../../lib/jsx'; // must be html here, as we're creating a div\r\nimport { getWindowScroll } from '../../utils/browser';\r\nimport { ILogger } from '../../utils/logging';\r\nimport { IActionDispatcher } from '../actions/action-dispatcher';\r\nimport { InitializeCanvasBoundsAction } from '../features/initialize-canvas';\r\nimport { SModelElementImpl, SModelRootImpl, SParentElementImpl } from '../model/smodel';\r\nimport { EMPTY_ROOT } from '../model/smodel-factory';\r\nimport { TYPES } from '../types';\r\nimport { isThunk } from './thunk-view';\r\nimport { IViewArgs, RenderingContext, RenderingTargetKind, ViewRegistry } from './view';\r\nimport { ViewerOptions } from './viewer-options';\r\nimport { IVNodePostprocessor } from './vnode-postprocessor';\r\nimport { copyClassesFromElement, copyClassesFromVNode, setAttr, setClass } from './vnode-utils';\r\n\r\n\r\nexport interface IViewer {\r\n    update(model: SModelRootImpl, cause?: Action): void\r\n}\r\n\r\nexport interface IViewerProvider {\r\n    readonly modelViewer: IViewer\r\n    readonly hiddenModelViewer: IViewer\r\n    readonly popupModelViewer: IViewer\r\n}\r\n\r\nexport class ModelRenderer implements RenderingContext {\r\n\r\n    constructor(readonly viewRegistry: ViewRegistry,\r\n        readonly targetKind: RenderingTargetKind,\r\n        private postprocessors: IVNodePostprocessor[],\r\n        protected args: IViewArgs = {}) {\r\n    }\r\n\r\n    decorate(vnode: VNode, element: Readonly<SModelElementImpl>): VNode {\r\n        if (isThunk(vnode)) {\r\n            return vnode;\r\n        }\r\n        return this.postprocessors.reduce(\r\n            (n: VNode, processor: IVNodePostprocessor) => processor.decorate(n, element),\r\n            vnode);\r\n    }\r\n\r\n    renderElement(element: Readonly<SModelElementImpl>): VNode | undefined {\r\n        const view = this.viewRegistry.get(element.type);\r\n        const vnode = view.render(element, this, this.args);\r\n        if (vnode) {\r\n            return this.decorate(vnode, element);\r\n        } else {\r\n            return undefined;\r\n        }\r\n    }\r\n\r\n    renderChildren(element: Readonly<SParentElementImpl>, args?: IViewArgs): VNode[] {\r\n        const context = args ?\r\n            new ModelRenderer(\r\n                this.viewRegistry,\r\n                this.targetKind,\r\n                this.postprocessors,\r\n                { ...args, parentArgs: this.args }\r\n            ) : this;\r\n        return element.children\r\n            .map(child => context.renderElement(child))\r\n            .filter(vnode => vnode !== undefined) as VNode[];\r\n    }\r\n\r\n    postUpdate(cause?: Action) {\r\n        this.postprocessors.forEach(processor => processor.postUpdate(cause));\r\n    }\r\n}\r\n\r\nexport type ModelRendererFactory = (\r\n    targetKind: RenderingTargetKind,\r\n    postprocessors: IVNodePostprocessor[],\r\n    args?: IViewArgs\r\n) => ModelRenderer;\r\n\r\nexport type Patcher = (oldRoot: VNode | Element, newRoot: VNode) => VNode;\r\n\r\n@injectable()\r\nexport class PatcherProvider {\r\n\r\n    readonly patcher: Patcher;\r\n\r\n    constructor() {\r\n        this.patcher = init(this.createModules());\r\n    }\r\n\r\n    protected createModules(): Module[] {\r\n        return [\r\n            propsModule,\r\n            attributesModule,\r\n            classModule,\r\n            styleModule,\r\n            eventListenersModule\r\n        ];\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * The component that turns the model into an SVG DOM.\r\n * Uses a VDOM based on snabbdom.js for performance.\r\n */\r\n@injectable()\r\nexport class ModelViewer implements IViewer {\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(TYPES.IActionDispatcher) protected actiondispatcher: IActionDispatcher;\r\n\r\n    constructor(@inject(TYPES.ModelRendererFactory) modelRendererFactory: ModelRendererFactory,\r\n        @inject(TYPES.PatcherProvider) patcherProvider: PatcherProvider,\r\n        @multiInject(TYPES.IVNodePostprocessor) @optional() postprocessors: IVNodePostprocessor[]) {\r\n        this.renderer = modelRendererFactory('main', postprocessors);\r\n        this.patcher = patcherProvider.patcher;\r\n    }\r\n\r\n    protected readonly renderer: ModelRenderer;\r\n    protected readonly patcher: Patcher;\r\n\r\n    protected lastVDOM: VNode;\r\n\r\n    update(model: Readonly<SModelRootImpl>, cause?: Action): void {\r\n        this.logger.log(this, 'rendering', model);\r\n        const newVDOM = <div id={this.options.baseDiv}>\r\n            {this.renderer.renderElement(model)}\r\n        </div>;\r\n        if (this.lastVDOM !== undefined) {\r\n            const hadFocus = this.hasFocus();\r\n            copyClassesFromVNode(this.lastVDOM, newVDOM);\r\n            this.lastVDOM = this.patcher.call(this, this.lastVDOM, newVDOM);\r\n            this.restoreFocus(hadFocus);\r\n        } else if (typeof document !== 'undefined') {\r\n            const placeholder = document.getElementById(this.options.baseDiv);\r\n            if (placeholder !== null) {\r\n                if (typeof window !== 'undefined') {\r\n                    window.addEventListener('resize', () => {\r\n                        this.onWindowResize(newVDOM);\r\n                    });\r\n                }\r\n                copyClassesFromElement(placeholder, newVDOM);\r\n                setClass(newVDOM, this.options.baseClass, true);\r\n                this.lastVDOM = this.patcher.call(this, placeholder, newVDOM);\r\n            } else {\r\n                this.logger.error(this, 'element not in DOM:', this.options.baseDiv);\r\n            }\r\n        }\r\n        this.renderer.postUpdate(cause);\r\n    }\r\n\r\n    protected hasFocus(): boolean {\r\n        if (typeof document !== 'undefined' && document.activeElement && this.lastVDOM.children && this.lastVDOM.children.length > 0) {\r\n            const lastRootVNode = this.lastVDOM.children[0];\r\n            if (typeof lastRootVNode === 'object') {\r\n                const lastElement = (lastRootVNode as VNode).elm;\r\n                return document.activeElement === lastElement;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected restoreFocus(focus: boolean) {\r\n        if (focus && this.lastVDOM.children && this.lastVDOM.children.length > 0) {\r\n            const lastRootVNode = this.lastVDOM.children[0];\r\n            if (typeof lastRootVNode === 'object') {\r\n                const lastElement = (lastRootVNode as VNode).elm;\r\n                if (lastElement && typeof (lastElement as any).focus === 'function')\r\n                    (lastElement as any).focus();\r\n            }\r\n        }\r\n    }\r\n\r\n    protected onWindowResize(vdom: VNode): void {\r\n        const baseDiv = document.getElementById(this.options.baseDiv);\r\n        if (baseDiv !== null) {\r\n            const newBounds = this.getBoundsInPage(baseDiv as Element);\r\n            this.actiondispatcher.dispatch(InitializeCanvasBoundsAction.create(newBounds));\r\n        }\r\n    }\r\n\r\n    protected getBoundsInPage(element: Element) {\r\n        const bounds = element.getBoundingClientRect();\r\n        const scroll = getWindowScroll();\r\n        return {\r\n            x: bounds.left + scroll.x,\r\n            y: bounds.top + scroll.y,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Viewer for the _hidden_ model. This serves as an intermediate step to compute bounds\r\n * of elements. The model is rendered in a section that is not visible to the user,\r\n * and then the bounds are extracted from the DOM.\r\n */\r\n@injectable()\r\nexport class HiddenModelViewer implements IViewer {\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n\r\n    constructor(@inject(TYPES.ModelRendererFactory) modelRendererFactory: ModelRendererFactory,\r\n        @inject(TYPES.PatcherProvider) patcherProvider: PatcherProvider,\r\n        @multiInject(TYPES.HiddenVNodePostprocessor) @optional() hiddenPostprocessors: IVNodePostprocessor[]) {\r\n        this.hiddenRenderer = modelRendererFactory('hidden', hiddenPostprocessors);\r\n        this.patcher = patcherProvider.patcher;\r\n    }\r\n\r\n    protected readonly hiddenRenderer: ModelRenderer;\r\n    protected readonly patcher: Patcher;\r\n\r\n    protected lastHiddenVDOM: VNode;\r\n\r\n    update(hiddenModel: Readonly<SModelRootImpl>, cause?: Action): void {\r\n        this.logger.log(this, 'rendering hidden');\r\n\r\n        let newVDOM: VNode;\r\n        if (hiddenModel.type === EMPTY_ROOT.type) {\r\n            newVDOM = <div id={this.options.hiddenDiv}></div>;\r\n        } else {\r\n            const hiddenVNode = this.hiddenRenderer.renderElement(hiddenModel);\r\n            if (hiddenVNode) {\r\n                setAttr(hiddenVNode, 'opacity', 0);\r\n            }\r\n            newVDOM = <div id={this.options.hiddenDiv}>\r\n                {hiddenVNode}\r\n            </div>;\r\n        }\r\n\r\n        if (this.lastHiddenVDOM !== undefined) {\r\n            copyClassesFromVNode(this.lastHiddenVDOM, newVDOM);\r\n            this.lastHiddenVDOM = this.patcher.call(this, this.lastHiddenVDOM, newVDOM);\r\n        } else {\r\n            let placeholder = document.getElementById(this.options.hiddenDiv);\r\n            if (placeholder === null) {\r\n                placeholder = document.createElement('div');\r\n                document.body.appendChild(placeholder);\r\n            } else {\r\n                copyClassesFromElement(placeholder, newVDOM);\r\n            }\r\n            setClass(newVDOM, this.options.baseClass, true);\r\n            setClass(newVDOM, this.options.hiddenClass, true);\r\n            this.lastHiddenVDOM = this.patcher.call(this, placeholder, newVDOM);\r\n        }\r\n        this.hiddenRenderer.postUpdate(cause);\r\n    }\r\n\r\n}\r\n\r\n@injectable()\r\nexport class PopupModelViewer implements IViewer {\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n\r\n    constructor(@inject(TYPES.ModelRendererFactory) protected readonly modelRendererFactory: ModelRendererFactory,\r\n        @inject(TYPES.PatcherProvider) patcherProvider: PatcherProvider,\r\n        @multiInject(TYPES.PopupVNodePostprocessor) @optional() popupPostprocessors: IVNodePostprocessor[]) {\r\n        this.popupRenderer = this.modelRendererFactory('popup', popupPostprocessors);\r\n        this.patcher = patcherProvider.patcher;\r\n    }\r\n\r\n    protected readonly popupRenderer: ModelRenderer;\r\n    protected readonly patcher: Patcher;\r\n\r\n    protected lastPopupVDOM: VNode;\r\n\r\n    update(model: Readonly<SModelRootImpl>, cause?: Action): void {\r\n        this.logger.log(this, 'rendering popup', model);\r\n\r\n        const popupClosed = model.type === EMPTY_ROOT.type;\r\n        let newVDOM: VNode;\r\n        if (popupClosed) {\r\n            newVDOM = <div id={this.options.popupDiv}></div>;\r\n        } else {\r\n            const position = model.canvasBounds;\r\n            const inlineStyle = {\r\n                top: position.y + 'px',\r\n                left: position.x + 'px'\r\n            };\r\n            newVDOM = <div id={this.options.popupDiv} style={inlineStyle}>\r\n                {this.popupRenderer.renderElement(model)}\r\n            </div>;\r\n        }\r\n\r\n        if (this.lastPopupVDOM !== undefined) {\r\n            copyClassesFromVNode(this.lastPopupVDOM, newVDOM);\r\n            setClass(newVDOM, this.options.popupClosedClass, popupClosed);\r\n            this.lastPopupVDOM = this.patcher.call(this, this.lastPopupVDOM, newVDOM);\r\n        } else if (typeof document !== 'undefined') {\r\n            let placeholder = document.getElementById(this.options.popupDiv);\r\n            if (placeholder === null) {\r\n                placeholder = document.createElement('div');\r\n                document.body.appendChild(placeholder);\r\n            } else {\r\n                copyClassesFromElement(placeholder, newVDOM);\r\n            }\r\n            setClass(newVDOM, this.options.popupClass, true);\r\n            setClass(newVDOM, this.options.popupClosedClass, popupClosed);\r\n            this.lastPopupVDOM = this.patcher.call(this, placeholder, newVDOM);\r\n        }\r\n        this.popupRenderer.postUpdate(cause);\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { SModelElementImpl } from \"../model/smodel\";\r\nimport { setAttr } from \"./vnode-utils\";\r\n\r\n/**\r\n * Manipulates a created VNode after it has been created.\r\n * Used to register listeners and add animations.\r\n */\r\nexport interface IVNodePostprocessor {\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode\r\n    postUpdate(cause?: Action): void\r\n}\r\n\r\n@injectable()\r\nexport class FocusFixPostprocessor implements IVNodePostprocessor {\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (vnode.sel && vnode.sel.startsWith('svg'))\r\n            // allows to set focus in Firefox\r\n            setAttr(vnode, 'tabindex', 0);\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { TYPES } from \"../base/types\";\r\nimport { ViewerOptions } from \"../base/views/viewer-options\";\r\n\r\nexport interface ILogger {\r\n    logLevel: LogLevel\r\n\r\n    error(thisArg: any, message: string, ...params: any[]): void\r\n    warn(thisArg: any, message: string, ...params: any[]): void\r\n    info(thisArg: any, message: string, ...params: any[]): void\r\n    log(thisArg: any, message: string, ...params: any[]): void\r\n}\r\n\r\nexport enum LogLevel { none = 0, error = 1, warn = 2, info = 3, log = 4 }\r\n\r\n@injectable()\r\nexport class NullLogger implements ILogger {\r\n    logLevel: LogLevel = LogLevel.none;\r\n\r\n    error(thisArg: any, message: string, ...params: any[]): void {}\r\n    warn(thisArg: any, message: string, ...params: any[]): void {}\r\n    info(thisArg: any, message: string, ...params: any[]): void {}\r\n    log(thisArg: any, message: string, ...params: any[]): void {}\r\n}\r\n\r\n@injectable()\r\nexport class ConsoleLogger implements ILogger {\r\n\r\n    @inject(TYPES.LogLevel) public logLevel: LogLevel = LogLevel.log;\r\n    @inject(TYPES.ViewerOptions) protected viewOptions: ViewerOptions = { baseDiv: '' } as ViewerOptions;\r\n\r\n    error(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.error)\r\n            try {\r\n                console.error.apply(thisArg, this.consoleArguments(thisArg, message, params));\r\n            } catch (error) {}\r\n    }\r\n\r\n    warn(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.warn)\r\n            try {\r\n                console.warn.apply(thisArg, this.consoleArguments(thisArg, message, params));\r\n            } catch (error) {}\r\n    }\r\n\r\n    info(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.info)\r\n            try {\r\n                console.info.apply(thisArg, this.consoleArguments(thisArg, message, params));\r\n            } catch (error) {}\r\n    }\r\n\r\n    log(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.log)\r\n            try {\r\n                console.log.apply(thisArg, this.consoleArguments(thisArg, message, params));\r\n            } catch (error) {}\r\n    }\r\n\r\n    protected consoleArguments(thisArg: any, message: string, params: any[]): any[] {\r\n        let caller: any;\r\n        if (typeof thisArg === 'object')\r\n            caller = thisArg.constructor.name;\r\n        else\r\n            caller = thisArg;\r\n        const date = new Date();\r\n        return [date.toLocaleTimeString() + ' ' + this.viewOptions.baseDiv + ' ' + caller + ': ' + message, ...params];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { TYPES } from \"../types\";\r\nimport { ILogger } from \"../../utils/logging\";\r\nimport { SModelElementImpl } from \"../model/smodel\";\r\nimport { IVNodePostprocessor } from \"./vnode-postprocessor\";\r\nimport { DOMHelper } from \"./dom-helper\";\r\nimport { getAttrs } from \"./vnode-utils\";\r\n\r\n@injectable()\r\nexport class IdPostprocessor implements IVNodePostprocessor {\r\n\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(TYPES.DOMHelper) protected domHelper: DOMHelper;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        const attrs = getAttrs(vnode);\r\n        if (attrs.id !== undefined)\r\n            this.logger.warn(vnode, 'Overriding id of vnode (' + attrs.id + '). Make sure not to set it manually in view.');\r\n        attrs.id = this.domHelper.createUniqueDOMElementId(element);\r\n        if (!vnode.key)\r\n            vnode.key = element.id;\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { IVNodePostprocessor } from \"./vnode-postprocessor\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { getSubType } from 'sprotty-protocol/lib/utils/model-utils';\r\nimport { SModelElementImpl } from \"../model/smodel\";\r\nimport { setClass } from \"./vnode-utils\";\r\nimport { injectable } from \"inversify\";\r\n\r\n@injectable()\r\nexport class CssClassPostprocessor implements IVNodePostprocessor {\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (element.cssClasses) {\r\n            for (const cssClass of element.cssClasses)\r\n                setClass(vnode, cssClass, true);\r\n        }\r\n        // append model subtype as class\r\n        const subType = getSubType(element);\r\n        if (subType && subType !== element.type) {\r\n            setClass(vnode, subType, true);\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n        // empty\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"./types\";\r\nimport { CanvasBoundsInitializer, InitializeCanvasBoundsCommand } from './features/initialize-canvas';\r\nimport { LogLevel, NullLogger } from \"../utils/logging\";\r\nimport { ActionDispatcher, IActionDispatcher } from \"./actions/action-dispatcher\";\r\nimport { ActionHandlerRegistry } from \"./actions/action-handler\";\r\nimport { CommandStack, ICommandStack } from \"./commands/command-stack\";\r\nimport { CommandStackOptions } from \"./commands/command-stack-options\";\r\nimport { SModelFactory, SModelRegistry } from './model/smodel-factory';\r\nimport { AnimationFrameSyncer } from \"./animations/animation-frame-syncer\";\r\nimport { IViewer, ModelViewer, HiddenModelViewer, PopupModelViewer, ModelRenderer, PatcherProvider } from \"./views/viewer\";\r\nimport { ViewerOptions, defaultViewerOptions } from \"./views/viewer-options\";\r\nimport { MouseTool, PopupMouseTool, MousePositionTracker } from \"./views/mouse-tool\";\r\nimport { KeyTool } from \"./views/key-tool\";\r\nimport { FocusFixPostprocessor, IVNodePostprocessor } from \"./views/vnode-postprocessor\";\r\nimport { ViewRegistry, RenderingTargetKind, IViewArgs } from \"./views/view\";\r\nimport { ViewerCache } from \"./views/viewer-cache\";\r\nimport { DOMHelper } from \"./views/dom-helper\";\r\nimport { IdPostprocessor } from \"./views/id-postprocessor\";\r\nimport { configureCommand, CommandActionHandlerInitializer } from \"./commands/command-registration\";\r\nimport { CssClassPostprocessor } from \"./views/css-class-postprocessor\";\r\nimport { SetModelCommand } from \"./features/set-model\";\r\nimport { UIExtensionRegistry, SetUIExtensionVisibilityCommand } from \"./ui-extensions/ui-extension-registry\";\r\nimport { DefaultDiagramLocker } from \"./actions/diagram-locker\";\r\n\r\nconst defaultContainerModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    // Logging ---------------------------------------------\r\n    bind(TYPES.ILogger).to(NullLogger).inSingletonScope();\r\n    bind(TYPES.LogLevel).toConstantValue(LogLevel.warn);\r\n\r\n    // Registries ---------------------------------------------\r\n    bind(TYPES.SModelRegistry).to(SModelRegistry).inSingletonScope();\r\n    bind(ActionHandlerRegistry).toSelf().inSingletonScope();\r\n    bind(TYPES.ActionHandlerRegistryProvider).toProvider<ActionHandlerRegistry>(ctx => {\r\n        return () => {\r\n            return new Promise<ActionHandlerRegistry>((resolve) => {\r\n                resolve(ctx.container.get<ActionHandlerRegistry>(ActionHandlerRegistry));\r\n            });\r\n        };\r\n    });\r\n    bind(TYPES.ViewRegistry).to(ViewRegistry).inSingletonScope();\r\n\r\n    // Model Creation ---------------------------------------------\r\n    bind(TYPES.IModelFactory).to(SModelFactory).inSingletonScope();\r\n\r\n    // Action Dispatcher ---------------------------------------------\r\n    bind(TYPES.IActionDispatcher).to(ActionDispatcher).inSingletonScope();\r\n    bind(TYPES.IActionDispatcherProvider).toProvider<IActionDispatcher>(ctx => {\r\n        return () => {\r\n            return new Promise<IActionDispatcher>((resolve) => {\r\n                resolve(ctx.container.get<IActionDispatcher>(TYPES.IActionDispatcher));\r\n            });\r\n        };\r\n    });\r\n    bind(TYPES.IDiagramLocker).to(DefaultDiagramLocker).inSingletonScope();\r\n\r\n    // Action handler\r\n    bind(TYPES.IActionHandlerInitializer).to(CommandActionHandlerInitializer);\r\n\r\n    // Command Stack ---------------------------------------------\r\n    bind(TYPES.ICommandStack).to(CommandStack).inSingletonScope();\r\n    bind(TYPES.ICommandStackProvider).toProvider<ICommandStack>(ctx => {\r\n        return () => {\r\n            return new Promise<ICommandStack>((resolve) => {\r\n                resolve(ctx.container.get<ICommandStack>(TYPES.ICommandStack));\r\n            });\r\n        };\r\n    });\r\n    bind<CommandStackOptions>(TYPES.CommandStackOptions).toConstantValue({\r\n        defaultDuration: 250,\r\n        undoHistoryLimit: 50\r\n    });\r\n\r\n    // Viewer ---------------------------------------------\r\n    bind(ModelViewer).toSelf().inSingletonScope();\r\n    bind(HiddenModelViewer).toSelf().inSingletonScope();\r\n    bind(PopupModelViewer).toSelf().inSingletonScope();\r\n    bind(TYPES.ModelViewer).toDynamicValue(ctx => {\r\n        const container = ctx.container.createChild();\r\n        container.bind(TYPES.IViewer).toService(ModelViewer);\r\n        container.bind(ViewerCache).toSelf();\r\n        return container.get(ViewerCache);\r\n    }).inSingletonScope();\r\n    bind(TYPES.PopupModelViewer).toDynamicValue(ctx => {\r\n        const container = ctx.container.createChild();\r\n        container.bind(TYPES.IViewer).toService(PopupModelViewer);\r\n        container.bind(ViewerCache).toSelf();\r\n        return container.get(ViewerCache);\r\n    }).inSingletonScope();\r\n    bind(TYPES.HiddenModelViewer).toService(HiddenModelViewer);\r\n    bind(TYPES.IViewerProvider).toDynamicValue(ctx => {\r\n        return {\r\n            get modelViewer() {\r\n                return ctx.container.get<IViewer>(TYPES.ModelViewer);\r\n            },\r\n            get hiddenModelViewer() {\r\n                return ctx.container.get<IViewer>(TYPES.HiddenModelViewer);\r\n            },\r\n            get popupModelViewer() {\r\n                return ctx.container.get<IViewer>(TYPES.PopupModelViewer);\r\n            }\r\n        };\r\n    });\r\n    bind<ViewerOptions>(TYPES.ViewerOptions).toConstantValue(defaultViewerOptions());\r\n    bind(TYPES.PatcherProvider).to(PatcherProvider).inSingletonScope();\r\n    bind(TYPES.DOMHelper).to(DOMHelper).inSingletonScope();\r\n    bind(TYPES.ModelRendererFactory).toFactory<ModelRenderer>(ctx => {\r\n        return (targetKind: RenderingTargetKind, processors: IVNodePostprocessor[], args: IViewArgs = {}) => {\r\n            const viewRegistry = ctx.container.get<ViewRegistry>(TYPES.ViewRegistry);\r\n            return new ModelRenderer(viewRegistry, targetKind, processors, args);\r\n        };\r\n    });\r\n\r\n    // Tools & Postprocessors --------------------------------------\r\n    bind(IdPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(IdPostprocessor);\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(IdPostprocessor);\r\n    bind(CssClassPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(CssClassPostprocessor);\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(CssClassPostprocessor);\r\n    bind(MouseTool).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(MouseTool);\r\n    bind(KeyTool).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(KeyTool);\r\n    bind(FocusFixPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(FocusFixPostprocessor);\r\n    bind(TYPES.PopupVNodePostprocessor).toService(IdPostprocessor);\r\n    bind(PopupMouseTool).toSelf().inSingletonScope();\r\n    bind(TYPES.PopupVNodePostprocessor).toService(PopupMouseTool);\r\n\r\n    // Animation Frame Sync ------------------------------------------\r\n    bind(TYPES.AnimationFrameSyncer).to(AnimationFrameSyncer).inSingletonScope();\r\n\r\n    // Canvas Initialization ---------------------------------------------\r\n    const context = { bind, isBound };\r\n    configureCommand(context, InitializeCanvasBoundsCommand);\r\n    bind(CanvasBoundsInitializer).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(CanvasBoundsInitializer);\r\n\r\n    // Model commands ---------------------------------------------\r\n    configureCommand(context, SetModelCommand);\r\n\r\n    // UIExtension registry initialization ------------------------------------\r\n    bind(TYPES.UIExtensionRegistry).to(UIExtensionRegistry).inSingletonScope();\r\n    configureCommand(context, SetUIExtensionVisibilityCommand);\r\n\r\n    // Tracker for last known mouse position on diagram ------------------------\r\n    bind(MousePositionTracker).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(MousePositionTracker);\r\n});\r\n\r\nexport default defaultContainerModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Locateable } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Dimension, isBounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { DOMHelper } from '../../base/views/dom-helper';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\nimport { getWindowScroll } from '../../utils/browser';\r\n\r\nexport const boundsFeature = Symbol('boundsFeature');\r\nexport const layoutContainerFeature = Symbol('layoutContainerFeature');\r\nexport const layoutableChildFeature = Symbol('layoutableChildFeature');\r\nexport const alignFeature = Symbol('alignFeature');\r\n\r\n/**\r\n * Model elements that implement this interface have a position and a size.\r\n * Note that this definition differs from the one in `sprotty-protocol` because this is\r\n * used in the _internal model_, while the other is used in the _external model_.\r\n *\r\n * Feature extension interface for {@link boundsFeature}.\r\n */\r\nexport interface InternalBoundsAware {\r\n    bounds: Bounds\r\n}\r\n\r\n/** @deprecated Use `InternalBoundsAware` instead. */\r\nexport type BoundsAware = InternalBoundsAware;\r\n\r\n/**\r\n * Used to identify model elements that specify a layout to apply to their children.\r\n */\r\nexport interface InternalLayoutContainer extends InternalLayoutableChild {\r\n    layout: string\r\n}\r\n\r\n/** @deprecated Use `InternalLayoutContainer` instead. */\r\nexport type LayoutContainer = InternalLayoutContainer;\r\n\r\nexport type ModelLayoutOptions = { [key: string]: string | number | boolean };\r\n\r\n/**\r\n * Feature extension interface for {@link layoutableChildFeature}.\r\n */\r\nexport interface InternalLayoutableChild extends InternalBoundsAware {\r\n    layoutOptions?: ModelLayoutOptions\r\n}\r\n\r\n/** @deprecated Use `InternalLayoutableChild` instead. */\r\nexport type LayoutableChild = InternalLayoutableChild;\r\n\r\n/**\r\n * Feature extension interface for {@link alignFeature}.\r\n * Used to adjust elements whose bounding box is not at the origin, e.g.\r\n * labels, or pre-rendered SVG figures.\r\n * @deprecated use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Alignable {\r\n    alignment: Point\r\n}\r\n\r\nexport function isBoundsAware(element: SModelElementImpl): element is SModelElementImpl & InternalBoundsAware {\r\n    return 'bounds' in element;\r\n}\r\n\r\nexport function isLayoutContainer(element: SModelElementImpl): element is SParentElementImpl & InternalLayoutContainer {\r\n    return isBoundsAware(element)\r\n        && element.hasFeature(layoutContainerFeature)\r\n        && 'layout' in element;\r\n}\r\n\r\nexport function isLayoutableChild(element: SModelElementImpl): element is SChildElementImpl & InternalLayoutableChild {\r\n    return isBoundsAware(element)\r\n        && element.hasFeature(layoutableChildFeature);\r\n}\r\n\r\nexport function isSizeable(element: SModelElementImpl): element is SModelElementImpl & InternalBoundsAware {\r\n    return element.hasFeature(boundsFeature) && isBoundsAware(element);\r\n}\r\n\r\nexport function isAlignable(element: SModelElementImpl): element is SModelElementImpl & Alignable {\r\n    return element.hasFeature(alignFeature)\r\n        && 'alignment' in element;\r\n}\r\n\r\nexport function getAbsoluteBounds(element: SModelElementImpl): Bounds {\r\n    const boundsAware = findParentByFeature(element, isBoundsAware);\r\n    if (boundsAware !== undefined) {\r\n        let bounds = boundsAware.bounds;\r\n        let current: SModelElementImpl = boundsAware;\r\n        while (current instanceof SChildElementImpl) {\r\n            const parent = current.parent;\r\n            bounds = parent.localToParent(bounds);\r\n            current = parent;\r\n        }\r\n        return bounds;\r\n    } else if (element instanceof SModelRootImpl) {\r\n        const canvasBounds = element.canvasBounds;\r\n        return { x: 0, y: 0, width: canvasBounds.width, height: canvasBounds.height };\r\n    } else {\r\n        return Bounds.EMPTY;\r\n    }\r\n}\r\n\r\n/**\r\n * Returns the \"client-absolute\" bounds of the specified `element`.\r\n *\r\n * The client-absolute bounds are relative to the entire browser page.\r\n *\r\n * @param element The element to get the bounds for.\r\n * @param domHelper The dom helper to obtain the SVG element's id.\r\n * @param viewerOptions The viewer options to obtain sprotty's container div id.\r\n */\r\nexport function getAbsoluteClientBounds(element: SModelElementImpl, domHelper: DOMHelper, viewerOptions: ViewerOptions): Bounds {\r\n    let x = 0;\r\n    let y = 0;\r\n    let width = 0;\r\n    let height = 0;\r\n\r\n    const svgElementId = domHelper.createUniqueDOMElementId(element);\r\n    const svgElement = document.getElementById(svgElementId);\r\n    if (svgElement) {\r\n        const rect = svgElement.getBoundingClientRect();\r\n        const scroll = getWindowScroll();\r\n        x = rect.left + scroll.x;\r\n        y = rect.top + scroll.y;\r\n        width = rect.width;\r\n        height = rect.height;\r\n    }\r\n\r\n    let container = document.getElementById(viewerOptions.baseDiv);\r\n    if (container) {\r\n        while (container.offsetParent instanceof HTMLElement\r\n            && (container = <HTMLElement>container.offsetParent)) {\r\n            x -= container.offsetLeft;\r\n            y -= container.offsetTop;\r\n        }\r\n    }\r\n\r\n    return { x, y, width, height };\r\n}\r\n\r\nexport function findChildrenAtPosition(parent: SParentElementImpl, point: Point): SModelElementImpl[] {\r\n    const matches: SModelElementImpl[] = [];\r\n    doFindChildrenAtPosition(parent, point, matches);\r\n    return matches;\r\n}\r\n\r\nfunction doFindChildrenAtPosition(parent: SParentElementImpl, point: Point, matches: SModelElementImpl[]) {\r\n    parent.children.forEach(child => {\r\n        if (isBoundsAware(child) && Bounds.includes(child.bounds, point))\r\n            matches.push(child);\r\n        if (child instanceof SParentElementImpl) {\r\n            const newPoint = child.parentToLocal(point);\r\n            doFindChildrenAtPosition(child, newPoint, matches);\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Abstract class for elements with a position and a size.\r\n */\r\nexport abstract class SShapeElementImpl extends SChildElementImpl implements InternalBoundsAware, Locateable, InternalLayoutableChild {\r\n\r\n    position: Point = Point.ORIGIN;\r\n    size: Dimension = Dimension.EMPTY;\r\n    layoutOptions?: ModelLayoutOptions;\r\n\r\n    get bounds(): Bounds {\r\n        return {\r\n            x: this.position.x,\r\n            y: this.position.y,\r\n            width: this.size.width,\r\n            height: this.size.height\r\n        };\r\n    }\r\n\r\n    set bounds(newBounds: Bounds) {\r\n        this.position = {\r\n            x: newBounds.x,\r\n            y: newBounds.y\r\n        };\r\n        this.size = {\r\n            width: newBounds.width,\r\n            height: newBounds.height\r\n        };\r\n    }\r\n\r\n    override localToParent(point: Point | Bounds): Bounds {\r\n        const result = {\r\n            x: point.x + this.position.x,\r\n            y: point.y + this.position.y,\r\n            width: -1,\r\n            height: -1\r\n        };\r\n        if (isBounds(point)) {\r\n            result.width = point.width;\r\n            result.height = point.height;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    override parentToLocal(point: Point | Bounds): Bounds {\r\n        const result = {\r\n            x: point.x - this.position.x,\r\n            y: point.y - this.position.y,\r\n            width: -1,\r\n            height: -1\r\n        };\r\n        if (isBounds(point)) {\r\n            result.width = point.width;\r\n            result.height = point.height;\r\n        }\r\n        return result;\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { Action, ComputedBoundsAction, RequestBoundsAction, SetBoundsAction } from 'sprotty-protocol/lib/actions';\r\nimport { Alignable } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { CommandExecutionContext, CommandResult, CommandReturn, HiddenCommand, SystemCommand } from '../../base/commands/command';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\nimport { InternalBoundsAware, isBoundsAware } from './model';\r\n\r\nexport interface ResolvedElementAndBounds {\r\n    element: SModelElementImpl & InternalBoundsAware\r\n    oldBounds: Bounds\r\n    newPosition?: Point\r\n    newSize: Dimension\r\n}\r\n\r\nexport interface ResolvedElementAndAlignment {\r\n    element: SModelElementImpl & Alignable\r\n    oldAlignment: Point\r\n    newAlignment: Point\r\n}\r\n\r\n@injectable()\r\nexport class SetBoundsCommand extends SystemCommand {\r\n    static readonly KIND: string = SetBoundsAction.KIND;\r\n\r\n    protected bounds: ResolvedElementAndBounds[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SetBoundsAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.action.bounds.forEach(\r\n            b => {\r\n                const element = context.root.index.getById(b.elementId);\r\n                if (element && isBoundsAware(element)) {\r\n                    this.bounds.push({\r\n                        element: element,\r\n                        oldBounds: element.bounds,\r\n                        newPosition: b.newPosition,\r\n                        newSize: b.newSize\r\n                    });\r\n                }\r\n            }\r\n        );\r\n        return this.redo(context);\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        this.bounds.forEach(\r\n            b => b.element.bounds = b.oldBounds\r\n        );\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        this.bounds.forEach(\r\n            b => {\r\n                if (b.newPosition)\r\n                    b.element.bounds = {\r\n                        ...b.newPosition,\r\n                        ...b.newSize,\r\n                    };\r\n                else\r\n                    // keep the position\r\n                    b.element.bounds = {\r\n                        x: b.element.bounds.x,\r\n                        y: b.element.bounds.y,\r\n                        ...b.newSize\r\n                    };\r\n            }\r\n        );\r\n        return context.root;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class RequestBoundsCommand extends HiddenCommand {\r\n    static readonly KIND: string = RequestBoundsAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected action: RequestBoundsAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandResult {\r\n        return {\r\n            model: context.modelFactory.createRoot(this.action.newRoot),\r\n            modelChanged: true,\r\n            cause: this.action\r\n        };\r\n    }\r\n\r\n    get blockUntil(): (action: Action) => boolean {\r\n        return action => action.kind === ComputedBoundsAction.KIND;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, interfaces, multiInject, optional } from \"inversify\";\r\nimport { Bounds } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { ILogger } from '../../utils/logging';\r\nimport { InstanceRegistry } from \"../../utils/registry\";\r\nimport { SParentElementImpl, SModelElementImpl } from \"../../base/model/smodel\";\r\nimport { isLayoutContainer, InternalLayoutContainer } from \"./model\";\r\nimport { BoundsData } from \"./hidden-bounds-updater\";\r\nimport { isInjectable } from \"../../utils/inversify\";\r\n\r\n@injectable()\r\nexport class LayoutRegistry extends InstanceRegistry<ILayout> {\r\n\r\n    @inject(TYPES.ILogger) logger: ILogger;\r\n\r\n    constructor(@multiInject(TYPES.LayoutRegistration) @optional() layouts: (LayoutRegistration)[] = []) {\r\n        super();\r\n        layouts.forEach(layout => {\r\n            if (this.hasKey(layout.layoutKind)) {\r\n                this.logger.warn('Layout kind is already defined: ', layout.layoutKind);\r\n            } else {\r\n                this.register(layout.layoutKind, layout.factory());\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nexport interface LayoutRegistration {\r\n    layoutKind: string;\r\n    factory: () => ILayout;\r\n}\r\n\r\n@injectable()\r\nexport class Layouter {\r\n\r\n    @inject(TYPES.LayoutRegistry) protected layoutRegistry: LayoutRegistry;\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n\r\n    layout(element2boundsData: Map<SModelElementImpl, BoundsData>) {\r\n        new StatefulLayouter(element2boundsData, this.layoutRegistry, this.logger).layout();\r\n    }\r\n}\r\n\r\nexport class StatefulLayouter {\r\n\r\n    private toBeLayouted: (SParentElementImpl & InternalLayoutContainer)[];\r\n\r\n    constructor(private readonly element2boundsData: Map<SModelElementImpl, BoundsData>,\r\n                private readonly layoutRegistry: LayoutRegistry,\r\n                public readonly log: ILogger) {\r\n        this.toBeLayouted = [];\r\n        element2boundsData.forEach(\r\n            (data, element) => {\r\n                if (isLayoutContainer(element))\r\n                    this.toBeLayouted.push(element);\r\n            });\r\n    }\r\n\r\n    getBoundsData(element: SModelElementImpl): BoundsData {\r\n        let boundsData = this.element2boundsData.get(element);\r\n        let bounds = (element as any).bounds;\r\n        if (isLayoutContainer(element) && this.toBeLayouted.indexOf(element) >= 0) {\r\n            bounds = this.doLayout(element);\r\n        }\r\n        if (!boundsData) {\r\n            boundsData = {\r\n                bounds: bounds,\r\n                boundsChanged: false,\r\n                alignmentChanged: false\r\n            };\r\n            this.element2boundsData.set(element, boundsData);\r\n        }\r\n        return boundsData;\r\n    }\r\n\r\n    layout(): void {\r\n        while (this.toBeLayouted.length > 0) {\r\n            const element = this.toBeLayouted[0];\r\n            this.doLayout(element);\r\n        }\r\n    }\r\n\r\n    protected doLayout(element: SParentElementImpl & InternalLayoutContainer): Bounds {\r\n        const index = this.toBeLayouted.indexOf(element);\r\n        if (index >= 0)\r\n            this.toBeLayouted.splice(index, 1);\r\n        const layout = this.layoutRegistry.get(element.layout);\r\n        if (layout)\r\n            layout.layout(element, this);\r\n        const boundsData = this.element2boundsData.get(element);\r\n        if (boundsData !== undefined && boundsData.bounds !== undefined) {\r\n            return boundsData.bounds;\r\n        } else {\r\n            this.log.error(element, 'Layout failed');\r\n            return Bounds.EMPTY;\r\n        }\r\n    }\r\n}\r\n\r\nexport interface ILayout {\r\n    layout(container: SParentElementImpl & InternalLayoutContainer,\r\n           layouter: StatefulLayouter): void\r\n}\r\n\r\n\r\nexport function configureLayout(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n    kind: string, constr: interfaces.ServiceIdentifier<ILayout>) {\r\n\r\n    if (typeof constr === 'function') {\r\n        if (!isInjectable(constr)) {\r\n            throw new Error(`Layouts be @injectable: ${constr.name}`);\r\n        }\r\n        if (!context.isBound(constr)) {\r\n            context.bind(constr).toSelf();\r\n        }\r\n    }\r\n    context.bind(TYPES.LayoutRegistration).toDynamicValue(ctx => ({\r\n        layoutKind: kind,\r\n        factory: () => ctx.container.get(constr)\r\n    }));\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Action, ComputedBoundsAction, ElementAndAlignment, ElementAndBounds, RequestBoundsAction } from 'sprotty-protocol/lib/actions';\r\nimport { almostEquals, Bounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { isSVGGraphicsElement } from '../../utils/browser';\r\nimport { ILogger } from '../../utils/logging';\r\nimport { IActionDispatcher } from '../../base/actions/action-dispatcher';\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\nimport { IVNodePostprocessor } from '../../base/views/vnode-postprocessor';\r\nimport { Layouter } from './layout';\r\nimport { InternalBoundsAware, isAlignable, isLayoutContainer, isSizeable } from './model';\r\n\r\nexport class BoundsData {\r\n    vnode?: VNode;\r\n    bounds?: Bounds;\r\n    alignment?: Point;\r\n    boundsChanged: boolean;\r\n    alignmentChanged: boolean;\r\n}\r\n\r\n/**\r\n * Grabs the bounds from hidden SVG DOM elements, applies layouts and fires\r\n * ComputedBoundsActions.\r\n *\r\n * The actual bounds of an element can usually not be determined from the SModel\r\n * as they depend on the view implementation and CSS stylings. So the best way is\r\n * to grab them from a live (but hidden) SVG using getBBox().\r\n *\r\n * If an element is Alignable, and the top-left corner of its bounding box is not\r\n * the origin, we also issue a realign with the ComputedBoundsAction.\r\n */\r\n@injectable()\r\nexport class HiddenBoundsUpdater implements IVNodePostprocessor {\r\n\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n    @inject(TYPES.Layouter) protected layouter: Layouter;\r\n\r\n    private readonly element2boundsData: Map<SModelElementImpl & InternalBoundsAware, BoundsData> = new Map;\r\n\r\n    root: SModelRootImpl | undefined;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (isSizeable(element) || isLayoutContainer(element)) {\r\n            this.element2boundsData.set(element, {\r\n                vnode: vnode,\r\n                bounds: element.bounds,\r\n                boundsChanged: false,\r\n                alignmentChanged: false\r\n            });\r\n        }\r\n        if (element instanceof SModelRootImpl) {\r\n            this.root = element;\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(cause?: Action) {\r\n        if (cause === undefined || cause.kind !== RequestBoundsAction.KIND) {\r\n            return;\r\n        }\r\n        const request = cause as RequestBoundsAction;\r\n        this.getBoundsFromDOM();\r\n        this.layouter.layout(this.element2boundsData);\r\n        const resizes: ElementAndBounds[] = [];\r\n        const alignments: ElementAndAlignment[] = [];\r\n        this.element2boundsData.forEach(\r\n            (boundsData, element) => {\r\n                if (boundsData.boundsChanged && boundsData.bounds !== undefined) {\r\n                    const resize: ElementAndBounds = {\r\n                        elementId: element.id,\r\n                        newSize: {\r\n                            width: boundsData.bounds.width,\r\n                            height: boundsData.bounds.height\r\n                        }\r\n                    };\r\n                    // don't copy position if the element is layouted by the server\r\n                    if (element instanceof SChildElementImpl && isLayoutContainer(element.parent)) {\r\n                        resize.newPosition = {\r\n                            x: boundsData.bounds.x,\r\n                            y: boundsData.bounds.y,\r\n                        };\r\n                    }\r\n                    resizes.push(resize);\r\n                }\r\n                if (boundsData.alignmentChanged && boundsData.alignment !== undefined) {\r\n                    alignments.push({\r\n                        elementId: element.id,\r\n                        newAlignment: boundsData.alignment\r\n                    });\r\n                }\r\n            });\r\n        const revision = (this.root !== undefined) ? this.root.revision : undefined;\r\n        this.actionDispatcher.dispatch(ComputedBoundsAction.create(resizes, { revision, alignments, requestId: request.requestId }));\r\n        this.element2boundsData.clear();\r\n    }\r\n\r\n    protected getBoundsFromDOM() {\r\n        this.element2boundsData.forEach(\r\n            (boundsData, element) => {\r\n                if (boundsData.bounds && isSizeable(element)) {\r\n                    const vnode = boundsData.vnode;\r\n                    if (vnode && vnode.elm) {\r\n                        const boundingBox = this.getBounds(vnode.elm, element);\r\n                        if (isAlignable(element) && !(\r\n                            almostEquals(boundingBox.x, 0) && almostEquals(boundingBox.y, 0)\r\n                        )) {\r\n                            boundsData.alignment = {\r\n                                x: -boundingBox.x,\r\n                                y: -boundingBox.y\r\n                            };\r\n                            boundsData.alignmentChanged = true;\r\n                        }\r\n                        const newBounds = {\r\n                            x: element.bounds.x,\r\n                            y: element.bounds.y,\r\n                            width: boundingBox.width,\r\n                            height: boundingBox.height\r\n                        };\r\n                        if (!(almostEquals(newBounds.x, element.bounds.x)\r\n                            && almostEquals(newBounds.y, element.bounds.y)\r\n                            && almostEquals(newBounds.width, element.bounds.width)\r\n                            && almostEquals(newBounds.height, element.bounds.height))) {\r\n                            boundsData.bounds = newBounds;\r\n                            boundsData.boundsChanged = true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Compute the bounds of the given DOM element. Override this method to customize how\r\n     * the bounding box of a rendered view is determined.\r\n     *\r\n     * In case your Sprotty model element contains children that are rendered outside of\r\n     * their parent, you can add the `ATTR_BBOX_ELEMENT` attribute to the SVG element\r\n     * that shall be used to compute the bounding box.\r\n     */\r\n    protected getBounds(elm: Node, element: SModelElementImpl & InternalBoundsAware): Bounds {\r\n        if (!isSVGGraphicsElement(elm)) {\r\n            this.logger.error(this, 'Not an SVG element:', elm);\r\n            return Bounds.EMPTY;\r\n        }\r\n        if (elm.tagName === 'g') {\r\n            for (const child of Array.from(elm.children)) {\r\n                if (child.getAttribute(ATTR_BBOX_ELEMENT) !== null) {\r\n                    return this.getBounds(child, element);\r\n                }\r\n            }\r\n        }\r\n        const bounds = elm.getBBox();\r\n        return {\r\n            x: bounds.x,\r\n            y: bounds.y,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Attribute name identifying the SVG element that determines the bounding box of a rendered view.\r\n * This can be used when a view creates a group of which only a part should contribute to the\r\n * bounding box computed by `HiddenBoundsUpdater`.\r\n */\r\nexport const ATTR_BBOX_ELEMENT = 'bboxElement';\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SParentElementImpl, SModelElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { isLayoutContainer, isLayoutableChild, InternalLayoutContainer, isBoundsAware } from './model';\r\nimport { ILayout, StatefulLayouter } from './layout';\r\nimport { AbstractLayoutOptions, HAlignment, VAlignment } from './layout-options';\r\nimport { BoundsData } from './hidden-bounds-updater';\r\nimport { injectable } from 'inversify';\r\n\r\n@injectable()\r\nexport abstract class AbstractLayout<T extends AbstractLayoutOptions> implements ILayout {\r\n\r\n    layout(container: SParentElementImpl & InternalLayoutContainer,\r\n           layouter: StatefulLayouter) {\r\n        const boundsData = layouter.getBoundsData(container);\r\n        const options = this.getLayoutOptions(container);\r\n        const childrenSize = this.getChildrenSize(container, options, layouter);\r\n        const maxWidth = options.paddingFactor * (\r\n            options.resizeContainer\r\n            ? Math.max(childrenSize.width, options.minWidth)\r\n            : Math.max(0, this.getFixedContainerBounds(container, options, layouter).width) - options.paddingLeft - options.paddingRight);\r\n        const maxHeight =  options.paddingFactor * (\r\n            options.resizeContainer\r\n            ? Math.max(childrenSize.height, options.minHeight)\r\n            : Math.max(0, this.getFixedContainerBounds(container, options, layouter).height) - options.paddingTop - options.paddingBottom);\r\n        if (maxWidth > 0 && maxHeight > 0) {\r\n            const offset = this.layoutChildren(container, layouter, options, maxWidth, maxHeight);\r\n            boundsData.bounds = this.getFinalContainerBounds(container, offset, options, maxWidth, maxHeight);\r\n            boundsData.boundsChanged = true;\r\n        }\r\n    }\r\n    protected abstract layoutChild(child: SChildElementImpl,\r\n                                boundsData: BoundsData, bounds: Bounds,\r\n                                childOptions: T, containerOptions: T,\r\n                                currentOffset: Point,\r\n                                maxWidth: number, maxHeight: number): Point;\r\n\r\n    protected getFinalContainerBounds(container: SParentElementImpl & InternalLayoutContainer,\r\n                                    lastOffset: Point,\r\n                                    options: T,\r\n                                    maxWidth: number,\r\n                                    maxHeight: number): Bounds {\r\n        return {\r\n            x: container.bounds.x,\r\n            y: container.bounds.y,\r\n            width: Math.max(options.minWidth, maxWidth + options.paddingLeft + options.paddingRight),\r\n            height: Math.max(options.minHeight, maxHeight + options.paddingTop + options.paddingBottom)\r\n        };\r\n    }\r\n\r\n    protected getFixedContainerBounds(\r\n            container: SModelElementImpl,\r\n            layoutOptions: T,\r\n            layouter: StatefulLayouter): Bounds {\r\n        let currentContainer = container;\r\n        while (true) {\r\n            if (isBoundsAware(currentContainer)) {\r\n                const bounds = currentContainer.bounds;\r\n                if (isLayoutContainer(currentContainer) && layoutOptions.resizeContainer)\r\n                    layouter.log.error(currentContainer, 'Resizable container found while detecting fixed bounds');\r\n                if (Dimension.isValid(bounds))\r\n                    return bounds;\r\n            }\r\n            if (currentContainer instanceof SChildElementImpl) {\r\n                currentContainer = currentContainer.parent;\r\n            } else {\r\n                layouter.log.error(currentContainer, 'Cannot detect fixed bounds');\r\n                return Bounds.EMPTY;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract getChildrenSize(container: SParentElementImpl & InternalLayoutContainer,\r\n                               containerOptions: T,\r\n                               layouter: StatefulLayouter): Dimension;\r\n\r\n    protected layoutChildren(container: SParentElementImpl & InternalLayoutContainer,\r\n                            layouter: StatefulLayouter,\r\n                            containerOptions: T,\r\n                            maxWidth: number,\r\n                            maxHeight: number): Point {\r\n        let currentOffset: Point = {\r\n            x: containerOptions.paddingLeft + 0.5 * (maxWidth - (maxWidth / containerOptions.paddingFactor)),\r\n            y: containerOptions.paddingTop + 0.5 * (maxHeight - (maxHeight / containerOptions.paddingFactor))};\r\n        container.children.forEach(\r\n            child => {\r\n                if (isLayoutableChild(child)) {\r\n                    const boundsData = layouter.getBoundsData(child);\r\n                    const bounds = boundsData.bounds;\r\n                    const childOptions = this.getChildLayoutOptions(child, containerOptions);\r\n                    if (bounds !== undefined && Dimension.isValid(bounds)) {\r\n                        currentOffset = this.layoutChild(child, boundsData, bounds,\r\n                            childOptions, containerOptions, currentOffset,\r\n                            maxWidth, maxHeight);\r\n                    }\r\n                }\r\n            }\r\n        );\r\n        return currentOffset;\r\n    }\r\n\r\n    protected getDx(hAlign: HAlignment, bounds: Bounds, maxWidth: number): number {\r\n        switch (hAlign) {\r\n            case 'left':\r\n                return 0;\r\n            case 'center':\r\n                return 0.5 * (maxWidth - bounds.width);\r\n            case 'right':\r\n                return maxWidth - bounds.width;\r\n        }\r\n    }\r\n\r\n    protected getDy(vAlign: VAlignment, bounds: Bounds, maxHeight: number): number {\r\n        switch (vAlign) {\r\n            case 'top':\r\n                return 0;\r\n            case 'center':\r\n                return 0.5 * (maxHeight - bounds.height);\r\n            case 'bottom':\r\n                return maxHeight - bounds.height;\r\n        }\r\n    }\r\n\r\n    protected getChildLayoutOptions(child: SChildElementImpl, containerOptions: T): T {\r\n        const layoutOptions = (child as any).layoutOptions;\r\n        if (layoutOptions === undefined)\r\n            return containerOptions;\r\n        else\r\n            return this.spread(containerOptions, layoutOptions);\r\n    }\r\n\r\n    protected getLayoutOptions(element: SModelElementImpl): T {\r\n        let current = element;\r\n        const allOptions: T[] = [];\r\n        while (current !== undefined) {\r\n            const layoutOptions = (current as any).layoutOptions;\r\n            if (layoutOptions !== undefined)\r\n                allOptions.push(layoutOptions);\r\n            if (current instanceof SChildElementImpl)\r\n                current = current.parent;\r\n            else\r\n                break;\r\n        }\r\n        return allOptions.reverse().reduce(\r\n            (a, b) => { return this.spread(a, b); }, this.getDefaultLayoutOptions());\r\n    }\r\n\r\n    protected abstract getDefaultLayoutOptions(): T;\r\n\r\n    protected abstract spread(a: T, b: T): T;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SParentElementImpl, SChildElementImpl } from \"../../base/model/smodel\";\r\nimport { AbstractLayout } from './abstract-layout';\r\nimport { AbstractLayoutOptions, HAlignment } from './layout-options';\r\nimport { BoundsData } from './hidden-bounds-updater';\r\nimport { InternalLayoutContainer, isLayoutableChild } from './model';\r\nimport { StatefulLayouter } from './layout';\r\n\r\nexport interface VBoxLayoutOptions extends AbstractLayoutOptions {\r\n    vGap: number\r\n    hAlign: HAlignment\r\n}\r\n\r\n/**\r\n * Layouts children of a container in vertical (top->bottom) direction.\r\n */\r\n@injectable()\r\nexport class VBoxLayouter extends AbstractLayout<VBoxLayoutOptions> {\r\n\r\n    static KIND = 'vbox';\r\n\r\n    protected getChildrenSize(container: SParentElementImpl & InternalLayoutContainer,\r\n                               containerOptions: VBoxLayoutOptions,\r\n                               layouter: StatefulLayouter) {\r\n        let maxWidth = -1;\r\n        let maxHeight = 0;\r\n        let isFirst = true;\r\n        container.children.forEach(\r\n            child => {\r\n                if (isLayoutableChild(child)) {\r\n                    const bounds = layouter.getBoundsData(child).bounds;\r\n                    if (bounds !== undefined && Dimension.isValid(bounds)) {\r\n                        maxHeight += bounds.height;\r\n                        if (isFirst)\r\n                            isFirst = false;\r\n                        else\r\n                            maxHeight += containerOptions.vGap;\r\n                        maxWidth = Math.max(maxWidth, bounds.width);\r\n                    }\r\n                }\r\n            }\r\n        );\r\n        return {\r\n            width: maxWidth,\r\n            height: maxHeight\r\n        };\r\n    }\r\n\r\n    protected layoutChild(child: SChildElementImpl,\r\n                        boundsData: BoundsData,\r\n                        bounds: Bounds,\r\n                        childOptions: VBoxLayoutOptions,\r\n                        containerOptions: VBoxLayoutOptions,\r\n                        currentOffset: Point,\r\n                        maxWidth: number,\r\n                        maxHeight: number) {\r\n        const dx = this.getDx(childOptions.hAlign, bounds, maxWidth);\r\n        boundsData.bounds = {\r\n            x: containerOptions.paddingLeft + (child as any).bounds.x - bounds.x + dx,\r\n            y: currentOffset.y + (child as any).bounds.y - bounds.y,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n        boundsData.boundsChanged = true;\r\n        return {\r\n            x: currentOffset.x,\r\n            y: currentOffset.y + bounds.height + containerOptions.vGap\r\n        };\r\n    }\r\n\r\n    protected getDefaultLayoutOptions(): VBoxLayoutOptions {\r\n        return {\r\n            resizeContainer: true,\r\n            paddingTop: 5,\r\n            paddingBottom: 5,\r\n            paddingLeft: 5,\r\n            paddingRight: 5,\r\n            paddingFactor: 1,\r\n            vGap: 1,\r\n            hAlign: 'center',\r\n            minWidth: 0,\r\n            minHeight: 0\r\n        };\r\n    }\r\n\r\n    protected spread(a: VBoxLayoutOptions, b: VBoxLayoutOptions): VBoxLayoutOptions {\r\n        return { ...a, ...b };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SParentElementImpl, SChildElementImpl } from \"../../base/model/smodel\";\r\nimport { AbstractLayout } from './abstract-layout';\r\nimport { AbstractLayoutOptions, VAlignment } from './layout-options';\r\nimport { BoundsData } from './hidden-bounds-updater';\r\nimport { InternalLayoutContainer, isLayoutableChild } from './model';\r\nimport { StatefulLayouter } from './layout';\r\n\r\nexport interface HBoxLayoutOptions extends AbstractLayoutOptions {\r\n    hGap: number\r\n    vAlign: VAlignment\r\n}\r\n\r\n/**\r\n * Layouts children of a container in horizontal (left->right) direction.\r\n */\r\n@injectable()\r\nexport class HBoxLayouter extends AbstractLayout<HBoxLayoutOptions> {\r\n\r\n    static KIND = 'hbox';\r\n\r\n    protected getChildrenSize(container: SParentElementImpl & InternalLayoutContainer,\r\n                               containerOptions: HBoxLayoutOptions,\r\n                               layouter: StatefulLayouter) {\r\n        let maxWidth = 0;\r\n        let maxHeight = -1;\r\n        let isFirst = true;\r\n        container.children.forEach(\r\n            child => {\r\n                if (isLayoutableChild(child)) {\r\n                    const bounds = layouter.getBoundsData(child).bounds;\r\n                    if (bounds !== undefined && Dimension.isValid(bounds)) {\r\n                        if (isFirst)\r\n                            isFirst = false;\r\n                        else\r\n                            maxWidth += containerOptions.hGap;\r\n                        maxWidth += bounds.width;\r\n                        maxHeight = Math.max(maxHeight, bounds.height);\r\n                    }\r\n                }\r\n            }\r\n        );\r\n        return {\r\n            width: maxWidth,\r\n            height: maxHeight\r\n        };\r\n    }\r\n\r\n    protected layoutChild(child: SChildElementImpl,\r\n                        boundsData: BoundsData,\r\n                        bounds: Bounds,\r\n                        childOptions: HBoxLayoutOptions,\r\n                        containerOptions: HBoxLayoutOptions,\r\n                        currentOffset: Point,\r\n                        maxWidth: number,\r\n                        maxHeight: number): Point {\r\n        const dy = this.getDy(childOptions.vAlign, bounds, maxHeight);\r\n        boundsData.bounds = {\r\n            x: currentOffset.x + (child as any).bounds.x - bounds.x,\r\n            y: containerOptions.paddingTop + (child as any).bounds.y - bounds.y + dy,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n        boundsData.boundsChanged = true;\r\n        return {\r\n            x: currentOffset.x + bounds.width + containerOptions.hGap,\r\n            y: currentOffset.y\r\n        };\r\n    }\r\n\r\n    protected getDefaultLayoutOptions(): HBoxLayoutOptions {\r\n        return {\r\n            resizeContainer: true,\r\n            paddingTop: 5,\r\n            paddingBottom: 5,\r\n            paddingLeft: 5,\r\n            paddingRight: 5,\r\n            paddingFactor: 1,\r\n            hGap: 1,\r\n            vAlign: 'center',\r\n            minWidth: 0,\r\n            minHeight: 0\r\n        };\r\n    }\r\n\r\n    protected spread(a: HBoxLayoutOptions, b: HBoxLayoutOptions): HBoxLayoutOptions {\r\n        return { ...a, ...b };\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SParentElementImpl, SChildElementImpl } from \"../../base/model/smodel\";\r\nimport { AbstractLayout } from './abstract-layout';\r\nimport { AbstractLayoutOptions, HAlignment, VAlignment } from './layout-options';\r\nimport { BoundsData } from './hidden-bounds-updater';\r\nimport { InternalLayoutContainer, isLayoutableChild } from './model';\r\nimport { StatefulLayouter } from './layout';\r\n\r\nexport interface StackLayoutOptions extends AbstractLayoutOptions {\r\n    paddingFactor: number\r\n    vAlign: VAlignment\r\n    hAlign: HAlignment\r\n}\r\n\r\n@injectable()\r\nexport class StackLayouter extends AbstractLayout<StackLayoutOptions> {\r\n\r\n    static KIND = 'stack';\r\n\r\n    protected getChildrenSize(container: SParentElementImpl & InternalLayoutContainer,\r\n                            options: StackLayoutOptions,\r\n                            layouter: StatefulLayouter) {\r\n        let maxWidth = -1;\r\n        let maxHeight = -1;\r\n        container.children.forEach(\r\n            child => {\r\n                if (isLayoutableChild(child)) {\r\n                    const bounds = layouter.getBoundsData(child).bounds;\r\n                    if (bounds !== undefined && Dimension.isValid(bounds)) {\r\n                        maxWidth = Math.max(maxWidth, bounds.width);\r\n                        maxHeight = Math.max(maxHeight, bounds.height);\r\n                    }\r\n                }\r\n            }\r\n        );\r\n        return {\r\n            width: maxWidth,\r\n            height: maxHeight\r\n        };\r\n    }\r\n\r\n    protected layoutChild(child: SChildElementImpl,\r\n                        boundsData: BoundsData,\r\n                        bounds: Bounds,\r\n                        childOptions: StackLayoutOptions,\r\n                        containerOptions: StackLayoutOptions,\r\n                        currentOffset: Point,\r\n                        maxWidth: number, maxHeight: number): Point {\r\n        const dx = this.getDx(childOptions.hAlign, bounds, maxWidth);\r\n        const dy = this.getDy(childOptions.vAlign, bounds, maxHeight);\r\n        boundsData.bounds = {\r\n            x: containerOptions.paddingLeft + (child as any).bounds.x - bounds.x + dx,\r\n            y: containerOptions.paddingTop + (child as any).bounds.y - bounds.y + dy,\r\n            width: bounds.width,\r\n            height: bounds.height\r\n        };\r\n        boundsData.boundsChanged = true;\r\n        return currentOffset;\r\n    }\r\n\r\n    protected getDefaultLayoutOptions(): StackLayoutOptions {\r\n        return {\r\n            resizeContainer: true,\r\n            paddingTop: 5,\r\n            paddingBottom: 5,\r\n            paddingLeft: 5,\r\n            paddingRight: 5,\r\n            paddingFactor: 1,\r\n            hAlign: 'center',\r\n            vAlign: 'center',\r\n            minWidth: 0,\r\n            minHeight: 0\r\n        };\r\n    }\r\n\r\n    protected spread(a: StackLayoutOptions, b: StackLayoutOptions): StackLayoutOptions {\r\n        return { ...a, ...b };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Dimension } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { IViewArgs, IView, RenderingContext } from '../../base/views/view';\r\nimport { getAbsoluteBounds, InternalBoundsAware } from './model';\r\nimport { SChildElementImpl } from '../../base/model/smodel';\r\n\r\n@injectable()\r\nexport abstract class ShapeView implements IView {\r\n\r\n    /**\r\n     * Check whether the given model element is in the current viewport. Use this method\r\n     * in your `render` implementation to skip rendering in case the element is not visible.\r\n     * This can greatly enhance performance for large models.\r\n     */\r\n    isVisible(model: Readonly<SChildElementImpl & InternalBoundsAware>, context: RenderingContext): boolean {\r\n        if (context.targetKind === 'hidden') {\r\n            // Don't hide any element for hidden rendering\r\n            return true;\r\n        }\r\n        if (!Dimension.isValid(model.bounds)) {\r\n            // We should hide only if we know the element's bounds\r\n            return true;\r\n        }\r\n        const ab = getAbsoluteBounds(model);\r\n        const canvasBounds = model.root.canvasBounds;\r\n        return ab.x <= canvasBounds.width\r\n            && ab.x + ab.width >= 0\r\n            && ab.y <= canvasBounds.height\r\n            && ab.y + ab.height >= 0;\r\n    }\r\n\r\n    abstract render(model: Readonly<SChildElementImpl>, context: RenderingContext, args?: IViewArgs): VNode | undefined;\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, interfaces, multiInject, optional } from 'inversify';\r\nimport { Action } from 'sprotty-protocol/lib/actions';\r\nimport { InstanceRegistry } from '../../utils/registry';\r\nimport { TYPES } from '../../base/types';\r\nimport { SButtonImpl } from './model';\r\nimport { isInjectable } from '../../utils/inversify';\r\n\r\nexport interface IButtonHandler {\r\n    buttonPressed(button: SButtonImpl): (Action | Promise<Action>)[]\r\n}\r\n\r\nexport interface IButtonHandlerRegistration {\r\n    TYPE: string\r\n    factory: () => IButtonHandler\r\n}\r\n\r\n@injectable()\r\nexport class ButtonHandlerRegistry extends InstanceRegistry<IButtonHandler> {\r\n\r\n    constructor(\r\n        @multiInject(TYPES.IButtonHandlerRegistration)@optional() buttonHandlerRegistrations: IButtonHandlerRegistration[]) {\r\n        super();\r\n        buttonHandlerRegistrations.forEach(factory => this.register(factory.TYPE, factory.factory()));\r\n    }\r\n}\r\n\r\n/**\r\n * Utility function to register a button handler for an button type.\r\n */\r\nexport function configureButtonHandler(context: { bind: interfaces.Bind, isBound: interfaces.IsBound },\r\n    type: string, constr: interfaces.ServiceIdentifier<IButtonHandler>): void {\r\n    if (typeof constr === 'function') {\r\n        if (!isInjectable(constr)) {\r\n            throw new Error(`Button handlers should be @injectable: ${constr.name}`);\r\n        }\r\n        if (!context.isBound(constr)) {\r\n            context.bind(constr).toSelf();\r\n        }\r\n    }\r\n    context.bind(TYPES.IButtonHandlerRegistration).toDynamicValue(ctx => ({\r\n        TYPE: type,\r\n        factory: () => ctx.container.get(constr)\r\n    }));\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const fadeFeature = Symbol('fadeFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link fadeFeature}.\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Fadeable {\r\n    opacity: number\r\n}\r\n\r\nexport function isFadeable(element: SModelElementImpl): element is SModelElementImpl & Fadeable {\r\n    return element.hasFeature(fadeFeature) && (element as any)['opacity'] !== undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SShapeElement } from 'sprotty-protocol';\r\nimport { boundsFeature, layoutableChildFeature, SShapeElementImpl } from '../bounds/model';\r\nimport { fadeFeature } from '../fade/model';\r\n\r\n/**\r\n * @deprecated Use SButton from `sprotty-protocol` instead.\r\n */\r\nexport interface SButtonSchema extends SShapeElement {\r\n    pressed: boolean\r\n    enabled: boolean\r\n}\r\n\r\nexport class SButtonImpl extends SShapeElementImpl {\r\n    static readonly DEFAULT_FEATURES = [boundsFeature, layoutableChildFeature, fadeFeature];\r\n\r\n    enabled = true;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const nameFeature = Symbol('nameableFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link nameableFeature}.\r\n */\r\nexport interface Nameable {\r\n    name: string\r\n}\r\n\r\nexport function isNameable(element: SModelElementImpl): element is SModelElementImpl & Nameable {\r\n    return element.hasFeature(nameFeature);\r\n}\r\n\r\nexport function name(element: SModelElementImpl): string | undefined {\r\n    if (isNameable(element)) {\r\n        return element.name;\r\n    } else {\r\n        return undefined;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, multiInject, optional } from \"inversify\";\r\nimport { CenterAction, SelectAction, SelectAllAction } from \"sprotty-protocol/lib/actions\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { LabeledAction } from \"../../base/actions/action\";\r\nimport { SModelRootImpl } from \"../../base/model/smodel\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { toArray } from \"../../utils/iterable\";\r\nimport { ILogger } from \"../../utils/logging\";\r\nimport { isNameable, name } from \"../nameable/model\";\r\n\r\nexport interface ICommandPaletteActionProvider {\r\n    getActions(root: Readonly<SModelRootImpl>, text: string, lastMousePosition?: Point, index?: number): Promise<LabeledAction[]>;\r\n}\r\n\r\n@injectable()\r\nexport class CommandPaletteActionProviderRegistry implements ICommandPaletteActionProvider {\r\n\r\n    constructor(@multiInject(TYPES.ICommandPaletteActionProvider) @optional() protected actionProviders: ICommandPaletteActionProvider[] = []) {\r\n    }\r\n\r\n    getActions(root: Readonly<SModelRootImpl>, text: string, lastMousePosition?: Point, index?: number) {\r\n        const actionLists = this.actionProviders.map(provider => provider.getActions(root, text, lastMousePosition, index));\r\n        return Promise.all(actionLists).then(p => p.reduce((acc, promise) => promise !== undefined ? acc.concat(promise) : acc));\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class RevealNamedElementActionProvider implements ICommandPaletteActionProvider {\r\n\r\n    constructor(@inject(TYPES.ILogger) protected logger: ILogger) { }\r\n\r\n    getActions(root: Readonly<SModelRootImpl>, text: string, lastMousePosition?: Point, index?: number) {\r\n        if (index !== undefined && index % 2 === 0)\r\n            return Promise.resolve(this.createSelectActions(root));\r\n        else\r\n            return Promise.resolve([new LabeledAction(\"Select all\", [SelectAllAction.create()])]);\r\n    }\r\n\r\n    createSelectActions(modelRoot: SModelRootImpl): LabeledAction[] {\r\n        const nameables = toArray(modelRoot.index.all().filter(element => isNameable(element)));\r\n        return nameables.map(nameable => new LabeledAction(`Reveal ${name(nameable)}`,\r\n            [SelectAction.create({ selectedElementsIDs: [nameable.id] }), CenterAction.create([nameable.id])], 'eye'));\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nexport const ACTION_ITEM = 'action-item';\r\nexport const ANIMATION_SPIN = 'animation-spin';\r\n\r\nexport function codiconCSSString(codiconId: string, actionItem = false, animationSpin = false, additionalCSS: string[] = []): string {\r\n    return codiconCSSClasses(codiconId, actionItem, animationSpin, additionalCSS).join(' ');\r\n}\r\n\r\nexport function codiconCSSClasses(codiconId: string, actionItem = false, animationSpin = false, additionalCSS: string[] = []): string[] {\r\n    const cssClassArray = ['codicon', `codicon-${codiconId}`];\r\n    if (actionItem) {\r\n        cssClassArray.push(ACTION_ITEM);\r\n    }\r\n    if (animationSpin) {\r\n        cssClassArray.push(ANIMATION_SPIN);\r\n    }\r\n    if (additionalCSS.length > 0) {\r\n        cssClassArray.push(...additionalCSS);\r\n    }\r\n    return cssClassArray;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { isMac } from './browser';\r\n\r\n/**\r\n * Returns whether the keyboard event matches the keystroke described by the given\r\n * code and modifiers. The code must comply to the format of the `code` property\r\n * of KeyboardEvent, but in contrast to that property, the actual keyboard layout is\r\n * considered by this function if possible.\r\n */\r\nexport function matchesKeystroke(event: KeyboardEvent, code: KeyCode, ...modifiers: KeyboardModifier[]): boolean {\r\n    if (getActualCode(event) !== code)\r\n        return false;\r\n    if (isMac()) {\r\n        if (event.ctrlKey !== (modifiers.findIndex(m => m === 'ctrl') >= 0))\r\n            return false;\r\n        if (event.metaKey !== (modifiers.findIndex(m => m === 'meta' || m === 'ctrlCmd') >= 0))\r\n            return false;\r\n    } else {\r\n        if (event.ctrlKey !== (modifiers.findIndex(m => m === 'ctrl' || m === 'ctrlCmd') >= 0))\r\n            return false;\r\n        if (event.metaKey !== (modifiers.findIndex(m => m === 'meta') >= 0))\r\n            return false;\r\n    }\r\n    if (event.altKey !== (modifiers.findIndex(m => m === 'alt') >= 0))\r\n        return false;\r\n    if (event.shiftKey !== (modifiers.findIndex(m => m === 'shift') >= 0))\r\n        return false;\r\n    return true;\r\n}\r\n\r\nexport type KeyboardModifier = 'ctrl' | 'meta' | 'ctrlCmd' | 'alt' | 'shift';\r\n\r\nexport type KeyCode =\r\n    'AltLeft'|'AltRight'|'ArrowDown'|'ArrowLeft'|'ArrowRight'|'ArrowUp'|'Backslash'|'Backspace'|'Backquote'\r\n    |'BracketLeft'|'BracketRight'|'CapsLock'|'Comma'|'ContextMenu'|'ControlLeft'|'ControlRight'|'Convert'|'Delete'\r\n    |'Digit0'|'Digit1'|'Digit2'|'Digit3'|'Digit4'|'Digit5'|'Digit6'|'Digit7'|'Digit8'|'Digit9'\r\n    |'F1'|'F2'|'F3'|'F4'|'F5'|'F6'|'F7'|'F8'|'F9'|'F10'|'F11'|'F12'|'F13'|'F14'|'F15'|'F16'|'F17'|'F18'|'F19'|'F20'|'F21'|'F22'|'F23'|'F24'\r\n    |'End'|'Enter'|'Equal'|'Escape'|'Home'|'Insert'|'IntlBackslash'|'IntlRo'|'IntlYen'|'KanaMode'\r\n    |'KeyA'|'KeyB'|'KeyC'|'KeyD'|'KeyE'|'KeyF'|'KeyG'|'KeyH'|'KeyI'|'KeyJ'|'KeyK'|'KeyL'|'KeyM'\r\n    |'KeyN'|'KeyO'|'KeyP'|'KeyQ'|'KeyR'|'KeyS'|'KeyT'|'KeyU'|'KeyV'|'KeyW'|'KeyX'|'KeyY'|'KeyZ'\r\n    |'MetaLeft'|'MetaRight'|'Minus'|'NonConvert'|'NumLock'\r\n    |'Numpad0'|'Numpad1'|'Numpad2'|'Numpad3'|'Numpad4'|'Numpad5'|'Numpad6'|'Numpad7'|'Numpad8'|'Numpad9'\r\n    |'NumpadAdd'|'NumpadComma'|'NumpadDecimal'|'NumpadDivide'|'NumpadEnter'|'NumpadEqual'|'NumpadMultiply'\r\n    |'NumpadSeparator'|'NumpadSubtract'|'OSLeft'|'OSRight'|'PageDown'|'PageUp'|'Pause'|'Period'|'PrintScreen'\r\n    |'Quote'|'ScrollLock'|'Semicolon'|'ShiftLeft'|'ShiftRight'|'Slash'|'Space'|'Tab';\r\n\r\n/**\r\n * Determines a key code from the given event. This is necessary because the `code` property of\r\n * a KeyboardEvent does not consider keyboard layouts.\r\n */\r\nexport function getActualCode(event: KeyboardEvent): KeyCode {\r\n    if (event.keyCode) {\r\n        const result = STRING_CODE[event.keyCode];\r\n        if (result !== undefined)\r\n            return result;\r\n    }\r\n    return event.code as KeyCode;\r\n}\r\n\r\nconst STRING_CODE: { [keyCode: number]: KeyCode } = new Array(256);\r\n\r\n(() => {\r\n    function addKeyCode(stringCode: KeyCode, numericCode: number): void {\r\n        if (STRING_CODE[numericCode] === undefined)\r\n            STRING_CODE[numericCode] = stringCode;\r\n    }\r\n\r\n    addKeyCode('Pause', 3);\r\n    addKeyCode('Backspace', 8);\r\n    addKeyCode('Tab', 9);\r\n    addKeyCode('Enter', 13);\r\n    addKeyCode('ShiftLeft', 16);\r\n    addKeyCode('ShiftRight', 16);\r\n    addKeyCode('ControlLeft', 17);\r\n    addKeyCode('ControlRight', 17);\r\n    addKeyCode('AltLeft', 18);\r\n    addKeyCode('AltRight', 18);\r\n    addKeyCode('CapsLock', 20);\r\n    addKeyCode('Escape', 27);\r\n    addKeyCode('Space', 32);\r\n    addKeyCode('PageUp', 33);\r\n    addKeyCode('PageDown', 34);\r\n    addKeyCode('End', 35);\r\n    addKeyCode('Home', 36);\r\n    addKeyCode('ArrowLeft', 37);\r\n    addKeyCode('ArrowUp', 38);\r\n    addKeyCode('ArrowRight', 39);\r\n    addKeyCode('ArrowDown', 40);\r\n    addKeyCode('Insert', 45);\r\n    addKeyCode('Delete', 46);\r\n\r\n    addKeyCode('Digit1', 49);\r\n    addKeyCode('Digit2', 50);\r\n    addKeyCode('Digit3', 51);\r\n    addKeyCode('Digit4', 52);\r\n    addKeyCode('Digit5', 53);\r\n    addKeyCode('Digit6', 54);\r\n    addKeyCode('Digit7', 55);\r\n    addKeyCode('Digit8', 56);\r\n    addKeyCode('Digit9', 57);\r\n    addKeyCode('Digit0', 48);\r\n\r\n    addKeyCode('KeyA', 65);\r\n    addKeyCode('KeyB', 66);\r\n    addKeyCode('KeyC', 67);\r\n    addKeyCode('KeyD', 68);\r\n    addKeyCode('KeyE', 69);\r\n    addKeyCode('KeyF', 70);\r\n    addKeyCode('KeyG', 71);\r\n    addKeyCode('KeyH', 72);\r\n    addKeyCode('KeyI', 73);\r\n    addKeyCode('KeyJ', 74);\r\n    addKeyCode('KeyK', 75);\r\n    addKeyCode('KeyL', 76);\r\n    addKeyCode('KeyM', 77);\r\n    addKeyCode('KeyN', 78);\r\n    addKeyCode('KeyO', 79);\r\n    addKeyCode('KeyP', 80);\r\n    addKeyCode('KeyQ', 81);\r\n    addKeyCode('KeyR', 82);\r\n    addKeyCode('KeyS', 83);\r\n    addKeyCode('KeyT', 84);\r\n    addKeyCode('KeyU', 85);\r\n    addKeyCode('KeyV', 86);\r\n    addKeyCode('KeyW', 87);\r\n    addKeyCode('KeyX', 88);\r\n    addKeyCode('KeyY', 89);\r\n    addKeyCode('KeyZ', 90);\r\n\r\n    addKeyCode('OSLeft', 91);\r\n    addKeyCode('MetaLeft', 91);\r\n    addKeyCode('OSRight', 92);\r\n    addKeyCode('MetaRight', 92);\r\n    addKeyCode('ContextMenu', 93);\r\n\r\n    addKeyCode('Numpad0', 96);\r\n    addKeyCode('Numpad1', 97);\r\n    addKeyCode('Numpad2', 98);\r\n    addKeyCode('Numpad3', 99);\r\n    addKeyCode('Numpad4', 100);\r\n    addKeyCode('Numpad5', 101);\r\n    addKeyCode('Numpad6', 102);\r\n    addKeyCode('Numpad7', 103);\r\n    addKeyCode('Numpad8', 104);\r\n    addKeyCode('Numpad9', 105);\r\n    addKeyCode('NumpadMultiply', 106);\r\n    addKeyCode('NumpadAdd', 107);\r\n    addKeyCode('NumpadSeparator', 108);\r\n    addKeyCode('NumpadSubtract', 109);\r\n    addKeyCode('NumpadDecimal', 110);\r\n    addKeyCode('NumpadDivide', 111);\r\n\r\n    addKeyCode('F1', 112);\r\n    addKeyCode('F2', 113);\r\n    addKeyCode('F3', 114);\r\n    addKeyCode('F4', 115);\r\n    addKeyCode('F5', 116);\r\n    addKeyCode('F6', 117);\r\n    addKeyCode('F7', 118);\r\n    addKeyCode('F8', 119);\r\n    addKeyCode('F9', 120);\r\n    addKeyCode('F10', 121);\r\n    addKeyCode('F11', 122);\r\n    addKeyCode('F12', 123);\r\n    addKeyCode('F13', 124);\r\n    addKeyCode('F14', 125);\r\n    addKeyCode('F15', 126);\r\n    addKeyCode('F16', 127);\r\n    addKeyCode('F17', 128);\r\n    addKeyCode('F18', 129);\r\n    addKeyCode('F19', 130);\r\n    addKeyCode('F20', 131);\r\n    addKeyCode('F21', 132);\r\n    addKeyCode('F22', 133);\r\n    addKeyCode('F23', 134);\r\n    addKeyCode('F24', 135);\r\n\r\n    addKeyCode('NumLock', 144);\r\n    addKeyCode('ScrollLock', 145);\r\n\r\n    addKeyCode('Semicolon', 186);\r\n    addKeyCode('Equal', 187);\r\n    addKeyCode('Comma', 188);\r\n    addKeyCode('Minus', 189);\r\n    addKeyCode('Period', 190);\r\n    addKeyCode('Slash', 191);\r\n    addKeyCode('Backquote', 192);\r\n    addKeyCode('IntlRo', 193);\r\n    addKeyCode('BracketLeft', 219);\r\n    addKeyCode('Backslash', 220);\r\n    addKeyCode('BracketRight', 221);\r\n    addKeyCode('Quote', 222);\r\n    addKeyCode('IntlYen', 255);\r\n})();\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const selectFeature = Symbol('selectFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link selectFeature}.\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Selectable {\r\n    selected: boolean\r\n}\r\n\r\nexport function isSelectable(element: SModelElementImpl): element is SModelElementImpl & Selectable {\r\n    return element.hasFeature(selectFeature);\r\n}\r\n\r\nexport function isSelected(element: SModelElementImpl | undefined): element is SModelElementImpl & Selectable {\r\n    return element !== undefined && isSelectable(element) && element.selected;\r\n}\r\n", "/**\n * Copyright (c) 2016 Denys Krasnoshchok\n * \n * Homepage: https://smartscheduling.com/en/documentation/autocomplete\n * Source: https://github.com/kraaden/autocomplete\n * \n * MIT License\n */\n\nexport const enum EventTrigger {\n    Keyboard = 0,\n    Focus = 1,\n    Mouse = 2,\n    /**\n     * Fetch is triggered manually by calling `fetch` function returned in `AutocompleteResult`\n     */\n    Manual = 3\n}\n\n/**\n * Enum for controlling form submission when `ENTER` key is pressed in the autocomplete input field.\n */\nexport const enum PreventSubmit {\n    Never = 0,\n    Always = 1,\n    /**\n     * Form submission is prevented only when an item is selected from the autocomplete list.\n     */\n    OnSelect = 2\n}\n\nexport interface AutocompleteItem {\n    label?: string;\n    group?: string;\n}\n\nexport interface AutocompleteEvent<T extends Event> {\n    /**\n     * Native event object passed by browser to the event handler\n     */\n    event: T;\n\n    /**\n     * Fetch data and display autocomplete\n     */\n    fetch: () => void;\n}\n\nexport interface AutocompleteSettings<T extends AutocompleteItem> {\n    /**\n     * Autocomplete will be attached to this element.\n     */\n    input: HTMLInputElement | HTMLTextAreaElement;\n\n    /**\n     * Provide your own container for the widget.\n     * If not specified, a new DIV element will be created.\n     */\n    container?: HTMLDivElement;\n\n    /**\n     * This method allows you to override the default rendering function for items.\n     * It must return a DIV element or undefined to skip rendering.\n     */\n    render?: (item: T, currentValue: string, index: number) => HTMLDivElement | undefined;\n\n    /**\n     * This method allows you to override the default rendering function for item groups.\n     * It must return a DIV element or undefined to skip rendering.\n     */\n    renderGroup?: (name: string, currentValue: string) => HTMLDivElement | undefined;\n\n    /**\n     * If specified, the autocomplete DOM element will have this class assigned to it.\n     */\n    className?: string;\n\n    /**\n     * Specify the minimum text length required to show autocomplete.\n     */\n    minLength?: number;\n\n    /**\n     * The message that will be showed when there are no suggestions that match the entered value.\n     */\n    emptyMsg?: string;\n\n    /**\n     * This method will be called when user choose an item in autocomplete. The selected item will be passed as the first parameter.\n     */\n    onSelect: (item: T, input: HTMLInputElement | HTMLTextAreaElement) => void;\n\n    /**\n     * Show autocomplete on focus event. Focus event will ignore the `minLength` property and will always call `fetch`.\n     */\n    showOnFocus?: boolean;\n\n    /**\n     * This method will be called to prepare suggestions and then pass them to autocomplete.\n     * @param {string} text - text in the input field\n     * @param {(items: T[] | false) => void} update - a callback function that must be called after suggestions are prepared\n     * @param {EventTrigger} trigger - type of the event that triggered the fetch\n     * @param {number} cursorPos - position of the cursor in the input field\n     */\n    fetch: (text: string, update: (items: T[] | false) => void, trigger: EventTrigger, cursorPos: number) => void;\n\n    /**\n     * Enforces that the fetch function will only be called once within the specified time frame (in milliseconds) and\n     * delays execution. This prevents flooding your server with AJAX requests.\n     */\n    debounceWaitMs?: number;\n\n    /**\n     * Callback for additional autocomplete customization\n     * @param {HTMLInputElement | HTMLTextAreaElement} input - input box associated with autocomplete\n     * @param {ClientRect | DOMRect} inputRect - size of the input box and its position relative to the viewport\n     * @param {HTMLDivElement} container - container with suggestions\n     * @param {number} maxHeight - max height that can be used by autocomplete\n     */\n    customize?: (input: HTMLInputElement | HTMLTextAreaElement, inputRect: ClientRect | DOMRect, container: HTMLDivElement, maxHeight: number) => void;\n\n    /**\n     * Controls form submission when the ENTER key is pressed in a input field.\n     */\n    preventSubmit?: PreventSubmit;\n\n    /**\n     * Prevents the first item in the list from being selected automatically. This option allows you\n     * to submit a custom text by pressing ENTER even when autocomplete is displayed.\n     */\n    disableAutoSelect?: boolean;\n\n    /**\n     * Provide your keyup event handler to display autocomplete when a key is pressed that doesn't modify the content. You can also perform some additional actions.\n     */\n    keyup?: (e: AutocompleteEvent<KeyboardEvent>) => void;\n\n    /**\n     * Allows to display autocomplete on mouse clicks or perform some additional actions.\n     */\n    click?: (e: AutocompleteEvent<MouseEvent>) => void;\n}\n\nexport interface AutocompleteResult {\n    /**\n     * Remove event handlers, DOM elements and ARIA/accessibility attributes created by the widget.\n     */\n    destroy: () => void;\n\n    /**\n     * This function allows to manually start data fetching and display autocomplete. Note that\n     * it does not automatically place focus on the input field, so you may need to do so manually\n     * in certain situations.\n     */\n    fetch: () => void;\n}\n\nexport default function autocomplete<T extends AutocompleteItem>(settings: AutocompleteSettings<T>): AutocompleteResult {\n\n    // just an alias to minimize JS file size\n    const doc = document;\n\n    const container: HTMLDivElement = settings.container || doc.createElement('div');\n    const preventSubmit: PreventSubmit = settings.preventSubmit || PreventSubmit.Never;\n\n    container.id = container.id || 'autocomplete-' + uid();\n    const containerStyle = container.style;\n    const debounceWaitMs = settings.debounceWaitMs || 0;\n    const disableAutoSelect = settings.disableAutoSelect || false;\n    const customContainerParent = container.parentElement;\n\n    let items: T[] = [];\n    let inputValue = '';\n    let minLen = 2;\n    const showOnFocus = settings.showOnFocus;\n    let selected: T | undefined;\n    let fetchCounter = 0;\n    let debounceTimer: number | undefined;\n    let destroyed = false;\n\n    // Fixes #104: autocomplete selection is broken on Firefox for Android\n    let suppressAutocomplete = false;\n\n    if (settings.minLength !== undefined) {\n        minLen = settings.minLength;\n    }\n\n    if (!settings.input) {\n        throw new Error('input undefined');\n    }\n\n    const input: HTMLInputElement | HTMLTextAreaElement = settings.input;\n\n    container.className = 'autocomplete ' + (settings.className || '');\n    container.setAttribute('role', 'listbox');\n\n    input.setAttribute('role', 'combobox');\n    input.setAttribute('aria-expanded', 'false');\n    input.setAttribute('aria-autocomplete', 'list');\n    input.setAttribute('aria-controls', container.id);\n    input.setAttribute('aria-owns', container.id);\n    input.setAttribute('aria-activedescendant', '');\n    input.setAttribute('aria-haspopup', 'listbox');\n\n    // IOS implementation for fixed positioning has many bugs, so we will use absolute positioning\n    containerStyle.position = 'absolute';\n\n    /**\n     * Generate a very complex textual ID that greatly reduces the chance of a collision with another ID or text.\n     */\n    function uid(): string {\n        return Date.now().toString(36) + Math.random().toString(36).substring(2);\n    }\n\n    /**\n     * Detach the container from DOM\n     */\n    function detach() {\n        const parent = container.parentNode;\n        if (parent) {\n            parent.removeChild(container);\n        }\n    }\n\n    /**\n     * Clear debouncing timer if assigned\n     */\n    function clearDebounceTimer() {\n        if (debounceTimer) {\n            window.clearTimeout(debounceTimer);\n        }\n    }\n\n    /**\n     * Attach the container to DOM\n     */\n    function attach() {\n        if (!container.parentNode) {\n            (customContainerParent || doc.body).appendChild(container);\n        }\n    }\n\n    /**\n     * Check if container for autocomplete is displayed\n     */\n    function containerDisplayed(): boolean {\n        return !!container.parentNode;\n    }\n\n    /**\n     * Clear autocomplete state and hide container\n     */\n    function clear() {\n        // prevent the update call if there are pending AJAX requests\n        fetchCounter++;\n\n        items = [];\n        inputValue = '';\n        selected = undefined;\n        input.setAttribute('aria-activedescendant', '');\n        input.setAttribute('aria-expanded', 'false');\n        detach();\n    }\n\n    /**\n     * Update autocomplete position\n     */\n    function updatePosition() {\n        if (!containerDisplayed()) {\n            return;\n        }\n\n        input.setAttribute('aria-expanded', 'true');\n\n        containerStyle.height = 'auto';\n        containerStyle.width = input.offsetWidth + 'px';\n\n        let maxHeight = 0;\n        let inputRect: DOMRect | undefined;\n\n        function calc() {\n            const docEl = doc.documentElement as HTMLElement;\n            const clientTop = docEl.clientTop || doc.body.clientTop || 0;\n            const clientLeft = docEl.clientLeft || doc.body.clientLeft || 0;\n            const scrollTop = window.pageYOffset || docEl.scrollTop;\n            const scrollLeft = window.pageXOffset || docEl.scrollLeft;\n\n            inputRect = input.getBoundingClientRect();\n\n            const top = inputRect.top + input.offsetHeight + scrollTop - clientTop;\n            const left = inputRect.left + scrollLeft - clientLeft;\n\n            containerStyle.top = top + 'px';\n            containerStyle.left = left + 'px';\n\n            maxHeight = window.innerHeight - (inputRect.top + input.offsetHeight);\n\n            if (maxHeight < 0) {\n                maxHeight = 0;\n            }\n\n            containerStyle.top = top + 'px';\n            containerStyle.bottom = '';\n            containerStyle.left = left + 'px';\n            containerStyle.maxHeight = maxHeight + 'px';\n        }\n\n        // the calc method must be called twice, otherwise the calculation may be wrong on resize event (chrome browser)\n        calc();\n        calc();\n\n        if (settings.customize && inputRect) {\n            settings.customize(input, inputRect, container, maxHeight);\n        }\n    }\n\n    /**\n     * Redraw the autocomplete div element with suggestions\n     */\n    function update() {\n\n        container.textContent = '';\n        input.setAttribute('aria-activedescendant', '');\n\n        // function for rendering autocomplete suggestions\n        let render = function (item: T, _: string, __: number): HTMLDivElement | undefined {\n            const itemElement = doc.createElement('div');\n            itemElement.textContent = item.label || '';\n            return itemElement;\n        };\n        if (settings.render) {\n            render = settings.render;\n        }\n\n        // function to render autocomplete groups\n        let renderGroup = function (groupName: string, _: string): HTMLDivElement | undefined {\n            const groupDiv = doc.createElement('div');\n            groupDiv.textContent = groupName;\n            return groupDiv;\n        };\n        if (settings.renderGroup) {\n            renderGroup = settings.renderGroup;\n        }\n\n        const fragment = doc.createDocumentFragment();\n        let prevGroup = uid();\n\n        items.forEach(function (item: T, index: number): void {\n            if (item.group && item.group !== prevGroup) {\n                prevGroup = item.group;\n                const groupDiv = renderGroup(item.group, inputValue);\n                if (groupDiv) {\n                    groupDiv.className += ' group';\n                    fragment.appendChild(groupDiv);\n                }\n            }\n            const div = render(item, inputValue, index);\n            if (div) {\n                div.id = `${container.id}_${index}`;\n                div.setAttribute('role', 'option');\n                div.addEventListener('click', function (ev: MouseEvent): void {\n                    suppressAutocomplete = true;\n                    try {\n                        settings.onSelect(item, input);\n                    } finally {\n                        suppressAutocomplete = false;\n                    }\n                    clear();\n                    ev.preventDefault();\n                    ev.stopPropagation();\n                });\n                if (item === selected) {\n                    div.className += ' selected';\n                    div.setAttribute('aria-selected', 'true');\n                    input.setAttribute('aria-activedescendant', div.id);\n                }\n                fragment.appendChild(div);\n            }\n        });\n        container.appendChild(fragment);\n        if (items.length < 1) {\n            if (settings.emptyMsg) {\n                const empty = doc.createElement('div');\n                empty.id = `${container.id}_${uid()}`;\n                empty.className = 'empty';\n                empty.textContent = settings.emptyMsg;\n                container.appendChild(empty);\n                input.setAttribute('aria-activedescendant', empty.id);\n            } else {\n                clear();\n                return;\n            }\n        }\n\n        attach();\n        updatePosition();\n\n        updateScroll();\n    }\n\n    function updateIfDisplayed() {\n        if (containerDisplayed()) {\n            update();\n        }\n    }\n\n    function resizeEventHandler() {\n        updateIfDisplayed();\n    }\n\n    function scrollEventHandler(e: Event) {\n        if (e.target !== container) {\n            updateIfDisplayed();\n        } else {\n            e.preventDefault();\n        }\n    }\n\n    function inputEventHandler() {\n        if (!suppressAutocomplete) {\n            fetch(EventTrigger.Keyboard);\n        }\n    }\n\n    /**\n     * Automatically move scroll bar if selected item is not visible\n     */\n    function updateScroll() {\n        const elements = container.getElementsByClassName('selected');\n        if (elements.length > 0) {\n            let element = elements[0] as HTMLDivElement;\n\n            // make group visible\n            const previous = element.previousElementSibling as HTMLDivElement;\n            if (previous && previous.className.indexOf('group') !== -1 && !previous.previousElementSibling) {\n                element = previous;\n            }\n\n            if (element.offsetTop < container.scrollTop) {\n                container.scrollTop = element.offsetTop;\n            } else {\n                const selectBottom = element.offsetTop + element.offsetHeight;\n                const containerBottom = container.scrollTop + container.offsetHeight;\n                if (selectBottom > containerBottom) {\n                    container.scrollTop += selectBottom - containerBottom;\n                }\n            }\n        }\n    }\n\n    function selectPreviousSuggestion() {\n        const index = items.indexOf(selected!);\n\n        selected = index === -1\n            ? undefined\n            : items[(index + items.length - 1) % items.length];\n\n        updateSelectedSuggestion(index);\n    }\n\n    function selectNextSuggestion() {\n        const index = items.indexOf(selected!);\n\n        selected = items.length < 1\n            ? undefined\n            : index === -1\n                ? items[0]\n                : items[(index + 1) % items.length];\n\n        updateSelectedSuggestion(index);\n    }\n\n    function updateSelectedSuggestion(index: number) {\n        if (items.length > 0) {\n            unselectSuggestion(index);\n            selectSuggestion(items.indexOf(selected!));\n            updateScroll();\n        }\n    }\n\n    function selectSuggestion(index: number) {\n        var element = doc.getElementById(container.id + \"_\" + index);\n        if (element) {\n            element.classList.add('selected');\n            element.setAttribute('aria-selected', 'true');\n            input.setAttribute('aria-activedescendant', element.id);\n        }\n    }\n\n    function unselectSuggestion(index: number) {\n        var element = doc.getElementById(container.id + \"_\" + index);\n        if (element) {\n            element.classList.remove('selected');\n            element.removeAttribute('aria-selected');\n            input.removeAttribute('aria-activedescendant');\n        }\n    }\n\n    function handleArrowAndEscapeKeys(ev: KeyboardEvent, key: 'ArrowUp' | 'ArrowDown' | 'Escape') {\n        const containerIsDisplayed = containerDisplayed();\n\n        if (key === 'Escape') {\n            clear();\n        } else {\n            if (!containerIsDisplayed || items.length < 1) {\n                return;\n            }\n            key === 'ArrowUp'\n                ? selectPreviousSuggestion()\n                : selectNextSuggestion();\n        }\n\n        ev.preventDefault();\n\n        if (containerIsDisplayed) {\n            ev.stopPropagation();\n        }\n    }\n\n    function handleEnterKey(ev: KeyboardEvent) {\n        if (selected) {\n            if (preventSubmit === PreventSubmit.OnSelect) {\n                ev.preventDefault();\n            }\n            suppressAutocomplete = true;\n            try {\n                settings.onSelect(selected, input);\n            } finally {\n                suppressAutocomplete = false;\n            }\n            clear();\n        }\n\n        if (preventSubmit === PreventSubmit.Always) {\n            ev.preventDefault();\n        }\n    }\n\n    function keydownEventHandler(ev: KeyboardEvent) {\n        const key = ev.key;\n\n        switch (key) {\n            case 'ArrowUp':\n            case 'ArrowDown':\n            case 'Escape':\n                handleArrowAndEscapeKeys(ev, key);\n                break;\n            case 'Enter':\n                handleEnterKey(ev);\n                break;\n            default:\n                break;\n        }\n    }\n\n    function focusEventHandler() {\n        if (showOnFocus) {\n            fetch(EventTrigger.Focus);\n        }\n    }\n\n    function fetch(trigger: EventTrigger) {\n        if (input.value.length >= minLen || trigger === EventTrigger.Focus) {\n            clearDebounceTimer();\n            debounceTimer = window.setTimeout(\n                () => startFetch(input.value, trigger, input.selectionStart || 0),\n                trigger === EventTrigger.Keyboard || trigger === EventTrigger.Mouse ? debounceWaitMs : 0);\n        } else {\n            clear();\n        }\n    }\n\n    function startFetch(inputText: string, trigger: EventTrigger, cursorPos: number) {\n        if (destroyed) return;\n        const savedFetchCounter = ++fetchCounter;\n        settings.fetch(inputText, function (elements: T[] | false): void {\n            if (fetchCounter === savedFetchCounter && elements) {\n                items = elements;\n                inputValue = inputText;\n                selected = (items.length < 1 || disableAutoSelect) ? undefined : items[0];\n                update();\n            }\n        }, trigger, cursorPos);\n    }\n\n    function keyupEventHandler(e: KeyboardEvent) {\n        if (settings.keyup) {\n            settings.keyup({\n                event: e,\n                fetch: () => fetch(EventTrigger.Keyboard)\n            });\n            return;\n        }\n\n        if (!containerDisplayed() && e.key === 'ArrowDown') {\n            fetch(EventTrigger.Keyboard);\n        }\n    }\n\n    function clickEventHandler(e: MouseEvent) {\n        settings.click && settings.click({\n            event: e,\n            fetch: () => fetch(EventTrigger.Mouse)\n        });\n    }\n\n    function blurEventHandler() {\n        // when an item is selected by mouse click, the blur event will be initiated before the click event and remove DOM elements,\n        // so that the click event will never be triggered. In order to avoid this issue, DOM removal should be delayed.\n        setTimeout(() => {\n            if (doc.activeElement !== input) {\n                clear();\n            }\n        }, 200);\n    }\n\n    function manualFetch() {\n        startFetch(input.value, EventTrigger.Manual, input.selectionStart || 0);\n    }\n\n    /**\n     * Fixes #26: on long clicks focus will be lost and onSelect method will not be called\n     */\n    container.addEventListener('mousedown', function (evt: Event) {\n        evt.stopPropagation();\n        evt.preventDefault();\n    });\n\n    /**\n     * Fixes #30: autocomplete closes when scrollbar is clicked in IE\n     * See: https://stackoverflow.com/a/9210267/13172349\n     */\n    container.addEventListener('focus', () => input.focus());\n\n    // If the custom autocomplete container is already appended to the DOM during widget initialization, detach it.\n    detach();\n\n    /**\n     * This function will remove DOM elements and clear event handlers\n     */\n    function destroy() {\n        input.removeEventListener('focus', focusEventHandler);\n        input.removeEventListener('keyup', keyupEventHandler as EventListenerOrEventListenerObject)\n        input.removeEventListener('click', clickEventHandler as EventListenerOrEventListenerObject)\n        input.removeEventListener('keydown', keydownEventHandler as EventListenerOrEventListenerObject);\n        input.removeEventListener('input', inputEventHandler as EventListenerOrEventListenerObject);\n        input.removeEventListener('blur', blurEventHandler);\n        window.removeEventListener('resize', resizeEventHandler);\n        doc.removeEventListener('scroll', scrollEventHandler, true);\n        input.removeAttribute('role');\n        input.removeAttribute('aria-expanded');\n        input.removeAttribute('aria-autocomplete');\n        input.removeAttribute('aria-controls');\n        input.removeAttribute('aria-activedescendant');\n        input.removeAttribute('aria-owns');\n        input.removeAttribute('aria-haspopup');\n        clearDebounceTimer();\n        clear();\n        destroyed = true;\n    }\n\n    // setup event handlers\n    input.addEventListener('keyup', keyupEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('click', clickEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('keydown', keydownEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('input', inputEventHandler as EventListenerOrEventListenerObject);\n    input.addEventListener('blur', blurEventHandler);\n    input.addEventListener('focus', focusEventHandler);\n    window.addEventListener('resize', resizeEventHandler);\n    doc.addEventListener('scroll', scrollEventHandler, true);\n\n    return {\n        destroy,\n        fetch: manualFetch\n    };\n}\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { AutocompleteResult, AutocompleteSettings } from \"autocompleter\";\r\nimport { inject, injectable } from \"inversify\";\r\nimport { Action, isAction } from 'sprotty-protocol/lib/actions';\r\nimport { LabeledAction, isLabeledAction } from \"../../base/actions/action\";\r\nimport { IActionDispatcherProvider } from \"../../base/actions/action-dispatcher\";\r\nimport { SModelElementImpl, SModelRootImpl } from \"../../base/model/smodel\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { AbstractUIExtension } from \"../../base/ui-extensions/ui-extension\";\r\nimport { SetUIExtensionVisibilityAction } from \"../../base/ui-extensions/ui-extension-registry\";\r\nimport { DOMHelper } from \"../../base/views/dom-helper\";\r\nimport { KeyListener } from \"../../base/views/key-tool\";\r\nimport { ViewerOptions } from \"../../base/views/viewer-options\";\r\nimport { codiconCSSClasses, codiconCSSString } from \"../../utils/codicon\";\r\nimport { toArray } from \"../../utils/iterable\";\r\nimport { matchesKeystroke } from \"../../utils/keyboard\";\r\nimport { getAbsoluteClientBounds } from \"../bounds/model\";\r\nimport { isSelectable } from \"../select/model\";\r\nimport { CommandPaletteActionProviderRegistry } from \"./action-providers\";\r\nimport { MousePositionTracker } from \"../../base/views/mouse-tool\";\r\nimport configureAutocomplete from \"autocompleter\";\r\n\r\n@injectable()\r\nexport class CommandPalette extends AbstractUIExtension {\r\n    static readonly ID = \"command-palette\";\r\n    static readonly isInvokePaletteKey = (event: KeyboardEvent) => matchesKeystroke(event, 'Space', 'ctrl');\r\n\r\n    protected loadingIndicatorClasses = codiconCSSClasses('loading', false, true, ['loading']);\r\n    protected xOffset = 20;\r\n    protected yOffset = 20;\r\n    protected defaultWidth = 400;\r\n    protected debounceWaitMs = 100;\r\n    protected noCommandsMsg = \"No commands available\";\r\n\r\n    protected inputElement: HTMLInputElement;\r\n    protected loadingIndicator: HTMLSpanElement;\r\n    protected autoCompleteResult: AutocompleteResult;\r\n    protected paletteIndex = 0;\r\n    protected contextActions?: LabeledAction[];\r\n\r\n    @inject(TYPES.IActionDispatcherProvider) protected actionDispatcherProvider: IActionDispatcherProvider;\r\n    @inject(TYPES.ICommandPaletteActionProviderRegistry) protected actionProviderRegistry: CommandPaletteActionProviderRegistry;\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n    @inject(TYPES.DOMHelper) protected domHelper: DOMHelper;\r\n    @inject(MousePositionTracker) protected mousePositionTracker: MousePositionTracker;\r\n\r\n    public id() { return CommandPalette.ID; }\r\n    public containerClass() { return \"command-palette\"; }\r\n\r\n    override show(root: Readonly<SModelRootImpl>, ...contextElementIds: string[]) {\r\n        super.show(root, ...contextElementIds);\r\n        this.paletteIndex = 0;\r\n        this.contextActions = undefined;\r\n        this.inputElement!.value = \"\";\r\n        this.autoCompleteResult = configureAutocomplete(this.autocompleteSettings(root));\r\n        this.inputElement.focus();\r\n    }\r\n\r\n    protected initializeContents(containerElement: HTMLElement) {\r\n        containerElement.style.position = \"absolute\";\r\n        this.inputElement = document.createElement('input');\r\n        this.inputElement.style.width = '100%';\r\n        this.inputElement.addEventListener('keydown', (event) => this.hideIfEscapeEvent(event));\r\n        this.inputElement.addEventListener('keydown', (event) => this.cylceIfInvokePaletteKey(event));\r\n        this.inputElement.onblur = () => window.setTimeout(() => this.hide(), 200);\r\n        containerElement.appendChild(this.inputElement);\r\n    }\r\n\r\n    protected hideIfEscapeEvent(event: KeyboardEvent): any {\r\n        if (matchesKeystroke(event, 'Escape')) { this.hide(); }\r\n    }\r\n\r\n    protected cylceIfInvokePaletteKey(event: KeyboardEvent): any {\r\n        if (CommandPalette.isInvokePaletteKey(event)) { this.cycle(); }\r\n    }\r\n\r\n    protected cycle() {\r\n        this.contextActions = undefined;\r\n        this.paletteIndex++;\r\n    }\r\n\r\n    protected override onBeforeShow(containerElement: HTMLElement, root: Readonly<SModelRootImpl>, ...selectedElementIds: string[]) {\r\n        let x = this.xOffset;\r\n        let y = this.yOffset;\r\n        const selectedElements = toArray(root.index.all().filter(e => isSelectable(e) && e.selected));\r\n        if (selectedElements.length === 1) {\r\n            const bounds = getAbsoluteClientBounds(selectedElements[0], this.domHelper, this.viewerOptions);\r\n            x += bounds.x + bounds.width;\r\n            y += bounds.y;\r\n        } else {\r\n            const bounds = getAbsoluteClientBounds(root, this.domHelper, this.viewerOptions);\r\n            x += bounds.x;\r\n            y += bounds.y;\r\n        }\r\n        containerElement.style.left = `${x}px`;\r\n        containerElement.style.top = `${y}px`;\r\n        containerElement.style.width = `${this.defaultWidth}px`;\r\n    }\r\n\r\n    protected autocompleteSettings(root: Readonly<SModelRootImpl>): AutocompleteSettings<LabeledAction> {\r\n        return {\r\n            input: this.inputElement,\r\n            emptyMsg: this.noCommandsMsg,\r\n            className: \"command-palette-suggestions\",\r\n            debounceWaitMs: this.debounceWaitMs,\r\n            showOnFocus: true,\r\n            minLength: -1,\r\n            fetch: (text: string, update: (items: LabeledAction[]) => void) =>\r\n                this.updateAutoCompleteActions(update, text, root),\r\n            onSelect: (item: LabeledAction) => this.onSelect(item),\r\n            render: (item: LabeledAction, currentValue: string): HTMLDivElement | undefined =>\r\n                this.renderLabeledActionSuggestion(item, currentValue),\r\n            customize: (input: HTMLInputElement, inputRect: ClientRect | DOMRect, container: HTMLDivElement, maxHeight: number) => {\r\n                this.customizeSuggestionContainer(container, inputRect, maxHeight);\r\n            }\r\n        };\r\n    }\r\n\r\n    protected onSelect(item: LabeledAction) {\r\n        this.executeAction(item);\r\n        this.hide();\r\n    }\r\n\r\n    protected updateAutoCompleteActions(update: (items: LabeledAction[]) => void, text: string, root: Readonly<SModelRootImpl>) {\r\n        this.onLoading();\r\n        if (this.contextActions) {\r\n            update(this.filterActions(text, this.contextActions));\r\n            this.onLoaded('success');\r\n        } else {\r\n            this.actionProviderRegistry\r\n                .getActions(root, text, this.mousePositionTracker.lastPositionOnDiagram, this.paletteIndex)\r\n                .then(actions => {\r\n                    this.contextActions = actions;\r\n                    update(this.filterActions(text, actions));\r\n                    this.onLoaded('success');\r\n                })\r\n                .catch((reason) => {\r\n                    this.logger.error(this, \"Failed to obtain actions from command palette action providers\", reason);\r\n                    this.onLoaded('error');\r\n                });\r\n        }\r\n    }\r\n\r\n    protected onLoading() {\r\n        if (this.loadingIndicator && this.containerElement.contains(this.loadingIndicator)) {\r\n            return;\r\n        }\r\n        this.loadingIndicator = document.createElement('span');\r\n        this.loadingIndicator.classList.add(...this.loadingIndicatorClasses);\r\n        this.containerElement.appendChild(this.loadingIndicator);\r\n    }\r\n\r\n    protected onLoaded(success: 'success' | 'error') {\r\n        if (this.containerElement.contains(this.loadingIndicator)) {\r\n            this.containerElement.removeChild(this.loadingIndicator);\r\n        }\r\n    }\r\n\r\n    protected renderLabeledActionSuggestion(item: LabeledAction, value: string) {\r\n        const itemElement = document.createElement(\"div\");\r\n        const wordMatcher = espaceForRegExp(value).split(\" \").join(\"|\");\r\n        const regex = new RegExp(wordMatcher, \"gi\");\r\n        if (item.icon) {\r\n            this.renderIcon(itemElement, item.icon);\r\n        }\r\n        if (value.length > 0) {\r\n            itemElement.innerHTML += item.label.replace(regex, (match) => \"<em>\" + match + \"</em>\").replace(/ /g, '&nbsp;');\r\n        } else {\r\n            itemElement.innerHTML += item.label.replace(/ /g, '&nbsp;');\r\n        }\r\n        return itemElement;\r\n    }\r\n\r\n    protected renderIcon(itemElement: HTMLDivElement, iconId: string) {\r\n        itemElement.innerHTML += `<span class=\"icon ${this.getCodicon(iconId)}\"></span>`;\r\n    }\r\n\r\n    protected getFontAwesomeIcon(iconId: string) {\r\n        return `fa fa-${iconId}`;\r\n    }\r\n\r\n    protected getCodicon(iconId: string) {\r\n        return codiconCSSString(iconId);\r\n    }\r\n\r\n    protected filterActions(filterText: string, actions: LabeledAction[]): LabeledAction[] {\r\n        return toArray(actions.filter(action => {\r\n            const label = action.label.toLowerCase();\r\n            const searchWords = filterText.split(' ');\r\n            return searchWords.every(word => label.indexOf(word.toLowerCase()) !== -1);\r\n        }));\r\n    }\r\n\r\n    protected customizeSuggestionContainer(container: HTMLDivElement, inputRect: ClientRect | DOMRect, maxHeight: number) {\r\n        // move container into our command palette container as this is already positioned correctly\r\n        container.style.position = \"fixed\";\r\n        if (this.containerElement) {\r\n            this.containerElement.appendChild(container);\r\n        }\r\n    }\r\n\r\n    override hide() {\r\n        super.hide();\r\n        if (this.autoCompleteResult) {\r\n            this.autoCompleteResult.destroy();\r\n        }\r\n    }\r\n\r\n    protected executeAction(input: LabeledAction | Action[] | Action) {\r\n        this.actionDispatcherProvider()\r\n            .then((actionDispatcher) => actionDispatcher.dispatchAll(toActionArray(input)))\r\n            .catch((reason) => this.logger.error(this, 'No action dispatcher available to execute command palette action', reason));\r\n    }\r\n}\r\n\r\nfunction toActionArray(input: LabeledAction | Action[] | Action): Action[] {\r\n    if (isLabeledAction(input)) {\r\n        return input.actions;\r\n    } else if (isAction(input)) {\r\n        return [input];\r\n    }\r\n    return [];\r\n}\r\n\r\nfunction espaceForRegExp(value: string): string {\r\n    return value.replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\r\n}\r\n\r\nexport class CommandPaletteKeyListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'Escape')) {\r\n            return [SetUIExtensionVisibilityAction.create({ extensionId: CommandPalette.ID, visible: false, contextElementsId: [] })];\r\n        } else if (CommandPalette.isInvokePaletteKey(event)) {\r\n            const selectedElements = toArray(element.index.all().filter(e => isSelectable(e) && e.selected).map(e => e.id));\r\n            return [SetUIExtensionVisibilityAction.create({ extensionId: CommandPalette.ID, visible: true, contextElementsId: selectedElements })];\r\n        }\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { LabeledAction } from \"../../base/actions/action\";\r\n\r\nexport interface MenuItem extends LabeledAction {\r\n    /** Technical id of the menu item. */\r\n    readonly id: string;\r\n    /** String indicating the order. */\r\n    readonly sortString?: string;\r\n    /** String indicating the grouping (separators). Items with equal group will be in the same group. */\r\n    readonly group?: string;\r\n    /**\r\n     * The optional parent id can be used to add this element as a child of another element provided by anohter menu provider.\r\n     * The `parentId` must be fully qualified in the form of `a.b.c`, whereas `a`, `b` and `c` are referring to the IDs of other elements.\r\n     * Note that this attribute will only be considered for root items of a provider and not for children of provided items.\r\n     */\r\n    readonly parentId?: string;\r\n    /** Function determining whether the element is enabled. */\r\n    readonly isEnabled?: () => boolean;\r\n    /** Function determining whether the element is visible. */\r\n    readonly isVisible?: () => boolean;\r\n    /** Function determining whether the element is toggled on or off. */\r\n    readonly isToggled?: () => boolean;\r\n    /** Children of this item. If this item has children, they will be added into a submenu of this item. */\r\n    children?: MenuItem[];\r\n}\r\n\r\nexport type Anchor = MouseEvent | { x: number, y: number };\r\n\r\nexport function toAnchor(anchor: HTMLElement | { x: number, y: number }): Anchor {\r\n    return anchor instanceof HTMLElement ? { x: anchor.offsetLeft, y: anchor.offsetTop } : anchor;\r\n}\r\n\r\nexport interface IContextMenuService {\r\n    show(items: MenuItem[], anchor: Anchor, onHide?: () => void): void;\r\n}\r\n\r\nexport type IContextMenuServiceProvider = () => Promise<IContextMenuService>;\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { DeleteElementAction } from 'sprotty-protocol/lib/actions';\r\nimport { Command, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { SModelElementImpl, SParentElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\n\r\nexport const deletableFeature = Symbol('deletableFeature');\r\n\r\n/**\r\n *  Feature extension interface for {@link deletableFeature}.\r\n */\r\nexport interface Deletable {\r\n}\r\n\r\nexport function isDeletable<T extends SModelElementImpl>(element: T): element is T & Deletable & SChildElementImpl {\r\n    return element instanceof SChildElementImpl && element.hasFeature(deletableFeature);\r\n}\r\n\r\nexport class ResolvedDelete {\r\n    child: SChildElementImpl;\r\n    parent: SParentElementImpl;\r\n}\r\n\r\n@injectable()\r\nexport class DeleteElementCommand extends Command {\r\n    static readonly KIND = DeleteElementAction.KIND;\r\n\r\n    resolvedDeletes: ResolvedDelete[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: DeleteElementAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const index = context.root.index;\r\n        for (const id of this.action.elementIds) {\r\n            const element = index.getById(id);\r\n            if (element && isDeletable(element)) {\r\n                this.resolvedDeletes.push({ child: element, parent: element.parent });\r\n                element.parent.remove(element);\r\n            }\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        for (const resolvedDelete of this.resolvedDeletes)\r\n            resolvedDelete.parent.add(resolvedDelete.child);\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        for (const resolvedDelete of this.resolvedDeletes)\r\n            resolvedDelete.parent.remove(resolvedDelete.child);\r\n        return context.root;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject, optional } from 'inversify';\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { MenuItem } from './context-menu-service';\r\nimport { SModelRootImpl } from '../../base/model/smodel';\r\nimport { LabeledAction } from '../../base/actions/action';\r\nimport { TYPES } from '../../base/types';\r\nimport { isDeletable } from '../edit/delete';\r\nimport { isSelected } from '../select/model';\r\nimport { DeleteElementAction } from 'sprotty-protocol';\r\n\r\nexport interface IContextMenuItemProvider {\r\n    getItems(root: Readonly<SModelRootImpl>, lastMousePosition?: Point): Promise<LabeledAction[]>;\r\n}\r\n\r\n@injectable()\r\nexport class ContextMenuProviderRegistry implements IContextMenuItemProvider {\r\n\r\n    constructor(@multiInject(TYPES.IContextMenuItemProvider) @optional() protected menuProviders: IContextMenuItemProvider[] = []) { }\r\n\r\n    getItems(root: Readonly<SModelRootImpl>, lastMousePosition?: Point) {\r\n        const menues = this.menuProviders.map(provider => provider.getItems(root, lastMousePosition));\r\n        return Promise.all(menues).then(this.flattenAndRestructure);\r\n    }\r\n\r\n    private flattenAndRestructure(p: MenuItem[][]): MenuItem[] {\r\n        let menuItems = p.reduce((acc, promise) => promise !== undefined ? acc.concat(promise) : acc, []);\r\n        const menuItemsWithParentId = menuItems.filter(menuItem => menuItem.parentId);\r\n        for (const menuItem of menuItemsWithParentId) {\r\n            if (menuItem.parentId) {\r\n                const fragments = menuItem.parentId.split('.');\r\n                let matchingParent: MenuItem | undefined = undefined;\r\n                let nextParents = menuItems;\r\n                for (const fragment of fragments) {\r\n                    matchingParent = nextParents.find(item => fragment === item.id);\r\n                    if (matchingParent && matchingParent.children)\r\n                        nextParents = matchingParent.children;\r\n                }\r\n                if (matchingParent) {\r\n                    if (matchingParent.children) {\r\n                        matchingParent.children.push(menuItem);\r\n                    } else {\r\n                        matchingParent.children = [menuItem];\r\n                    }\r\n                    menuItems = menuItems.filter(item => item !== menuItem);\r\n                }\r\n            }\r\n        }\r\n        return menuItems;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class DeleteContextMenuItemProvider implements IContextMenuItemProvider {\r\n    getItems(root: Readonly<SModelRootImpl>, lastMousePosition?: Point): Promise<MenuItem[]> {\r\n        const selectedElements = Array.from(root.index.all().filter(isSelected).filter(isDeletable));\r\n        return Promise.resolve([\r\n            {\r\n                id: 'delete',\r\n                label: 'Delete',\r\n                sortString: 'd',\r\n                group: 'edit',\r\n                actions: [DeleteElementAction.create(selectedElements.map(e => e.id))],\r\n                isEnabled: () => selectedElements.length > 0\r\n            }\r\n        ]);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject } from \"inversify\";\r\nimport { Action, SelectAction } from \"sprotty-protocol/lib/actions\";\r\nimport { IActionDispatcher } from \"../../base/actions/action-dispatcher\";\r\nimport { SModelElementImpl } from \"../../base/model/smodel\";\r\nimport { findParentByFeature } from \"../../base/model/smodel-utils\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { MouseListener } from \"../../base/views/mouse-tool\";\r\nimport { isSelectable, isSelected } from \"../select/model\";\r\nimport { IContextMenuService, IContextMenuServiceProvider } from \"./context-menu-service\";\r\nimport { ContextMenuProviderRegistry } from \"./menu-providers\";\r\n\r\nexport class ContextMenuMouseListener extends MouseListener {\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n    constructor(\r\n        @inject(TYPES.IContextMenuServiceProvider) protected readonly contextMenuService: IContextMenuServiceProvider,\r\n        @inject(TYPES.IContextMenuProviderRegistry) protected readonly menuProvider: ContextMenuProviderRegistry) {\r\n        super();\r\n    }\r\n\r\n    override contextMenu(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        this.showContextMenu(target, event);\r\n        return [];\r\n    }\r\n\r\n    protected async showContextMenu(target: SModelElementImpl, event: MouseEvent): Promise<void> {\r\n        let menuService: IContextMenuService;\r\n        try {\r\n            menuService = await this.contextMenuService();\r\n        } catch (rejected) {\r\n            // IContextMenuService is not bound => do nothing\r\n            return;\r\n        }\r\n\r\n        let isTargetSelected = false;\r\n        const selectableTarget = findParentByFeature(target, isSelectable);\r\n        if (selectableTarget) {\r\n            isTargetSelected = selectableTarget.selected;\r\n            selectableTarget.selected = true;\r\n        }\r\n\r\n        const root = target.root;\r\n        const mousePosition = { x: event.x, y: event.y };\r\n        if (target.id === root.id || isSelected(selectableTarget)) {\r\n            const menuItems = await this.menuProvider.getItems(root, mousePosition);\r\n            const restoreSelection = () => { if (selectableTarget) selectableTarget.selected = isTargetSelected; };\r\n            menuService.show(menuItems, mousePosition, restoreSelection);\r\n        } else {\r\n            if (isSelectable(target)) {\r\n                const options = { selectedElementsIDs: [target.id], deselectedElementsIDs: Array.from(root.index.all().filter(isSelected), (val) => { return val.id; }) };\r\n                await this.actionDispatcher.dispatch(SelectAction.create(options));\r\n            }\r\n            const items = await this.menuProvider.getItems(root, mousePosition);\r\n            menuService.show(items, mousePosition);\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const hoverFeedbackFeature = Symbol('hoverFeedbackFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link hoverFeedbackFeature}.\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Hoverable {\r\n    hoverFeedback: boolean\r\n}\r\n\r\nexport function isHoverable(element: SModelElementImpl): element is SModelElementImpl & Hoverable {\r\n    return element.hasFeature(hoverFeedbackFeature);\r\n}\r\n\r\nexport const popupFeature = Symbol('popupFeature');\r\n\r\nexport function hasPopupFeature(element: SModelElementImpl): boolean {\r\n    return element.hasFeature(popupFeature);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { hasOwnProperty } from 'sprotty-protocol/lib/utils/object';\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const moveFeature = Symbol('moveFeature');\r\n\r\n/**\r\n * An element that can be placed at a specific location using its position property.\r\n * Feature extension interface for {@link moveFeature}.\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Locateable {\r\n    position: Point\r\n}\r\n\r\nexport function isLocateable(element: SModelElementImpl): element is SModelElementImpl & Locateable {\r\n    return hasOwnProperty(element, 'position');\r\n}\r\n\r\nexport function isMoveable(element: SModelElementImpl): element is SModelElementImpl & Locateable {\r\n    return element.hasFeature(moveFeature) && isLocateable(element);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Hoverable, Selectable } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SChildElementImpl, SModelElementImpl } from '../../base/model/smodel';\r\nimport { FluentIterable } from '../../utils/iterable';\r\nimport { SShapeElementImpl } from '../bounds/model';\r\nimport { deletableFeature } from '../edit/delete';\r\nimport { selectFeature } from '../select/model';\r\nimport { hoverFeedbackFeature } from '../hover/model';\r\nimport { moveFeature } from '../move/model';\r\n\r\nexport abstract class SRoutableElementImpl extends SChildElementImpl {\r\n\r\n    routerKind?: string;\r\n    routingPoints: Point[] = [];\r\n    sourceId: string;\r\n    targetId: string;\r\n    sourceAnchorCorrection?: number;\r\n    targetAnchorCorrection?: number;\r\n\r\n    get source(): SConnectableElementImpl | undefined {\r\n        return this.index.getById(this.sourceId) as SConnectableElementImpl;\r\n    }\r\n\r\n    get target(): SConnectableElementImpl | undefined {\r\n        return this.index.getById(this.targetId) as SConnectableElementImpl;\r\n    }\r\n\r\n    get bounds(): Bounds {\r\n        // this should also work for splines, which have the convex hull property\r\n        return this.routingPoints.reduce<Bounds>((bounds, routingPoint) => Bounds.combine(bounds, {\r\n            x: routingPoint.x,\r\n            y: routingPoint.y,\r\n            width: 0,\r\n            height: 0\r\n        }), Bounds.EMPTY);\r\n    }\r\n}\r\n\r\nexport const connectableFeature = Symbol('connectableFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link connectableFeature}.\r\n */\r\nexport interface Connectable {\r\n    canConnect(routable: SRoutableElementImpl, role: 'source' | 'target'): boolean;\r\n}\r\n\r\nexport function isConnectable<T extends SModelElementImpl>(element: T): element is Connectable & T {\r\n    return element.hasFeature(connectableFeature) && (element as any).canConnect;\r\n}\r\n\r\nexport function getAbsoluteRouteBounds(model: Readonly<SRoutableElementImpl>, route: Point[] = model.routingPoints): Bounds {\r\n    let bounds = getRouteBounds(route);\r\n    let current: SModelElementImpl = model;\r\n    while (current instanceof SChildElementImpl) {\r\n        const parent = current.parent;\r\n        bounds = parent.localToParent(bounds);\r\n        current = parent;\r\n    }\r\n    return bounds;\r\n}\r\n\r\nexport function getRouteBounds(route: Point[]): Bounds {\r\n    const bounds = { x: NaN, y: NaN, width: 0, height: 0 };\r\n    for (const point of route) {\r\n        if (isNaN(bounds.x)) {\r\n            bounds.x = point.x;\r\n            bounds.y = point.y;\r\n        } else {\r\n            if (point.x < bounds.x) {\r\n                bounds.width += bounds.x - point.x;\r\n                bounds.x = point.x;\r\n            } else if (point.x > bounds.x + bounds.width) {\r\n                bounds.width = point.x - bounds.x;\r\n            }\r\n            if (point.y < bounds.y) {\r\n                bounds.height += bounds.y - point.y;\r\n                bounds.y = point.y;\r\n            } else if (point.y > bounds.y + bounds.height) {\r\n                bounds.height = point.y - bounds.y;\r\n            }\r\n        }\r\n    }\r\n    return bounds;\r\n}\r\n\r\n/**\r\n * A connectable element is one that can have outgoing and incoming edges, i.e. it can be the source\r\n * or target element of an edge. There are two kinds of connectable elements: nodes (`SNode`) and\r\n * ports (`SPort`). A node represents a main entity, while a port is a connection point inside a node.\r\n */\r\nexport abstract class SConnectableElementImpl extends SShapeElementImpl implements Connectable {\r\n\r\n    get anchorKind(): string | undefined {\r\n        return undefined;\r\n    }\r\n\r\n    strokeWidth: number = 0;\r\n\r\n    /**\r\n     * The incoming edges of this connectable element. They are resolved by the index, which must\r\n     * be an `SGraphIndex` for efficient lookup.\r\n     */\r\n    get incomingEdges(): FluentIterable<SRoutableElementImpl> {\r\n        const allEdges = this.index.all().filter(e => e instanceof SRoutableElementImpl) as FluentIterable<SRoutableElementImpl>;\r\n        return allEdges.filter(e => e.targetId === this.id);\r\n    }\r\n\r\n    /**\r\n     * The outgoing edges of this connectable element. They are resolved by the index, which must\r\n     * be an `SGraphIndex` for efficient lookup.\r\n     */\r\n    get outgoingEdges(): FluentIterable<SRoutableElementImpl> {\r\n        const allEdges = this.index.all().filter(e => e instanceof SRoutableElementImpl) as FluentIterable<SRoutableElementImpl>;\r\n        return allEdges.filter(e => e.sourceId === this.id);\r\n    }\r\n\r\n    canConnect(routable: SRoutableElementImpl, role: 'source' | 'target') {\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\nexport type RoutingHandleKind = 'junction' | 'line' | 'source' | 'target' | 'manhattan-50%' |\r\n    'bezier-control-after' | 'bezier-control-before' | 'bezier-junction' | 'bezier-add' | 'bezier-remove';\r\n\r\nexport class SRoutingHandleImpl extends SChildElementImpl implements Selectable, Hoverable {\r\n    static readonly DEFAULT_FEATURES = [selectFeature, moveFeature, hoverFeedbackFeature];\r\n\r\n    /**\r\n     * 'junction' is a point where two line segments meet,\r\n     * 'line' is a volatile handle placed on a line segment,\r\n     * 'source' and 'target' are the respective anchors.\r\n     */\r\n    kind: RoutingHandleKind;\r\n    /** The actual routing point index (junction) or the previous point index (line). */\r\n    pointIndex: number;\r\n    /** Whether the routing point is being dragged. */\r\n    editMode: boolean = false;\r\n\r\n    hoverFeedback: boolean = false;\r\n    selected: boolean = false;\r\n    danglingAnchor?: SDanglingAnchorImpl;\r\n\r\n    /**\r\n     * SRoutingHandles are created using the constructor, so we hard-wire the\r\n     * default features\r\n     */\r\n    override hasFeature(feature: symbol): boolean {\r\n        return SRoutingHandleImpl.DEFAULT_FEATURES.indexOf(feature) !== -1;\r\n    }\r\n}\r\n\r\nexport class SDanglingAnchorImpl extends SConnectableElementImpl {\r\n    static readonly DEFAULT_FEATURES = [deletableFeature];\r\n\r\n    original?: SModelElementImpl;\r\n    override type = 'dangling-anchor';\r\n\r\n    constructor() {\r\n        super();\r\n        this.size = { width: 0, height: 0 };\r\n    }\r\n}\r\n\r\nexport const edgeInProgressID = 'edge-in-progress';\r\nexport const edgeInProgressTargetHandleID = edgeInProgressID + '-target-anchor';\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport type { EdgePlacement as EdgePlacementSchema } from 'sprotty-protocol/lib/model';\r\nimport { SModelElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { InternalBoundsAware, isBoundsAware } from '../bounds/model';\r\nimport { SRoutableElementImpl } from '../routing/model';\r\n\r\nexport const edgeLayoutFeature = Symbol('edgeLayout');\r\n\r\n/**\r\n * @deprecated Use EdgeLayoutable from sprotty-protocol instead\r\n * Feature extension interface for {@link edgeLayoutFeature}.\r\n */\r\nexport interface EdgeLayoutable {\r\n    edgePlacement: EdgePlacementSchema\r\n}\r\n\r\nexport function isEdgeLayoutable<T extends SModelElementImpl>(element: T): element is T & SChildElementImpl & InternalBoundsAware & EdgeLayoutable {\r\n    return element instanceof SChildElementImpl\r\n        && element.parent instanceof SRoutableElementImpl\r\n        && isBoundsAware(element)\r\n        && element.hasFeature(edgeLayoutFeature);\r\n}\r\n\r\nexport function checkEdgePlacement(element: SChildElementImpl): element is SChildElementImpl & EdgeLayoutable {\r\n    return 'edgePlacement' in element;\r\n}\r\n\r\n/**\r\n * @deprecated Use EdgeSide from sprotty-protocol instead\r\n */\r\nexport type EdgeSide = 'left' | 'right' | 'top' | 'bottom' | 'on';\r\n\r\n/**\r\n * @deprecated Use EdgePlacement from sprotty-protocol instead\r\n */\r\nexport class EdgePlacement extends Object {\r\n    /**\r\n     * true, if the label should be rotated to touch the edge tangentially\r\n     */\r\n    rotate: boolean;\r\n\r\n    /**\r\n     * where is the label relative to the line's direction\r\n     */\r\n    side: EdgeSide;\r\n\r\n    /**\r\n     * between 0 (source anchor) and 1 (target anchor)\r\n     */\r\n    position: number;\r\n\r\n    /**\r\n     * space between label and edge/connected nodes\r\n     */\r\n    offset: number;\r\n\r\n    /**\r\n     * where should the label be moved when move feature is enabled.\r\n     * 'edge' means the label is moved along the edge, 'free' means the label is moved freely, 'none' means the label is not moved.\r\n     * Default is 'edge'.\r\n     */\r\n    moveMode?: 'edge' | 'free' | 'none';\r\n\r\n}\r\n\r\nexport const DEFAULT_EDGE_PLACEMENT: EdgePlacementSchema = {\r\n    rotate: true,\r\n    side: 'top',\r\n    position: 0.5,\r\n    offset: 7,\r\n    moveMode: 'edge'\r\n};\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { SRoutableElementImpl } from '../routing/model';\r\n\r\nexport const editFeature = Symbol('editFeature');\r\n\r\nexport function canEditRouting(element: SModelElementImpl): element is SRoutableElementImpl {\r\n    return element instanceof SRoutableElementImpl && element.hasFeature(editFeature);\r\n}\r\n\r\n\r\nexport const editLabelFeature = Symbol('editLabelFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link editLabelFeature}.\r\n */\r\nexport interface EditableLabel  {\r\n    text: string;\r\n    readonly isMultiLine?: boolean;\r\n    readonly editControlDimension?: Dimension;\r\n    readonly editControlPositionCorrection?: Point;\r\n}\r\n\r\nexport function isEditableLabel<T extends SModelElementImpl>(element: T): element is T & EditableLabel {\r\n    return 'text' in element && element.hasFeature(editLabelFeature);\r\n}\r\n\r\nexport const withEditLabelFeature = Symbol('withEditLabelFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link withEditLabelFeature}.\r\n */\r\nexport interface WithEditableLabel  {\r\n    readonly editableLabel?: EditableLabel & SModelElementImpl;\r\n}\r\n\r\nexport function isWithEditableLabel<T extends SModelElementImpl>(element: T): element is T & WithEditableLabel {\r\n    return 'editableLabel' in element && element.hasFeature(withEditLabelFeature);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2022 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Bounds, Point, toDegrees } from 'sprotty-protocol';\r\n\r\n/**\r\n * Represents an object's insets, for top, bottom, left and right\r\n */\r\nexport interface Insets {\r\n    top: number\r\n    bottom: number\r\n    left: number\r\n    right: number\r\n}\r\n\r\nexport type Orientation = 'north' | 'south' | 'east' | 'west';\r\n\r\n/**\r\n * A diamond or rhombus is a quadrilateral whose four sides all have the same length.\r\n * It consists of four points, a `topPoint`, `rightPoint`, `bottomPoint`, and a `leftPoint`,\r\n * which are connected by four lines -- the `topRightSideLight`, `topLeftSideLine`, `bottomRightSideLine`,\r\n * and the `bottomLeftSideLine`.\r\n */\r\nexport class Diamond {\r\n\r\n    constructor(protected bounds: Bounds) { }\r\n\r\n    get topPoint(): Point {\r\n        return {\r\n            x: this.bounds.x + this.bounds.width / 2,\r\n            y: this.bounds.y\r\n        };\r\n    }\r\n\r\n    get rightPoint(): Point {\r\n        return {\r\n            x: this.bounds.x + this.bounds.width,\r\n            y: this.bounds.y + this.bounds.height / 2\r\n        };\r\n    }\r\n\r\n    get bottomPoint(): Point {\r\n        return {\r\n            x: this.bounds.x + this.bounds.width / 2,\r\n            y: this.bounds.y + this.bounds.height\r\n        };\r\n    }\r\n\r\n    get leftPoint(): Point {\r\n        return {\r\n            x: this.bounds.x,\r\n            y: this.bounds.y + this.bounds.height / 2\r\n        };\r\n    }\r\n\r\n    get topRightSideLine(): Line {\r\n        return new PointToPointLine(this.topPoint, this.rightPoint);\r\n    }\r\n\r\n    get topLeftSideLine(): Line {\r\n        return new PointToPointLine(this.topPoint, this.leftPoint);\r\n    }\r\n\r\n    get bottomRightSideLine(): Line {\r\n        return new PointToPointLine(this.bottomPoint, this.rightPoint);\r\n    }\r\n\r\n    get bottomLeftSideLine(): Line {\r\n        return new PointToPointLine(this.bottomPoint, this.leftPoint);\r\n    }\r\n\r\n    /**\r\n     * Return the closest side of this diamond to the specified `refPoint`.\r\n     * @param {Point} refPoint a reference point\r\n     * @returns {Line} a line representing the closest side\r\n     */\r\n    closestSideLine(refPoint: Point): Line {\r\n        const c = Bounds.center(this.bounds);\r\n        if (refPoint.x > c.x) {\r\n            if (refPoint.y > c.y) {\r\n                return this.bottomRightSideLine;\r\n            } else {\r\n                return this.topRightSideLine;\r\n            }\r\n        } else {\r\n            if (refPoint.y > c.y) {\r\n                return this.bottomLeftSideLine;\r\n            } else {\r\n                return this.topLeftSideLine;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * A line represented in its standard form `a*x + b*y = c`.\r\n */\r\nexport interface Line {\r\n    readonly a: number\r\n    readonly b: number\r\n    readonly c: number\r\n}\r\n\r\nexport type CardinalDirection =\r\n    'north' | 'north-east' | 'east' | 'south-east' |\r\n    'south' | 'south-west' | 'west' | 'north-west';\r\n\r\n/**\r\n * A line made up from two points.\r\n */\r\nexport class PointToPointLine implements Line {\r\n\r\n    constructor(public p1: Point, public p2: Point) { }\r\n\r\n    get a(): number {\r\n        return this.p1.y - this.p2.y;\r\n    }\r\n\r\n    get b(): number {\r\n        return this.p2.x - this.p1.x;\r\n    }\r\n\r\n    get c(): number {\r\n        return this.p2.x * this.p1.y - this.p1.x * this.p2.y;\r\n    }\r\n\r\n    /**\r\n     * The counter-clockwise angle of this line relative to the x-axis.\r\n     */\r\n    get angle(): number {\r\n        return Math.atan2(-this.a, this.b);\r\n    }\r\n\r\n    /**\r\n     * The slope of the line.\r\n     * A vertical line returns `undefined`.\r\n     */\r\n    get slope(): number | undefined {\r\n        if (this.b === 0) return undefined;\r\n        return this.a / this.b;\r\n    }\r\n\r\n    /**\r\n     * The slope of the line or `Number.MAX_SAFE_INTEGER` if vertical.\r\n     */\r\n    get slopeOrMax(): number {\r\n        if (this.slope === undefined) {\r\n            return Number.MAX_SAFE_INTEGER;\r\n        }\r\n        return this.slope;\r\n    }\r\n\r\n    /**\r\n     * The direction of this line, such as 'north', 'south', or 'south-west'.\r\n     */\r\n    get direction(): CardinalDirection {\r\n        const hDegrees = toDegrees(this.angle);\r\n        const degrees = hDegrees < 0 ? 360 + hDegrees : hDegrees;\r\n        // degrees are relative to the x-axis\r\n        if (degrees === 90) {\r\n            return 'south';\r\n        } else if (degrees === 0 || degrees === 360) {\r\n            return 'east';\r\n        } else if (degrees === 270) {\r\n            return 'north';\r\n        } else if (degrees === 180) {\r\n            return 'west';\r\n        } else if (degrees > 0 && degrees < 90) {\r\n            return 'south-east';\r\n        } else if (degrees > 90 && degrees < 180) {\r\n            return 'south-west';\r\n        } else if (degrees > 180 && degrees < 270) {\r\n            return 'north-west';\r\n        } else if (degrees > 270 && degrees < 360) {\r\n            return 'north-east';\r\n        }\r\n        throw new Error(`Cannot determine direction of line (${this.p1.x},${this.p1.y}) to (${this.p2.x},${this.p2.y})`);\r\n    }\r\n\r\n    /**\r\n     * @param otherLine the other line\r\n     * @returns the intersection point between `this` line and the `otherLine` if exists, or `undefined`.\r\n     */\r\n    intersection(otherLine: PointToPointLine): Point | undefined {\r\n        if (this.hasIndistinctPoints(otherLine)) {\r\n            return undefined;\r\n        }\r\n\r\n        const x1 = this.p1.x;\r\n        const y1 = this.p1.y;\r\n        const x2 = this.p2.x;\r\n        const y2 = this.p2.y;\r\n        const x3 = otherLine.p1.x;\r\n        const y3 = otherLine.p1.y;\r\n        const x4 = otherLine.p2.x;\r\n        const y4 = otherLine.p2.y;\r\n\r\n        const denominator = ((y4 - y3) * (x2 - x1)) - ((x4 - x3) * (y2 - y1));\r\n        if (denominator === 0) {\r\n            return undefined;\r\n        }\r\n        const numeratorA = ((x4 - x3) * (y1 - y3)) - ((y4 - y3) * (x1 - x3));\r\n        const numeratorB = ((x2 - x1) * (y1 - y3)) - ((y2 - y1) * (x1 - x3));\r\n        if (numeratorA === 0 && numeratorB === 0) {\r\n            return undefined;\r\n        }\r\n\r\n        const determinantA = numeratorA / denominator;\r\n        const determinantB = numeratorB / denominator;\r\n        if (determinantA < 0 || determinantA > 1 || determinantB < 0 || determinantB > 1) {\r\n            return undefined;\r\n        }\r\n\r\n        const x = x1 + (determinantA * (x2 - x1));\r\n        const y = y1 + (determinantA * (y2 - y1));\r\n        return { x, y };\r\n    }\r\n\r\n    /**\r\n     * @param otherLine the other line\r\n     * @returns whether the start and end point of this line is does not have distinct start\r\n     * or end points with the `otherLine`\r\n     */\r\n    hasIndistinctPoints(otherLine: PointToPointLine): boolean {\r\n        return Point.equals(this.p1, otherLine.p1) ||\r\n            Point.equals(this.p1, otherLine.p2) ||\r\n            Point.equals(this.p2, otherLine.p1) ||\r\n            Point.equals(this.p2, otherLine.p2);\r\n    }\r\n}\r\n\r\n/**\r\n * Returns the intersection of two lines `l1` and `l2`\r\n * @param {Line} l1 - A line\r\n * @param {Line} l2 - Another line\r\n * @returns {Point} The intersection point of `l1` and `l2`\r\n */\r\nexport function intersection(l1: Line, l2: Line): Point {\r\n    return {\r\n        x: (l1.c * l2.b - l2.c * l1.b) / (l1.a * l2.b - l2.a * l1.b),\r\n        y: (l1.a * l2.c - l2.a * l1.c) / (l1.a * l2.b - l2.a * l1.b)\r\n    };\r\n}\r\n\r\n/**\r\n * A minimum and maximum value of a numeric type.\r\n */\r\nexport interface Limits {\r\n    min: number\r\n    max: number\r\n}\r\n\r\n/**\r\n * Limits a value to the specified `limits`.\r\n * @param {number} value - The value to limit\r\n * @param {Limits} limits - The minimum and maximum limits\r\n */\r\nexport function limit(value: number, limits: Limits): number {\r\n    if (value < limits.min) {\r\n        return limits.min;\r\n    }\r\n    if (value > limits.max) {\r\n        return limits.max;\r\n    }\r\n    return value;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Bounds, Dimension } from 'sprotty-protocol';\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { limit, Limits } from '../../utils/geometry';\r\n\r\nexport const viewportFeature = Symbol('viewportFeature');\r\n\r\n/**\r\n * Determine whether the given model element has a viewport.\r\n */\r\nexport function isViewport(element: SModelElementImpl): element is SModelRootImpl & Viewport {\r\n    return element instanceof SModelRootImpl\r\n        && element.hasFeature(viewportFeature)\r\n        && 'zoom' in element\r\n        && 'scroll' in element;\r\n}\r\n\r\n/**\r\n * Apply limits to the given viewport.\r\n */\r\nexport function limitViewport(viewport: Viewport,\r\n    canvasBounds: Bounds | undefined,\r\n    horizontalScrollLimits: Limits | undefined,\r\n    verticalScrollLimits: Limits | undefined,\r\n    zoomLimits: Limits | undefined): Viewport {\r\n    if (canvasBounds && !Dimension.isValid(canvasBounds)) {\r\n        canvasBounds = undefined;\r\n    }\r\n    // Limit the zoom factor\r\n    let zoom = zoomLimits ? limit(viewport.zoom, zoomLimits) : viewport.zoom;\r\n    if (canvasBounds && horizontalScrollLimits) {\r\n        const minZoom = canvasBounds.width / (horizontalScrollLimits.max - horizontalScrollLimits.min);\r\n        if (zoom < minZoom) {\r\n            zoom = minZoom;\r\n        }\r\n    }\r\n    if (canvasBounds && verticalScrollLimits) {\r\n        const minZoom = canvasBounds.height / (verticalScrollLimits.max - verticalScrollLimits.min);\r\n        if (zoom < minZoom) {\r\n            zoom = minZoom;\r\n        }\r\n    }\r\n    // Limit the horizontal scroll position\r\n    let scrollX: number;\r\n    if (horizontalScrollLimits) {\r\n        const min = horizontalScrollLimits.min;\r\n        const max = canvasBounds ? horizontalScrollLimits.max - canvasBounds.width / zoom : horizontalScrollLimits.max;\r\n        scrollX = limit(viewport.scroll.x, { min, max });\r\n    } else {\r\n        scrollX = viewport.scroll.x;\r\n    }\r\n    // Limit the vertical scroll position\r\n    let scrollY: number;\r\n    if (verticalScrollLimits) {\r\n        const min = verticalScrollLimits.min;\r\n        const max = canvasBounds ? verticalScrollLimits.max - canvasBounds.height / zoom : verticalScrollLimits.max;\r\n        scrollY = limit(viewport.scroll.y, { min, max });\r\n    } else {\r\n        scrollY = viewport.scroll.y;\r\n    }\r\n    return { scroll: { x: scrollX, y: scrollY }, zoom };\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const exportFeature = Symbol('exportFeature');\r\n\r\nexport function isExportable(element: SModelElementImpl): boolean {\r\n     return element.hasFeature(exportFeature);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Dimension, isBounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelRootImpl, ModelIndexImpl } from '../../base/model/smodel';\r\nimport { viewportFeature } from \"./model\";\r\nimport { exportFeature } from \"../export/model\";\r\nimport { InternalBoundsAware } from \"../bounds/model\";\r\n\r\n/**\r\n * Model root element that defines a viewport, so it transforms the coordinate system with\r\n * a `scroll` translation and a `zoom` scaling.\r\n */\r\nexport class ViewportRootElementImpl extends SModelRootImpl implements Viewport, InternalBoundsAware {\r\n    static readonly DEFAULT_FEATURES = [viewportFeature, exportFeature];\r\n\r\n    scroll: Point = { x: 0, y: 0 };\r\n    zoom: number = 1;\r\n    position: Point = Point.ORIGIN;\r\n    size: Dimension = Dimension.EMPTY;\r\n\r\n    constructor(index?: ModelIndexImpl) {\r\n        super(index);\r\n    }\r\n\r\n    get bounds(): Bounds {\r\n        return {\r\n            x: this.position.x,\r\n            y: this.position.y,\r\n            width: this.size.width,\r\n            height: this.size.height\r\n        };\r\n    }\r\n\r\n    set bounds(newBounds: Bounds) {\r\n        this.position = {\r\n            x: newBounds.x,\r\n            y: newBounds.y\r\n        };\r\n        this.size = {\r\n            width: newBounds.width,\r\n            height: newBounds.height\r\n        };\r\n    }\r\n\r\n    override localToParent(point: Point | Bounds): Bounds {\r\n        const result = {\r\n            x: (point.x - this.scroll.x) * this.zoom,\r\n            y: (point.y - this.scroll.y) * this.zoom,\r\n            width: -1,\r\n            height: -1\r\n        };\r\n        if (isBounds(point)) {\r\n            result.width = point.width * this.zoom;\r\n            result.height = point.height * this.zoom;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    override parentToLocal(point: Point | Bounds): Bounds {\r\n        const result = {\r\n            x: (point.x / this.zoom) + this.scroll.x,\r\n            y: (point.y / this.zoom) + this.scroll.y,\r\n            width: -1,\r\n            height: -1\r\n        };\r\n        if (isBounds(point) && Dimension.isValid(point)) {\r\n            result.width = point.width / this.zoom;\r\n            result.height = point.height / this.zoom;\r\n        }\r\n        return result;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { Alignable, EdgePlacement, Fadeable, Hoverable, Selectable } from 'sprotty-protocol/lib/model';\r\nimport { ModelIndexImpl, SChildElementImpl, SModelElementImpl } from '../base/model/smodel';\r\nimport {\r\n    alignFeature, InternalBoundsAware, boundsFeature, layoutableChildFeature, layoutContainerFeature,\r\n    ModelLayoutOptions, SShapeElementImpl\r\n} from '../features/bounds/model';\r\nimport { edgeLayoutFeature } from '../features/edge-layout/model';\r\nimport { deletableFeature } from '../features/edit/delete';\r\nimport { editFeature } from '../features/edit/model';\r\nimport { fadeFeature } from '../features/fade/model';\r\nimport { hoverFeedbackFeature, popupFeature } from '../features/hover/model';\r\nimport { moveFeature } from '../features/move/model';\r\nimport { connectableFeature, SConnectableElementImpl, SRoutableElementImpl } from '../features/routing/model';\r\nimport { selectFeature } from '../features/select/model';\r\nimport { ViewportRootElementImpl } from '../features/viewport/viewport-root';\r\nimport { FluentIterable, FluentIterableImpl } from '../utils/iterable';\r\n\r\n/**\r\n * Root element for graph-like models.\r\n */\r\nexport class SGraphImpl extends ViewportRootElementImpl {\r\n    layoutOptions?: ModelLayoutOptions;\r\n\r\n    constructor(index = new SGraphIndex()) {\r\n        super(index);\r\n    }\r\n}\r\n\r\n/**\r\n * Model element class for nodes, which are the main entities in a graph. A node can be connected to\r\n * another node via an SEdge. Such a connection can be direct, i.e. the node is the source or target of\r\n * the edge, or indirect through a port, i.e. it contains an SPort which is the source or target of the edge.\r\n */\r\nexport class SNodeImpl extends SConnectableElementImpl implements Selectable, Fadeable, Hoverable {\r\n    static readonly DEFAULT_FEATURES = [connectableFeature, deletableFeature, selectFeature, boundsFeature,\r\n        moveFeature, layoutContainerFeature, fadeFeature, hoverFeedbackFeature, popupFeature];\r\n\r\n    override children: SChildElementImpl[];\r\n    layout?: string;\r\n    selected: boolean = false;\r\n    hoverFeedback: boolean = false;\r\n    opacity: number = 1;\r\n\r\n    override canConnect(routable: SRoutableElementImpl, role: string) {\r\n        return this.children.find(c => c instanceof SPortImpl) === undefined;\r\n    }\r\n\r\n    override get incomingEdges(): FluentIterable<SEdgeImpl> {\r\n        const index = this.index;\r\n        if (index instanceof SGraphIndex) {\r\n            return index.getIncomingEdges(this);\r\n        }\r\n        const allEdges = this.index.all().filter(e => e instanceof SEdgeImpl) as FluentIterable<SEdgeImpl>;\r\n        return allEdges.filter(e => e.targetId === this.id);\r\n    }\r\n\r\n    override get outgoingEdges(): FluentIterable<SEdgeImpl> {\r\n        const index = this.index;\r\n        if (index instanceof SGraphIndex) {\r\n            return index.getOutgoingEdges(this);\r\n        }\r\n        const allEdges = this.index.all().filter(e => e instanceof SEdgeImpl) as FluentIterable<SEdgeImpl>;\r\n        return allEdges.filter(e => e.sourceId === this.id);\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * A port is a connection point for edges. It should always be contained in an SNode.\r\n */\r\nexport class SPortImpl extends SConnectableElementImpl implements Selectable, Fadeable, Hoverable {\r\n    static readonly DEFAULT_FEATURES = [connectableFeature, selectFeature, boundsFeature, fadeFeature,\r\n        hoverFeedbackFeature];\r\n\r\n    selected: boolean = false;\r\n    hoverFeedback: boolean = false;\r\n    opacity: number = 1;\r\n\r\n    override get incomingEdges(): FluentIterable<SEdgeImpl> {\r\n        const index = this.index;\r\n        if (index instanceof SGraphIndex) {\r\n            return index.getIncomingEdges(this);\r\n        }\r\n        return super.incomingEdges.filter(e => e instanceof SEdgeImpl) as FluentIterable<SEdgeImpl>;\r\n    }\r\n\r\n    override get outgoingEdges(): FluentIterable<SEdgeImpl> {\r\n        const index = this.index;\r\n        if (index instanceof SGraphIndex) {\r\n            return index.getOutgoingEdges(this);\r\n        }\r\n        return super.outgoingEdges.filter(e => e instanceof SEdgeImpl) as FluentIterable<SEdgeImpl>;\r\n    }\r\n\r\n}\r\n\r\n\r\n\r\n/**\r\n * Model element class for edges, which are the connectors in a graph. An edge has a source and a target,\r\n * each of which can be either a node or a port. The source and target elements are referenced via their\r\n * ids and can be resolved with the index stored in the root element.\r\n */\r\nexport class SEdgeImpl extends SRoutableElementImpl implements Fadeable, Selectable, Hoverable, InternalBoundsAware {\r\n    static readonly DEFAULT_FEATURES = [editFeature, deletableFeature, selectFeature, fadeFeature,\r\n        hoverFeedbackFeature];\r\n\r\n    selected: boolean = false;\r\n    hoverFeedback: boolean = false;\r\n    opacity: number = 1;\r\n\r\n}\r\n\r\n/**\r\n * A label can be attached to a node, edge, or port, and contains some text to be rendered in its view.\r\n */\r\nexport class SLabelImpl extends SShapeElementImpl implements Selectable, Alignable, Fadeable {\r\n    static readonly DEFAULT_FEATURES = [boundsFeature, alignFeature, layoutableChildFeature,\r\n        edgeLayoutFeature, fadeFeature];\r\n\r\n    text: string;\r\n    selected: boolean = false;\r\n    alignment: Point = Point.ORIGIN;\r\n    opacity = 1;\r\n    edgePlacement?: EdgePlacement;\r\n\r\n}\r\n\r\n/**\r\n * A compartment is used to group multiple child elements such as labels of a node. Usually a `vbox`\r\n * or `hbox` layout is used to arrange these children.\r\n */\r\nexport class SCompartmentImpl extends SShapeElementImpl implements Fadeable {\r\n    static readonly DEFAULT_FEATURES = [boundsFeature, layoutContainerFeature, layoutableChildFeature,\r\n        fadeFeature];\r\n\r\n    override children: SChildElementImpl[];\r\n    layout?: string;\r\n    override layoutOptions?: {[key: string]: string | number | boolean};\r\n    opacity = 1;\r\n\r\n}\r\n\r\n\r\n\r\n/**\r\n * A specialized model index that tracks outgoing and incoming edges.\r\n */\r\nexport class SGraphIndex extends ModelIndexImpl {\r\n\r\n    private outgoing: Map<string, SEdgeImpl[]> = new Map;\r\n    private incoming: Map<string, SEdgeImpl[]> = new Map;\r\n\r\n    override add(element: SModelElementImpl): void {\r\n        super.add(element);\r\n        if (element instanceof SEdgeImpl) {\r\n            // Register the edge in the outgoing map\r\n            if (element.sourceId) {\r\n                const sourceArr = this.outgoing.get(element.sourceId);\r\n                if (sourceArr === undefined)\r\n                    this.outgoing.set(element.sourceId, [element]);\r\n                else\r\n                    sourceArr.push(element);\r\n            }\r\n            // Register the edge in the incoming map\r\n            if (element.targetId) {\r\n                const targetArr = this.incoming.get(element.targetId);\r\n                if (targetArr === undefined)\r\n                    this.incoming.set(element.targetId, [element]);\r\n                else\r\n                    targetArr.push(element);\r\n            }\r\n        }\r\n    }\r\n\r\n    override remove(element: SModelElementImpl): void {\r\n        super.remove(element);\r\n        if (element instanceof SEdgeImpl) {\r\n            // Remove the edge from the outgoing map\r\n            const sourceArr = this.outgoing.get(element.sourceId);\r\n            if (sourceArr !== undefined) {\r\n                const index = sourceArr.indexOf(element);\r\n                if (index >= 0) {\r\n                    if (sourceArr.length === 1)\r\n                        this.outgoing.delete(element.sourceId);\r\n                    else\r\n                        sourceArr.splice(index, 1);\r\n                }\r\n            }\r\n            // Remove the edge from the incoming map\r\n            const targetArr = this.incoming.get(element.targetId);\r\n            if (targetArr !== undefined) {\r\n                const index = targetArr.indexOf(element);\r\n                if (index >= 0) {\r\n                    if (targetArr.length === 1)\r\n                        this.incoming.delete(element.targetId);\r\n                    else\r\n                        targetArr.splice(index, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    override getAttachedElements(element: SModelElementImpl): FluentIterable<SModelElementImpl> {\r\n        return new FluentIterableImpl(\r\n            () => ({\r\n                outgoing: this.outgoing.get(element.id),\r\n                incoming: this.incoming.get(element.id),\r\n                nextOutgoingIndex: 0,\r\n                nextIncomingIndex: 0\r\n            }),\r\n            (state) => {\r\n                let index = state.nextOutgoingIndex;\r\n                if (state.outgoing !== undefined && index < state.outgoing.length) {\r\n                    state.nextOutgoingIndex = index + 1;\r\n                    return { done: false, value: state.outgoing[index] };\r\n                }\r\n                index = state.nextIncomingIndex;\r\n                if (state.incoming !== undefined) {\r\n                    // Filter out self-loops: edges that are both outgoing and incoming\r\n                    while (index < state.incoming.length) {\r\n                        const edge = state.incoming[index];\r\n                        if (edge.sourceId !== edge.targetId) {\r\n                            state.nextIncomingIndex = index + 1;\r\n                            return { done: false, value: edge };\r\n                        }\r\n                        index++;\r\n                    }\r\n                }\r\n                return { done: true, value: undefined as any };\r\n            }\r\n        );\r\n    }\r\n\r\n    getIncomingEdges(element: SConnectableElementImpl): FluentIterable<SEdgeImpl> {\r\n        return this.incoming.get(element.id) || [];\r\n    }\r\n\r\n    getOutgoingEdges(element: SConnectableElementImpl): FluentIterable<SEdgeImpl> {\r\n        return this.outgoing.get(element.id) || [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject } from \"inversify\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { InstanceRegistry } from \"../../utils/registry\";\r\nimport { SConnectableElementImpl } from \"./model\";\r\n\r\nexport const DIAMOND_ANCHOR_KIND = 'diamond';\r\nexport const ELLIPTIC_ANCHOR_KIND = 'elliptic';\r\nexport const RECTANGULAR_ANCHOR_KIND = 'rectangular';\r\n\r\nexport interface IAnchorComputer {\r\n    readonly kind: string;\r\n\r\n    /**\r\n     * Compute an anchor position for routing an edge towards this element.\r\n     *\r\n     * The default implementation returns the element's center point. If edges should be connected\r\n     * differently, e.g. to some point on the boundary of the element's view, the according computation\r\n     * should be implemented in a subclass by overriding this method.\r\n     *\r\n     * @param connectable The node or port an edge should be connected to.\r\n     * @param referencePoint The point from which the edge is routed towards this elemet, in the same\r\n     *                       coordintae system as the connectable.\r\n     * @param offset An optional offset value to be considered in the anchor computation;\r\n     *               positive values should shift the anchor away from this element, negative values\r\n     *               should shift the anchor more to the inside. Use this to adapt ot arrow heads.\r\n     */\r\n    getAnchor(connectable: SConnectableElementImpl, referencePoint: Point, offset?: number): Point;\r\n}\r\n\r\n\r\n@injectable()\r\nexport class AnchorComputerRegistry extends InstanceRegistry<IAnchorComputer> {\r\n\r\n    constructor(@multiInject(TYPES.IAnchorComputer) anchors: IAnchorComputer[]) {\r\n        super();\r\n        anchors.forEach(anchor => this.register(anchor.kind, anchor));\r\n    }\r\n\r\n    protected get defaultAnchorKind() {\r\n        return RECTANGULAR_ANCHOR_KIND;\r\n    }\r\n\r\n    override get(routerKind: string, anchorKind?: string): IAnchorComputer {\r\n        return super.get(`${routerKind}:${anchorKind || this.defaultAnchorKind}`);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { Bounds, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { SModelElementImpl, SParentElementImpl } from \"../../base/model/smodel\";\r\nimport { translateBounds, translatePoint } from \"../../base/model/smodel-utils\";\r\nimport { ResolvedHandleMove } from \"../move/move\";\r\nimport { RoutingHandleKind, SDanglingAnchorImpl, SRoutingHandleImpl, edgeInProgressID, edgeInProgressTargetHandleID } from \"./model\";\r\nimport { AnchorComputerRegistry, IAnchorComputer } from \"./anchor\";\r\nimport { SConnectableElementImpl, SRoutableElementImpl } from \"./model\";\r\nimport { EdgeSnapshot, IEdgeRouter, RoutedPoint } from \"./routing\";\r\n\r\nexport interface LinearRouteOptions {\r\n    minimalPointDistance: number\r\n    standardDistance: number\r\n    selfEdgeOffset: number\r\n}\r\n\r\nexport enum Side { RIGHT, LEFT, TOP, BOTTOM }\r\n\r\nexport class DefaultAnchors {\r\n    readonly bounds: Bounds;\r\n    readonly left: RoutedPoint;\r\n    readonly right: RoutedPoint;\r\n    readonly top: RoutedPoint;\r\n    readonly bottom: RoutedPoint;\r\n\r\n    constructor(readonly element: SConnectableElementImpl, edgeParent: SParentElementImpl, readonly kind: 'source' | 'target') {\r\n        const bounds = element.bounds;\r\n        this.bounds = translateBounds(bounds, element.parent, edgeParent);\r\n        this.left = { x: this.bounds.x, y: this.bounds.y + 0.5 * this.bounds.height, kind };\r\n        this.right = { x: this.bounds.x + this.bounds.width, y: this.bounds.y + 0.5 * this.bounds.height, kind };\r\n        this.top = { x: this.bounds.x + 0.5 * this.bounds.width, y: this.bounds.y, kind };\r\n        this.bottom = { x: this.bounds.x + 0.5 * this.bounds.width, y: this.bounds.y + this.bounds.height, kind };\r\n    }\r\n\r\n    get(side: Side): RoutedPoint {\r\n        return (this as any)[Side[side].toLowerCase()];\r\n    }\r\n\r\n    getNearestSide(point: Point): Side {\r\n        const leftDistance = Point.euclideanDistance(point, this.left);\r\n        const rightDistance = Point.euclideanDistance(point, this.right);\r\n        const topDistance = Point.euclideanDistance(point, this.top);\r\n        const bottomDistance = Point.euclideanDistance(point, this.bottom);\r\n        let currentNearestSide = Side.LEFT;\r\n        let currentMinDist = leftDistance;\r\n        if (rightDistance < currentMinDist) {\r\n            currentMinDist = rightDistance;\r\n            currentNearestSide = Side.RIGHT;\r\n        }\r\n        if (topDistance < currentMinDist) {\r\n            currentMinDist = topDistance;\r\n            currentNearestSide = Side.TOP;\r\n        }\r\n        if (bottomDistance < currentMinDist) {\r\n            currentMinDist = bottomDistance;\r\n            currentNearestSide = Side.BOTTOM;\r\n        }\r\n        return currentNearestSide;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport abstract class AbstractEdgeRouter implements IEdgeRouter {\r\n\r\n    @inject(AnchorComputerRegistry) anchorRegistry: AnchorComputerRegistry;\r\n\r\n    abstract get kind(): string;\r\n\r\n    abstract route(edge: SRoutableElementImpl): RoutedPoint[];\r\n\r\n    abstract createRoutingHandles(edge: SRoutableElementImpl): void;\r\n\r\n    protected abstract getOptions(edge: SRoutableElementImpl): LinearRouteOptions;\r\n\r\n    findOrthogonalIntersection(edge: SRoutableElementImpl, point: Point): {point: Point, derivative: Point} {\r\n        const calcOrthogonalIntersectionForSegment = (p1: Point, p2: Point) => {\r\n            // Calculate the direction vector d of the edge and vector pq from p1 to point q\r\n            const d: Point = Point.subtract(p2, p1);\r\n            const pq: Point = Point.subtract(point, p1);\r\n\r\n            // Calculate the scalar t for the direction vector d\r\n            const t: number = Point.dotProduct(pq, d) / Point.dotProduct(d, d);\r\n\r\n            // Check if the intersection point lies on the edge segment\r\n            if (t >= 0 && t <= 1) {\r\n                // Calculate and return the intersection point x\r\n                return Point.linear(p1, p2, t);\r\n            } else if (t < 0) {\r\n                return p1;\r\n            } else {\r\n                return p2;\r\n            }\r\n        };\r\n\r\n        // Calculate the intersection for each segment of the edge and return the closest one\r\n        const routedPoints = this.route(edge);\r\n        let intersectionPoint: Point = routedPoints[0];\r\n        let index = 0;\r\n        for (let i = 0; i < routedPoints.length - 1; ++i) {\r\n            const intersection = calcOrthogonalIntersectionForSegment(routedPoints[i], routedPoints[i + 1]);\r\n            if (Point.euclideanDistance(point, intersection) < Point.euclideanDistance(point, intersectionPoint)) {\r\n                intersectionPoint = intersection;\r\n                index = i;\r\n            }\r\n        }\r\n        const derivative = Point.subtract(routedPoints[index + 1], routedPoints[index]);\r\n        return {point: intersectionPoint, derivative};\r\n    }\r\n\r\n    pointAt(edge: SRoutableElementImpl, t: number): Point | undefined {\r\n        const segments = this.calculateSegment(edge, t);\r\n        if (!segments)\r\n            return undefined;\r\n        const { segmentStart, segmentEnd, lambda } = segments;\r\n        return Point.linear(segmentStart, segmentEnd, lambda);\r\n    }\r\n\r\n    derivativeAt(edge: SRoutableElementImpl, t: number): Point | undefined {\r\n        const segments = this.calculateSegment(edge, t);\r\n        if (!segments)\r\n            return undefined;\r\n        const { segmentStart, segmentEnd } = segments;\r\n        return {\r\n            x: segmentEnd.x - segmentStart.x,\r\n            y: segmentEnd.y - segmentStart.y\r\n        };\r\n    }\r\n\r\n    protected calculateSegment(edge: SRoutableElementImpl, t: number): { segmentStart: Point, segmentEnd: Point, lambda: number } | undefined {\r\n        if (t < 0 || t > 1)\r\n            return undefined;\r\n        const routedPoints = this.route(edge);\r\n        if (routedPoints.length < 2)\r\n            return undefined;\r\n        const segmentLengths: number[] = [];\r\n        let totalLength = 0;\r\n        for (let i = 0; i < routedPoints.length - 1; ++i) {\r\n            segmentLengths[i] = Point.euclideanDistance(routedPoints[i], routedPoints[i + 1]);\r\n            totalLength += segmentLengths[i];\r\n        }\r\n        let currentLenght = 0;\r\n        const tAsLenght = t * totalLength;\r\n        for (let i = 0; i < routedPoints.length - 1; ++i) {\r\n            const newLength = currentLenght + segmentLengths[i];\r\n            // avoid division by (almost) zero\r\n            if (segmentLengths[i] > 1E-8) {\r\n                if (newLength >= tAsLenght) {\r\n                    const lambda = Math.max(0, (tAsLenght - currentLenght)) / segmentLengths[i];\r\n                    return {\r\n                        segmentStart: routedPoints[i],\r\n                        segmentEnd: routedPoints[i + 1],\r\n                        lambda\r\n                    };\r\n                }\r\n            }\r\n            currentLenght = newLength;\r\n        }\r\n        return {\r\n            segmentEnd: routedPoints.pop()!,\r\n            segmentStart: routedPoints.pop()!,\r\n            lambda: 1\r\n        };\r\n    }\r\n\r\n    protected addHandle(edge: SRoutableElementImpl, kind: RoutingHandleKind, type: string, routingPointIndex: number): SRoutingHandleImpl {\r\n        const handle = new SRoutingHandleImpl();\r\n        handle.kind = kind;\r\n        handle.pointIndex = routingPointIndex;\r\n        handle.type = type;\r\n        if (kind === 'target' && edge.id === edgeInProgressID)\r\n            handle.id = edgeInProgressTargetHandleID;\r\n        edge.add(handle);\r\n        return handle;\r\n    }\r\n\r\n    getHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl): Point | undefined {\r\n        switch (handle.kind) {\r\n            case 'source':\r\n                if (edge.source instanceof SDanglingAnchorImpl)\r\n                    return edge.source.position;\r\n                else\r\n                    return route[0];\r\n            case 'target':\r\n                if (edge.target instanceof SDanglingAnchorImpl)\r\n                    return edge.target.position;\r\n                else {\r\n                    return route[route.length - 1];\r\n                }\r\n            default:\r\n                const position = this.getInnerHandlePosition(edge, route, handle);\r\n                if (position !== undefined)\r\n                    return position;\r\n                if (handle.pointIndex >= 0 && handle.pointIndex < edge.routingPoints.length)\r\n                    return edge.routingPoints[handle.pointIndex];\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected abstract getInnerHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl): Point | undefined;\r\n\r\n    protected findRouteSegment(edge: SRoutableElementImpl, route: RoutedPoint[], handleIndex: number): { start?: Point, end?: Point } {\r\n        const getIndex = (rp: RoutedPoint) => {\r\n            if (rp.pointIndex !== undefined)\r\n                return rp.pointIndex;\r\n            else if (rp.kind === 'target')\r\n                return edge.routingPoints.length;\r\n            else\r\n                return -2;\r\n        };\r\n        let start, end: RoutedPoint | undefined;\r\n        for (const rp of route) {\r\n            const i = getIndex(rp);\r\n            if (i <= handleIndex && (start === undefined || i > getIndex(start)))\r\n                start = rp;\r\n            if (i > handleIndex && (end === undefined || i < getIndex(end)))\r\n                end = rp;\r\n        }\r\n        return { start, end };\r\n    }\r\n\r\n    getTranslatedAnchor(connectable: SConnectableElementImpl, refPoint: Point, refContainer: SParentElementImpl, edge: SRoutableElementImpl, anchorCorrection: number = 0): Point {\r\n        const translatedRefPoint = translatePoint(refPoint, refContainer, connectable.parent);\r\n        const anchorComputer = this.getAnchorComputer(connectable);\r\n        const strokeCorrection = 0.5 * connectable.strokeWidth;\r\n        const anchor = anchorComputer.getAnchor(connectable, translatedRefPoint, anchorCorrection + strokeCorrection);\r\n        return translatePoint(anchor, connectable.parent, edge.parent);\r\n    }\r\n\r\n    protected getAnchorComputer(connectable: SConnectableElementImpl): IAnchorComputer {\r\n        return this.anchorRegistry.get(this.kind, connectable.anchorKind);\r\n    }\r\n\r\n    applyHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]): void {\r\n        const remainingMoves = moves.slice();\r\n        moves.forEach(move => {\r\n            const handle = move.handle;\r\n            if (handle.kind === 'source' && !(edge.source instanceof SDanglingAnchorImpl)) {\r\n                // detach source\r\n                const anchor = new SDanglingAnchorImpl();\r\n                anchor.id = edge.id + '_dangling-source';\r\n                anchor.original = edge.source;\r\n                anchor.position = move.toPosition;\r\n                handle.root.add(anchor);\r\n                handle.danglingAnchor = anchor;\r\n                edge.sourceId = anchor.id;\r\n            } else if (handle.kind === 'target' && !(edge.target instanceof SDanglingAnchorImpl)) {\r\n                // detach target\r\n                const anchor = new SDanglingAnchorImpl();\r\n                anchor.id = edge.id + '_dangling-target';\r\n                anchor.original = edge.target;\r\n                anchor.position = move.toPosition;\r\n                handle.root.add(anchor);\r\n                handle.danglingAnchor = anchor;\r\n                edge.targetId = anchor.id;\r\n            }\r\n            if (handle.danglingAnchor) {\r\n                handle.danglingAnchor.position = move.toPosition;\r\n                remainingMoves.splice(remainingMoves.indexOf(move), 1);\r\n            }\r\n        });\r\n        if (remainingMoves.length > 0)\r\n            this.applyInnerHandleMoves(edge, remainingMoves);\r\n        this.cleanupRoutingPoints(edge, edge.routingPoints, true, true);\r\n    }\r\n\r\n    protected abstract applyInnerHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]): void;\r\n\r\n    cleanupRoutingPoints(edge: SRoutableElementImpl, routingPoints: Point[], updateHandles: boolean, addRoutingPoints: boolean) {\r\n        const sourceAnchors = new DefaultAnchors(edge.source!, edge.parent, \"source\");\r\n        const targetAnchors = new DefaultAnchors(edge.target!, edge.parent, \"target\");\r\n        this.resetRoutingPointsOnReconnect(edge, routingPoints, updateHandles, sourceAnchors, targetAnchors);\r\n    }\r\n\r\n    protected resetRoutingPointsOnReconnect(edge: SRoutableElementImpl, routingPoints: Point[], updateHandles: boolean,\r\n        sourceAnchors: DefaultAnchors, targetAnchors: DefaultAnchors): boolean {\r\n        if (routingPoints.length === 0 || edge.source instanceof SDanglingAnchorImpl || edge.target instanceof SDanglingAnchorImpl) {\r\n            const options = this.getOptions(edge);\r\n            const corners = this.calculateDefaultCorners(edge, sourceAnchors, targetAnchors, options);\r\n            routingPoints.splice(0, routingPoints.length, ...corners);\r\n            if (updateHandles) {\r\n                let maxPointIndex = -2;\r\n                edge.children.forEach(child => {\r\n                    if (child instanceof SRoutingHandleImpl) {\r\n                        if (child.kind === 'target')\r\n                            child.pointIndex = routingPoints.length;\r\n                        else if (child.kind === 'line' && child.pointIndex >= routingPoints.length)\r\n                            edge.remove(child);\r\n                        else\r\n                            maxPointIndex = Math.max(child.pointIndex, maxPointIndex);\r\n                    }\r\n                });\r\n                for (let i = maxPointIndex; i < routingPoints.length - 1; ++i)\r\n                    this.addHandle(edge, 'manhattan-50%', 'volatile-routing-point', i);\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    applyReconnect(edge: SRoutableElementImpl, newSourceId?: string, newTargetId?: string) {\r\n        let hasChanged = false;\r\n        if (newSourceId) {\r\n            const newSource = edge.root.index.getById(newSourceId);\r\n            if (newSource instanceof SConnectableElementImpl) {\r\n                edge.sourceId = newSource.id;\r\n                hasChanged = true;\r\n            }\r\n        }\r\n        if (newTargetId) {\r\n            const newTarget = edge.root.index.getById(newTargetId);\r\n            if (newTarget instanceof SConnectableElementImpl) {\r\n                edge.targetId = newTarget.id;\r\n                hasChanged = true;\r\n            }\r\n        }\r\n        if (hasChanged) {\r\n            // reset attached elements in index\r\n            edge.index.remove(edge);\r\n            if (edge.id === edgeInProgressID) {\r\n                // create a proper edge id after connecting the edge in progress\r\n                const idGen = (counter: number) => `${edge.sourceId}_to_${edge.targetId}_${counter}`;\r\n                let idx = 0;\r\n                let newId = idGen(idx);\r\n                while (edge.index.getById(newId) !== undefined) {\r\n                    newId = idGen(++idx);\r\n                }\r\n                edge.id = newId;\r\n                const progressTargetHandle = edge.children.find(child => child.id === edgeInProgressTargetHandleID);\r\n                if (progressTargetHandle instanceof SRoutingHandleImpl) {\r\n                    // remove in progress target handle\r\n                    edge.remove(progressTargetHandle);\r\n                    if (progressTargetHandle.danglingAnchor) {\r\n                        // remove dangling anchor\r\n                        progressTargetHandle.danglingAnchor.parent.remove(progressTargetHandle.danglingAnchor);\r\n                    }\r\n                }\r\n            }\r\n            edge.index.add(edge);\r\n            if (this.getSelfEdgeIndex(edge) > -1) {\r\n                edge.routingPoints = [];\r\n                this.cleanupRoutingPoints(edge, edge.routingPoints, true, true);\r\n            }\r\n        }\r\n    }\r\n\r\n    takeSnapshot(edge: SRoutableElementImpl): EdgeSnapshot {\r\n        return {\r\n            routingPoints: edge.routingPoints.slice(),\r\n            routingHandles: edge.children\r\n                .filter(child => child instanceof SRoutingHandleImpl)\r\n                .map(child => child as SRoutingHandleImpl),\r\n            routedPoints: this.route(edge),\r\n            router: this,\r\n            source: edge.source,\r\n            target: edge.target\r\n        };\r\n    }\r\n\r\n    applySnapshot(edge: SRoutableElementImpl, snapshot: EdgeSnapshot): void {\r\n        edge.routingPoints = snapshot.routingPoints;\r\n        edge.removeAll(child => child instanceof SRoutingHandleImpl);\r\n        edge.routerKind = snapshot.router.kind;\r\n        snapshot.routingHandles.forEach(handle => edge.add(handle));\r\n        if (snapshot.source)\r\n            edge.sourceId = snapshot.source.id;\r\n        if (snapshot.target)\r\n            edge.targetId = snapshot.target.id;\r\n        // update index\r\n        edge.root.index.remove(edge as SModelElementImpl);\r\n        edge.root.index.add(edge as SModelElementImpl);\r\n    }\r\n\r\n    protected calculateDefaultCorners(edge: SRoutableElementImpl, sourceAnchors: DefaultAnchors, targetAnchors: DefaultAnchors, options: LinearRouteOptions): Point[] {\r\n        const selfEdgeIndex = this.getSelfEdgeIndex(edge);\r\n        if (selfEdgeIndex >= 0) {\r\n            const standardDist = options.standardDistance;\r\n            const delta = options.selfEdgeOffset * Math.min(sourceAnchors.bounds.width, sourceAnchors.bounds.height);\r\n            switch (selfEdgeIndex % 4) {\r\n                case 0:\r\n                    return [\r\n                        { x: sourceAnchors.get(Side.RIGHT).x + standardDist, y: sourceAnchors.get(Side.RIGHT).y + delta },\r\n                        { x: sourceAnchors.get(Side.RIGHT).x + standardDist, y: sourceAnchors.get(Side.BOTTOM).y + standardDist },\r\n                        { x: sourceAnchors.get(Side.BOTTOM).x + delta, y: sourceAnchors.get(Side.BOTTOM).y + standardDist },\r\n                    ];\r\n                case 1:\r\n                    return [\r\n                        { x: sourceAnchors.get(Side.BOTTOM).x - delta, y: sourceAnchors.get(Side.BOTTOM).y + standardDist },\r\n                        { x: sourceAnchors.get(Side.LEFT).x - standardDist, y: sourceAnchors.get(Side.BOTTOM).y + standardDist },\r\n                        { x: sourceAnchors.get(Side.LEFT).x - standardDist, y: sourceAnchors.get(Side.LEFT).y + delta },\r\n                    ];\r\n                case 2:\r\n                    return [\r\n                        { x: sourceAnchors.get(Side.LEFT).x - standardDist, y: sourceAnchors.get(Side.LEFT).y - delta },\r\n                        { x: sourceAnchors.get(Side.LEFT).x - standardDist, y: sourceAnchors.get(Side.TOP).y - standardDist },\r\n                        { x: sourceAnchors.get(Side.TOP).x - delta, y: sourceAnchors.get(Side.TOP).y - standardDist },\r\n                    ];\r\n                case 3:\r\n                    return [\r\n                        { x: sourceAnchors.get(Side.TOP).x + delta, y: sourceAnchors.get(Side.TOP).y - standardDist },\r\n                        { x: sourceAnchors.get(Side.RIGHT).x + standardDist, y: sourceAnchors.get(Side.TOP).y - standardDist },\r\n                        { x: sourceAnchors.get(Side.RIGHT).x + standardDist, y: sourceAnchors.get(Side.RIGHT).y - delta },\r\n                    ];\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    protected getSelfEdgeIndex(edge: SRoutableElementImpl): number {\r\n        if (!edge.source || edge.source !== edge.target)\r\n            return -1;\r\n        return edge.source.outgoingEdges\r\n            .filter(otherEdge => otherEdge.target === edge.source)\r\n            .indexOf(edge);\r\n    }\r\n\r\n    protected commitRoute(edge: SRoutableElementImpl, routedPoints: RoutedPoint[]) {\r\n        const newRoutingPoints: Point[] = [];\r\n        for (let i = 1; i < routedPoints.length - 1; ++i)\r\n            newRoutingPoints.push({ x: routedPoints[i].x, y: routedPoints[i].y });\r\n        edge.routingPoints = newRoutingPoints;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { angleBetweenPoints, Bounds, centerOfLine, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { SRoutingHandleImpl } from \"./model\";\r\nimport { ResolvedHandleMove } from \"../move/move\";\r\nimport { AnchorComputerRegistry } from \"./anchor\";\r\nimport { AbstractEdgeRouter, LinearRouteOptions } from \"./abstract-edge-router\";\r\nimport { SRoutableElementImpl } from \"./model\";\r\nimport { RoutedPoint } from \"./routing\";\r\n\r\nexport interface PolylineRouteOptions extends LinearRouteOptions {\r\n    /** The angle in radians below which a routing handle is removed. */\r\n    removeAngleThreshold: number;\r\n}\r\n\r\n@injectable()\r\nexport class PolylineEdgeRouter extends AbstractEdgeRouter {\r\n\r\n    @inject(AnchorComputerRegistry) override anchorRegistry: AnchorComputerRegistry;\r\n\r\n    static readonly KIND = 'polyline';\r\n\r\n    get kind() {\r\n        return PolylineEdgeRouter.KIND;\r\n    }\r\n\r\n    protected getOptions(edge: SRoutableElementImpl): PolylineRouteOptions {\r\n        return {\r\n            minimalPointDistance: 2,\r\n            removeAngleThreshold: 0.1,\r\n            standardDistance: 20,\r\n            selfEdgeOffset: 0.25\r\n        };\r\n    }\r\n\r\n    route(edge: SRoutableElementImpl): RoutedPoint[] {\r\n        const source = edge.source;\r\n        const target = edge.target;\r\n        if (source === undefined || target === undefined) {\r\n            return [];\r\n        }\r\n\r\n        let sourceAnchor: Point;\r\n        let targetAnchor: Point;\r\n        const options = this.getOptions(edge);\r\n        const routingPoints = edge.routingPoints.length > 0\r\n            ? edge.routingPoints\r\n            : [];\r\n        this.cleanupRoutingPoints(edge, routingPoints, false, false);\r\n        const rpCount = routingPoints !== undefined ? routingPoints.length : 0;\r\n        if (rpCount === 0) {\r\n            // Use the target center as start anchor reference\r\n            const startRef = Bounds.center(target.bounds);\r\n            sourceAnchor = this.getTranslatedAnchor(source, startRef, target.parent, edge, edge.sourceAnchorCorrection);\r\n            // Use the source center as end anchor reference\r\n            const endRef = Bounds.center(source.bounds);\r\n            targetAnchor = this.getTranslatedAnchor(target, endRef, source.parent, edge, edge.targetAnchorCorrection);\r\n        } else {\r\n            // Use the first routing point as start anchor reference\r\n            const p0 = routingPoints[0];\r\n            sourceAnchor = this.getTranslatedAnchor(source, p0, edge.parent, edge, edge.sourceAnchorCorrection);\r\n            // Use the last routing point as end anchor reference\r\n            const pn = routingPoints[rpCount - 1];\r\n            targetAnchor = this.getTranslatedAnchor(target, pn, edge.parent, edge, edge.targetAnchorCorrection);\r\n        }\r\n\r\n        const result: RoutedPoint[] = [];\r\n        result.push({ kind: 'source', x: sourceAnchor.x, y: sourceAnchor.y });\r\n        for (let i = 0; i < rpCount; i++) {\r\n            const p = routingPoints[i];\r\n            if (i > 0 && i < rpCount - 1\r\n                || i === 0 && Point.maxDistance(sourceAnchor, p) >= options.minimalPointDistance + (edge.sourceAnchorCorrection || 0)\r\n                || i === rpCount - 1 && Point.maxDistance(p, targetAnchor) >= options.minimalPointDistance + (edge.targetAnchorCorrection || 0)) {\r\n                result.push({ kind: 'linear', x: p.x, y: p.y, pointIndex: i });\r\n            }\r\n        }\r\n        result.push({ kind: 'target', x: targetAnchor.x, y: targetAnchor.y });\r\n            return this.filterEditModeHandles(result, edge, options);\r\n    }\r\n\r\n    /**\r\n     * Remove routed points that are in edit mode and for which the angle between the preceding and\r\n     * following points falls below a threshold.\r\n     */\r\n    protected filterEditModeHandles(route: RoutedPoint[], edge: SRoutableElementImpl, options: PolylineRouteOptions): RoutedPoint[] {\r\n        if (edge.children.length === 0)\r\n            return route;\r\n\r\n        let i = 0;\r\n        while (i < route.length) {\r\n            const curr = route[i];\r\n            if (curr.pointIndex !== undefined) {\r\n                const handle: SRoutingHandleImpl | undefined = edge.children.find(child =>\r\n                    child instanceof SRoutingHandleImpl && child.kind === 'junction' && child.pointIndex === curr.pointIndex) as any;\r\n                if (handle !== undefined && handle.editMode && i > 0 && i < route.length - 1) {\r\n                    const prev = route[i - 1], next = route[i + 1];\r\n                    const prevDiff: Point = { x: prev.x - curr.x, y: prev.y - curr.y };\r\n                    const nextDiff: Point = { x: next.x - curr.x, y: next.y - curr.y };\r\n                    const angle = angleBetweenPoints(prevDiff, nextDiff);\r\n                    if (Math.abs(Math.PI - angle) < options.removeAngleThreshold) {\r\n                        route.splice(i, 1);\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n            i++;\r\n        }\r\n        return route;\r\n    }\r\n\r\n    createRoutingHandles(edge: SRoutableElementImpl): void {\r\n        const rpCount = edge.routingPoints.length;\r\n        this.addHandle(edge, 'source', 'routing-point', -2);\r\n        this.addHandle(edge, 'line', 'volatile-routing-point', -1);\r\n        for (let i = 0; i < rpCount; i++) {\r\n            this.addHandle(edge, 'junction', 'routing-point', i);\r\n            this.addHandle(edge, 'line', 'volatile-routing-point', i);\r\n        }\r\n        this.addHandle(edge, 'target', 'routing-point', rpCount);\r\n    }\r\n\r\n    getInnerHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl) {\r\n        if (handle.kind === 'line') {\r\n            const { start, end } = this.findRouteSegment(edge, route, handle.pointIndex);\r\n            if (start !== undefined && end !== undefined)\r\n                return centerOfLine(start, end);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    applyInnerHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]) {\r\n        moves.forEach(move => {\r\n            const handle = move.handle;\r\n            const points = edge.routingPoints;\r\n            let index = handle.pointIndex;\r\n            if (handle.kind === 'line') {\r\n                // Upgrade to a proper routing point\r\n                handle.kind = 'junction';\r\n                handle.type = 'routing-point';\r\n                points.splice(index + 1, 0, move.fromPosition || points[Math.max(index, 0)]);\r\n                edge.children.forEach(child => {\r\n                    if (child instanceof SRoutingHandleImpl && (child === handle || child.pointIndex > index))\r\n                        child.pointIndex++;\r\n                });\r\n                this.addHandle(edge, 'line', 'volatile-routing-point', index);\r\n                index++;\r\n                this.addHandle(edge, 'line', 'volatile-routing-point', index);\r\n            }\r\n            if (index >= 0 && index < points.length) {\r\n                points[index] = move.toPosition;\r\n            }\r\n        });\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, multiInject, optional } from \"inversify\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { SParentElementImpl } from \"../../base/model/smodel\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { findArgValue, IViewArgs } from \"../../base/views/view\";\r\nimport { InstanceRegistry } from \"../../utils/registry\";\r\nimport { ResolvedHandleMove } from \"../move/move\";\r\nimport { SRoutingHandleImpl } from \"../routing/model\";\r\nimport { SConnectableElementImpl, SRoutableElementImpl } from \"./model\";\r\nimport { PolylineEdgeRouter } from \"./polyline-edge-router\";\r\n\r\n/**\r\n * A point describing the shape of an edge.\r\n *\r\n * The <code>RoutedPoints</code> of an edge are derived from the <code>routingPoints</code>\r\n * which plain <code>Points</code> stored in the SModel by the <code>IEdgeRouter</code>.\r\n * As opposed to the originals, they also contain the source and target anchor points.\r\n * The router may also add or remove points in order to satisfy the constraints\r\n * the constraints of the routing algorithm or in order to to filter out points which are\r\n * obsolete, e.g. to close to each other.\r\n */\r\nexport interface RoutedPoint extends Point {\r\n    kind: 'source' | 'target' | 'linear' | 'bezier-control-before' | 'bezier-junction' | 'bezier-control-after'\r\n    pointIndex?: number\r\n}\r\n\r\n/**\r\n * Stores the state of an edge at a specific time.\r\n */\r\nexport interface EdgeSnapshot {\r\n    routingHandles: SRoutingHandleImpl[]\r\n    routingPoints: Point[]\r\n    routedPoints: RoutedPoint[]\r\n    router: IEdgeRouter\r\n    source?: SConnectableElementImpl\r\n    target?: SConnectableElementImpl\r\n}\r\n\r\nexport interface EdgeMemento {\r\n    edge: SRoutableElementImpl\r\n    before: EdgeSnapshot\r\n    after: EdgeSnapshot\r\n}\r\n\r\n/**\r\n * Encapsulates the logic of how the actual shape of an edge is derived from its routing points,\r\n * and how the user can modify it.\r\n */\r\nexport interface IEdgeRouter {\r\n\r\n    readonly kind: string;\r\n\r\n    /**\r\n     * Calculates the route of the given edge.\r\n     */\r\n    route(edge: SRoutableElementImpl): RoutedPoint[]\r\n\r\n    /**\r\n     * Finds the orthogonal intersection point between an edge and a given point in 2D space.\r\n     *\r\n     * @param edge - The edge to find the intersection point on.\r\n     * @param point - The point to find the intersection with.\r\n     * @returns The intersection point and its derivative on the respective edge segment.\r\n     */\r\n    findOrthogonalIntersection(edge: SRoutableElementImpl, point: Point): {point: Point, derivative: Point} | undefined\r\n\r\n    /**\r\n     * Calculates a point on the edge\r\n     *\r\n     * @param t a value between 0 (sourceAnchor) and 1 (targetAnchor)\r\n     * @returns the point or undefined if t is out of bounds or it cannot be computed\r\n     */\r\n    pointAt(edge: SRoutableElementImpl, t: number): Point | undefined\r\n\r\n    /**\r\n     * Calculates the derivative at a point on the edge.\r\n     *\r\n     * @param t a value between 0 (sourceAnchor) and 1 (targetAnchor)\r\n     * @returns the point or undefined if t is out of bounds or it cannot be computed\r\n     */\r\n    derivativeAt(edge: SRoutableElementImpl, t: number): Point | undefined\r\n\r\n    /**\r\n     * Retuns the position of the given handle based on the routing points of the edge.\r\n     */\r\n    getHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl): Point | undefined\r\n\r\n    /**\r\n     * Creates the routing handles for the given target.\r\n     */\r\n    createRoutingHandles(edge: SRoutableElementImpl): void\r\n\r\n    /**\r\n     * Updates the routing points and handles of the given edge with regard to the given moves.\r\n     */\r\n    applyHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]): void\r\n\r\n    /**\r\n     * Updates the routing points and handles of the given edge with regard to the given moves.\r\n     */\r\n    applyReconnect(edge: SRoutableElementImpl, newSourceId?: string, newTargetId?: string): void\r\n\r\n    /**\r\n     * Remove/add points in order to keep routing constraints consistent, or reset RPs on reconnect.\r\n     */\r\n    cleanupRoutingPoints(edge: SRoutableElementImpl, routingPoints: Point[], updateHandles: boolean, addRoutingPoints: boolean): void;\r\n    /**\r\n     * Creates a snapshot of the given edge, storing all the data needed to restore it to\r\n     * its current state.\r\n     */\r\n    takeSnapshot(edge: SRoutableElementImpl): EdgeSnapshot;\r\n\r\n    /**\r\n     * Applies a snapshot to the current edge.\r\n     */\r\n    applySnapshot(edge: SRoutableElementImpl, edgeSnapshot: EdgeSnapshot): void;\r\n}\r\n\r\nexport interface IMultipleEdgesRouter extends IEdgeRouter {\r\n    routeAll(\r\n        edges: SRoutableElementImpl[],\r\n        parent: Readonly<SParentElementImpl>\r\n    ): EdgeRouting;\r\n}\r\n\r\nfunction isMultipleEdgesRouter(\r\n    router: IEdgeRouter | IMultipleEdgesRouter\r\n): router is IMultipleEdgesRouter {\r\n    return (router as IMultipleEdgesRouter).routeAll !== undefined;\r\n}\r\n\r\n/** A postprocessor that is applied to all routes, once they are computed. */\r\nexport interface IEdgeRoutePostprocessor {\r\n    apply(routing: EdgeRouting): void;\r\n}\r\n\r\n@injectable()\r\nexport class EdgeRouterRegistry extends InstanceRegistry<IEdgeRouter> {\r\n\r\n    @multiInject(TYPES.IEdgeRoutePostprocessor) @optional()\r\n    protected postProcessors: IEdgeRoutePostprocessor[];\r\n\r\n    constructor(@multiInject(TYPES.IEdgeRouter) edgeRouters: IEdgeRouter[]) {\r\n        super();\r\n        edgeRouters.forEach(router => this.register(router.kind, router));\r\n    }\r\n\r\n    protected get defaultKind() {\r\n        return PolylineEdgeRouter.KIND;\r\n    }\r\n\r\n    override get(kind: string | undefined): IEdgeRouter {\r\n        return super.get(kind || this.defaultKind);\r\n    }\r\n\r\n    /**\r\n     * Computes the routes of all edges contained by the specified `parent`.\r\n     * After all routes are available, it'll apply the registered `EdgeRoutePostProcessors`.\r\n     * @param parent the parent to traverse for edges\r\n     * @returns the routes of all edges that are children of `parent`\r\n     */\r\n    routeAllChildren(parent: Readonly<SParentElementImpl>): EdgeRouting {\r\n        const routing = this.doRouteAllChildren(parent);\r\n        for (const postProcessor of this.postProcessors) {\r\n            postProcessor.apply(routing);\r\n        }\r\n        return routing;\r\n    }\r\n\r\n    /**\r\n     * Recursively traverses the children of `parent`, collects children grouped by router kind,\r\n     * and then routes them either.\r\n     * @param parent the parent to traverse for edges\r\n     * @returns the routes of all edges that are children of `parent`\r\n     */\r\n    protected doRouteAllChildren(parent: Readonly<SParentElementImpl>) {\r\n        const routing = new EdgeRouting();\r\n        const routersEdges = new Map<string, SRoutableElementImpl[]>();\r\n\r\n        const elementsToProcess = [parent];\r\n        while (elementsToProcess.length > 0) {\r\n            const element = elementsToProcess.shift() as SParentElementImpl;\r\n            for (const child of element.children) {\r\n                if (child instanceof SRoutableElementImpl) {\r\n                    const routerKind = child.routerKind || this.defaultKind;\r\n                    if (routersEdges.has(routerKind)) {\r\n                        (routersEdges.get(routerKind) as SRoutableElementImpl[]).push(child);\r\n                    } else {\r\n                        routersEdges.set(routerKind, [child]);\r\n                    }\r\n                }\r\n                if (child instanceof SParentElementImpl) {\r\n                    elementsToProcess.push(child);\r\n                }\r\n            }\r\n        }\r\n\r\n        routersEdges.forEach((edges, routerKind) => {\r\n            const childRouter = this.get(routerKind);\r\n            if (isMultipleEdgesRouter(childRouter)) {\r\n                routing.setAll(childRouter.routeAll(edges, parent));\r\n            } else {\r\n                for (const edge of  edges) {\r\n                    routing.set(edge.id, this.route(edge));\r\n                }\r\n            }\r\n        });\r\n\r\n        return routing;\r\n    }\r\n\r\n    /**\r\n     * Computes or obtains the route of a single edge.\r\n     * @param edge the edge to be routed\r\n     * @param args arguments that may contain an `EdgeRouting` already\r\n     * @returns the route of the specified `edge`\r\n     */\r\n    route(edge: Readonly<SRoutableElementImpl>, args?: IViewArgs): RoutedPoint[] {\r\n        const edgeRouting = findArgValue<EdgeRouting>(args, 'edgeRouting');\r\n        if (edgeRouting) {\r\n            const route = edgeRouting.get(edge.id);\r\n            if (route) {\r\n                return route;\r\n            }\r\n        }\r\n        const router = this.get(edge.routerKind);\r\n        return router.route(edge);\r\n    }\r\n\r\n}\r\n\r\n/** Any object that contains a routing, such as an argument object passed to views for rendering. */\r\nexport interface EdgeRoutingContainer {\r\n    edgeRouting: EdgeRouting;\r\n}\r\n\r\n/**\r\n * Map of edges and their computed routes.\r\n */\r\nexport class EdgeRouting {\r\n\r\n    protected routesMap = new Map<string, RoutedPoint[]>();\r\n\r\n    set(routableId: string, route: RoutedPoint[]): void {\r\n        this.routesMap.set(routableId, route);\r\n    }\r\n\r\n    setAll(otherRoutes: EdgeRouting): void {\r\n        otherRoutes.routes.forEach((route, routableId) => this.set(routableId, route));\r\n    }\r\n\r\n    get(routableId: string): RoutedPoint[] | undefined {\r\n        return this.routesMap.get(routableId);\r\n    }\r\n\r\n    get routes() {\r\n        return this.routesMap;\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Bounds, Point, toDegrees } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { EdgeLayoutable, EdgePlacement } from 'sprotty-protocol/lib/model';\r\nimport { SModelElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { IVNodePostprocessor } from '../../base/views/vnode-postprocessor';\r\nimport { setAttr } from '../../base/views/vnode-utils';\r\nimport { SEdgeImpl } from '../../graph/sgraph';\r\nimport { Orientation } from '../../utils/geometry';\r\nimport { isAlignable, InternalBoundsAware } from '../bounds/model';\r\nimport { DEFAULT_EDGE_PLACEMENT, isEdgeLayoutable, checkEdgePlacement } from './model';\r\nimport { EdgeRouterRegistry } from '../routing/routing';\r\nimport { TYPES } from '../../base/types';\r\nimport { ILogger } from '../../utils/logging';\r\n\r\n@injectable()\r\nexport class EdgeLayoutPostprocessor implements IVNodePostprocessor {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n    @inject(TYPES.ILogger) protected readonly logger: ILogger;\r\n\r\n    /**\r\n     * Decorates the vnode with the appropriate transformation based on the element's placement and bounds.\r\n     * @param vnode - The vnode to decorate.\r\n     * @param element - The SModelElementImpl to decorate.\r\n     * @returns The decorated vnode.\r\n     */\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (isEdgeLayoutable(element) && element.parent instanceof SEdgeImpl) {\r\n            if (element.bounds !== Bounds.EMPTY) {\r\n                const actualBounds = element.bounds;\r\n                const hasOwnPlacement = checkEdgePlacement(element);\r\n                const placement = this.getEdgePlacement(element);\r\n                const edge = element.parent;\r\n                const position = Math.min(1, Math.max(0, placement.position));\r\n                const router = this.edgeRouterRegistry.get(edge.routerKind);\r\n                // point on edge derived from edgePlacement.position\r\n                const pointOnEdge = router.pointAt(edge, position);\r\n                let transform = '';\r\n                // Calculation of potential free movement. Just add the actual bounds to the point on edge.\r\n                const freeTransform = `translate(${(pointOnEdge?.x ?? 0) + actualBounds.x}, ${(pointOnEdge?.y ?? 0) + actualBounds.y})`;\r\n                // Check if edgeplacement is set. If not the label is freely movable if movefeature is enabled for such labels.\r\n                if (hasOwnPlacement) {\r\n                    if (pointOnEdge) {\r\n                        let derivativeOnEdge: Point | undefined;\r\n                        // handle different move modes\r\n                        if (placement.moveMode && placement.moveMode !== 'edge') {\r\n                            // get the relative position on segment\r\n                            derivativeOnEdge = router.derivativeAt(edge, position);\r\n                            // handle free move mode\r\n                            if (placement.moveMode === 'free') {\r\n                                transform += freeTransform;\r\n                            } else {\r\n                                // The moveMode is neither 'edge' nor 'free' so it is 'none'. Hence the label is not movable and gets the fixed point on edge.\r\n                                transform += `translate(${pointOnEdge.x}, ${pointOnEdge.y})`;\r\n                            }\r\n                        } else {\r\n                            // no movemode was set or set to 'edge': label movement is constrained to the edge\r\n                            // Find orthogonal intersection point on edge and use it as the label's position\r\n                            const orthogonalPoint = router.findOrthogonalIntersection(edge, Point.add(pointOnEdge, actualBounds));\r\n                            if (orthogonalPoint) {\r\n                                derivativeOnEdge = orthogonalPoint.derivative;\r\n                                transform += `translate(${orthogonalPoint.point.x}, ${orthogonalPoint.point.y})`;\r\n                            }\r\n                        }\r\n                        if (derivativeOnEdge) {\r\n                            const angle = toDegrees(Math.atan2(derivativeOnEdge.y, derivativeOnEdge.x));\r\n                            if (placement.rotate) {\r\n                                let flippedAngle = angle;\r\n                                // Flip angle if it exceeds 90 degrees\r\n                                if (Math.abs(angle) > 90) {\r\n                                    if (angle < 0)\r\n                                        flippedAngle += 180;\r\n                                    else if (angle > 0)\r\n                                        flippedAngle -= 180;\r\n                                }\r\n                                transform += ` rotate(${flippedAngle})`;\r\n                                // Get rotated alignment based on flipped angle\r\n                                const alignment = this.getRotatedAlignment(element, placement, flippedAngle !== angle);\r\n                                transform += ` translate(${alignment.x}, ${alignment.y})`;\r\n                            } else {\r\n                                // Get alignment based on angle\r\n                                const alignment = this.getAlignment(element, placement, angle);\r\n                                transform += ` translate(${alignment.x}, ${alignment.y})`;\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    transform += freeTransform;\r\n                }\r\n                setAttr(vnode, 'transform', transform);\r\n            }\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    protected getRotatedAlignment(element: EdgeLayoutable & SModelElementImpl & InternalBoundsAware, placement: EdgePlacement, flip: boolean) {\r\n        let x = isAlignable(element) ? element.alignment.x : 0;\r\n        let y = isAlignable(element) ? element.alignment.y : 0;\r\n        const bounds = element.bounds;\r\n        if (placement.side === 'on')\r\n            return { x: x - 0.5 * bounds.height, y: y - 0.5 * bounds.height};\r\n        if (flip) {\r\n            if (placement.position < 0.3333333)\r\n                x -= bounds.width + placement.offset;\r\n            else if (placement.position < 0.6666666)\r\n                x -= 0.5 * bounds.width;\r\n            else\r\n                x += placement.offset;\r\n            switch (placement.side) {\r\n                case 'left':\r\n                case 'bottom':\r\n                    y -= placement.offset + bounds.height;\r\n                    break;\r\n                case 'right':\r\n                case 'top':\r\n                    y += placement.offset;\r\n            }\r\n        } else {\r\n            if (placement.position < 0.3333333)\r\n                x += placement.offset;\r\n            else if (placement.position < 0.6666666)\r\n                x -= 0.5 * bounds.width;\r\n            else\r\n                x -= bounds.width + placement.offset;\r\n            switch (placement.side) {\r\n                case 'right':\r\n                case 'bottom':\r\n                    y += - placement.offset - bounds.height;\r\n                    break;\r\n                case 'left':\r\n                case 'top':\r\n                    y += placement.offset;\r\n            }\r\n        }\r\n        return { x, y };\r\n    }\r\n\r\n    protected getEdgePlacement(element: SModelElementImpl): EdgePlacement {\r\n        let current = element;\r\n        const allPlacements: EdgePlacement[] = [];\r\n        while (current !== undefined) {\r\n            const placement = (current as any).edgePlacement;\r\n            if (placement !== undefined)\r\n                allPlacements.push(placement);\r\n            if (current instanceof SChildElementImpl)\r\n                current = current.parent;\r\n            else\r\n                break;\r\n        }\r\n        return allPlacements.reverse().reduce(\r\n            (a, b) => { return {...a, ...b}; }, DEFAULT_EDGE_PLACEMENT);\r\n    }\r\n\r\n    protected getAlignment(label: EdgeLayoutable & SModelElementImpl & InternalBoundsAware, placement: EdgePlacement, angle: number): Point {\r\n        const bounds = label.bounds;\r\n        const x = isAlignable(label) ? label.alignment.x - bounds.width : 0;\r\n        const y = isAlignable(label) ? label.alignment.y - bounds.height : 0;\r\n        if (placement.side === 'on') {\r\n            return { x: x + 0.5 * bounds.width, y: y + 0.5 * bounds.height};\r\n        }\r\n        const quadrant = this.getQuadrant(angle);\r\n        const midLeft = { x: placement.offset, y: y + 0.5 * bounds.height };\r\n        const topLeft = { x: placement.offset, y: y + bounds.height + placement.offset };\r\n        const topRight = { x: -bounds.width - placement.offset, y: y + bounds.height + placement.offset};\r\n        const midRight = { x: -bounds.width - placement.offset, y: y + 0.5 * bounds.height };\r\n        const bottomRight = { x: -bounds.width - placement.offset, y: y - placement.offset};\r\n        const bottomLeft = { x: placement.offset, y: y - placement.offset};\r\n        switch (placement.side) {\r\n            case 'left':\r\n                switch (quadrant.orientation) {\r\n                    case 'west':\r\n                        return Point.linear(topLeft, topRight, quadrant.position);\r\n                    case 'north':\r\n                        return Point.linear(topRight, bottomRight, quadrant.position);\r\n                    case 'east':\r\n                        return Point.linear(bottomRight, bottomLeft, quadrant.position);\r\n                    case 'south':\r\n                        return Point.linear(bottomLeft, topLeft, quadrant.position);\r\n                }\r\n                break;\r\n            case 'right':\r\n                switch (quadrant.orientation) {\r\n                    case 'west':\r\n                        return Point.linear(bottomRight, bottomLeft, quadrant.position);\r\n                    case 'north':\r\n                        return Point.linear(bottomLeft, topLeft, quadrant.position);\r\n                    case 'east':\r\n                        return Point.linear(topLeft, topRight, quadrant.position);\r\n                    case 'south':\r\n                        return Point.linear(topRight, bottomRight, quadrant.position);\r\n                }\r\n                break;\r\n            case 'top':\r\n                switch (quadrant.orientation) {\r\n                    case 'west':\r\n                        return Point.linear(bottomRight, bottomLeft, quadrant.position);\r\n                    case 'north':\r\n                        return this.linearFlip(bottomLeft, midLeft, midRight, bottomRight, quadrant.position);\r\n                    case 'east':\r\n                        return Point.linear(bottomRight, bottomLeft, quadrant.position);\r\n                    case 'south':\r\n                        return this.linearFlip(bottomLeft, midLeft, midRight, bottomRight, quadrant.position);\r\n                }\r\n                break;\r\n            case 'bottom':\r\n                switch (quadrant.orientation) {\r\n                    case 'west':\r\n                        return Point.linear(topLeft, topRight, quadrant.position);\r\n                    case 'north':\r\n                        return this.linearFlip(topRight, midRight, midLeft, topLeft, quadrant.position);\r\n                    case 'east':\r\n                        return Point.linear(topLeft, topRight, quadrant.position);\r\n                    case 'south':\r\n                        return this.linearFlip(topRight, midRight, midLeft, topLeft, quadrant.position);\r\n                }\r\n                break;\r\n        }\r\n        return {x: 0, y: 0};\r\n    }\r\n\r\n    protected getQuadrant(angle: number): {orientation: Orientation, position: number} {\r\n        if (Math.abs(angle) > 135)\r\n            return { orientation: 'west', position: (angle > 0 ? angle - 135 : angle + 225) / 90 };\r\n        else if (angle < -45)\r\n            return { orientation: 'north', position: (angle + 135) / 90 };\r\n        else if (angle < 45)\r\n            return { orientation: 'east', position: (angle + 45) / 90 };\r\n        else\r\n            return { orientation: 'south', position: (angle - 45) / 90 };\r\n    }\r\n\r\n    protected linearFlip(p0: Point, p1: Point, p2: Point, p3: Point, position: number) {\r\n        return position < 0.5 ? Point.linear(p0, p1, 2 * position) : Point.linear(p2, p3, 2 * position - 1);\r\n    }\r\n\r\n    postUpdate(): void {}\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { EdgeLayoutPostprocessor } from \"./edge-layout\";\r\n\r\nconst edgeLayoutModule = new ContainerModule(bind => {\r\n    bind(EdgeLayoutPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(EdgeLayoutPostprocessor);\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(EdgeLayoutPostprocessor);\r\n});\r\n\r\nexport default edgeLayoutModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { CreateElementAction } from 'sprotty-protocol/lib/actions';\r\nimport { Command, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { SParentElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\n\r\n@injectable()\r\nexport class CreateElementCommand extends Command {\r\n    static readonly KIND = CreateElementAction.KIND;\r\n\r\n    container: SParentElementImpl;\r\n    newElement: SChildElementImpl;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: CreateElementAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const container = context.root.index.getById(this.action.containerId);\r\n        if (container instanceof SParentElementImpl) {\r\n            this.container = container;\r\n            this.newElement = context.modelFactory.createElement(this.action.elementSchema);\r\n            this.container.add(this.newElement);\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        this.container.remove(this.newElement);\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        this.container.add(this.newElement);\r\n        return context.root;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { SModelElementImpl } from \"../../base/model/smodel\";\r\n\r\nexport const creatingOnDragFeature = Symbol('creatingOnDragFeature');\r\n\r\n/**\r\n *  Feature extension interface for {@link creatingOnDragFeature}.\r\n */\r\nexport interface CreatingOnDrag {\r\n    createAction(id: string): Action;\r\n}\r\n\r\nexport function isCreatingOnDrag<T extends SModelElementImpl>(element: T): element is T & CreatingOnDrag {\r\n    return element.hasFeature(creatingOnDragFeature) && (element as any).createAction !== undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { svg } from './jsx';\r\n\r\nimport { VNode } from 'snabbdom';\r\nimport { Hoverable, Selectable } from 'sprotty-protocol/lib/model';\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { IView, IViewArgs, RenderingContext } from '../base/views/view';\r\nimport { SNodeImpl, SPortImpl } from '../graph/sgraph';\r\nimport { ViewportRootElementImpl } from '../features/viewport/viewport-root';\r\nimport { SShapeElementImpl } from '../features/bounds/model';\r\nimport { ShapeView } from '../features/bounds/views';\r\nimport { Diamond } from '../utils/geometry';\r\nimport { SModelElementImpl } from '../base/model/smodel';\r\nimport { injectable } from 'inversify';\r\n\r\n@injectable()\r\nexport class SvgViewportView implements IView {\r\n    render(model: Readonly<ViewportRootElementImpl>, context: RenderingContext, args?: IViewArgs): VNode {\r\n        const transform = `scale(${model.zoom}) translate(${-model.scroll.x},${-model.scroll.y})`;\r\n        return <svg>\r\n            <g transform={transform}>\r\n                {context.renderChildren(model)}\r\n            </g>\r\n        </svg>;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class CircularNodeView extends ShapeView {\r\n    render(node: Readonly<SShapeElementImpl & Hoverable & Selectable>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        if (!this.isVisible(node, context)) {\r\n            return undefined;\r\n        }\r\n        const radius = this.getRadius(node);\r\n        return <g>\r\n            <circle class-sprotty-node={node instanceof SNodeImpl} class-sprotty-port={node instanceof SPortImpl}\r\n                    class-mouseover={node.hoverFeedback} class-selected={node.selected}\r\n                    r={radius} cx={radius} cy={radius}></circle>\r\n            {context.renderChildren(node)}\r\n        </g>;\r\n    }\r\n\r\n    protected getRadius(node: SShapeElementImpl): number {\r\n        const d = Math.min(node.size.width, node.size.height);\r\n        return d > 0 ? d / 2 : 0;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class RectangularNodeView extends ShapeView {\r\n    render(node: Readonly<SShapeElementImpl & Hoverable & Selectable>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        if (!this.isVisible(node, context)) {\r\n            return undefined;\r\n        }\r\n        return <g>\r\n            <rect class-sprotty-node={node instanceof SNodeImpl} class-sprotty-port={node instanceof SPortImpl}\r\n                  class-mouseover={node.hoverFeedback} class-selected={node.selected}\r\n                  x=\"0\" y=\"0\" width={Math.max(node.size.width, 0)} height={Math.max(node.size.height, 0)}></rect>\r\n            {context.renderChildren(node)}\r\n        </g>;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class DiamondNodeView extends ShapeView {\r\n    render(node: Readonly<SShapeElementImpl & Hoverable & Selectable>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        if (!this.isVisible(node, context)) {\r\n            return undefined;\r\n        }\r\n        const diamond = new Diamond({ height: Math.max(node.size.height, 0), width: Math.max(node.size.width, 0), x: 0, y: 0 });\r\n        const points = `${svgStr(diamond.topPoint)} ${svgStr(diamond.rightPoint)} ${svgStr(diamond.bottomPoint)} ${svgStr(diamond.leftPoint)}`;\r\n        return <g>\r\n            <polygon class-sprotty-node={node instanceof SNodeImpl} class-sprotty-port={node instanceof SPortImpl}\r\n                  class-mouseover={node.hoverFeedback} class-selected={node.selected}\r\n                  points={points} />\r\n            {context.renderChildren(node)}\r\n        </g>;\r\n    }\r\n}\r\n\r\nfunction svgStr(point: Point) {\r\n    return `${point.x},${point.y}`;\r\n}\r\n\r\n@injectable()\r\nexport class EmptyGroupView implements IView {\r\n    render(model: Readonly<SModelElementImpl>, context: RenderingContext): VNode {\r\n        return <g></g>;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject } from 'inversify';\r\nimport { Action, isAction, ApplyLabelEditAction } from 'sprotty-protocol/lib/actions';\r\nimport { CommandExecutionContext, CommandReturn, Command } from '../../base/commands/command';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { isSelectable } from '../select/model';\r\nimport { toArray } from '../../utils/iterable';\r\nimport { EditableLabel, isEditableLabel, isWithEditableLabel } from './model';\r\n\r\nexport interface EditLabelAction extends Action {\r\n    kind: typeof EditLabelAction.KIND\r\n    labelId: string\r\n}\r\nexport namespace EditLabelAction {\r\n    export const KIND = 'EditLabel';\r\n\r\n    export function create(labelId: string): EditLabelAction {\r\n        return {\r\n            kind: KIND,\r\n            labelId\r\n        };\r\n    }\r\n}\r\n\r\nexport function isEditLabelAction(element?: any): element is EditLabelAction {\r\n    return isAction(element) && element.kind === EditLabelAction.KIND && 'labelId' in element;\r\n}\r\n\r\nexport function isApplyLabelEditAction(element?: any): element is ApplyLabelEditAction {\r\n    return isAction(element) && element.kind === ApplyLabelEditAction.KIND && 'labelId' in element && 'text' in element;\r\n}\r\n\r\nexport class ResolvedLabelEdit {\r\n    label: EditableLabel;\r\n    oldLabel: string;\r\n    newLabel: string;\r\n}\r\n\r\nexport class ApplyLabelEditCommand extends Command {\r\n    static readonly KIND = ApplyLabelEditAction.KIND;\r\n\r\n    protected resolvedLabelEdit: ResolvedLabelEdit;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: ApplyLabelEditAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const index = context.root.index;\r\n        const label = index.getById(this.action.labelId);\r\n        if (label && isEditableLabel(label)) {\r\n            this.resolvedLabelEdit = { label, oldLabel: label.text, newLabel: this.action.text };\r\n            label.text = this.action.text;\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        if (this.resolvedLabelEdit) {\r\n            this.resolvedLabelEdit.label.text = this.resolvedLabelEdit.oldLabel;\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        if (this.resolvedLabelEdit) {\r\n            this.resolvedLabelEdit.label.text = this.resolvedLabelEdit.newLabel;\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n}\r\n\r\nexport interface IEditLabelValidator {\r\n    validate(value: string, label: EditableLabel & SModelElementImpl): Promise<EditLabelValidationResult>;\r\n}\r\n\r\nexport interface EditLabelValidationResult {\r\n    readonly severity: Severity;\r\n    readonly message?: string;\r\n}\r\n\r\nexport type Severity = 'ok' | 'warning' | 'error';\r\n\r\nexport class EditLabelMouseListener extends MouseListener {\r\n    override doubleClick(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const editableLabel = getEditableLabel(target);\r\n        if (editableLabel) {\r\n            return [EditLabelAction.create(editableLabel.id)];\r\n        }\r\n        return [];\r\n    }\r\n}\r\n\r\nexport class EditLabelKeyListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'F2')) {\r\n            const editableLabels = toArray(element.index.all()\r\n                .filter(e => isSelectable(e) && e.selected)).map(getEditableLabel)\r\n                .filter((e): e is EditableLabel & SModelElementImpl => e !== undefined);\r\n            if (editableLabels.length === 1) {\r\n                return [EditLabelAction.create(editableLabels[0].id)];\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n}\r\n\r\nexport function getEditableLabel(element: SModelElementImpl): EditableLabel & SModelElementImpl | undefined {\r\n    if (isEditableLabel(element)) {\r\n        return element;\r\n    } else if (isWithEditableLabel(element) && element.editableLabel) {\r\n        return element.editableLabel;\r\n    }\r\n    return undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from \"inversify\";\r\nimport { RequestAction, ResponseAction } from 'sprotty-protocol/lib/actions';\r\nimport { Bounds } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\nimport { isBoundsAware } from '../bounds/model';\r\nimport { ActionDispatcher } from '../../base/actions/action-dispatcher';\r\nimport { TYPES } from '../../base/types';\r\nimport { SModelRootImpl } from '../../base/model/smodel';\r\nimport { ILogger } from '../../utils/logging';\r\n\r\nexport interface ExportSvgAction extends ResponseAction {\r\n    kind: typeof ExportSvgAction.KIND;\r\n    svg: string\r\n    responseId: string\r\n}\r\nexport namespace ExportSvgAction {\r\n    export const KIND = 'exportSvg';\r\n\r\n    export function create(svg: string, requestId: string): ExportSvgAction {\r\n        return {\r\n            kind: KIND,\r\n            svg,\r\n            responseId: requestId\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SvgExporter {\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: ActionDispatcher;\r\n    @inject(TYPES.ILogger) protected log: ILogger;\r\n\r\n    export(root: SModelRootImpl, request?: RequestAction<ExportSvgAction>): void {\r\n        if (typeof document !== 'undefined') {\r\n            const hiddenDiv = document.getElementById(this.options.hiddenDiv);\r\n            if (hiddenDiv === null) {\r\n                this.log.warn(this, `Element with id ${this.options.hiddenDiv} not found. Nothing to export.`);\r\n                return;\r\n\r\n            }\r\n\r\n            const svgElement = hiddenDiv.querySelector('svg');\r\n            if (svgElement === null) {\r\n                this.log.warn(this, `No svg element found in ${this.options.hiddenDiv} div. Nothing to export.`);\r\n                return;\r\n            }\r\n            const svg = this.createSvg(svgElement, root);\r\n            this.actionDispatcher.dispatch(ExportSvgAction.create(svg, request ? request.requestId : ''));\r\n        }\r\n    }\r\n\r\n    protected createSvg(svgElementOrig: SVGSVGElement, root: SModelRootImpl): string {\r\n        const serializer = new XMLSerializer();\r\n        const svgCopy = serializer.serializeToString(svgElementOrig);\r\n        const iframe: HTMLIFrameElement = document.createElement('iframe');\r\n        document.body.appendChild(iframe);\r\n        if (!iframe.contentWindow)\r\n            throw new Error('IFrame has no contentWindow');\r\n        const docCopy = iframe.contentWindow.document;\r\n        docCopy.open();\r\n        docCopy.write(svgCopy);\r\n        docCopy.close();\r\n        const svgElementNew = docCopy.querySelector('svg')!;\r\n        svgElementNew.removeAttribute('opacity');\r\n        // inline-size copied from sprotty-hidden svg shrinks the svg so it is not visible.\r\n        this.copyStyles(svgElementOrig, svgElementNew, ['width', 'height', 'opacity', 'inline-size']);\r\n        svgElementNew.setAttribute('version', '1.1');\r\n        const bounds = this.getBounds(root);\r\n        svgElementNew.setAttribute('viewBox', `${bounds.x} ${bounds.y} ${bounds.width} ${bounds.height}`);\r\n        const svgCode = serializer.serializeToString(svgElementNew);\r\n        document.body.removeChild(iframe);\r\n        return svgCode;\r\n    }\r\n\r\n    protected copyStyles(source: Element, target: Element, skippedProperties: string[]) {\r\n        const sourceStyle = getComputedStyle(source);\r\n        const targetStyle = getComputedStyle(target);\r\n        let diffStyle = '';\r\n        for (let i = 0; i < sourceStyle.length; i++) {\r\n            const key = sourceStyle[i];\r\n            if (skippedProperties.indexOf(key) === -1) {\r\n                const value = sourceStyle.getPropertyValue(key);\r\n                if (targetStyle.getPropertyValue(key) !== value) {\r\n                    diffStyle += key + \":\" + value + \";\";\r\n                }\r\n            }\r\n        }\r\n        if (diffStyle !== '')\r\n            target.setAttribute('style', diffStyle);\r\n        // IE doesn't return anything on source.children\r\n        for (let i = 0; i < source.childNodes.length; ++i) {\r\n            const sourceChild = source.childNodes[i];\r\n            const targetChild = target.childNodes[i];\r\n            if (sourceChild instanceof Element)\r\n                this.copyStyles(sourceChild, targetChild as Element, []);\r\n        }\r\n    }\r\n\r\n    protected getBounds(root: SModelRootImpl) {\r\n        const allBounds: Bounds[] = [ Bounds.EMPTY ];\r\n        root.children.forEach(element => {\r\n            if (isBoundsAware(element)) {\r\n                allBounds.push(element.bounds);\r\n            }\r\n        });\r\n        return allBounds.reduce((one, two) => Bounds.combine(one, two));\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { Action, ComputedBoundsAction, RequestModelAction } from 'sprotty-protocol/lib/actions';\r\nimport { SModelElement, SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelIndex } from 'sprotty-protocol/lib/utils/model-utils';\r\nimport { IActionDispatcher } from '../base/actions/action-dispatcher';\r\nimport { ActionHandlerRegistry, IActionHandler, IActionHandlerInitializer } from '../base/actions/action-handler';\r\nimport { ICommand } from '../base/commands/command';\r\nimport { TYPES } from '../base/types';\r\nimport { ViewerOptions } from '../base/views/viewer-options';\r\nimport { ExportSvgAction } from '../features/export/svg-exporter';\r\n\r\n/**\r\n * A model source is serving the model to the event cycle. It represents\r\n * the entry point to the client for external sources, such as model\r\n * editors.\r\n *\r\n * As an `IActionHandler` it listens to actions in and reacts to them with\r\n * commands or actions if necessary. This way, you can implement action\r\n * protocols between the client and the outside world.\r\n *\r\n * There are two default implementations for a ModelSource:\r\n *\r\n *  - The `LocalModelSource` handles the actions to calculate bounds and\r\n *    set/update the model\r\n *  - the `DiagramServerProxy` connects via websocket to a remote source.\r\n *    It can be used to connect to a model editor that provides the model,\r\n *    layouts diagrams, transfers selection and answers model queries from\r\n *    the client.\r\n */\r\n@injectable()\r\nexport abstract class ModelSource implements IActionHandler, IActionHandlerInitializer {\r\n\r\n    @inject(TYPES.IActionDispatcher) readonly actionDispatcher: IActionDispatcher;\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n\r\n    initialize(registry: ActionHandlerRegistry): void {\r\n        // Register this model source\r\n        registry.register(RequestModelAction.KIND, this);\r\n        registry.register(ExportSvgAction.KIND, this);\r\n    }\r\n\r\n    abstract get model(): SModelRoot;\r\n\r\n    abstract handle(action: Action): ICommand | Action | void;\r\n\r\n    /**\r\n     * Commit changes from the internal SModel back to the currentModel.\r\n     *\r\n     * This method is meant to be called only by CommitModelCommand and other commands\r\n     * that need to feed the current internal model back to the model source. It does\r\n     * not have any side effects such as triggering layout or bounds computation, as the\r\n     * internal model is already current. See `CommitModelAction` for details.\r\n     *\r\n     * @param newRoot the new model.\r\n     * @return the previous model.\r\n     */\r\n    abstract commitModel(newRoot: SModelRoot): Promise<SModelRoot> | SModelRoot;\r\n}\r\n\r\n\r\n@injectable()\r\nexport class ComputedBoundsApplicator {\r\n    apply(root: SModelRoot, action: ComputedBoundsAction): SModelIndex {\r\n        const index = new SModelIndex();\r\n        index.add(root);\r\n        for (const b of action.bounds) {\r\n            const element = index.getById(b.elementId);\r\n            if (element !== undefined)\r\n                this.applyBounds(element, b.newPosition, b.newSize);\r\n        }\r\n        if (action.alignments !== undefined) {\r\n            for (const a of action.alignments) {\r\n                const element = index.getById(a.elementId);\r\n                if (element !== undefined)\r\n                    this.applyAlignment(element, a.newAlignment);\r\n            }\r\n        }\r\n        return index;\r\n    }\r\n\r\n    protected applyAlignment(element: SModelElement, newAlignment: Point) {\r\n        const e = element as any;\r\n        e.alignment = { x: newAlignment.x, y: newAlignment.y };\r\n    }\r\n\r\n    protected applyBounds(element: SModelElement, newPosition: Point | undefined, newSize: Dimension) {\r\n        const e = element as any;\r\n        if (newPosition)\r\n            e.position = {...newPosition};\r\n        e.size = {...newSize};\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { Action } from 'sprotty-protocol/lib/actions';\r\nimport { SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { CommandExecutionContext, CommandReturn, SystemCommand } from '../base/commands/command';\r\nimport { SModelRootImpl } from '../base/model/smodel';\r\nimport { TYPES } from '../base/types';\r\nimport { ModelSource } from './model-source';\r\n\r\n/**\r\n * Commit the current SModel back to the model source.\r\n *\r\n * The SModel (AKA internal model) contains a lot of dirty/transitional state, such\r\n * as intermediate move postions or handles. When a user interaction that spans multiple\r\n * commands finishes, it fires a CommitModelAction to write the final changes back to\r\n * the model source.\r\n */\r\nexport interface CommitModelAction extends Action {\r\n    kind: typeof CommitModelAction.KIND;\r\n}\r\nexport namespace CommitModelAction {\r\n    export const KIND = 'commitModel';\r\n\r\n    export function create(): CommitModelAction {\r\n        return {\r\n            kind: KIND\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class CommitModelCommand extends SystemCommand {\r\n    static readonly KIND = CommitModelAction.KIND;\r\n\r\n    @inject(TYPES.ModelSource) modelSource: ModelSource;\r\n\r\n    originalModel: SModelRoot;\r\n    newModel: SModelRoot;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: CommitModelAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.newModel = context.modelFactory.createSchema(context.root);\r\n        return this.doCommit(this.newModel, context.root, true);\r\n    }\r\n\r\n    protected doCommit(model: SModelRoot, result: SModelRootImpl, doSetOriginal: boolean): CommandReturn {\r\n        const commitResult = this.modelSource.commitModel(model);\r\n        if (commitResult instanceof Promise) {\r\n            return commitResult.then(originalModel => {\r\n                if (doSetOriginal)\r\n                    this.originalModel = originalModel;\r\n                return result;\r\n            });\r\n        } else {\r\n            if (doSetOriginal)\r\n                this.originalModel = commitResult;\r\n            return result;\r\n        }\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return this.doCommit(this.originalModel, context.root, false);\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return this.doCommit(this.newModel, context.root, false);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject } from 'inversify';\r\nimport { Action, SetViewportAction } from 'sprotty-protocol/lib/actions';\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { almostEquals, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { TYPES } from '../../base/types';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\nimport { getWindowScroll } from '../../utils/browser';\r\nimport { isViewport } from './model';\r\n\r\nexport function getZoom(label: SModelElementImpl) {\r\n    let zoom = 1;\r\n    const viewport = findParentByFeature(label, isViewport);\r\n    if (viewport) {\r\n        zoom = viewport.zoom;\r\n    }\r\n    return zoom;\r\n}\r\n\r\nexport class ZoomMouseListener extends MouseListener {\r\n\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n\r\n    override wheel(target: SModelElementImpl, event: WheelEvent): Action[] {\r\n        const viewport = findParentByFeature(target, isViewport);\r\n        if (!viewport) {\r\n            return [];\r\n        }\r\n        const newViewport = this.isScrollMode(event) ? this.processScroll(viewport, event) : this.processZoom(viewport, target, event);\r\n        if (newViewport) {\r\n            return [SetViewportAction.create(viewport.id, newViewport, { animate: false })];\r\n        }\r\n        return [];\r\n    }\r\n\r\n    protected isScrollMode(event: WheelEvent) {\r\n        return event.altKey;\r\n    }\r\n\r\n    protected processScroll(viewport: Viewport, event: WheelEvent): Viewport {\r\n        return {\r\n            scroll: {\r\n                x: viewport.scroll.x + event.deltaX,\r\n                y: viewport.scroll.y + event.deltaY\r\n            },\r\n            zoom: viewport.zoom\r\n        };\r\n    }\r\n\r\n    protected processZoom(viewport: Viewport, target: SModelElementImpl, event: WheelEvent): Viewport | undefined {\r\n        const zoomFactor = this.getZoomFactor(event);\r\n        if (zoomFactor > 1 && almostEquals(viewport.zoom, this.viewerOptions.zoomLimits.max)\r\n            || zoomFactor < 1 && almostEquals(viewport.zoom, this.viewerOptions.zoomLimits.min)) {\r\n            return;\r\n        }\r\n        const zoom = viewport.zoom * zoomFactor;\r\n        const viewportOffset = this.getViewportOffset(target.root, event);\r\n        const offsetFactor = 1.0 / zoom - 1.0 / viewport.zoom;\r\n        return {\r\n            scroll: {\r\n                x: viewport.scroll.x - offsetFactor * viewportOffset.x,\r\n                y: viewport.scroll.y - offsetFactor * viewportOffset.y\r\n            },\r\n            zoom\r\n        };\r\n    }\r\n\r\n    protected getViewportOffset(root: SModelRootImpl, event: WheelEvent): Point {\r\n        const canvasBounds = root.canvasBounds;\r\n        const windowScroll = getWindowScroll();\r\n        return {\r\n            x: event.clientX + windowScroll.x - canvasBounds.x,\r\n            y: event.clientY + windowScroll.y - canvasBounds.y\r\n        };\r\n    }\r\n\r\n    protected getZoomFactor(event: WheelEvent): number {\r\n        if (event.deltaMode === event.DOM_DELTA_PAGE)\r\n            return Math.exp(-event.deltaY * 0.5);\r\n        else if (event.deltaMode === event.DOM_DELTA_LINE)\r\n            return Math.exp(-event.deltaY * 0.05);\r\n        else // deltaMode === DOM_DELTA_PIXEL\r\n            return Math.exp(-event.deltaY * 0.005);\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019-2022 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, optional } from 'inversify';\r\nimport { Action, ApplyLabelEditAction } from 'sprotty-protocol/lib/actions';\r\nimport { IActionDispatcherProvider } from '../../base/actions/action-dispatcher';\r\nimport { IActionHandler } from '../../base/actions/action-handler';\r\nimport { ICommand } from '../../base/commands/command';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { TYPES } from '../../base/types';\r\nimport { AbstractUIExtension } from '../../base/ui-extensions/ui-extension';\r\nimport { SetUIExtensionVisibilityAction } from '../../base/ui-extensions/ui-extension-registry';\r\nimport { DOMHelper } from '../../base/views/dom-helper';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\nimport { CommitModelAction } from '../../model-source/commit-model';\r\nimport { matchesKeystroke, KeyCode, KeyboardModifier } from '../../utils/keyboard';\r\nimport { getAbsoluteClientBounds } from '../bounds/model';\r\nimport { getZoom } from '../viewport/zoom';\r\nimport { EditLabelValidationResult, IEditLabelValidator, isEditLabelAction, Severity } from './edit-label';\r\nimport { EditableLabel, isEditableLabel } from './model';\r\n\r\n/** Shows a UI extension for editing a label on emitted `EditLabelAction`s. */\r\n@injectable()\r\nexport class EditLabelActionHandler implements IActionHandler {\r\n    handle(action: Action): void | Action | ICommand {\r\n        if (isEditLabelAction(action)) {\r\n            return SetUIExtensionVisibilityAction.create({ extensionId: EditLabelUI.ID, visible: true, contextElementsId: [action.labelId] });\r\n        }\r\n    }\r\n}\r\n\r\nexport interface IEditLabelValidationDecorator {\r\n    decorate(input: HTMLInputElement | HTMLTextAreaElement, validationResult: EditLabelValidationResult): void;\r\n    dispose(input: HTMLInputElement | HTMLTextAreaElement): void;\r\n}\r\n\r\n@injectable()\r\nexport class EditLabelUI extends AbstractUIExtension {\r\n    static readonly ID = 'editLabelUi';\r\n\r\n    @inject(TYPES.IActionDispatcherProvider) public actionDispatcherProvider: IActionDispatcherProvider;\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n    @inject(TYPES.DOMHelper) protected domHelper: DOMHelper;\r\n    @inject(TYPES.IEditLabelValidator) @optional() public labelValidator: IEditLabelValidator;\r\n    @inject(TYPES.IEditLabelValidationDecorator) @optional() public validationDecorator: IEditLabelValidationDecorator;\r\n\r\n    protected inputElement: HTMLInputElement;\r\n    protected textAreaElement: HTMLTextAreaElement;\r\n\r\n    protected label?: EditableLabel & SModelElementImpl;\r\n    protected labelElement: HTMLElement | null;\r\n    protected validationTimeout?: number = undefined;\r\n    protected isActive: boolean = false;\r\n    protected blockApplyEditOnInvalidInput = true;\r\n    protected isCurrentLabelValid: boolean = true;\r\n    protected previousLabelContent?: string;\r\n\r\n    public id() { return EditLabelUI.ID; }\r\n    public containerClass() { return 'label-edit'; }\r\n\r\n    protected get labelId() { return this.label ? this.label.id : 'unknown'; }\r\n\r\n    protected initializeContents(containerElement: HTMLElement) {\r\n        containerElement.style.position = 'absolute';\r\n        this.inputElement = document.createElement('input');\r\n        this.textAreaElement = document.createElement('textarea');\r\n        [this.inputElement, this.textAreaElement].forEach((element) => {\r\n            element.onkeydown = event => this.applyLabelEditOnEvent(event, 'Enter');\r\n            this.configureAndAdd(element, containerElement);\r\n        });\r\n    }\r\n\r\n    protected configureAndAdd(element: HTMLInputElement | HTMLTextAreaElement, containerElement: HTMLElement) {\r\n        element.style.visibility = 'hidden';\r\n        element.style.position = 'absolute';\r\n        element.style.top = '0px';\r\n        element.style.left = '0px';\r\n        element.addEventListener('keydown', (event: KeyboardEvent) => this.hideIfEscapeEvent(event));\r\n        element.addEventListener('keyup', (event: KeyboardEvent) => this.validateLabelIfContentChange(event, element.value));\r\n        element.addEventListener('blur', () => window.setTimeout(() => this.applyLabelEdit(), 200));\r\n        containerElement.appendChild(element);\r\n    }\r\n\r\n    get editControl(): HTMLInputElement | HTMLTextAreaElement {\r\n        if (this.label && this.label.isMultiLine) {\r\n            return this.textAreaElement;\r\n        }\r\n        return this.inputElement;\r\n    }\r\n\r\n    protected hideIfEscapeEvent(event: KeyboardEvent) {\r\n        if (matchesKeystroke(event, 'Escape')) { this.hide(); }\r\n    }\r\n\r\n    protected applyLabelEditOnEvent(event: KeyboardEvent, code?: KeyCode, ...modifiers: KeyboardModifier[]) {\r\n        if (matchesKeystroke(event, code ? code : 'Enter', ...modifiers)) {\r\n            event.preventDefault();\r\n            this.applyLabelEdit();\r\n        }\r\n    }\r\n\r\n    protected validateLabelIfContentChange(event: KeyboardEvent, value: string) {\r\n        if (this.previousLabelContent === undefined || this.previousLabelContent !== value) {\r\n            this.previousLabelContent = value;\r\n            this.performLabelValidation(event, this.editControl.value);\r\n        }\r\n    }\r\n\r\n    protected async applyLabelEdit() {\r\n        if (!this.isActive) {\r\n            return;\r\n        }\r\n        if (this.label?.text === this.editControl.value) {\r\n            // no action necessary\r\n            this.hide();\r\n            return;\r\n        }\r\n        if (this.blockApplyEditOnInvalidInput) {\r\n            const result = await this.validateLabel(this.editControl.value);\r\n            if ('error' === result.severity) {\r\n                this.editControl.focus();\r\n                return;\r\n            }\r\n        }\r\n        this.actionDispatcherProvider()\r\n            .then((actionDispatcher) => actionDispatcher.dispatchAll([ApplyLabelEditAction.create(this.labelId, this.editControl.value), CommitModelAction.create()]))\r\n            .catch((reason) => this.logger.error(this, 'No action dispatcher available to execute apply label edit action', reason));\r\n        this.hide();\r\n    }\r\n\r\n    protected performLabelValidation(event: KeyboardEvent, value: string) {\r\n        if (this.validationTimeout) {\r\n            window.clearTimeout(this.validationTimeout);\r\n        }\r\n        this.validationTimeout = window.setTimeout(() => this.validateLabel(value), 200);\r\n    }\r\n\r\n    protected async validateLabel(value: string): Promise<EditLabelValidationResult> {\r\n        if (this.labelValidator && this.label) {\r\n            try {\r\n                const result = await this.labelValidator.validate(value, this.label);\r\n                this.isCurrentLabelValid = 'error' !== result.severity;\r\n                this.showValidationResult(result);\r\n                return result;\r\n            } catch (reason) {\r\n                this.logger.error(this, 'Error validating edited label', reason);\r\n            }\r\n        }\r\n        this.isCurrentLabelValid = true;\r\n        return { severity: <Severity>'ok', message: undefined };\r\n    }\r\n\r\n    protected showValidationResult(result: EditLabelValidationResult) {\r\n        this.clearValidationResult();\r\n        if (this.validationDecorator) {\r\n            this.validationDecorator.decorate(this.editControl, result);\r\n        }\r\n    }\r\n\r\n    protected clearValidationResult() {\r\n        if (this.validationDecorator) {\r\n            this.validationDecorator.dispose(this.editControl);\r\n        }\r\n    }\r\n\r\n    override show(root: Readonly<SModelRootImpl>, ...contextElementIds: string[]) {\r\n        if (!hasEditableLabel(contextElementIds, root) || this.isActive) {\r\n            return;\r\n        }\r\n        super.show(root, ...contextElementIds);\r\n        this.isActive = true;\r\n    }\r\n\r\n    override hide(): void {\r\n        this.editControl.style.visibility = 'hidden';\r\n        super.hide();\r\n        this.clearValidationResult();\r\n        this.isActive = false;\r\n        this.isCurrentLabelValid = true;\r\n        this.previousLabelContent = undefined;\r\n        if (this.labelElement) {\r\n            this.labelElement.style.visibility = 'visible';\r\n        }\r\n    }\r\n\r\n    protected override onBeforeShow(containerElement: HTMLElement, root: Readonly<SModelRootImpl>, ...contextElementIds: string[]) {\r\n        this.label = getEditableLabels(contextElementIds, root)[0];\r\n        this.previousLabelContent = this.label.text;\r\n        this.setPosition(containerElement);\r\n        this.applyTextContents();\r\n        this.applyFontStyling();\r\n        this.editControl.style.visibility = 'visible';\r\n        this.editControl.focus();\r\n    }\r\n\r\n    protected setPosition(containerElement: HTMLElement) {\r\n        let x = 0;\r\n        let y = 0;\r\n        let width = 100;\r\n        let height = 20;\r\n\r\n        if (this.label) {\r\n            const zoom = getZoom(this.label);\r\n            const bounds = getAbsoluteClientBounds(this.label, this.domHelper, this.viewerOptions);\r\n            x = bounds.x + (this.label.editControlPositionCorrection ? this.label.editControlPositionCorrection.x : 0) * zoom;\r\n            y = bounds.y + (this.label.editControlPositionCorrection ? this.label.editControlPositionCorrection.y : 0) * zoom;\r\n            height = (this.label.editControlDimension ? this.label.editControlDimension.height : height) * zoom;\r\n            width = (this.label.editControlDimension ? this.label.editControlDimension.width : width) * zoom;\r\n        }\r\n\r\n        containerElement.style.left = `${x}px`;\r\n        containerElement.style.top = `${y}px`;\r\n        containerElement.style.width = `${width}px`;\r\n        this.editControl.style.width = `${width}px`;\r\n        containerElement.style.height = `${height}px`;\r\n        this.editControl.style.height = `${height}px`;\r\n    }\r\n\r\n    protected applyTextContents() {\r\n        if (this.label) {\r\n            this.editControl.value = this.label.text;\r\n            if (this.editControl instanceof HTMLTextAreaElement) {\r\n                this.editControl.selectionStart = 0;\r\n                this.editControl.selectionEnd = 0;\r\n                this.editControl.scrollTop = 0;\r\n                this.editControl.scrollLeft = 0;\r\n            } else {\r\n                this.editControl.setSelectionRange(0, this.editControl.value.length);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected applyFontStyling() {\r\n        if (this.label) {\r\n            this.labelElement = document.getElementById(this.domHelper.createUniqueDOMElementId(this.label));\r\n            if (this.labelElement) {\r\n                this.labelElement.style.visibility = 'hidden';\r\n                const style = window.getComputedStyle(this.labelElement);\r\n                this.editControl.style.font = style.font;\r\n                this.editControl.style.fontStyle = style.fontStyle;\r\n                this.editControl.style.fontFamily = style.fontFamily;\r\n                this.editControl.style.fontSize = scaledFont(style.fontSize, getZoom(this.label));\r\n                this.editControl.style.fontWeight = style.fontWeight;\r\n                this.editControl.style.lineHeight = style.lineHeight;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction hasEditableLabel(contextElementIds: string[], root: Readonly<SModelRootImpl>) {\r\n    return getEditableLabels(contextElementIds, root).length === 1;\r\n}\r\n\r\nfunction getEditableLabels(contextElementIds: string[], root: Readonly<SModelRootImpl>) {\r\n    return contextElementIds.map(id => root.index.getById(id)).filter(isEditableLabel);\r\n}\r\n\r\nfunction scaledFont(font: string, zoom: number): string {\r\n    return font.replace(/\\d+(\\.\\d+)?/, (match) => {\r\n        return String(Number.parseInt(match, 10) * zoom);\r\n    });\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { Action } from \"sprotty-protocol/lib/actions\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { Command, CommandExecutionContext, CommandReturn } from \"../../base/commands/command\";\r\nimport { SModelElementImpl, SModelRootImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { TYPES } from \"../../base/types\";\r\nimport { SRoutableElementImpl, SRoutingHandleImpl } from \"../routing/model\";\r\nimport { EdgeRouterRegistry } from \"../routing/routing\";\r\nimport { canEditRouting } from './model';\r\n\r\nexport interface SwitchEditModeAction extends Action {\r\n    kind: typeof SwitchEditModeAction.KIND;\r\n    elementsToActivate: string[]\r\n    elementsToDeactivate: string[]\r\n}\r\nexport namespace SwitchEditModeAction {\r\n    export const KIND = \"switchEditMode\";\r\n\r\n    export function create(options: { elementsToActivate?: string[], elementsToDeactivate?: string[] }): SwitchEditModeAction {\r\n        return {\r\n            kind: KIND,\r\n            elementsToActivate: options.elementsToActivate ?? [],\r\n            elementsToDeactivate: options.elementsToDeactivate ?? []\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SwitchEditModeCommand extends Command {\r\n    static readonly KIND: string = SwitchEditModeAction.KIND;\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    protected elementsToActivate: SModelElementImpl[] = [];\r\n    protected elementsToDeactivate: SModelElementImpl[] = [];\r\n    protected handlesToRemove: { handle: SRoutingHandleImpl, parent: SRoutableElementImpl, point?: Point }[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SwitchEditModeAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const index = context.root.index;\r\n        this.action.elementsToActivate.forEach(id => {\r\n            const element = index.getById(id);\r\n            if (element !== undefined )\r\n                this.elementsToActivate.push(element);\r\n        });\r\n        this.action.elementsToDeactivate.forEach(id => {\r\n            const element = index.getById(id);\r\n            if (element !== undefined)\r\n                this.elementsToDeactivate.push(element);\r\n            if (element instanceof SRoutingHandleImpl && element.parent instanceof SRoutableElementImpl) {\r\n                const parent = element.parent;\r\n                if (this.shouldRemoveHandle(element, parent)) {\r\n                    this.handlesToRemove.push({ handle: element, parent });\r\n                    this.elementsToDeactivate.push(parent);\r\n                    this.elementsToActivate.push(parent);\r\n                }\r\n            }\r\n        });\r\n        return this.doExecute(context);\r\n    }\r\n\r\n    protected doExecute(context: CommandExecutionContext): SModelRootImpl {\r\n        this.handlesToRemove.forEach(entry => {\r\n            entry.point = entry.parent.routingPoints.splice(entry.handle.pointIndex, 1)[0];\r\n        });\r\n        this.elementsToDeactivate.forEach(element => {\r\n            if (element instanceof SRoutableElementImpl)\r\n                element.removeAll(child => child instanceof SRoutingHandleImpl);\r\n            else if (element instanceof SRoutingHandleImpl) {\r\n                element.editMode = false;\r\n                if (element.danglingAnchor) {\r\n                    if (element.parent instanceof SRoutableElementImpl && element.danglingAnchor.original)  {\r\n                        if (element.parent.source === element.danglingAnchor)\r\n                            element.parent.sourceId = element.danglingAnchor.original.id;\r\n                        else if (element.parent.target === element.danglingAnchor)\r\n                            element.parent.targetId = element.danglingAnchor.original.id;\r\n                        element.danglingAnchor.parent.remove(element.danglingAnchor);\r\n                        element.danglingAnchor = undefined;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this.elementsToActivate.forEach(element => {\r\n            if (canEditRouting(element) && element instanceof SParentElementImpl) {\r\n                const router = this.edgeRouterRegistry.get(element.routerKind);\r\n                router.createRoutingHandles(element);\r\n            } else if (element instanceof SRoutingHandleImpl)\r\n                element.editMode = true;\r\n        });\r\n        return context.root;\r\n    }\r\n\r\n    protected shouldRemoveHandle(handle: SRoutingHandleImpl, parent: SRoutableElementImpl): boolean {\r\n        if (handle.kind === 'junction') {\r\n            const route = this.edgeRouterRegistry.route(parent);\r\n            return route.find(rp => rp.pointIndex === handle.pointIndex) === undefined;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        this.handlesToRemove.forEach(entry => {\r\n            if (entry.point !== undefined)\r\n                entry.parent.routingPoints.splice(entry.handle.pointIndex, 0, entry.point);\r\n        });\r\n        this.elementsToActivate.forEach(element => {\r\n            if (element instanceof SRoutableElementImpl)\r\n                element.removeAll(child => child instanceof SRoutingHandleImpl);\r\n            else if (element instanceof SRoutingHandleImpl)\r\n                element.editMode = false;\r\n        });\r\n        this.elementsToDeactivate.forEach(element => {\r\n            if (canEditRouting(element)) {\r\n                const router = this.edgeRouterRegistry.get(element.routerKind);\r\n                router.createRoutingHandles(element);\r\n            } else if (element instanceof SRoutingHandleImpl)\r\n                element.editMode = true;\r\n        });\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return this.doExecute(context);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { ReconnectAction } from 'sprotty-protocol/lib/actions';\r\nimport { Command, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { TYPES } from '../../base/types';\r\nimport { SRoutableElementImpl } from '../routing/model';\r\nimport { EdgeMemento, EdgeRouterRegistry } from '../routing/routing';\r\n\r\n@injectable()\r\nexport class ReconnectCommand extends Command {\r\n    static readonly KIND = ReconnectAction.KIND;\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    memento: EdgeMemento | undefined;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: ReconnectAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.doExecute(context);\r\n        return context.root;\r\n    }\r\n\r\n    private doExecute(context: CommandExecutionContext) {\r\n        const index = context.root.index;\r\n        const edge = index.getById(this.action.routableId);\r\n        if (edge instanceof SRoutableElementImpl) {\r\n            const router = this.edgeRouterRegistry.get(edge.routerKind);\r\n            const before = router.takeSnapshot(edge);\r\n            router.applyReconnect(edge, this.action.newSourceId, this.action.newTargetId);\r\n            const after = router.takeSnapshot(edge);\r\n            this.memento = {\r\n                edge: edge,\r\n                before,\r\n                after\r\n            };\r\n        }\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        if (this.memento) {\r\n            const router = this.edgeRouterRegistry.get(this.memento.edge.routerKind);\r\n            router.applySnapshot(this.memento.edge, this.memento.before);\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        if (this.memento) {\r\n            const router = this.edgeRouterRegistry.get(this.memento.edge.routerKind);\r\n            router.applySnapshot(this.memento.edge, this.memento.after);\r\n        }\r\n        return context.root;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\nimport { configureActionHandler } from \"../../base/actions/action-handler\";\r\nimport { configureModelElement } from \"../../base/views/view\";\r\nimport { SDanglingAnchorImpl } from \"../../features/routing/model\";\r\nimport { EmptyGroupView } from \"../../lib/svg-views\";\r\nimport { DeleteElementCommand } from \"./delete\";\r\nimport { EditLabelMouseListener, ApplyLabelEditCommand, EditLabelKeyListener, EditLabelAction } from \"./edit-label\";\r\nimport { EditLabelUI, EditLabelActionHandler } from \"./edit-label-ui\";\r\nimport { SwitchEditModeCommand } from \"./edit-routing\";\r\nimport { ReconnectCommand } from \"./reconnect\";\r\n\r\nexport const edgeEditModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    const context = { bind, isBound };\r\n    configureCommand(context, SwitchEditModeCommand);\r\n    configureCommand(context, ReconnectCommand);\r\n    configureCommand(context, DeleteElementCommand);\r\n    configureModelElement(context, 'dangling-anchor', SDanglingAnchorImpl, EmptyGroupView);\r\n});\r\n\r\nexport const labelEditModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(EditLabelMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(EditLabelMouseListener);\r\n    bind(EditLabelKeyListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(EditLabelKeyListener);\r\n    configureCommand({ bind, isBound }, ApplyLabelEditCommand);\r\n});\r\n\r\nexport const labelEditUiModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    const context = { bind, isBound };\r\n    configureActionHandler(context, EditLabelAction.KIND, EditLabelActionHandler);\r\n    bind(EditLabelUI).toSelf().inSingletonScope();\r\n    bind(TYPES.IUIExtension).toService(EditLabelUI);\r\n});\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const expandFeature = Symbol('expandFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link expandFeature}.\r\n * Model elements that implement this interface can be expanded/collapsed\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Expandable {\r\n    expanded: boolean\r\n}\r\n\r\nexport function isExpandable(element: SModelElementImpl): element is SModelElementImpl & Expandable {\r\n    return element.hasFeature(expandFeature) && 'expanded' in element;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { Action, CollapseExpandAction } from 'sprotty-protocol/lib/actions';\r\nimport { SButtonImpl } from '../button/model';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { isExpandable } from './model';\r\nimport { IButtonHandler } from '../button/button-handler';\r\n\r\n@injectable()\r\nexport class ExpandButtonHandler implements IButtonHandler {\r\n    static TYPE = 'button:expand';\r\n\r\n    buttonPressed(button: SButtonImpl): Action[] {\r\n        const expandable = findParentByFeature(button, isExpandable);\r\n        if (expandable !== undefined) {\r\n            return [ CollapseExpandAction.create({\r\n                expandIds:   expandable.expanded ? [] : [ expandable.id ],\r\n                collapseIds:  expandable.expanded ? [ expandable.id ] : []\r\n            })];\r\n        } else {\r\n            return [];\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n /** @jsx svg */\r\nimport { svg } from '../../lib/jsx';\r\n\r\nimport { VNode } from 'snabbdom';\r\nimport { IView, RenderingContext } from '../../base/views/view';\r\nimport { isExpandable } from './model';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { SButtonImpl } from '../button/model';\r\nimport { injectable } from 'inversify';\r\n\r\n@injectable()\r\nexport class ExpandButtonView implements IView {\r\n    render(button: SButtonImpl, context: RenderingContext): VNode {\r\n        const expandable = findParentByFeature(button, isExpandable);\r\n        const path = (expandable !== undefined && expandable.expanded)\r\n            ? 'M 1,5 L 8,12 L 15,5 Z'\r\n            : 'M 1,8 L 8,15 L 8,1 Z';\r\n        return <g class-sprotty-button=\"{true}\" class-enabled=\"{button.enabled}\">\r\n                <rect x={0} y={0} width={16} height={16} opacity={0}></rect>\r\n                <path d={path}></path>\r\n            </g>;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from \"inversify\";\r\nimport { VNode } from 'snabbdom';\r\nimport { Action, generateRequestId, RequestAction } from \"sprotty-protocol/lib/actions\";\r\nimport { CommandExecutionContext, HiddenCommand, CommandResult } from '../../base/commands/command';\r\nimport { IVNodePostprocessor } from '../../base/views/vnode-postprocessor';\r\nimport { isSelectable } from '../select/model';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { isExportable } from './model';\r\nimport { SvgExporter, ExportSvgAction } from './svg-exporter';\r\nimport { isViewport } from '../viewport/model';\r\nimport { isHoverable } from '../hover/model';\r\nimport { TYPES } from '../../base/types';\r\n\r\n@injectable()\r\nexport class ExportSvgKeyListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'KeyE', 'ctrlCmd', 'shift'))\r\n            return [ RequestExportSvgAction.create() ];\r\n        else\r\n            return [];\r\n    }\r\n}\r\n\r\nexport interface RequestExportSvgAction extends RequestAction<ExportSvgAction> {\r\n    kind: typeof RequestExportSvgAction.KIND\r\n}\r\nexport namespace RequestExportSvgAction {\r\n    export const KIND = 'requestExportSvg';\r\n\r\n    export function create(): RequestExportSvgAction {\r\n        return {\r\n            kind: KIND,\r\n            requestId: generateRequestId()\r\n        };\r\n    }\r\n}\r\n\r\nexport class ExportSvgCommand extends HiddenCommand {\r\n    static readonly KIND = RequestExportSvgAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected action: RequestExportSvgAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandResult {\r\n        if (isExportable(context.root)) {\r\n            const root = context.modelFactory.createRoot(context.root);\r\n            if (isExportable(root)) {\r\n                if (isViewport(root)) {\r\n                    root.zoom = 1;\r\n                    root.scroll = { x: 0, y: 0 };\r\n                }\r\n                root.index.all().forEach(element => {\r\n                    if (isSelectable(element) && element.selected)\r\n                        element.selected = false;\r\n                    if (isHoverable(element) && element.hoverFeedback)\r\n                        element.hoverFeedback = false;\r\n                });\r\n                return {\r\n                    model: root,\r\n                    modelChanged: true,\r\n                    cause: this.action\r\n                };\r\n            }\r\n        }\r\n        return {\r\n            model: context.root,\r\n            modelChanged: false\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class ExportSvgPostprocessor implements IVNodePostprocessor {\r\n\r\n    root: SModelRootImpl;\r\n\r\n    @inject(TYPES.SvgExporter) protected svgExporter: SvgExporter;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (element instanceof SModelRootImpl)\r\n            this.root = element;\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(cause?: Action): void {\r\n        if (this.root && cause !== undefined && cause.kind === RequestExportSvgAction.KIND) {\r\n            this.svgExporter.export(this.root, cause as RequestExportSvgAction);\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Fadeable } from 'sprotty-protocol/lib/model';\r\nimport { Animation } from '../../base/animations/animation';\r\nimport { CommandExecutionContext } from '../../base/commands/command';\r\nimport { SModelRootImpl, SModelElementImpl, SChildElementImpl } from '../../base/model/smodel';\r\nimport { IVNodePostprocessor } from '../../base/views/vnode-postprocessor';\r\nimport { setAttr } from '../../base/views/vnode-utils';\r\nimport { isFadeable } from './model';\r\n\r\nexport interface ResolvedElementFade {\r\n    element: SModelElementImpl & Fadeable\r\n    type: 'in' | 'out'\r\n}\r\n\r\nexport class FadeAnimation extends Animation {\r\n\r\n    constructor(protected model: SModelRootImpl,\r\n                public elementFades: ResolvedElementFade[],\r\n                context: CommandExecutionContext,\r\n                protected removeAfterFadeOut: boolean = false) {\r\n        super(context);\r\n    }\r\n\r\n    tween(t: number, context: CommandExecutionContext): SModelRootImpl {\r\n        for (const elementFade of this.elementFades) {\r\n            const element = elementFade.element;\r\n            if (elementFade.type === 'in') {\r\n                element.opacity = t;\r\n            } else if (elementFade.type === 'out') {\r\n                element.opacity = 1 - t;\r\n                if (t === 1 && this.removeAfterFadeOut && element instanceof SChildElementImpl) {\r\n                    element.parent.remove(element);\r\n                }\r\n            }\r\n        }\r\n        return this.model;\r\n    }\r\n\r\n}\r\n\r\n@injectable()\r\nexport class ElementFader implements IVNodePostprocessor {\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (isFadeable(element) && element.opacity !== 1) {\r\n            setAttr(vnode, 'opacity', element.opacity);\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { Action, RequestPopupModelAction, SetPopupModelAction, HoverFeedbackAction } from 'sprotty-protocol/lib/actions';\r\nimport { Bounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { TYPES } from '../../base/types';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { CommandExecutionContext, PopupCommand, SystemCommand, CommandReturn, ICommand } from '../../base/commands/command';\r\nimport { IActionHandler } from '../../base/actions/action-handler';\r\nimport { EMPTY_ROOT } from '../../base/model/smodel-factory';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { findParentByFeature, findParent } from '../../base/model/smodel-utils';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\nimport { getAbsoluteBounds } from '../bounds/model';\r\nimport { hasPopupFeature, isHoverable } from './model';\r\n\r\n\r\n@injectable()\r\nexport class HoverFeedbackCommand extends SystemCommand {\r\n    static readonly KIND = HoverFeedbackAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: HoverFeedbackAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const model: SModelRootImpl = context.root;\r\n        const modelElement: SModelElementImpl | undefined = model.index.getById(this.action.mouseoverElement);\r\n\r\n        if (modelElement) {\r\n            if (isHoverable(modelElement)) {\r\n                modelElement.hoverFeedback = this.action.mouseIsOver;\r\n            }\r\n        }\r\n\r\n        return this.redo(context);\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return context.root;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SetPopupModelCommand extends PopupCommand {\r\n    static readonly KIND = SetPopupModelAction.KIND;\r\n\r\n    oldRoot: SModelRootImpl;\r\n    newRoot: SModelRootImpl;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SetPopupModelAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.oldRoot = context.root;\r\n        this.newRoot = context.modelFactory.createRoot(this.action.newRoot);\r\n\r\n        return this.newRoot;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return this.oldRoot;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return this.newRoot;\r\n    }\r\n}\r\n\r\nexport interface HoverState {\r\n    mouseOverTimer: number | undefined\r\n    mouseOutTimer: number | undefined\r\n    popupOpen: boolean\r\n    previousPopupElement: SModelElementImpl | undefined\r\n}\r\n\r\nexport abstract class AbstractHoverMouseListener extends MouseListener {\r\n\r\n    protected mouseIsDown: boolean;\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n    @inject(TYPES.HoverState) protected state: HoverState;\r\n\r\n    override mouseDown(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        this.mouseIsDown = true;\r\n        return [];\r\n    }\r\n\r\n    override mouseUp(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        this.mouseIsDown = false;\r\n        return [];\r\n    }\r\n\r\n    protected stopMouseOutTimer(): void {\r\n        if (this.state.mouseOutTimer !== undefined) {\r\n            window.clearTimeout(this.state.mouseOutTimer);\r\n            this.state.mouseOutTimer = undefined;\r\n        }\r\n    }\r\n\r\n    protected startMouseOutTimer(): Promise<Action> {\r\n        this.stopMouseOutTimer();\r\n        return new Promise((resolve) => {\r\n            this.state.mouseOutTimer = window.setTimeout(() => {\r\n                this.state.popupOpen = false;\r\n                this.state.previousPopupElement = undefined;\r\n                resolve(SetPopupModelAction.create({ type: EMPTY_ROOT.type, id: EMPTY_ROOT.id }));\r\n            }, this.options.popupCloseDelay);\r\n        });\r\n    }\r\n\r\n    protected stopMouseOverTimer(): void {\r\n        if (this.state.mouseOverTimer !== undefined) {\r\n            window.clearTimeout(this.state.mouseOverTimer);\r\n            this.state.mouseOverTimer = undefined;\r\n        }\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class HoverMouseListener extends AbstractHoverMouseListener {\r\n\r\n    protected lastHoverFeedbackElementId?: string;\r\n\r\n    @inject(TYPES.ViewerOptions) protected override options: ViewerOptions;\r\n\r\n    protected computePopupBounds(target: SModelElementImpl, mousePosition: Point): Bounds {\r\n        // Default position: below the mouse cursor\r\n        let offset: Point = { x: -5, y: 20 };\r\n\r\n        const targetBounds = getAbsoluteBounds(target);\r\n        const canvasBounds = target.root.canvasBounds;\r\n        const boundsInWindow = Bounds.translate(targetBounds, canvasBounds);\r\n        const distRight = boundsInWindow.x + boundsInWindow.width - mousePosition.x;\r\n        const distBottom = boundsInWindow.y + boundsInWindow.height - mousePosition.y;\r\n        if (distBottom <= distRight && this.allowSidePosition(target, 'below', distBottom)) {\r\n            // Put the popup below the target element\r\n            offset = { x: -5, y: Math.round(distBottom + 5) };\r\n        } else if (distRight <= distBottom && this.allowSidePosition(target, 'right', distRight)) {\r\n            // Put the popup right of the target element\r\n            offset = { x: Math.round(distRight + 5), y: -5 };\r\n        }\r\n        let leftPopupPosition = mousePosition.x + offset.x;\r\n        const canvasRightBorderPosition = canvasBounds.x + canvasBounds.width;\r\n        if (leftPopupPosition > canvasRightBorderPosition) {\r\n            leftPopupPosition = canvasRightBorderPosition;\r\n        }\r\n        let topPopupPosition = mousePosition.y + offset.y;\r\n        const canvasBottomBorderPosition = canvasBounds.y + canvasBounds.height;\r\n        if (topPopupPosition > canvasBottomBorderPosition) {\r\n            topPopupPosition = canvasBottomBorderPosition;\r\n        }\r\n        return { x: leftPopupPosition, y: topPopupPosition, width: -1, height: -1 };\r\n    }\r\n\r\n    protected allowSidePosition(target: SModelElementImpl, side: 'above' | 'below' | 'left' | 'right', distance: number): boolean {\r\n        return !(target instanceof SModelRootImpl) && distance <= 150;\r\n    }\r\n\r\n    protected startMouseOverTimer(target: SModelElementImpl, event: MouseEvent): Promise<Action> {\r\n        this.stopMouseOverTimer();\r\n        return new Promise((resolve) => {\r\n            this.state.mouseOverTimer = window.setTimeout(() => {\r\n                const popupBounds = this.computePopupBounds(target, { x: event.pageX, y: event.pageY });\r\n                resolve(RequestPopupModelAction.create({ elementId: target.id, bounds: popupBounds }));\r\n\r\n                this.state.popupOpen = true;\r\n                this.state.previousPopupElement = target;\r\n            }, this.options.popupOpenDelay);\r\n        });\r\n    }\r\n\r\n    override mouseOver(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: (Action | Promise<Action>)[] = [];\r\n        if (!this.mouseIsDown) {\r\n            const popupTarget = findParent(target, hasPopupFeature);\r\n            if (this.state.popupOpen && (popupTarget === undefined ||\r\n                this.state.previousPopupElement !== undefined && this.state.previousPopupElement.id !== popupTarget.id)) {\r\n                result.push(this.startMouseOutTimer());\r\n            } else {\r\n                this.stopMouseOverTimer();\r\n                this.stopMouseOutTimer();\r\n            }\r\n            if (popupTarget !== undefined &&\r\n                (this.state.previousPopupElement === undefined || this.state.previousPopupElement.id !== popupTarget.id)) {\r\n                result.push(this.startMouseOverTimer(popupTarget, event));\r\n            }\r\n            if (this.lastHoverFeedbackElementId) {\r\n                result.push(HoverFeedbackAction.create({ mouseoverElement: this.lastHoverFeedbackElementId, mouseIsOver: false }));\r\n                this.lastHoverFeedbackElementId = undefined;\r\n            }\r\n            const hoverTarget = findParentByFeature(target, isHoverable);\r\n            if (hoverTarget !== undefined) {\r\n                result.push(HoverFeedbackAction.create({ mouseoverElement: hoverTarget.id, mouseIsOver: true }));\r\n                this.lastHoverFeedbackElementId = hoverTarget.id;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    override mouseOut(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: (Action | Promise<Action>)[] = [];\r\n        if (!this.mouseIsDown) {\r\n            const elementUnderMouse = this.getElementFromEventPosition(event);\r\n            if (!this.isSprottyPopup(elementUnderMouse)) {\r\n                if (this.state.popupOpen) {\r\n                    const popupTarget = findParent(target, hasPopupFeature);\r\n                    if (this.state.previousPopupElement !== undefined && popupTarget !== undefined\r\n                        && this.state.previousPopupElement.id === popupTarget.id)\r\n                        result.push(this.startMouseOutTimer());\r\n                }\r\n                this.stopMouseOverTimer();\r\n                const hoverTarget = findParentByFeature(target, isHoverable);\r\n                if (hoverTarget !== undefined) {\r\n                    result.push(HoverFeedbackAction.create({ mouseoverElement: hoverTarget.id, mouseIsOver: false }));\r\n                    if (this.lastHoverFeedbackElementId && this.lastHoverFeedbackElementId !== hoverTarget.id) {\r\n                        result.push(HoverFeedbackAction.create({ mouseoverElement: this.lastHoverFeedbackElementId, mouseIsOver: false }));\r\n                    }\r\n                    this.lastHoverFeedbackElementId = undefined;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected getElementFromEventPosition(event: MouseEvent) {\r\n        return document.elementFromPoint(event.x, event.y);\r\n    }\r\n\r\n    protected isSprottyPopup(element: Element | null): boolean {\r\n        return element\r\n            ? (element.id === this.options.popupDiv\r\n                || (!!element.parentElement && this.isSprottyPopup(element.parentElement)))\r\n            : false;\r\n    }\r\n\r\n    override mouseMove(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: (Action | Promise<Action>)[] = [];\r\n\r\n        if (!this.mouseIsDown) {\r\n            if (this.state.previousPopupElement !== undefined && this.closeOnMouseMove(this.state.previousPopupElement, event)) {\r\n                result.push(this.startMouseOutTimer());\r\n            }\r\n\r\n            const popupTarget = findParent(target, hasPopupFeature);\r\n            if (popupTarget !== undefined && (this.state.previousPopupElement === undefined\r\n                || this.state.previousPopupElement.id !== popupTarget.id)) {\r\n                result.push(this.startMouseOverTimer(popupTarget, event));\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected closeOnMouseMove(target: SModelElementImpl, event: MouseEvent): boolean {\r\n        return target instanceof SModelRootImpl;\r\n    }\r\n\r\n}\r\n\r\n@injectable()\r\nexport class PopupHoverMouseListener extends AbstractHoverMouseListener {\r\n\r\n    override mouseOut(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [this.startMouseOutTimer()];\r\n    }\r\n\r\n    override mouseOver(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        this.stopMouseOutTimer();\r\n        this.stopMouseOverTimer();\r\n        return [];\r\n    }\r\n}\r\n\r\nexport class HoverKeyListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'Escape')) {\r\n            return [SetPopupModelAction.create({ type: EMPTY_ROOT.type, id: EMPTY_ROOT.id })];\r\n        }\r\n        return [];\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class ClosePopupActionHandler implements IActionHandler {\r\n    protected popupOpen: boolean = false;\r\n\r\n    handle(action: Action): void | ICommand | Action {\r\n        if (action.kind === SetPopupModelCommand.KIND) {\r\n            this.popupOpen = (action as SetPopupModelAction).newRoot.type !== EMPTY_ROOT.type;\r\n        } else if (this.popupOpen) {\r\n            return  SetPopupModelAction.create({ id: EMPTY_ROOT.id, type: EMPTY_ROOT.type });\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SIssue as SIssueSchema } from 'sprotty-protocol/lib/model';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { SShapeElementImpl, boundsFeature } from '../bounds/model';\r\nimport { hoverFeedbackFeature, popupFeature } from '../hover/model';\r\n\r\nexport const decorationFeature = Symbol('decorationFeature');\r\n\r\n/**\r\n * Feature extension interface for {@link decorationFeature}.\r\n */\r\nexport interface Decoration {\r\n}\r\n\r\nexport function isDecoration<T extends SModelElementImpl>(e: T): e is T & Decoration {\r\n    return e.hasFeature(decorationFeature);\r\n}\r\n\r\nexport class SDecoration extends SShapeElementImpl implements Decoration {\r\n    static readonly DEFAULT_FEATURES = [decorationFeature, boundsFeature, hoverFeedbackFeature, popupFeature];\r\n}\r\n\r\nexport class SIssueMarkerImpl extends SDecoration {\r\n    issues: SIssueSchema[];\r\n}\r\n\r\n/** @deprecated Use SIssueMarkerImpl instead. */\r\nexport const SIssueMarker = SIssueMarkerImpl;\r\n\r\n/**\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport type SIssueSeverity = 'error' | 'warning' | 'info';\r\n\r\n/**\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport class SIssue {\r\n    message: string;\r\n    severity: SIssueSeverity;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { svg } from '../../lib/jsx';\r\n\r\nimport { VNode } from 'snabbdom';\r\nimport { IView, RenderingContext } from '../../base/views/view';\r\nimport { SIssueMarkerImpl, SIssueSeverity } from './model';\r\nimport { setClass } from '../../base/views/vnode-utils';\r\nimport { injectable } from 'inversify';\r\n\r\n@injectable()\r\nexport class IssueMarkerView implements IView {\r\n    render(marker: SIssueMarkerImpl, context: RenderingContext): VNode {\r\n        const scale = 16 / 1792;\r\n        const trafo = `scale(${scale}, ${scale})`;\r\n        const maxSeverity = this.getMaxSeverity(marker);\r\n        const group = <g class-sprotty-issue={true}>\r\n            <g transform={trafo}>\r\n                <path d={this.getPath(maxSeverity)} />\r\n            </g>\r\n        </g>;\r\n        setClass(group, 'sprotty-' + maxSeverity, true);\r\n        return group;\r\n    }\r\n\r\n    protected getMaxSeverity(marker: SIssueMarkerImpl): SIssueSeverity {\r\n        let currentSeverity: SIssueSeverity = 'info';\r\n        for (const severity of marker.issues.map(s => s.severity)) {\r\n            if (severity === 'error' || (severity === 'warning' && currentSeverity === 'info'))\r\n                currentSeverity = severity;\r\n        }\r\n        return currentSeverity;\r\n    }\r\n\r\n    protected getPath(severity: SIssueSeverity) {\r\n        switch (severity) {\r\n            case 'error':\r\n            case 'warning':\r\n                // eslint-disable-next-line max-len\r\n                return \"M768 128q209 0 385.5 103t279.5 279.5 103 385.5-103 385.5-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103zm128 1247v-190q0-14-9-23.5t-22-9.5h-192q-13 0-23 10t-10 23v190q0 13 10 23t23 10h192q13 0 22-9.5t9-23.5zm-2-344l18-621q0-12-10-18-10-8-24-8h-220q-14 0-24 8-10 6-10 18l17 621q0 10 10 17.5t24 7.5h185q14 0 23.5-7.5t10.5-17.5z\";\r\n            case 'info':\r\n                // eslint-disable-next-line max-len\r\n                return \"M1024 1376v-160q0-14-9-23t-23-9h-96v-512q0-14-9-23t-23-9h-320q-14 0-23 9t-9 23v160q0 14 9 23t23 9h96v320h-96q-14 0-23 9t-9 23v160q0 14 9 23t23 9h448q14 0 23-9t9-23zm-128-896v-160q0-14-9-23t-23-9h-192q-14 0-23 9t-9 23v160q0 14 9 23t23 9h192q14 0 23-9t9-23zm640 416q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z\";\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { SModelElementImpl, SChildElementImpl } from \"../../base/model/smodel\";\r\nimport { IVNodePostprocessor } from \"../../base/views/vnode-postprocessor\";\r\nimport { isDecoration, Decoration } from \"./model\";\r\nimport { setAttr } from \"../../base/views/vnode-utils\";\r\nimport { isSizeable } from \"../bounds/model\";\r\nimport { SRoutableElementImpl } from \"../routing/model\";\r\nimport { EdgeRouterRegistry } from \"../routing/routing\";\r\nimport { Point } from \"sprotty-protocol\";\r\n\r\n@injectable()\r\nexport class DecorationPlacer implements IVNodePostprocessor {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (isDecoration(element)) {\r\n            const position = this.getPosition(element);\r\n            const translate = 'translate(' + position.x + ', ' + position.y + ')';\r\n            setAttr(vnode, 'transform', translate);\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    protected getPosition(element: SModelElementImpl & Decoration): Point {\r\n        if (element instanceof SChildElementImpl && element.parent instanceof SRoutableElementImpl) {\r\n            const route =  this.edgeRouterRegistry.route(element.parent);\r\n            if (route.length > 1) {\r\n                const index = Math.floor(0.5  * (route.length - 1));\r\n                const offset = isSizeable(element)\r\n                    ? {\r\n                        x: - 0.5 * element.bounds.width,\r\n                        y: - 0.5 * element.bounds.width\r\n                    }\r\n                    : Point.ORIGIN;\r\n                return {\r\n                    x: 0.5 * (route[index].x + route[index + 1].x) + offset.x,\r\n                    y: 0.5 * (route[index].y + route[index + 1].y) + offset.y\r\n                };\r\n            }\r\n        }\r\n        if (isSizeable(element))\r\n            return {\r\n                x: -0.666 * element.bounds.width,\r\n                y: -0.666 * element.bounds.height\r\n            };\r\n        return Point.ORIGIN;\r\n    }\r\n\r\n    postUpdate(): void {\r\n    }\r\n}\r\n", "(function (global, factory) {\r\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\r\ntypeof define === 'function' && define.amd ? define(factory) :\r\n(global = global || self, global.TinyQueue = factory());\r\n}(this, function () { 'use strict';\r\n\r\nvar TinyQueue = function TinyQueue(data, compare) {\r\n    if ( data === void 0 ) data = [];\r\n    if ( compare === void 0 ) compare = defaultCompare;\r\n\r\n    this.data = data;\r\n    this.length = this.data.length;\r\n    this.compare = compare;\r\n\r\n    if (this.length > 0) {\r\n        for (var i = (this.length >> 1) - 1; i >= 0; i--) { this._down(i); }\r\n    }\r\n};\r\n\r\nTinyQueue.prototype.push = function push (item) {\r\n    this.data.push(item);\r\n    this.length++;\r\n    this._up(this.length - 1);\r\n};\r\n\r\nTinyQueue.prototype.pop = function pop () {\r\n    if (this.length === 0) { return undefined; }\r\n\r\n    var top = this.data[0];\r\n    var bottom = this.data.pop();\r\n    this.length--;\r\n\r\n    if (this.length > 0) {\r\n        this.data[0] = bottom;\r\n        this._down(0);\r\n    }\r\n\r\n    return top;\r\n};\r\n\r\nTinyQueue.prototype.peek = function peek () {\r\n    return this.data[0];\r\n};\r\n\r\nTinyQueue.prototype._up = function _up (pos) {\r\n    var ref = this;\r\n        var data = ref.data;\r\n        var compare = ref.compare;\r\n    var item = data[pos];\r\n\r\n    while (pos > 0) {\r\n        var parent = (pos - 1) >> 1;\r\n        var current = data[parent];\r\n        if (compare(item, current) >= 0) { break; }\r\n        data[pos] = current;\r\n        pos = parent;\r\n    }\r\n\r\n    data[pos] = item;\r\n};\r\n\r\nTinyQueue.prototype._down = function _down (pos) {\r\n    var ref = this;\r\n        var data = ref.data;\r\n        var compare = ref.compare;\r\n    var halfLength = this.length >> 1;\r\n    var item = data[pos];\r\n\r\n    while (pos < halfLength) {\r\n        var left = (pos << 1) + 1;\r\n        var best = data[left];\r\n        var right = left + 1;\r\n\r\n        if (right < this.length && compare(data[right], best) < 0) {\r\n            left = right;\r\n            best = data[right];\r\n        }\r\n        if (compare(best, item) >= 0) { break; }\r\n\r\n        data[pos] = best;\r\n        pos = left;\r\n    }\r\n\r\n    data[pos] = item;\r\n};\r\n\r\nfunction defaultCompare(a, b) {\r\n    return a < b ? -1 : a > b ? 1 : 0;\r\n}\r\n\r\nreturn TinyQueue;\r\n\r\n}));\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 Rowan Winsemius and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n// Based on the sweepline implementation at https://github.com/rowanwins/sweepline-intersections\r\n// which is published under the terms of MIT, but has been adapted to the use case of sprotty.\r\nimport TinyQueue from \"tinyqueue\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { PointToPointLine } from \"../../utils/geometry\";\r\nimport { Intersection } from \"./intersection-finder\";\r\nimport { RoutedPoint } from \"../routing/routing\";\r\n\r\n/*\r\n * The algorithm implemented in this module is loosely based on the Bentley-Ottmann algorithm for\r\n * finding intersection among line segments in `O((n+k) log n)`, whereas `n` is the number of line\r\n * segments and `k` is the number of intersections.\r\n * The underlying idea is to use a imaginary sweep line that moves over the x/y plane and testing\r\n * only the line segments for intersection that the sweepline currently crosses, instead of\r\n * testing all segment with each other, which would be `O(n^2)`.\r\n * It does so by generating a prioritized event queue for start and end events of the line segments\r\n * and working its way through the queue (i.e., sweeping).\r\n * More information can be found at https://en.wikipedia.org/wiki/Bentley%E2%80%93Ottmann_algorithm\r\n * In contrast to the original Bently-Ottmann algorithm, the implementation below does not use a tree\r\n * data structure to store the segments in order to simplify the implementation.\r\n * See also https://github.com/rowanwins/sweepline-intersections#algorithm-notes\r\n */\r\n\r\n/**\r\n * Add the specified `route` to the event `queue` from left to right.\r\n * @param routeId id of the route.\r\n * @param route the route as array of points.\r\n * @param queue the queue to add the route to.\r\n */\r\nexport function addRoute(routeId: string, route: RoutedPoint[], queue: TinyQueue<SweepEvent>) {\r\n    if (route.length < 1) return;\r\n    let currentPoint = route[0];\r\n    let nextPoint = undefined;\r\n    for (let i = 0; i < route.length - 1; i++) {\r\n        nextPoint = route[i + 1];\r\n\r\n        const e1 = new SweepEvent(routeId, currentPoint, i);\r\n        const e2 = new SweepEvent(routeId, nextPoint, i + 1);\r\n\r\n        e1.otherEvent = e2;\r\n        e2.otherEvent = e1;\r\n\r\n        if (checkWhichEventIsLeft(e1, e2) > 0) {\r\n            e2.isLeftEndpoint = true;\r\n            e1.isLeftEndpoint = false;\r\n        } else {\r\n            e1.isLeftEndpoint = true;\r\n            e2.isLeftEndpoint = false;\r\n        }\r\n        queue.push(e1);\r\n        queue.push(e2);\r\n\r\n        currentPoint = nextPoint;\r\n    }\r\n}\r\n\r\n/**\r\n * Returns which of the two events is left.\r\n * This is used to classify the endpoints of a segment when generating the\r\n * event queue.\r\n */\r\nexport function checkWhichEventIsLeft(e1: SweepEvent, e2: SweepEvent): 1 | -1 {\r\n    if (e1.point.x > e2.point.x) return 1;\r\n    if (e1.point.x < e2.point.x) return -1;\r\n    if (e1.point.y !== e2.point.y) return e1.point.y > e2.point.y ? 1 : -1;\r\n    return 1;\r\n}\r\n\r\n/**\r\n * An event -- or with other words a start or end point of a segment -- in the context\r\n * of the event queue for the sweep.\r\n *\r\n * Stores the original Sprotty `edgeId` and the segment index of this segment in the edge\r\n * to keep track of which edge and segment this event originated from.\r\n */\r\nexport class SweepEvent {\r\n    otherEvent: SweepEvent;\r\n    isLeftEndpoint: boolean;\r\n    constructor(readonly edgeId: string, readonly point: Point, readonly segmentIndex: number) { }\r\n}\r\n\r\n/**\r\n * A line segment consists of a start and a stop event.\r\n */\r\nexport class Segment {\r\n    readonly leftSweepEvent: SweepEvent;\r\n    readonly rightSweepEvent: SweepEvent;\r\n    constructor(event: SweepEvent) {\r\n        this.leftSweepEvent = event;\r\n        this.rightSweepEvent = event.otherEvent;\r\n    }\r\n}\r\n\r\n/**\r\n * Performs the main sweep algorithm on the specified event queue.\r\n *\r\n * An empty priority queue is created to store segments encountered.\r\n * An item is removed from the priority queue if the vertex is the left endpoint\r\n * of a segment, we test it against every other segment in the segment queue for\r\n * intersections with any intersection recorded. We then add the vertex (and it's\r\n * associated right endpoint) to the segment queue.\r\n * If we encounter a right endpoint we remove the first item from the segment queue.\r\n *\r\n * Each pair of segments are only tested once. And only segments that overlap on the\r\n * x plane are tested against each other.\r\n *\r\n * @param eventQueue the event queue.\r\n * @returns the identified intersections.\r\n */\r\nexport function runSweep(eventQueue: TinyQueue<SweepEvent>): Intersection[] {\r\n    const intersectionPoints: Intersection[] = [];\r\n    const outQueue = new TinyQueue<Segment>([], checkWhichSegmentHasRightEndpointFirst);\r\n    while (eventQueue.length) {\r\n        const event = eventQueue.pop();\r\n        if (event?.isLeftEndpoint) {\r\n            const segment = new Segment(event);\r\n            for (let i = 0; i < outQueue.data.length; i++) {\r\n                const otherSegment = outQueue.data[i];\r\n                const intersection = intersectionOfSegments(segment, otherSegment);\r\n                if (intersection) {\r\n                    intersectionPoints.push(\r\n                        <Intersection>{\r\n                            routable1: event.edgeId,\r\n                            routable2: otherSegment.leftSweepEvent.edgeId,\r\n                            segmentIndex1: getSegmentIndex(segment),\r\n                            segmentIndex2: getSegmentIndex(otherSegment),\r\n                            intersectionPoint: intersection\r\n                        }\r\n                    );\r\n                }\r\n            }\r\n            outQueue.push(segment);\r\n        } else if (event?.isLeftEndpoint === false) {\r\n            outQueue.pop();\r\n        }\r\n    }\r\n    return intersectionPoints;\r\n}\r\n\r\n/**\r\n * Specifies which of the two specified segments has a right endpoint first.\r\n * Used as a comparator to sort the event queue.\r\n */\r\nexport function checkWhichSegmentHasRightEndpointFirst(seg1: Segment, seg2: Segment): 1 | -1 {\r\n    if (seg1.rightSweepEvent.point.x > seg2.rightSweepEvent.point.x) return 1;\r\n    if (seg1.rightSweepEvent.point.x < seg2.rightSweepEvent.point.x) return -1;\r\n    if (seg1.rightSweepEvent.point.y !== seg2.rightSweepEvent.point.y) return seg1.rightSweepEvent.point.y < seg2.rightSweepEvent.point.y ? 1 : -1;\r\n    return 1;\r\n}\r\n\r\nexport function getSegmentIndex(segment: Segment): number {\r\n    return Math.min(segment.leftSweepEvent.segmentIndex, segment.rightSweepEvent.segmentIndex);\r\n}\r\n\r\n/**\r\n * Tests whether two segments intersect and returns the intersection point if existing.\r\n */\r\nexport function intersectionOfSegments(seg1: Segment, seg2: Segment): Point | undefined {\r\n    if (seg1.leftSweepEvent.edgeId === seg2.leftSweepEvent.edgeId) {\r\n        return undefined;\r\n    }\r\n    const seg1Line = new PointToPointLine(seg1.leftSweepEvent.point, seg1.rightSweepEvent.point);\r\n    const seg2Line = new PointToPointLine(seg2.leftSweepEvent.point, seg2.rightSweepEvent.point);\r\n    return seg1Line.intersection(seg2Line);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021-2022 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport TinyQueue from \"tinyqueue\";\r\nimport { EdgeRouting, IEdgeRoutePostprocessor, RoutedPoint } from \"../routing/routing\";\r\nimport { addRoute, checkWhichEventIsLeft, runSweep, SweepEvent } from \"./sweepline\";\r\n\r\nexport interface Intersection {\r\n    readonly routable1: string;\r\n    readonly segmentIndex1: number;\r\n    readonly routable2: string;\r\n    readonly segmentIndex2: number;\r\n    readonly intersectionPoint: Point;\r\n}\r\n\r\nexport interface IntersectingRoutedPoint extends RoutedPoint {\r\n    intersections: Intersection[];\r\n}\r\n\r\nexport function isIntersectingRoutedPoint(routedPoint: Point): routedPoint is IntersectingRoutedPoint {\r\n    return routedPoint !== undefined && 'intersections' in routedPoint && 'kind' in routedPoint;\r\n}\r\n\r\nexport const BY_X_THEN_Y = (a: Intersection, b: Intersection): number => {\r\n    if (a.intersectionPoint.x === b.intersectionPoint.x) {\r\n        return a.intersectionPoint.y - b.intersectionPoint.y;\r\n    }\r\n    return a.intersectionPoint.x - b.intersectionPoint.x;\r\n};\r\n\r\nexport const BY_DESCENDING_X_THEN_Y = (a: Intersection, b: Intersection): number => {\r\n    if (a.intersectionPoint.x === b.intersectionPoint.x) {\r\n        return a.intersectionPoint.y - b.intersectionPoint.y;\r\n    }\r\n    return b.intersectionPoint.x - a.intersectionPoint.x;\r\n};\r\n\r\nexport const BY_X_THEN_DESCENDING_Y = (a: Intersection, b: Intersection): number => {\r\n    if (a.intersectionPoint.x === b.intersectionPoint.x) {\r\n        return b.intersectionPoint.y - a.intersectionPoint.y;\r\n    }\r\n    return a.intersectionPoint.x - b.intersectionPoint.x;\r\n};\r\n\r\nexport const BY_DESCENDING_X_THEN_DESCENDING_Y = (a: Intersection, b: Intersection): number => {\r\n    if (a.intersectionPoint.x === b.intersectionPoint.x) {\r\n        return b.intersectionPoint.y - a.intersectionPoint.y;\r\n    }\r\n    return b.intersectionPoint.x - a.intersectionPoint.x;\r\n};\r\n\r\n/**\r\n * Finds intersections among edges and updates routed points to reflect those intersections.\r\n *\r\n * This only yields correct intersections among straight line segments and doesn't work with bezier curves.\r\n */\r\n@injectable()\r\nexport class IntersectionFinder implements IEdgeRoutePostprocessor {\r\n\r\n    /**\r\n     * Finds all intersections in the specified `routing` and replaces the `RoutedPoints` that are\r\n     * intersecting by adding intersection information to routing points (@see `IntersectingRoutedPoints`).\r\n     * @param routing the edge routing to find intersections for and update.\r\n     */\r\n    apply(routing: EdgeRouting) {\r\n        const intersections = this.find(routing);\r\n        this.addToRouting(intersections, routing);\r\n    }\r\n\r\n    /**\r\n     * Finds the intersections in the specified `routing` and returns them.\r\n     * @param routing the edge routing to find intersections for and update.\r\n     * @returns the identified intersections.\r\n     */\r\n    find(routing: EdgeRouting): Intersection[] {\r\n        const eventQueue = new TinyQueue<SweepEvent>(undefined, checkWhichEventIsLeft);\r\n        routing.routes.forEach((route, routeId) => {\r\n            if (this.isSupportedRoute(route)) {\r\n                addRoute(routeId, route, eventQueue);\r\n            }\r\n        });\r\n        return runSweep(eventQueue);\r\n    }\r\n\r\n    /**\r\n     * Specifies whether or not a specific route should be included in this intersection search or not.\r\n     *\r\n     * As this intersection finder only supports linear line segments, this method only returns `true`\r\n     * for routes that only contain routed points, which are either 'source', 'target' or 'linear'.\r\n     */\r\n    protected isSupportedRoute(route: RoutedPoint[]): boolean {\r\n        return route.find(point => point.kind !== 'source' && point.kind !== 'target' && point.kind !== 'linear') === undefined;\r\n    }\r\n\r\n    protected addToRouting(intersections: Intersection[], routing: EdgeRouting) {\r\n        for (const intersection of intersections) {\r\n            const routable1 = routing.get(intersection.routable1);\r\n            const routable2 = routing.get(intersection.routable2);\r\n            this.addIntersectionToRoutedPoint(intersection, routable1, intersection.segmentIndex1);\r\n            this.addIntersectionToRoutedPoint(intersection, routable2, intersection.segmentIndex2);\r\n        }\r\n    }\r\n\r\n    private addIntersectionToRoutedPoint(intersection: Intersection, routedPoint: RoutedPoint[] | undefined, segmentIndex: number) {\r\n        if (routedPoint && routedPoint.length > segmentIndex) {\r\n            const segment = routedPoint[segmentIndex + 1];\r\n            if (isIntersectingRoutedPoint(segment)) {\r\n                segment.intersections.push(intersection);\r\n            } else {\r\n                const intersectingRoutedPoint = { ...segment, intersections: [intersection] };\r\n                routedPoint[segmentIndex + 1] = intersectingRoutedPoint;\r\n            }\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, optional } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Locateable } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { Action, DeleteElementAction, ReconnectAction, SelectAction, SelectAllAction, MoveAction } from 'sprotty-protocol/lib/actions';\r\nimport { Animation, CompoundAnimation } from '../../base/animations/animation';\r\nimport { CommandExecutionContext, ICommand, MergeableCommand, CommandReturn } from '../../base/commands/command';\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { findParentByFeature, translatePoint } from '../../base/model/smodel-utils';\r\nimport { TYPES } from '../../base/types';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { IVNodePostprocessor } from '../../base/views/vnode-postprocessor';\r\nimport { setAttr } from '../../base/views/vnode-utils';\r\nimport { SEdgeImpl } from '../../graph/sgraph';\r\nimport { CommitModelAction } from '../../model-source/commit-model';\r\nimport { findChildrenAtPosition, isAlignable } from '../bounds/model';\r\nimport { CreatingOnDrag, isCreatingOnDrag } from '../edit/create-on-drag';\r\nimport { SwitchEditModeAction } from '../edit/edit-routing';\r\nimport { ReconnectCommand } from '../edit/reconnect';\r\nimport { edgeInProgressID, edgeInProgressTargetHandleID, isConnectable, SRoutableElementImpl, SRoutingHandleImpl } from '../routing/model';\r\nimport { EdgeMemento, EdgeRouterRegistry, EdgeSnapshot, RoutedPoint } from '../routing/routing';\r\nimport { isEdgeLayoutable } from '../edge-layout/model';\r\nimport { isSelectable } from '../select/model';\r\nimport { isViewport } from '../viewport/model';\r\nimport { isLocateable, isMoveable } from './model';\r\nimport { ISnapper } from './snap';\r\n\r\nexport interface ElementMove {\r\n    elementId: string\r\n    elementType?: string\r\n    fromPosition?: Point\r\n    toPosition: Point\r\n}\r\n\r\nexport interface ResolvedElementMove {\r\n    element: SModelElementImpl & Locateable\r\n    fromPosition: Point\r\n    toPosition: Point\r\n}\r\n\r\nexport interface ResolvedHandleMove {\r\n    handle: SRoutingHandleImpl\r\n    fromPosition: Point\r\n    toPosition: Point\r\n}\r\n\r\n@injectable()\r\nexport class MoveCommand extends MergeableCommand {\r\n    static readonly KIND = MoveAction.KIND;\r\n\r\n    @inject(EdgeRouterRegistry) @optional() edgeRouterRegistry?: EdgeRouterRegistry;\r\n\r\n    protected resolvedMoves: Map<string, ResolvedElementMove> = new Map;\r\n    protected edgeMementi: EdgeMemento[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: MoveAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const index = context.root.index;\r\n        const edge2handleMoves = new Map<SRoutableElementImpl, ResolvedHandleMove[]>();\r\n        const attachedEdgeShifts = new Map<SRoutableElementImpl, Point>();\r\n        this.action.moves.forEach(move => {\r\n            const element = index.getById(move.elementId);\r\n            if (element instanceof SRoutingHandleImpl && this.edgeRouterRegistry) {\r\n                const edge = element.parent;\r\n                if (edge instanceof SRoutableElementImpl) {\r\n                    const resolvedMove = this.resolveHandleMove(element, edge, move);\r\n                    if (resolvedMove) {\r\n                        let movesByEdge = edge2handleMoves.get(edge);\r\n                        if (!movesByEdge) {\r\n                            movesByEdge = [];\r\n                            edge2handleMoves.set(edge, movesByEdge);\r\n                        }\r\n                        movesByEdge.push(resolvedMove);\r\n                    }\r\n                }\r\n            } else if (element && isLocateable(element)) {\r\n                const resolvedMove = this.resolveElementMove(element, move);\r\n                if (resolvedMove) {\r\n                    this.resolvedMoves.set(resolvedMove.element.id, resolvedMove);\r\n                    if (this.edgeRouterRegistry) {\r\n                        index.getAttachedElements(element).forEach(edge => {\r\n                            if (edge instanceof SRoutableElementImpl) {\r\n                                const existingDelta = attachedEdgeShifts.get(edge);\r\n                                const newDelta = Point.subtract(resolvedMove.toPosition, resolvedMove.fromPosition);\r\n                                const delta = (existingDelta)\r\n                                    ? Point.linear(existingDelta, newDelta, 0.5)\r\n                                    : newDelta;\r\n                                attachedEdgeShifts.set(edge, delta);\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this.doMove(edge2handleMoves, attachedEdgeShifts);\r\n        if (this.action.animate) {\r\n            this.undoMove();\r\n            return new CompoundAnimation(context.root, context, [\r\n                new MoveAnimation(context.root, this.resolvedMoves, context, false),\r\n                new MorphEdgesAnimation(context.root, this.edgeMementi, context, false)\r\n            ]).start();\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    protected resolveHandleMove(handle: SRoutingHandleImpl, edge: SRoutableElementImpl, move: ElementMove): ResolvedHandleMove | undefined {\r\n        let fromPosition = move.fromPosition;\r\n        if (!fromPosition) {\r\n            const router = this.edgeRouterRegistry!.get(edge.routerKind);\r\n            fromPosition = router.getHandlePosition(edge, router.route(edge), handle);\r\n        }\r\n        if (fromPosition)\r\n            return {\r\n                handle,\r\n                fromPosition,\r\n                toPosition: move.toPosition\r\n            };\r\n        return undefined;\r\n    }\r\n\r\n    protected resolveElementMove(element: SModelElementImpl & Locateable, move: ElementMove): ResolvedElementMove | undefined {\r\n        const fromPosition = move.fromPosition\r\n            || { x: element.position.x, y: element.position.y };\r\n        return {\r\n            element,\r\n            fromPosition,\r\n            toPosition: move.toPosition\r\n        };\r\n    }\r\n\r\n    protected doMove(edge2move: Map<SRoutableElementImpl, ResolvedHandleMove[]>, attachedEdgeShifts: Map<SRoutableElementImpl, Point>) {\r\n        this.resolvedMoves.forEach(res => {\r\n            res.element.position = res.toPosition;\r\n        });\r\n        // reset edges to state before\r\n        edge2move.forEach((moves, edge) => {\r\n            const router = this.edgeRouterRegistry!.get(edge.routerKind);\r\n            const before = router.takeSnapshot(edge);\r\n            router.applyHandleMoves(edge, moves);\r\n            const after = router.takeSnapshot(edge);\r\n            this.edgeMementi.push({ edge, before, after });\r\n        });\r\n        attachedEdgeShifts.forEach((delta, edge) => {\r\n            if (!edge2move.get(edge)) {\r\n                const router = this.edgeRouterRegistry!.get(edge.routerKind);\r\n                const before = router.takeSnapshot(edge);\r\n                if (edge.source\r\n                    && edge.target\r\n                    && this.resolvedMoves.get(edge.source.id)\r\n                    && this.resolvedMoves.get(edge.target.id)) {\r\n                    // move the entire edge when both source and target are moved\r\n                    edge.routingPoints = edge.routingPoints.map(rp => Point.add(rp, delta));\r\n                } else {\r\n                    // add/remove RPs according to the new source/target positions\r\n                    const updateHandles = isSelectable(edge) && edge.selected;\r\n                    router.cleanupRoutingPoints(edge, edge.routingPoints, updateHandles, this.action.finished);\r\n                }\r\n                const after = router.takeSnapshot(edge);\r\n                this.edgeMementi.push({ edge, before, after });\r\n            }\r\n        });\r\n    }\r\n\r\n    protected undoMove() {\r\n        this.resolvedMoves.forEach(res => {\r\n            (res.element as any).position = res.fromPosition;\r\n        });\r\n        this.edgeMementi.forEach(memento => {\r\n            const router = this.edgeRouterRegistry!.get(memento.edge.routerKind);\r\n            router.applySnapshot(memento.edge, memento.before);\r\n        });\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): Promise<SModelRootImpl> {\r\n        return new CompoundAnimation(context.root, context, [\r\n            new MoveAnimation(context.root, this.resolvedMoves, context, true),\r\n            new MorphEdgesAnimation(context.root, this.edgeMementi, context, true)\r\n        ]).start();\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): Promise<SModelRootImpl> {\r\n        return new CompoundAnimation(context.root, context, [\r\n            new MoveAnimation(context.root, this.resolvedMoves, context, false),\r\n            new MorphEdgesAnimation(context.root, this.edgeMementi, context, false)\r\n        ]).start();\r\n    }\r\n\r\n    override merge(other: ICommand, context: CommandExecutionContext) {\r\n        if (!this.action.animate && other instanceof MoveCommand) {\r\n            other.resolvedMoves.forEach(\r\n                (otherMove, otherElementId) => {\r\n                    const existingMove = this.resolvedMoves.get(otherElementId);\r\n                    if (existingMove) {\r\n                        existingMove.toPosition = otherMove.toPosition;\r\n                    } else {\r\n                        this.resolvedMoves.set(otherElementId, otherMove);\r\n                    }\r\n                }\r\n            );\r\n            other.edgeMementi.forEach(otherMemento => {\r\n                const existingMemento = this.edgeMementi.find(edgeMemento => edgeMemento.edge.id === otherMemento.edge.id);\r\n                if (existingMemento) {\r\n                    existingMemento.after = otherMemento.after;\r\n                } else {\r\n                    this.edgeMementi.push(otherMemento);\r\n                }\r\n            });\r\n            return true;\r\n        } else if (other instanceof ReconnectCommand) {\r\n            const otherMemento = other.memento;\r\n            if (otherMemento) {\r\n                const existingMemento = this.edgeMementi.find(edgeMemento => edgeMemento.edge.id === otherMemento.edge.id);\r\n                if (existingMemento) {\r\n                    existingMemento.after = otherMemento.after;\r\n                } else {\r\n                    this.edgeMementi.push(otherMemento);\r\n                }\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\nexport class MoveAnimation extends Animation {\r\n\r\n    constructor(protected model: SModelRootImpl,\r\n                public elementMoves: Map<string, ResolvedElementMove>,\r\n                context: CommandExecutionContext,\r\n                protected reverse: boolean = false) {\r\n        super(context);\r\n    }\r\n\r\n    tween(t: number) {\r\n        this.elementMoves.forEach((elementMove) => {\r\n            if (this.reverse) {\r\n                elementMove.element.position = {\r\n                    x: (1 - t) * elementMove.toPosition.x + t * elementMove.fromPosition.x,\r\n                    y: (1 - t) * elementMove.toPosition.y + t * elementMove.fromPosition.y\r\n                };\r\n            } else {\r\n                elementMove.element.position = {\r\n                    x: (1 - t) * elementMove.fromPosition.x + t * elementMove.toPosition.x,\r\n                    y: (1 - t) * elementMove.fromPosition.y + t * elementMove.toPosition.y\r\n                };\r\n            }\r\n        });\r\n        return this.model;\r\n    }\r\n}\r\n\r\ninterface ExpandedEdgeMorph {\r\n    startExpandedRoute: Point[],\r\n    endExpandedRoute: Point[],\r\n    memento: EdgeMemento\r\n}\r\n\r\nexport class MorphEdgesAnimation extends Animation {\r\n\r\n    protected expanded: ExpandedEdgeMorph[] = [];\r\n\r\n    constructor(protected model: SModelRootImpl,\r\n                originalMementi: EdgeMemento[],\r\n                context: CommandExecutionContext,\r\n                protected reverse: boolean = false) {\r\n        super(context);\r\n        originalMementi.forEach(edgeMemento => {\r\n            const start = this.reverse ? edgeMemento.after : edgeMemento.before;\r\n            const end = this.reverse ? edgeMemento.before : edgeMemento.after;\r\n            const startRoute = start.routedPoints;\r\n            const endRoute = end.routedPoints;\r\n            const maxRoutingPoints = Math.max(startRoute.length, endRoute.length);\r\n            this.expanded.push({\r\n                startExpandedRoute: this.growToSize(startRoute, maxRoutingPoints),\r\n                endExpandedRoute: this.growToSize(endRoute, maxRoutingPoints),\r\n                memento: edgeMemento\r\n            });\r\n        });\r\n    }\r\n\r\n    protected midPoint(edgeMemento: EdgeMemento): Point {\r\n        const edge = edgeMemento.edge;\r\n        const source = edgeMemento.edge.source!;\r\n        const target = edgeMemento.edge.target!;\r\n        return Point.linear(\r\n            translatePoint(Bounds.center(source.bounds), source.parent, edge.parent),\r\n            translatePoint(Bounds.center(target.bounds), target.parent, edge.parent),\r\n            0.5);\r\n    }\r\n\r\n    override start() {\r\n        this.expanded.forEach(morph => {\r\n            morph.memento.edge.removeAll(e => e instanceof SRoutingHandleImpl);\r\n        });\r\n        return super.start();\r\n    }\r\n\r\n    tween(t: number) {\r\n        if (t === 1) {\r\n            this.expanded.forEach(morph => {\r\n                const memento = morph.memento;\r\n                if (this.reverse)\r\n                    memento.before.router.applySnapshot(memento.edge, memento.before);\r\n                else\r\n                    memento.after.router.applySnapshot(memento.edge, memento.after);\r\n            });\r\n        } else {\r\n            this.expanded.forEach(morph => {\r\n                const newRoutingPoints: Point[] = [];\r\n                // ignore source and target anchor\r\n                for (let i = 1; i < morph.startExpandedRoute.length - 1; ++i)\r\n                    newRoutingPoints.push(Point.linear(morph.startExpandedRoute[i], morph.endExpandedRoute[i], t));\r\n\r\n                const closestSnapshot = t < 0.5 ? morph.memento.before : morph.memento.after;\r\n                const newSnapshot: EdgeSnapshot = {\r\n                    ...closestSnapshot,\r\n                    routingPoints: newRoutingPoints,\r\n                    routingHandles: []\r\n                };\r\n                closestSnapshot.router.applySnapshot(morph.memento.edge, newSnapshot);\r\n            });\r\n        }\r\n        return this.model;\r\n    }\r\n\r\n    protected growToSize(route: RoutedPoint[], targetSize: number): Point[] {\r\n        const diff = targetSize - route.length;\r\n        if (diff <= 0)\r\n            return route;\r\n        const result: Point[] = [];\r\n        result.push(route[0]);\r\n        const deltaDiff = 1 / (diff + 1);\r\n        const deltaSmaller = 1 / (route.length - 1);\r\n        let nextInsertion = 1;\r\n        for (let i = 1; i < route.length; ++i) {\r\n            const pos = deltaSmaller * i;\r\n            let insertions = 0;\r\n            while (pos > (nextInsertion + insertions) * deltaDiff)\r\n                ++insertions;\r\n            nextInsertion += insertions;\r\n            for (let j = 0; j < insertions; ++j) {\r\n                const p = Point.linear(route[i - 1], route[i], (j + 1) / (insertions + 1));\r\n                result.push(p);\r\n            }\r\n            result.push(route[i]);\r\n        }\r\n        return result;\r\n    }\r\n\r\n}\r\n\r\nexport class MoveMouseListener extends MouseListener {\r\n\r\n    @inject(EdgeRouterRegistry) @optional() edgeRouterRegistry?: EdgeRouterRegistry;\r\n    @inject(TYPES.ISnapper) @optional() snapper?: ISnapper;\r\n\r\n    hasDragged = false;\r\n    startDragPosition: Point | undefined;\r\n    elementId2startPos = new Map<string, Point>();\r\n\r\n    override mouseDown(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        if (event.button === 0) {\r\n            const moveable = findParentByFeature(target, isMoveable);\r\n            const isRoutingHandle = target instanceof SRoutingHandleImpl;\r\n            if (moveable !== undefined || isRoutingHandle || isCreatingOnDrag(target)) {\r\n                this.startDragPosition = { x: event.pageX, y: event.pageY };\r\n            } else {\r\n                this.startDragPosition = undefined;\r\n            }\r\n            this.hasDragged = false;\r\n            if (isCreatingOnDrag(target)) {\r\n                return this.startCreatingOnDrag(target, event);\r\n            } else if (isRoutingHandle) {\r\n                return this.activateRoutingHandle(target, event);\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    protected startCreatingOnDrag(target: CreatingOnDrag, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: Action[] = [];\r\n        result.push(SelectAllAction.create({ select: false }));\r\n        result.push(target.createAction(edgeInProgressID));\r\n        result.push(SelectAction.create({ selectedElementsIDs: [edgeInProgressID] }));\r\n        result.push(SwitchEditModeAction.create({ elementsToActivate: [edgeInProgressID] }));\r\n        result.push(SelectAction.create({ selectedElementsIDs: [edgeInProgressTargetHandleID] }));\r\n        result.push(SwitchEditModeAction.create({ elementsToActivate: [edgeInProgressTargetHandleID] }));\r\n        return result;\r\n    }\r\n\r\n    protected activateRoutingHandle(target: SRoutingHandleImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        return [SwitchEditModeAction.create({ elementsToActivate: [target.id] })];\r\n    }\r\n\r\n    override mouseMove(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        const result: Action[] = [];\r\n        if (event.buttons === 0)\r\n            this.mouseUp(target, event);\r\n        else if (this.startDragPosition) {\r\n            if (this.elementId2startPos.size === 0) {\r\n                this.collectStartPositions(target.root);\r\n            }\r\n            this.hasDragged = true;\r\n            const moveAction = this.getElementMoves(target, event, false);\r\n            if (moveAction)\r\n                result.push(moveAction);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected collectStartPositions(root: SModelRootImpl) {\r\n        const selectedElements = new Set<SModelElementImpl>(root.index.all()\r\n            .filter(element => isSelectable(element) && element.selected));\r\n\r\n        selectedElements.forEach(element => {\r\n            if (!this.isChildOfSelected(selectedElements, element)) {\r\n                if (isMoveable(element))\r\n                    this.elementId2startPos.set(element.id, element.position);\r\n                else if (element instanceof SRoutingHandleImpl) {\r\n                    const position = this.getHandlePosition(element);\r\n                    if (position)\r\n                        this.elementId2startPos.set(element.id, position);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected isChildOfSelected(selectedElements: Set<SModelElementImpl>, element: SModelElementImpl): boolean {\r\n        while (element instanceof SChildElementImpl) {\r\n            element = element.parent;\r\n            if (isMoveable(element) && selectedElements.has(element)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected getElementMoves(target: SModelElementImpl, event: MouseEvent, isFinished: boolean): MoveAction | undefined {\r\n        if (!this.startDragPosition)\r\n            return undefined;\r\n        const elementMoves: ElementMove[] = [];\r\n        const viewport = findParentByFeature(target, isViewport);\r\n        const zoom = viewport ? viewport.zoom : 1;\r\n        const delta = {\r\n            x: (event.pageX - this.startDragPosition.x) / zoom,\r\n            y: (event.pageY - this.startDragPosition.y) / zoom\r\n        };\r\n        this.elementId2startPos.forEach((startPosition, elementId) => {\r\n            const element = target.root.index.getById(elementId);\r\n            if (element) {\r\n                const move = this.createElementMove(element, startPosition, delta, event);\r\n                if (move) {\r\n                    elementMoves.push(move);\r\n                }\r\n            }\r\n        });\r\n        if (elementMoves.length > 0)\r\n            return MoveAction.create(elementMoves, { animate: false, finished: isFinished });\r\n        else\r\n            return undefined;\r\n    }\r\n\r\n    protected createElementMove(element: SModelElementImpl, startPosition: Point, delta: Point, event: MouseEvent): ElementMove | undefined {\r\n        const toPosition = this.snap({\r\n            x: startPosition.x + delta.x,\r\n            y: startPosition.y + delta.y\r\n        }, element, !event.shiftKey);\r\n        if (isMoveable(element)) {\r\n            return {\r\n                elementId: element.id,\r\n                elementType: element.type,\r\n                fromPosition: {\r\n                    x: element.position.x,\r\n                    y: element.position.y\r\n                },\r\n                toPosition\r\n            };\r\n        } else if (element instanceof SRoutingHandleImpl) {\r\n            const point = this.getHandlePosition(element);\r\n            if (point !== undefined) {\r\n                return {\r\n                    elementId: element.id,\r\n                    elementType: element.type,\r\n                    fromPosition: point,\r\n                    toPosition\r\n                };\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected snap(position: Point, element: SModelElementImpl, isSnap: boolean): Point {\r\n        if (isSnap && this.snapper)\r\n            return this.snapper.snap(position, element);\r\n        else\r\n            return position;\r\n    }\r\n\r\n    protected getHandlePosition(handle: SRoutingHandleImpl): Point | undefined {\r\n        if (this.edgeRouterRegistry) {\r\n            const parent = handle.parent;\r\n            if (!(parent instanceof SRoutableElementImpl))\r\n                return undefined;\r\n            const router = this.edgeRouterRegistry.get(parent.routerKind);\r\n            const route = router.route(parent);\r\n            return router.getHandlePosition(parent, route, handle);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    override mouseEnter(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        if (target instanceof SModelRootImpl && event.buttons === 0 && !this.startDragPosition)\r\n            this.mouseUp(target, event);\r\n        return [];\r\n    }\r\n\r\n    override mouseUp(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: Action[] = [];\r\n        if (this.startDragPosition) {\r\n            const moveAction = this.getElementMoves(target, event, true);\r\n            if (moveAction) {\r\n                result.push(moveAction);\r\n            }\r\n            target.root.index.all().forEach(element => {\r\n                if (element instanceof SRoutingHandleImpl) {\r\n                    result.push(...this.deactivateRoutingHandle(element, target, event));\r\n                }\r\n            });\r\n        }\r\n        if (!result.some(a => a.kind === ReconnectAction.KIND)) {\r\n            const edgeInProgress = target.root.index.getById(edgeInProgressID);\r\n            if (edgeInProgress instanceof SChildElementImpl) {\r\n                result.push(this.deleteEdgeInProgress(edgeInProgress));\r\n            }\r\n        }\r\n        if (this.hasDragged) {\r\n            result.push(CommitModelAction.create());\r\n        }\r\n        this.hasDragged = false;\r\n        this.startDragPosition = undefined;\r\n        this.elementId2startPos.clear();\r\n        return result;\r\n    }\r\n\r\n    protected deactivateRoutingHandle(element: SRoutingHandleImpl, target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        const result: Action[] = [];\r\n        const parent = element.parent;\r\n        if (parent instanceof SRoutableElementImpl && element.danglingAnchor) {\r\n            const handlePos = this.getHandlePosition(element);\r\n            if (handlePos) {\r\n                const handlePosAbs = translatePoint(handlePos, element.parent, element.root);\r\n                const newEnd = findChildrenAtPosition(target.root, handlePosAbs)\r\n                    .find(e => isConnectable(e) && e.canConnect(parent, element.kind as ('source' | 'target')));\r\n                if (newEnd && this.hasDragged) {\r\n                    result.push(ReconnectAction.create({\r\n                        routableId: element.parent.id,\r\n                        newSourceId: element.kind === 'source' ? newEnd.id : parent.sourceId,\r\n                        newTargetId: element.kind === 'target' ? newEnd.id : parent.targetId\r\n                    }));\r\n                }\r\n            }\r\n        }\r\n        if (element.editMode) {\r\n            result.push(SwitchEditModeAction.create({ elementsToDeactivate: [element.id] }));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected deleteEdgeInProgress(edgeInProgress: SChildElementImpl): Action {\r\n        const deleteIds: string[] = [];\r\n        deleteIds.push(edgeInProgressID);\r\n        edgeInProgress.children.forEach(c => {\r\n            if (c instanceof SRoutingHandleImpl && c.danglingAnchor)\r\n                deleteIds.push(c.danglingAnchor.id);\r\n        });\r\n        return DeleteElementAction.create(deleteIds);\r\n    }\r\n\r\n    override decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        return vnode;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class LocationPostprocessor implements IVNodePostprocessor {\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        if (isEdgeLayoutable(element) && element.parent instanceof SEdgeImpl) {\r\n            // The element is handled by EdgeLayoutDecorator\r\n            return vnode;\r\n        }\r\n        let translate: string = '';\r\n        if (isLocateable(element) && element instanceof SChildElementImpl && element.parent !== undefined) {\r\n            const pos = element.position;\r\n            if (pos.x !== 0 || pos.y !== 0) {\r\n                translate = 'translate(' + pos.x + ', ' + pos.y + ')';\r\n            }\r\n        }\r\n        if (isAlignable(element)) {\r\n            const ali = element.alignment;\r\n            if (ali.x !== 0 || ali.y !== 0) {\r\n                if (translate.length > 0) {\r\n                    translate += ' ';\r\n                }\r\n                translate += 'translate(' + ali.x + ', ' + ali.y + ')';\r\n            }\r\n        }\r\n        if (translate.length > 0) {\r\n            setAttr(vnode, 'transform', translate);\r\n        }\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from \"inversify\";\r\nimport { Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { SModelElementImpl } from \"../../base/model/smodel\";\r\nimport { isBoundsAware } from \"../bounds/model\";\r\n\r\n/**\r\n * A snapper helps to align nodes and routing handles.\r\n */\r\nexport interface ISnapper {\r\n    /**\r\n     * @retruns the closest snapped position that for the `element` located at `position`\r\n     */\r\n    snap(position: Point, element: SModelElementImpl): Point\r\n}\r\n\r\n/**\r\n * A simple snapper that snaps the center of nodes and routing points to a grid.\r\n */\r\n@injectable()\r\nexport class CenterGridSnapper implements ISnapper {\r\n\r\n    get gridX() {\r\n        return 10;\r\n    }\r\n\r\n    get gridY() {\r\n        return 10;\r\n    }\r\n\r\n    snap(position: Point, element: SModelElementImpl): Point {\r\n        if (element && isBoundsAware(element))\r\n            return {\r\n                x: Math.round((position.x + 0.5 * element.bounds.width) / this.gridX) * this.gridX - 0.5 * element.bounds.width,\r\n                y: Math.round((position.y + 0.5 * element.bounds.height) / this.gridY) * this.gridY - 0.5 * element.bounds.height\r\n            };\r\n        else\r\n            return {\r\n                x: Math.round(position.x / this.gridX) * this.gridX,\r\n                y: Math.round(position.y / this.gridY) * this.gridY\r\n            };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\n\r\nexport const openFeature = Symbol('openFeature');\r\n\r\nexport function isOpenable(element: SModelElementImpl): element is SModelElementImpl  {\r\n    return element.hasFeature(openFeature);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action, OpenAction } from 'sprotty-protocol/lib/actions';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { isOpenable } from './model';\r\n\r\n\r\nexport class OpenMouseListener extends MouseListener {\r\n    override doubleClick(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const openableTarget = findParentByFeature(target, isOpenable);\r\n        if (openableTarget !== undefined) {\r\n            return [ OpenAction.create(openableTarget.id) ];\r\n        }\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Projectable as ProjectableSchema, Viewport } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Dimension } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { hasOwnProperty } from 'sprotty-protocol/lib/utils/object';\r\nimport { SChildElementImpl, SModelRootImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { transformToRootBounds } from '../../base/model/smodel-utils';\r\nimport { isBoundsAware } from '../bounds/model';\r\n\r\n/**\r\n * Model elements implementing this interface can be displayed on a projection bar.\r\n * _Note:_ If set, the projectedBounds property will be prefered over the model element bounds.\r\n * Otherwise model elements also have to be `BoundsAware` so their projections can be shown.\r\n * @deprecated Use the definition from `sprotty-protocol` instead.\r\n */\r\nexport interface Projectable {\r\n    projectionCssClasses: string[],\r\n    projectedBounds?: Bounds,\r\n}\r\n\r\nexport function isProjectable(arg: unknown): arg is ProjectableSchema {\r\n    return hasOwnProperty(arg, 'projectionCssClasses');\r\n}\r\n\r\n/**\r\n * A projection can be shown in a horizontal or vertical bar to display an overview of the diagram.\r\n */\r\nexport interface ViewProjection {\r\n    elementId: string;\r\n    projectedBounds: Bounds;\r\n    cssClasses: string[];\r\n}\r\n\r\n/**\r\n * Gather all projections of elements contained in the given parent element.\r\n */\r\nexport function getProjections(parent: Readonly<SParentElementImpl>): ViewProjection[] | undefined {\r\n    let result: ViewProjection[] | undefined;\r\n    for (const child of parent.children) {\r\n        if (isProjectable(child) && child.projectionCssClasses.length > 0) {\r\n            const projectedBounds = getProjectedBounds(child);\r\n            if (projectedBounds) {\r\n                const projection: ViewProjection = {\r\n                    elementId: child.id,\r\n                    projectedBounds,\r\n                    cssClasses: child.projectionCssClasses\r\n                };\r\n                if (result) {\r\n                    result.push(projection);\r\n                } else {\r\n                    result = [projection];\r\n                }\r\n            }\r\n        }\r\n        if (child.children.length > 0) {\r\n            const childProj = getProjections(child);\r\n            if (childProj) {\r\n                if (result) {\r\n                    result.push(...childProj);\r\n                } else {\r\n                    result = childProj;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\n/**\r\n * Compute the projected bounds of the given model element, that is the absolute position in the diagram.\r\n */\r\nexport function getProjectedBounds(model: Readonly<SChildElementImpl & ProjectableSchema>): Bounds | undefined {\r\n    const parent = model.parent;\r\n    if (model.projectedBounds) {\r\n        let bounds = model.projectedBounds;\r\n        if (isBoundsAware(parent)) {\r\n            bounds = transformToRootBounds(parent, bounds);\r\n        }\r\n        return bounds;\r\n    } else if (isBoundsAware(model)) {\r\n        let bounds = model.bounds;\r\n        bounds = transformToRootBounds(parent, bounds);\r\n        return bounds;\r\n    }\r\n    return undefined;\r\n}\r\n\r\nconst MAX_COORD = 1_000_000_000;\r\n\r\n/**\r\n * Determine the total bounds of a model; this takes the viewport into consideration\r\n * so it can be shown in the projections.\r\n */\r\nexport function getModelBounds(model: SModelRootImpl & Viewport): Bounds | undefined {\r\n    let minX = MAX_COORD;\r\n    let minY = MAX_COORD;\r\n    let maxX = -MAX_COORD;\r\n    let maxY = -MAX_COORD;\r\n\r\n    const bounds = isBoundsAware(model) ? model.bounds : undefined;\r\n    if (bounds && Dimension.isValid(bounds)) {\r\n        // Get the bounds directly from the model if it returns a valid size\r\n        minX = bounds.x;\r\n        minY = bounds.y;\r\n        maxX = minX + bounds.width;\r\n        maxY = minY + bounds.height;\r\n    } else {\r\n        // Determine the min. / max coordinates of top-level model elements\r\n        // Note that this approach is slower, so provide valid bounds to speed up the process.\r\n        for (const element of model.children) {\r\n            if (isBoundsAware(element)) {\r\n                const b = element.bounds;\r\n                minX = Math.min(minX, b.x);\r\n                minY = Math.min(minY, b.y);\r\n                maxX = Math.max(maxX, b.x + b.width);\r\n                maxY = Math.max(maxY, b.y + b.height);\r\n            }\r\n        }\r\n    }\r\n\r\n    // Enlarge the bounds by the current viewport to ensure it always fits into the projection\r\n    minX = Math.min(minX, model.scroll.x);\r\n    minY = Math.min(minY, model.scroll.y);\r\n    maxX = Math.max(maxX, model.scroll.x + model.canvasBounds.width / model.zoom);\r\n    maxY = Math.max(maxY, model.scroll.y + model.canvasBounds.height / model.zoom);\r\n\r\n    if (minX < maxX && minY < maxY) {\r\n        return {\r\n            x: minX,\r\n            y: minY,\r\n            width: maxX - minX,\r\n            height: maxY - minY\r\n        };\r\n    }\r\n    return undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx html */\r\nimport { html } from '../../lib/jsx';\r\n\r\nimport { injectable } from 'inversify';\r\nimport { VNode, VNodeStyle, h } from 'snabbdom';\r\nimport { Bounds } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { IView, IViewArgs, RenderingContext } from '../../base/views/view';\r\nimport { setAttr, setClass } from '../../base/views/vnode-utils';\r\nimport { ViewportRootElementImpl } from '../viewport/viewport-root';\r\nimport { getModelBounds, getProjections, ViewProjection } from './model';\r\n\r\n/**\r\n * Special viewport root view that renders horizontal and vertical projection bars for quick navigation.\r\n */\r\n@injectable()\r\nexport class ProjectedViewportView implements IView {\r\n\r\n    render(model: Readonly<ViewportRootElementImpl>, context: RenderingContext, args?: IViewArgs): VNode {\r\n        const rootNode: VNode = <div class-sprotty-root={true}>\r\n            {this.renderSvg(model, context, args)}\r\n            {this.renderProjections(model, context, args)}\r\n        </div>;\r\n        setAttr(rootNode, 'tabindex', 0); // make root div focus-able\r\n        return rootNode;\r\n    }\r\n\r\n    protected renderSvg(model: Readonly<ViewportRootElementImpl>, context: RenderingContext, args?: IViewArgs): VNode {\r\n        const transform = `scale(${model.zoom}) translate(${-model.scroll.x},${-model.scroll.y})`;\r\n        const ns = 'http://www.w3.org/2000/svg';\r\n        return h('svg', { ns }, h('g', { ns, attrs: { transform } }, context.renderChildren(model)));\r\n    }\r\n\r\n    protected renderProjections(model: Readonly<ViewportRootElementImpl>, context: RenderingContext, args?: IViewArgs): VNode[] {\r\n        if (model.zoom <= 0) {\r\n            return [];\r\n        }\r\n        const modelBounds = getModelBounds(model);\r\n        if (!modelBounds) {\r\n            return [];\r\n        }\r\n        const projections = getProjections(model) ?? [];\r\n        return [\r\n            this.renderProjectionBar(projections, model, modelBounds, 'vertical'),\r\n            this.renderProjectionBar(projections, model, modelBounds, 'horizontal')\r\n        ];\r\n    }\r\n\r\n    protected renderProjectionBar(projections: ViewProjection[], model: Readonly<ViewportRootElementImpl>, modelBounds: Bounds, orientation: 'horizontal' | 'vertical'): VNode {\r\n        const params: ProjectionParams = { modelBounds, orientation } as ProjectionParams;\r\n        // NOTE: Here we assume that the projection bars have the same size as the diagram canvas, i.e. they are drawn as overlay above the canvas.\r\n        params.factor = orientation === 'horizontal' ? model.canvasBounds.width / modelBounds.width : model.canvasBounds.height / modelBounds.height;\r\n        params.zoomedFactor = params.factor / model.zoom;\r\n        return <div\r\n                class-sprotty-projection-bar={true}\r\n                class-horizontal={orientation === 'horizontal'}\r\n                class-vertical={orientation === 'vertical'} >\r\n            {this.renderViewport(model, params)}\r\n            {projections.map(p => this.renderProjection(p, model, params))}\r\n        </div>;\r\n    }\r\n\r\n    protected renderViewport(model: Readonly<ViewportRootElementImpl>, params: ProjectionParams): VNode {\r\n        let canvasSize, viewportPos: number;\r\n        if (params.orientation === 'horizontal') {\r\n            canvasSize = model.canvasBounds.width;\r\n            viewportPos = (model.scroll.x - params.modelBounds.x) * params.factor;\r\n        } else {\r\n            canvasSize = model.canvasBounds.height;\r\n            viewportPos = (model.scroll.y - params.modelBounds.y) * params.factor;\r\n        }\r\n        let viewportSize = canvasSize * params.zoomedFactor;\r\n        if (viewportPos < 0) {\r\n            viewportSize += viewportPos;\r\n            viewportPos = 0;\r\n        } else if (viewportPos > canvasSize) {\r\n            viewportPos = canvasSize;\r\n        }\r\n        if (viewportSize < 0) {\r\n            viewportSize = 0;\r\n        } else if (viewportPos + viewportSize > canvasSize) {\r\n            viewportSize = canvasSize - viewportPos;\r\n        }\r\n        const style: VNodeStyle = params.orientation === 'horizontal' ? {\r\n            left: `${viewportPos}px`,\r\n            width: `${viewportSize}px`\r\n        } : {\r\n            top: `${viewportPos}px`,\r\n            height: `${viewportSize}px`\r\n        };\r\n        return <div class-sprotty-viewport={true} style={style} />;\r\n    }\r\n\r\n    protected renderProjection(projection: ViewProjection, model: Readonly<ViewportRootElementImpl>, params: ProjectionParams): VNode {\r\n        let canvasSize, projPos, projSize: number;\r\n        if (params.orientation === 'horizontal') {\r\n            canvasSize = model.canvasBounds.width;\r\n            projPos = (projection.projectedBounds.x - params.modelBounds.x) * params.factor;\r\n            projSize = projection.projectedBounds.width * params.factor;\r\n        } else {\r\n            canvasSize = model.canvasBounds.height;\r\n            projPos = (projection.projectedBounds.y - params.modelBounds.y) * params.factor;\r\n            projSize = projection.projectedBounds.height * params.factor;\r\n        }\r\n        if (projPos < 0) {\r\n            projSize += projPos;\r\n            projPos = 0;\r\n        } else if (projPos > canvasSize) {\r\n            projPos = canvasSize;\r\n        }\r\n        if (projSize < 0) {\r\n            projSize = 0;\r\n        } else if (projPos + projSize > canvasSize) {\r\n            projSize = canvasSize - projPos;\r\n        }\r\n        const style: VNodeStyle = params.orientation === 'horizontal' ? {\r\n            left: `${projPos}px`,\r\n            width: `${projSize}px`\r\n        } : {\r\n            top: `${projPos}px`,\r\n            height: `${projSize}px`\r\n        };\r\n        const result = <div id={`${params.orientation}-projection:${projection.elementId}`} class-sprotty-projection={true} style={style} />;\r\n        projection.cssClasses.forEach(cl => setClass(result, cl, true));\r\n        return result;\r\n    }\r\n\r\n}\r\n\r\nexport type ProjectionParams = {\r\n    modelBounds: Bounds\r\n    orientation: 'horizontal' | 'vertical'\r\n    factor: number\r\n    zoomedFactor: number\r\n};\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { IAnchorComputer, ELLIPTIC_ANCHOR_KIND, RECTANGULAR_ANCHOR_KIND, DIAMOND_ANCHOR_KIND } from \"./anchor\";\r\nimport { SConnectableElementImpl } from \"./model\";\r\nimport { PointToPointLine, Diamond, intersection } from \"../../utils/geometry\";\r\nimport { injectable } from \"inversify\";\r\nimport { PolylineEdgeRouter } from \"./polyline-edge-router\";\r\nimport { almostEquals, Bounds, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\n\r\n@injectable()\r\nexport class EllipseAnchor implements IAnchorComputer {\r\n\r\n    get kind() {\r\n        return PolylineEdgeRouter.KIND + ':' + ELLIPTIC_ANCHOR_KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number = 0): Point {\r\n        const bounds = connectable.bounds;\r\n        const c = Bounds.center(bounds);\r\n        const dx = c.x - refPoint.x;\r\n        const dy = c.y - refPoint.y;\r\n        const distance = Math.sqrt(dx * dx + dy * dy);\r\n        const normX = (dx / distance) || 0;\r\n        const normY = (dy / distance) || 0;\r\n        return {\r\n            x: c.x - normX * (0.5 * bounds.width + offset),\r\n            y: c.y - normY * (0.5 * bounds.height + offset)\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class RectangleAnchor implements IAnchorComputer {\r\n\r\n    get kind() {\r\n        return PolylineEdgeRouter.KIND + ':' + RECTANGULAR_ANCHOR_KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number = 0): Point {\r\n        const bounds = connectable.bounds;\r\n        const c = Bounds.center(bounds);\r\n        const finder = new NearestPointFinder(c, refPoint);\r\n        if (!almostEquals(c.y, refPoint.y)) {\r\n            const xTop = this.getXIntersection(bounds.y, c, refPoint);\r\n            if (xTop >= bounds.x && xTop <= bounds.x + bounds.width)\r\n                finder.addCandidate(xTop, bounds.y - offset);\r\n            const xBottom = this.getXIntersection(bounds.y + bounds.height, c, refPoint);\r\n            if (xBottom >= bounds.x && xBottom <= bounds.x + bounds.width)\r\n                finder.addCandidate(xBottom, bounds.y + bounds.height + offset);\r\n        }\r\n        if (!almostEquals(c.x, refPoint.x)) {\r\n            const yLeft = this.getYIntersection(bounds.x, c, refPoint);\r\n            if (yLeft >= bounds.y && yLeft <= bounds.y + bounds.height)\r\n                finder.addCandidate(bounds.x - offset, yLeft);\r\n            const yRight = this.getYIntersection(bounds.x + bounds.width, c, refPoint);\r\n            if (yRight >= bounds.y && yRight <= bounds.y + bounds.height)\r\n                finder.addCandidate(bounds.x + bounds.width + offset, yRight);\r\n        }\r\n        return finder.best;\r\n    }\r\n\r\n    protected getXIntersection(yIntersection: number, centerPoint: Point, point: Point): number {\r\n        const t = (yIntersection - centerPoint.y) / (point.y - centerPoint.y);\r\n        return (point.x - centerPoint.x) * t + centerPoint.x;\r\n    }\r\n\r\n    protected getYIntersection(xIntersection: number, centerPoint: Point, point: Point): number {\r\n        const t = (xIntersection - centerPoint.x) / (point.x - centerPoint.x);\r\n        return (point.y - centerPoint.y) * t + centerPoint.y;\r\n    }\r\n}\r\n\r\nclass NearestPointFinder {\r\n    protected currentBest: Point | undefined;\r\n    protected currentDist: number = -1;\r\n\r\n    constructor(protected centerPoint: Point, protected refPoint: Point) {\r\n    }\r\n\r\n    addCandidate(x: number, y: number) {\r\n        const dx = this.refPoint.x - x;\r\n        const dy = this.refPoint.y - y;\r\n        const dist = dx * dx + dy * dy;\r\n        if (this.currentDist < 0 || dist < this.currentDist) {\r\n            this.currentBest = {\r\n                x: x,\r\n                y: y\r\n            };\r\n            this.currentDist = dist;\r\n        }\r\n    }\r\n\r\n    get best(): Point {\r\n        if (this.currentBest === undefined)\r\n            return this.centerPoint;\r\n        else\r\n            return this.currentBest;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class DiamondAnchor implements IAnchorComputer {\r\n\r\n    get kind() {\r\n        return PolylineEdgeRouter.KIND + ':' + DIAMOND_ANCHOR_KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number): Point {\r\n        const bounds = connectable.bounds;\r\n        const referenceLine = new PointToPointLine(Bounds.center(bounds), refPoint);\r\n        const closestDiamondSide = new Diamond(bounds).closestSideLine(refPoint);\r\n        const anchorPoint = intersection(closestDiamondSide, referenceLine);\r\n        return Point.shiftTowards(anchorPoint, refPoint, offset);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from 'inversify';\r\nimport { Action } from 'sprotty-protocol/lib/actions';\r\nimport { centerOfLine, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { ResolvedHandleMove } from '../move/move';\r\nimport { SDanglingAnchorImpl, SRoutableElementImpl, SRoutingHandleImpl } from './model';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { EdgeRouterRegistry, RoutedPoint } from './routing';\r\nimport { AbstractEdgeRouter, LinearRouteOptions } from './abstract-edge-router';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { Command, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { TYPES } from \"../../base/types\";\r\nimport { SEdgeImpl } from '../../graph/sgraph';\r\n\r\n@injectable()\r\nexport class BezierEdgeRouter extends AbstractEdgeRouter {\r\n\r\n    static readonly KIND = 'bezier';\r\n    static readonly DEFAULT_BEZIER_HANDLE_OFFSET = 25;\r\n\r\n    get kind() {\r\n        return BezierEdgeRouter.KIND;\r\n    }\r\n\r\n    route(edge: SRoutableElementImpl): RoutedPoint[] {\r\n        if (!edge.source || !edge.target)\r\n            return [];\r\n        const rpCount = edge.routingPoints.length;\r\n        const source = edge.source;\r\n        const target = edge.target;\r\n\r\n        const result: RoutedPoint[] = [];\r\n        result.push({ kind: 'source', x: 0, y: 0 });\r\n        if (rpCount === 0) {\r\n            // initial values\r\n            const [h1, h2] = this.createDefaultBezierHandles(source.position, target.position);\r\n            result.push( { kind: 'bezier-control-after', x: h1.x, y: h1.y, pointIndex: 0 } );\r\n            result.push( { kind: 'bezier-control-before', x: h2.x, y: h2.y, pointIndex: 1 } );\r\n            edge.routingPoints.push(h1);\r\n            edge.routingPoints.push(h2);\r\n        } else if (rpCount >= 2) {\r\n            for (let i = 0; i < rpCount; i++) {\r\n                const p = edge.routingPoints[i];\r\n                if (i % 3 === 0) {\r\n                    result.push({ kind: 'bezier-control-after', x: p.x, y: p.y, pointIndex: i });\r\n                }\r\n                if ((i + 1) % 3 === 0) {\r\n                    result.push({ kind: 'bezier-junction', x: p.x, y: p.y, pointIndex: i });\r\n                } else if ((i + 2) % 3 === 0) {\r\n                    result.push({ kind: 'bezier-control-before', x: p.x, y: p.y, pointIndex: i });\r\n                }\r\n            }\r\n        }\r\n        result.push({ kind: 'target', x: 0, y: 0 });\r\n\r\n        // use \"ends\" of edge as reference or next bezier-junction\r\n        const p0 = rpCount > 2 ? edge.routingPoints[2] : target.position;\r\n        const pn = rpCount > 2 ? edge.routingPoints[edge.routingPoints.length - 3] : source.position;\r\n\r\n        const sourceAnchor = this.getTranslatedAnchor(source, p0, target.parent, edge, edge.sourceAnchorCorrection);\r\n        const targetAnchor = this.getTranslatedAnchor(target, pn, source.parent, edge, edge.targetAnchorCorrection);\r\n\r\n        result[0] = { kind: 'source', x: sourceAnchor.x, y: sourceAnchor.y };\r\n        result[result.length - 1] = { kind: 'target', x: targetAnchor.x, y: targetAnchor.y };\r\n\r\n        return result;\r\n    }\r\n\r\n    private createDefaultBezierHandles(relH1: Point, relH2: Point): [Point, Point] {\r\n        const h1 = {\r\n            x: relH1.x - BezierEdgeRouter.DEFAULT_BEZIER_HANDLE_OFFSET,\r\n            y: relH1.y\r\n        };\r\n        const h2 = {\r\n            x: relH2.x + BezierEdgeRouter.DEFAULT_BEZIER_HANDLE_OFFSET,\r\n            y: relH2.y\r\n        };\r\n        return [ h1, h2 ];\r\n    }\r\n\r\n    createRoutingHandles(edge: SRoutableElementImpl): void {\r\n        // route ensure there are at least 2 routed points\r\n        this.route(edge);\r\n\r\n        this.rebuildHandles(edge);\r\n    }\r\n\r\n    private rebuildHandles(edge: SRoutableElementImpl) {\r\n        this.addHandle(edge, 'source', 'routing-point', -2);\r\n        this.addHandle(edge, 'bezier-control-after', 'bezier-routing-point', 0);\r\n        this.addHandle(edge, 'bezier-add', 'bezier-create-routing-point', 0);\r\n        const rpCount = edge.routingPoints.length;\r\n\r\n        if (rpCount > 2) {\r\n            for (let i = 1; i < rpCount - 1; i += 3) {\r\n                this.addHandle(edge, 'bezier-control-before', 'bezier-routing-point', i);\r\n                // Add two circle for add/remove segments\r\n                this.addHandle(edge, 'bezier-add', 'bezier-create-routing-point', i + 1);\r\n                this.addHandle(edge, 'bezier-junction', 'routing-point', i + 1);\r\n                this.addHandle(edge, 'bezier-remove', 'bezier-remove-routing-point', i + 1);\r\n                this.addHandle(edge, 'bezier-control-after', 'bezier-routing-point', i + 2);\r\n\r\n                // re-position control-pairs\r\n                this.moveBezierControlPair(edge.routingPoints[i], i, edge);\r\n            }\r\n        }\r\n        this.addHandle(edge, 'bezier-control-before', 'bezier-routing-point', rpCount - 1);\r\n        this.addHandle(edge, 'target', 'routing-point', -1);\r\n    }\r\n\r\n    getInnerHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl) {\r\n       if (handle.kind === 'bezier-control-before' || handle.kind === 'bezier-junction' || handle.kind === 'bezier-control-after') {\r\n            for (let i = 0; i < route.length; i++) {\r\n                const p = route[i];\r\n                if (p.pointIndex === handle.pointIndex && p.kind === handle.kind)\r\n                    return p;\r\n            }\r\n        } else if (handle.kind === 'bezier-add') {\r\n            const ctrlPoint = this.findBezierControl(edge, route, handle.pointIndex);\r\n            return { x: ctrlPoint.x, y: ctrlPoint.y + 12.5};\r\n        } else if (handle.kind === 'bezier-remove') {\r\n            const ctrlPoint = this.findBezierControl(edge, route, handle.pointIndex);\r\n            return { x: ctrlPoint.x, y: ctrlPoint.y - 12.5};\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected findBezierControl(edge: SRoutableElementImpl, route: RoutedPoint[], handleIndex: number): Point {\r\n        let result: Point = { x: route[0].x, y: route[0].y };\r\n        if (handleIndex > 0) {\r\n            for (const rp of route) {\r\n                if (rp.pointIndex !== undefined && rp.pointIndex === handleIndex && rp.kind === 'bezier-junction') {\r\n                    result = { x: rp.x, y: rp.y };\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    override applyHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]): void {\r\n        moves.forEach(move => {\r\n            const handle = move.handle;\r\n            let orgPosition = { x: 0, y: 0 };\r\n            let relativePos, newControlPos, ctrlPointIndex;\r\n            const moveToPos = move.toPosition;\r\n\r\n            switch (handle.kind) {\r\n                case 'bezier-control-before':\r\n                case 'bezier-control-after':\r\n                    // find potential other handle/rp and move\r\n                    this.moveBezierControlPair(moveToPos, move.handle.pointIndex, edge);\r\n                    break;\r\n                case 'bezier-junction':\r\n                    const index = handle.pointIndex;\r\n                    if (index >= 0 && index < edge.routingPoints.length) {\r\n                        ctrlPointIndex = index - 1;\r\n                        orgPosition = edge.routingPoints[index];\r\n                        relativePos = edge.routingPoints[ctrlPointIndex];\r\n                        newControlPos = this.calcRelativeMove(orgPosition, moveToPos, relativePos);\r\n                        edge.routingPoints[index] = moveToPos;\r\n                        this.moveBezierControlPair(newControlPos, ctrlPointIndex, edge);\r\n                    }\r\n                    break;\r\n                case 'source':\r\n                    ctrlPointIndex = 0;\r\n                    relativePos = edge.routingPoints[ctrlPointIndex];\r\n\r\n                    if (!(edge.source instanceof SDanglingAnchorImpl)) {\r\n                        // detach source\r\n                        const anchor = new SDanglingAnchorImpl();\r\n                        anchor.id = edge.id + '_dangling-source';\r\n                        anchor.original = edge.source;\r\n                        anchor.position = move.toPosition;\r\n                        handle.root.add(anchor);\r\n                        handle.danglingAnchor = anchor;\r\n                        edge.sourceId = anchor.id;\r\n                        if (edge.source) orgPosition = edge.source.position;\r\n                    } else if (handle.danglingAnchor) {\r\n                        orgPosition = handle.danglingAnchor.position;\r\n                        handle.danglingAnchor.position = moveToPos;\r\n                    }\r\n                    newControlPos = this.calcRelativeMove(orgPosition, moveToPos, relativePos);\r\n                    this.moveBezierControlPair(newControlPos, ctrlPointIndex, edge);\r\n                    break;\r\n                case 'target':\r\n                    ctrlPointIndex = edge.routingPoints.length - 1;\r\n                    relativePos = edge.routingPoints[ctrlPointIndex];\r\n\r\n                    if (!(edge.target instanceof SDanglingAnchorImpl)) {\r\n                        // detach target\r\n                        const anchor = new SDanglingAnchorImpl();\r\n                        anchor.id = edge.id + '_dangling-target';\r\n                        anchor.original = edge.target;\r\n                        anchor.position = moveToPos;\r\n                        handle.root.add(anchor);\r\n                        handle.danglingAnchor = anchor;\r\n                        edge.targetId = anchor.id;\r\n                        if (edge.target) orgPosition = edge.target.position;\r\n                    } else if (handle.danglingAnchor) {\r\n                        orgPosition = handle.danglingAnchor.position;\r\n                        handle.danglingAnchor.position = moveToPos;\r\n                    }\r\n                    newControlPos = this.calcRelativeMove(orgPosition, moveToPos, relativePos);\r\n                    this.moveBezierControlPair(newControlPos, ctrlPointIndex, edge);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    protected applyInnerHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]): void {\r\n        // not required\r\n    }\r\n\r\n    protected getOptions(edge: SRoutableElementImpl): LinearRouteOptions {\r\n        return  {\r\n            minimalPointDistance: 2,\r\n            standardDistance: 0.1,\r\n            selfEdgeOffset: 20\r\n        };\r\n    }\r\n\r\n    private calcRelativeMove(oldPos: Point, newPos: Point, relativePoint: Point): Point {\r\n        return {\r\n            x: relativePoint.x - (oldPos.x - newPos.x),\r\n            y: relativePoint.y - (oldPos.y - newPos.y)\r\n        };\r\n    }\r\n\r\n    public createNewBezierSegment(index: number, edge: SRoutableElementImpl): void {\r\n        const routingPoints = edge.routingPoints;\r\n\r\n        let bezierJunctionPos, start, end: Point;\r\n        if (routingPoints.length === 2) {\r\n            start = routingPoints[index < 0 ? 0 : index];\r\n            end = routingPoints[routingPoints.length - 1];\r\n            bezierJunctionPos = centerOfLine(start, end);\r\n        } else {\r\n            start = routingPoints[index];\r\n            end = routingPoints[index + 2];\r\n            bezierJunctionPos = centerOfLine(start, end);\r\n        }\r\n        const [h1, h2] = this.createDefaultBezierHandles(bezierJunctionPos, bezierJunctionPos);\r\n\r\n        routingPoints.splice(index + 1, 0, h1);\r\n        routingPoints.splice(index + 2, 0, bezierJunctionPos);\r\n        routingPoints.splice(index + 3, 0, h2);\r\n        // ensure handles are correctly positioned\r\n        this.moveBezierControlPair(h1, index + 1, edge);\r\n\r\n        // simple solution for now: just rebuildHandles\r\n        edge.removeAll(c => c instanceof SRoutingHandleImpl);\r\n        this.rebuildHandles(edge);\r\n    }\r\n\r\n    public removeBezierSegment(index: number, edge: SRoutableElementImpl): void {\r\n        const routingPoints = edge.routingPoints;\r\n\r\n        routingPoints.splice(index - 1, 3);\r\n\r\n        // simple solution for now: just rebuildHandles\r\n        edge.removeAll(c => c instanceof SRoutingHandleImpl);\r\n        this.rebuildHandles(edge);\r\n    }\r\n\r\n    private moveBezierControlPair(newPos: Point, ctrlPointIndex: number, edge: SRoutableElementImpl) {\r\n        if (ctrlPointIndex >= 0 && ctrlPointIndex < edge.routingPoints.length) {\r\n            // find neighbors\r\n            const before = ctrlPointIndex - 1;\r\n            const after = ctrlPointIndex + 1;\r\n\r\n            // this is the first control or the last control => nothing to do further\r\n            if (before < 0 || after === edge.routingPoints.length) {\r\n                edge.routingPoints[ctrlPointIndex] = newPos;\r\n            } else  {\r\n                // behind bezier-junction\r\n                if (ctrlPointIndex % 3 === 0) {\r\n                    this.setBezierMirror(edge, newPos, ctrlPointIndex, false);\r\n                // before bezier-junction\r\n                } else if ((ctrlPointIndex + 2) % 3 === 0) {\r\n                    this.setBezierMirror(edge, newPos, ctrlPointIndex, true);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private setBezierMirror(edge: SRoutableElementImpl, newPos: Point, pointIndex: number, before: boolean) {\r\n        edge.routingPoints[pointIndex] = newPos;\r\n        const jct = edge.routingPoints[before ? (pointIndex + 1) : (pointIndex - 1)];\r\n        edge.routingPoints[before ? (pointIndex + 2) : (pointIndex - 2)] = {\r\n            x: jct.x - (newPos.x - jct.x),\r\n            y: jct.y - (newPos.y - jct.y)\r\n        };\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * Reacts on mouseDown events if the target kind is bezier-add or bezier-remove\r\n */\r\nexport class BezierMouseListener extends MouseListener {\r\n\r\n    override mouseDown(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        const result = [];\r\n        if (target instanceof SRoutingHandleImpl && (target.kind === 'bezier-add' || target.kind === 'bezier-remove')) {\r\n            if (target.type === 'bezier-create-routing-point') {\r\n                result.push(AddRemoveBezierSegmentAction.create('add', target.id));\r\n            } else if (target.type === 'bezier-remove-routing-point') {\r\n                result.push(AddRemoveBezierSegmentAction.create('remove', target.id));\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n};\r\n\r\nexport interface AddRemoveBezierSegmentAction extends Action {\r\n    kind: typeof AddRemoveBezierSegmentAction.KIND\r\n    targetId: string\r\n    actionTask: 'add' | 'remove'\r\n}\r\n\r\nexport namespace AddRemoveBezierSegmentAction {\r\n    export const KIND = 'addRemoveBezierSegment';\r\n    export function create(actionTask: 'add' | 'remove', targetId: string): AddRemoveBezierSegmentAction {\r\n        return {\r\n            kind: KIND,\r\n            actionTask,\r\n            targetId\r\n        };\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class AddRemoveBezierSegmentCommand extends Command {\r\n    static readonly KIND = AddRemoveBezierSegmentAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: AddRemoveBezierSegmentAction,\r\n        @inject(EdgeRouterRegistry) protected readonly edgeRouterRegistry?: EdgeRouterRegistry) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const index = context.root.index;\r\n        const target = index.getById(this.action.targetId);\r\n\r\n        if (this.edgeRouterRegistry && target instanceof SRoutingHandleImpl) {\r\n            const raw = this.edgeRouterRegistry.get((target.parent as SRoutableElementImpl).routerKind);\r\n            if (raw instanceof BezierEdgeRouter) {\r\n                const router = raw;\r\n\r\n                for (const child of context.root.children) {\r\n                    if (child.id === target.parent.id) {\r\n                        if (this.action.actionTask === 'add') {\r\n                            router.createNewBezierSegment(target.pointIndex, child as SEdgeImpl);\r\n                        } else if (this.action.actionTask === 'remove') {\r\n                            router.removeBezierSegment(target.pointIndex, child as SEdgeImpl);\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        throw new Error('Method not implemented.');\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ELLIPTIC_ANCHOR_KIND, RECTANGULAR_ANCHOR_KIND, DIAMOND_ANCHOR_KIND } from \"./anchor\";\r\nimport { injectable } from \"inversify\";\r\nimport { DiamondAnchor, EllipseAnchor, RectangleAnchor } from './polyline-anchors';\r\nimport { BezierEdgeRouter } from './bezier-edge-router';\r\n\r\n@injectable()\r\nexport class BezierEllipseAnchor extends EllipseAnchor {\r\n\r\n    override get kind() {\r\n        return BezierEdgeRouter.KIND + ':' + ELLIPTIC_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class BezierRectangleAnchor extends RectangleAnchor {\r\n\r\n    override get kind() {\r\n        return BezierEdgeRouter.KIND + ':' + RECTANGULAR_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class BezierDiamondAnchor extends DiamondAnchor {\r\n\r\n    override get kind() {\r\n        return BezierEdgeRouter.KIND + ':' + DIAMOND_ANCHOR_KIND;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { almostEquals, Bounds, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { translatePoint } from \"../../base/model/smodel-utils\";\r\nimport { ResolvedHandleMove } from \"../move/move\";\r\nimport { DefaultAnchors, AbstractEdgeRouter, LinearRouteOptions, Side } from \"./abstract-edge-router\";\r\nimport { SRoutableElementImpl, RoutingHandleKind, SRoutingHandleImpl } from \"./model\";\r\nimport { RoutedPoint } from \"./routing\";\r\n\r\nexport interface ManhattanRouterOptions extends LinearRouteOptions {\r\n    standardDistance: number;\r\n}\r\n\r\nexport class ManhattanEdgeRouter extends AbstractEdgeRouter {\r\n\r\n    static readonly KIND = 'manhattan';\r\n\r\n    get kind() {\r\n        return ManhattanEdgeRouter.KIND;\r\n    }\r\n\r\n    protected getOptions(edge: SRoutableElementImpl): ManhattanRouterOptions {\r\n        return {\r\n            standardDistance: 20,\r\n            minimalPointDistance: 3,\r\n            selfEdgeOffset: 0.25\r\n        };\r\n    }\r\n\r\n    route(edge: SRoutableElementImpl): RoutedPoint[] {\r\n        if (!edge.source || !edge.target)\r\n            return [];\r\n        const routedCorners = this.createRoutedCorners(edge);\r\n        const sourceRefPoint = routedCorners[0]\r\n            || translatePoint(Bounds.center(edge.target.bounds), edge.target.parent, edge.parent);\r\n        const sourceAnchor = this.getTranslatedAnchor(edge.source, sourceRefPoint, edge.parent, edge, edge.sourceAnchorCorrection);\r\n        const targetRefPoint = routedCorners[routedCorners.length - 1]\r\n            || translatePoint(Bounds.center(edge.source.bounds), edge.source.parent, edge.parent);\r\n        const targetAnchor = this.getTranslatedAnchor(edge.target, targetRefPoint, edge.parent, edge, edge.targetAnchorCorrection);\r\n        if (!sourceAnchor || !targetAnchor)\r\n            return [];\r\n        const routedPoints: RoutedPoint[] = [];\r\n        routedPoints.push({ kind: 'source', ...sourceAnchor});\r\n        routedCorners.forEach(corner => routedPoints.push(corner));\r\n        routedPoints.push({ kind: 'target', ...targetAnchor});\r\n        return routedPoints;\r\n    }\r\n\r\n    protected createRoutedCorners(edge: SRoutableElementImpl): RoutedPoint[] {\r\n        const sourceAnchors = new DefaultAnchors(edge.source!, edge.parent, 'source');\r\n        const targetAnchors = new DefaultAnchors(edge.target!, edge.parent, 'target');\r\n        if (edge.routingPoints.length > 0) {\r\n            const routingPointsCopy = edge.routingPoints.slice();\r\n            this.cleanupRoutingPoints(edge, routingPointsCopy, false, true);\r\n            if (routingPointsCopy.length > 0)\r\n                return routingPointsCopy.map((routingPoint, index) => {\r\n                    return <RoutedPoint> { kind: 'linear', pointIndex: index, ...routingPoint};\r\n                });\r\n        }\r\n        const options = this.getOptions(edge);\r\n        const corners = this.calculateDefaultCorners(edge, sourceAnchors, targetAnchors, options);\r\n        return corners.map(corner => {\r\n            return <RoutedPoint> { kind: 'linear', ...corner };\r\n        });\r\n    }\r\n\r\n    createRoutingHandles(edge: SRoutableElementImpl) {\r\n        const routedPoints = this.route(edge);\r\n        this.commitRoute(edge, routedPoints);\r\n        if (routedPoints.length > 0) {\r\n            this.addHandle(edge, 'source', 'routing-point', -2);\r\n            for (let i = 0; i < routedPoints.length - 1; ++i)\r\n                this.addHandle(edge, 'manhattan-50%', 'volatile-routing-point', i - 1);\r\n            this.addHandle(edge, 'target', 'routing-point', routedPoints.length - 2);\r\n        }\r\n    }\r\n\r\n    protected getInnerHandlePosition(edge: SRoutableElementImpl, route: RoutedPoint[], handle: SRoutingHandleImpl) {\r\n        const fraction = this.getFraction(handle.kind);\r\n        if (fraction !== undefined) {\r\n            const { start, end } = this.findRouteSegment(edge, route, handle.pointIndex);\r\n            if (start !== undefined && end !== undefined)\r\n                return Point.linear(start, end, fraction);\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected getFraction(kind: RoutingHandleKind): number | undefined {\r\n        switch (kind) {\r\n            case 'manhattan-50%': return 0.5;\r\n            default: return undefined;\r\n        }\r\n    }\r\n\r\n    protected applyInnerHandleMoves(edge: SRoutableElementImpl, moves: ResolvedHandleMove[]) {\r\n        const route = this.route(edge);\r\n        const routingPoints = edge.routingPoints;\r\n        const minimalPointDistance = this.getOptions(edge).minimalPointDistance;\r\n        moves.forEach(move => {\r\n            const handle = move.handle;\r\n            const index = handle.pointIndex;\r\n            const correctedX = this.correctX(routingPoints, index, move.toPosition.x, minimalPointDistance);\r\n            const correctedY = this.correctY(routingPoints, index, move.toPosition.y, minimalPointDistance);\r\n            switch (handle.kind) {\r\n                case 'manhattan-50%':\r\n                    if (index < 0) {\r\n                        if (routingPoints.length === 0) {\r\n                            routingPoints.push({ x: correctedX, y: correctedY });\r\n                            handle.pointIndex = 0;\r\n                        } else if (almostEquals(route[0].x, route[1].x)) {\r\n                            this.alignX(routingPoints, 0, correctedX);\r\n                        } else {\r\n                            this.alignY(routingPoints, 0, correctedY);\r\n                        }\r\n                    } else if (index < routingPoints.length - 1) {\r\n                        if (almostEquals(routingPoints[index].x, routingPoints[index + 1].x)) {\r\n                            this.alignX(routingPoints, index, correctedX);\r\n                            this.alignX(routingPoints, index + 1, correctedX);\r\n                        } else {\r\n                            this.alignY(routingPoints, index, correctedY);\r\n                            this.alignY(routingPoints, index + 1, correctedY);\r\n                        }\r\n                    } else {\r\n                        if (almostEquals(route[route.length - 2].x, route[route.length - 1].x)) {\r\n                            this.alignX(routingPoints, routingPoints.length - 1, correctedX);\r\n                        } else {\r\n                            this.alignY(routingPoints, routingPoints.length - 1, correctedY);\r\n                        }\r\n                    }\r\n                    break;\r\n            }\r\n        });\r\n    }\r\n\r\n    protected correctX(routingPoints: Point[], index: number, x: number, minimalPointDistance: number) {\r\n        if (index > 0 && Math.abs(x - routingPoints[index - 1].x) < minimalPointDistance)\r\n            return routingPoints[index - 1].x;\r\n        else if (index < routingPoints.length - 2 && Math.abs(x - routingPoints[index + 2].x) < minimalPointDistance)\r\n            return routingPoints[index + 2].x;\r\n        else\r\n            return x;\r\n    }\r\n\r\n    protected alignX(routingPoints: Point[], index: number, x: number) {\r\n        if (index >= 0 && index < routingPoints.length)\r\n            routingPoints[index] = {\r\n                x,\r\n                y: routingPoints[index].y\r\n            };\r\n    }\r\n\r\n    protected correctY(routingPoints: Point[], index: number, y: number, minimalPointDistance: number) {\r\n        if (index > 0 && Math.abs(y - routingPoints[index - 1].y) < minimalPointDistance)\r\n            return routingPoints[index - 1].y;\r\n        else if (index < routingPoints.length - 2 && Math.abs(y - routingPoints[index + 2].y) < minimalPointDistance)\r\n            return routingPoints[index + 2].y;\r\n        else\r\n            return y;\r\n    }\r\n\r\n    protected alignY(routingPoints: Point[], index: number, y: number) {\r\n        if (index >= 0 && index < routingPoints.length)\r\n            routingPoints[index] = {\r\n                x: routingPoints[index].x,\r\n                y\r\n            };\r\n    }\r\n\r\n    override cleanupRoutingPoints(edge: SRoutableElementImpl, routingPoints: Point[], updateHandles: boolean, addRoutingPoints: boolean) {\r\n        const sourceAnchors = new DefaultAnchors(edge.source!, edge.parent, \"source\");\r\n        const targetAnchors = new DefaultAnchors(edge.target!, edge.parent, \"target\");\r\n        if (this.resetRoutingPointsOnReconnect(edge, routingPoints, updateHandles, sourceAnchors, targetAnchors))\r\n            return;\r\n        // delete leading RPs inside the bounds of the source\r\n        for (let i = 0; i < routingPoints.length; ++i)\r\n            if (Bounds.includes(sourceAnchors.bounds, routingPoints[i])) {\r\n                routingPoints.splice(0, 1);\r\n                if (updateHandles) {\r\n                    this.removeHandle(edge, -1);\r\n                }\r\n            } else {\r\n                break;\r\n            }\r\n        // delete trailing RPs inside the bounds of the target\r\n        for (let i = routingPoints.length - 1; i >= 0; --i)\r\n            if (Bounds.includes(targetAnchors.bounds, routingPoints[i])) {\r\n                routingPoints.splice(i, 1);\r\n                if (updateHandles) {\r\n                    this.removeHandle(edge, i);\r\n                }\r\n            } else {\r\n                break;\r\n        }\r\n        if (routingPoints.length >= 2) {\r\n            const options = this.getOptions(edge);\r\n            for (let i = routingPoints.length - 2; i >= 0; --i) {\r\n                if (Point.manhattanDistance(routingPoints[i], routingPoints[i + 1]) < options.minimalPointDistance) {\r\n                    routingPoints.splice(i, 2);\r\n                    --i;\r\n                    if (updateHandles) {\r\n                        this.removeHandle(edge, i - 1);\r\n                        this.removeHandle(edge, i);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (addRoutingPoints) {\r\n            this.addAdditionalCorner(edge, routingPoints, sourceAnchors, targetAnchors, updateHandles);\r\n            this.addAdditionalCorner(edge, routingPoints, targetAnchors, sourceAnchors, updateHandles);\r\n            this.manhattanify(edge, routingPoints);\r\n        }\r\n    }\r\n\r\n    protected removeHandle(edge: SRoutableElementImpl, pointIndex: number) {\r\n        const toBeRemoved: SRoutingHandleImpl[] = [];\r\n        edge.children.forEach(child => {\r\n            if (child instanceof SRoutingHandleImpl) {\r\n                if (child.pointIndex > pointIndex)\r\n                    --child.pointIndex;\r\n                else if (child.pointIndex === pointIndex)\r\n                    toBeRemoved.push(child);\r\n            }\r\n        });\r\n        toBeRemoved.forEach(child => edge.remove(child));\r\n    }\r\n\r\n    protected addAdditionalCorner(edge: SRoutableElementImpl, routingPoints: Point[], currentAnchors: DefaultAnchors, otherAnchors: DefaultAnchors, updateHandles: boolean) {\r\n        if (routingPoints.length === 0)\r\n            return;\r\n        const refPoint = currentAnchors.kind === 'source' ? routingPoints[0] : routingPoints[routingPoints.length - 1];\r\n        const index = currentAnchors.kind === 'source' ? 0 : routingPoints.length;\r\n        const shiftIndex = index - (currentAnchors.kind === 'source' ? 1 : 0);\r\n        let isHorizontal: boolean;\r\n        if (routingPoints.length > 1) {\r\n            isHorizontal = index === 0\r\n            ? almostEquals(routingPoints[0].x, routingPoints[1].x)\r\n            : almostEquals(routingPoints[routingPoints.length - 1].x, routingPoints[routingPoints.length - 2].x);\r\n        } else {\r\n            const nearestSide = otherAnchors.getNearestSide(refPoint);\r\n            isHorizontal = nearestSide === Side.TOP || nearestSide === Side.BOTTOM;\r\n        }\r\n        if (isHorizontal) {\r\n            if (refPoint.y < currentAnchors.get(Side.TOP).y || refPoint.y > currentAnchors.get(Side.BOTTOM).y) {\r\n                const newPoint = { x: currentAnchors.get(Side.TOP).x, y: refPoint.y };\r\n                routingPoints.splice(index, 0, newPoint);\r\n                if (updateHandles) {\r\n                    edge.children.forEach(child => {\r\n                        if (child instanceof SRoutingHandleImpl && child.pointIndex >= shiftIndex)\r\n                            ++child.pointIndex;\r\n                    });\r\n                    this.addHandle(edge, 'manhattan-50%', 'volatile-routing-point', shiftIndex);\r\n                }\r\n            }\r\n        } else {\r\n            if (refPoint.x < currentAnchors.get(Side.LEFT).x || refPoint.x > currentAnchors.get(Side.RIGHT).x) {\r\n                const newPoint = { x: refPoint.x, y: currentAnchors.get(Side.LEFT).y };\r\n                routingPoints.splice(index, 0, newPoint);\r\n                if (updateHandles) {\r\n                    edge.children.forEach(child => {\r\n                        if (child instanceof SRoutingHandleImpl && child.pointIndex >= shiftIndex)\r\n                            ++child.pointIndex;\r\n                    });\r\n                    this.addHandle(edge, 'manhattan-50%', 'volatile-routing-point', shiftIndex);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add artificial routing points to keep all angles rectilinear.\r\n     *\r\n     * This makes edge morphing look a lot smoother, where RP positions are interpolated\r\n     * linearly probably resulting in non-rectilinear angles. We don't add handles for\r\n     * these additional RPs.\r\n     */\r\n    protected manhattanify(edge: SRoutableElementImpl, routingPoints: Point[]) {\r\n        for (let i = 1; i < routingPoints.length; ++i) {\r\n            const isVertical = Math.abs(routingPoints[i - 1].x - routingPoints[i].x) < 1;\r\n            const isHorizontal = Math.abs(routingPoints[i - 1].y - routingPoints[i].y) < 1;\r\n            if (!isVertical && !isHorizontal) {\r\n                routingPoints.splice(i, 0, {\r\n                    x: routingPoints[i - 1].x,\r\n                    y: routingPoints[i].y\r\n                });\r\n                ++i;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected override calculateDefaultCorners(edge: SRoutableElementImpl, sourceAnchors: DefaultAnchors, targetAnchors: DefaultAnchors, options: ManhattanRouterOptions): Point[] {\r\n        const selfEdge = super.calculateDefaultCorners(edge, sourceAnchors, targetAnchors, options);\r\n        if (selfEdge.length > 0)\r\n            return selfEdge;\r\n        const bestAnchors = this.getBestConnectionAnchors(edge, sourceAnchors, targetAnchors, options);\r\n        const sourceSide = bestAnchors.source;\r\n        const targetSide = bestAnchors.target;\r\n        const corners: Point[] = [];\r\n        const startPoint = sourceAnchors.get(sourceSide);\r\n        let endPoint = targetAnchors.get(targetSide);\r\n        switch (sourceSide) {\r\n            case Side.RIGHT:\r\n                switch (targetSide) {\r\n                    case Side.BOTTOM:\r\n                        corners.push({ x: endPoint.x, y: startPoint.y });\r\n                        break;\r\n                    case Side.TOP:\r\n                        corners.push({ x: endPoint.x, y: startPoint.y });\r\n                        break;\r\n                    case Side.RIGHT:\r\n                        corners.push({ x: Math.max(startPoint.x, endPoint.x) + 1.5 * options.standardDistance, y: startPoint.y });\r\n                        corners.push({ x: Math.max(startPoint.x, endPoint.x) + 1.5 * options.standardDistance, y: endPoint.y });\r\n                        break;\r\n                    case Side.LEFT:\r\n                        if (endPoint.y !== startPoint.y) {\r\n                            corners.push({ x: (startPoint.x + endPoint.x) / 2, y: startPoint.y });\r\n                            corners.push({ x: (startPoint.x + endPoint.x) / 2, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n            case Side.LEFT:\r\n                switch (targetSide) {\r\n                    case Side.BOTTOM:\r\n                        corners.push({ x: endPoint.x, y: startPoint.y });\r\n                        break;\r\n                    case Side.TOP:\r\n                        corners.push({ x: endPoint.x, y: startPoint.y });\r\n                        break;\r\n                    default:\r\n                        endPoint = targetAnchors.get(Side.RIGHT);\r\n                        if (endPoint.y !== startPoint.y) {\r\n                            corners.push({ x: (startPoint.x + endPoint.x) / 2, y: startPoint.y });\r\n                            corners.push({ x: (startPoint.x + endPoint.x) / 2, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n            case Side.TOP:\r\n                switch (targetSide) {\r\n                    case Side.RIGHT:\r\n                        if ((endPoint.x - startPoint.x) > 0) {\r\n                            corners.push({ x: startPoint.x, y: startPoint.y - options.standardDistance });\r\n                            corners.push({ x: endPoint.x + 1.5 * options.standardDistance, y: startPoint.y - options.standardDistance });\r\n                            corners.push({ x: endPoint.x + 1.5 * options.standardDistance, y: endPoint.y });\r\n                        } else {\r\n                            corners.push({ x: startPoint.x, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                    case Side.LEFT:\r\n                        if ((endPoint.x - startPoint.x) < 0) {\r\n                            corners.push({ x: startPoint.x, y: startPoint.y - options.standardDistance });\r\n                            corners.push({ x: endPoint.x - 1.5 * options.standardDistance, y: startPoint.y - options.standardDistance });\r\n                            corners.push({ x: endPoint.x - 1.5 * options.standardDistance, y: endPoint.y });\r\n                        } else {\r\n                            corners.push({ x: startPoint.x, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                    case Side.TOP:\r\n                        corners.push({ x: startPoint.x, y: Math.min(startPoint.y, endPoint.y) - 1.5 * options.standardDistance });\r\n                        corners.push({ x: endPoint.x, y: Math.min(startPoint.y, endPoint.y) - 1.5 * options.standardDistance });\r\n                        break;\r\n                    case Side.BOTTOM:\r\n                        if (endPoint.x !== startPoint.x) {\r\n                            corners.push({ x: startPoint.x, y: (startPoint.y + endPoint.y) / 2 });\r\n                            corners.push({ x: endPoint.x, y: (startPoint.y + endPoint.y) / 2 });\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n            case Side.BOTTOM:\r\n                switch (targetSide) {\r\n                    case Side.RIGHT:\r\n                        if ((endPoint.x - startPoint.x) > 0) {\r\n                            corners.push({ x: startPoint.x, y: startPoint.y + options.standardDistance });\r\n                            corners.push({ x: endPoint.x + 1.5 * options.standardDistance, y: startPoint.y + options.standardDistance });\r\n                            corners.push({ x: endPoint.x + 1.5 * options.standardDistance, y: endPoint.y });\r\n                        } else {\r\n                            corners.push({ x: startPoint.x, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                    case Side.LEFT:\r\n                        if ((endPoint.x - startPoint.x) < 0) {\r\n                            corners.push({ x: startPoint.x, y: startPoint.y + options.standardDistance });\r\n                            corners.push({ x: endPoint.x - 1.5 * options.standardDistance, y: startPoint.y + options.standardDistance });\r\n                            corners.push({ x: endPoint.x - 1.5 * options.standardDistance, y: endPoint.y });\r\n                        } else {\r\n                            corners.push({ x: startPoint.x, y: endPoint.y });\r\n                        }\r\n                        break;\r\n                    default:\r\n                        endPoint = targetAnchors.get(Side.TOP);\r\n                        if (endPoint.x !== startPoint.x) {\r\n                            corners.push({ x: startPoint.x, y: (startPoint.y + endPoint.y) / 2 });\r\n                            corners.push({ x: endPoint.x, y: (startPoint.y + endPoint.y) / 2 });\r\n                        }\r\n                        break;\r\n                }\r\n                break;\r\n        }\r\n        return corners;\r\n    }\r\n\r\n    protected getBestConnectionAnchors(edge: SRoutableElementImpl,\r\n                                        sourceAnchors: DefaultAnchors, targetAnchors: DefaultAnchors,\r\n                                        options: ManhattanRouterOptions): { source: Side, target: Side } {\r\n        // distance is enough\r\n        let sourcePoint = sourceAnchors.get(Side.RIGHT);\r\n        let targetPoint = targetAnchors.get(Side.LEFT);\r\n        if ((targetPoint.x - sourcePoint.x) > options.standardDistance)\r\n            return { source: Side.RIGHT, target: Side.LEFT };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.LEFT);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if ((sourcePoint.x - targetPoint.x) > options.standardDistance)\r\n            return { source: Side.LEFT, target: Side.RIGHT };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.TOP);\r\n        targetPoint = targetAnchors.get(Side.BOTTOM);\r\n        if ((sourcePoint.y - targetPoint.y) > options.standardDistance)\r\n            return { source: Side.TOP, target: Side.BOTTOM };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.BOTTOM);\r\n        targetPoint = targetAnchors.get(Side.TOP);\r\n        if ((targetPoint.y - sourcePoint.y) > options.standardDistance)\r\n            return { source: Side.BOTTOM, target: Side.TOP };\r\n\r\n        // One additional point\r\n        sourcePoint = sourceAnchors.get(Side.RIGHT);\r\n        targetPoint = targetAnchors.get(Side.TOP);\r\n        if (((targetPoint.x - sourcePoint.x) > 0.5 * options.standardDistance) && ((targetPoint.y - sourcePoint.y) > options.standardDistance))\r\n            return { source: Side.RIGHT, target: Side.TOP };\r\n\r\n        targetPoint = targetAnchors.get(Side.BOTTOM);\r\n        if (((targetPoint.x - sourcePoint.x) > 0.5 * options.standardDistance) && ((sourcePoint.y - targetPoint.y) > options.standardDistance))\r\n            return { source: Side.RIGHT, target: Side.BOTTOM };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.LEFT);\r\n        targetPoint = targetAnchors.get(Side.BOTTOM);\r\n        if (((sourcePoint.x - targetPoint.x) > 0.5 * options.standardDistance) && ((sourcePoint.y - targetPoint.y) > options.standardDistance))\r\n            return { source: Side.LEFT, target: Side.BOTTOM };\r\n\r\n        targetPoint = targetAnchors.get(Side.TOP);\r\n        if (((sourcePoint.x - targetPoint.x) > 0.5 * options.standardDistance) && ((targetPoint.y - sourcePoint.y) > options.standardDistance))\r\n            return { source: Side.LEFT, target: Side.TOP };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.TOP);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if (((sourcePoint.y - targetPoint.y) > 0.5 * options.standardDistance) && ((sourcePoint.x - targetPoint.x) > options.standardDistance))\r\n            return { source: Side.TOP, target: Side.RIGHT };\r\n\r\n        targetPoint = targetAnchors.get(Side.LEFT);\r\n        if (((sourcePoint.y - targetPoint.y) > 0.5 * options.standardDistance) && ((targetPoint.x - sourcePoint.x) > options.standardDistance))\r\n            return { source: Side.TOP, target: Side.LEFT };\r\n\r\n        sourcePoint = sourceAnchors.get(Side.BOTTOM);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if (((targetPoint.y - sourcePoint.y) > 0.5 * options.standardDistance) && ((sourcePoint.x - targetPoint.x) > options.standardDistance))\r\n            return { source: Side.BOTTOM, target: Side.RIGHT };\r\n\r\n        targetPoint = targetAnchors.get(Side.LEFT);\r\n        if (((targetPoint.y - sourcePoint.y) > 0.5 * options.standardDistance) && ((targetPoint.x - sourcePoint.x) > options.standardDistance))\r\n            return { source: Side.BOTTOM, target: Side.LEFT };\r\n\r\n        // Two points\r\n        // priority NN >> EE >> NE >> NW >> SE >> SW\r\n        sourcePoint = sourceAnchors.get(Side.TOP);\r\n        targetPoint = targetAnchors.get(Side.TOP);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint)) {\r\n            if ((sourcePoint.y - targetPoint.y) < 0) {\r\n                if (Math.abs(sourcePoint.x - targetPoint.x) > ((sourceAnchors.bounds.width + options.standardDistance) / 2))\r\n                    return { source: Side.TOP, target: Side.TOP };\r\n            } else {\r\n                if (Math.abs(sourcePoint.x - targetPoint.x) > (targetAnchors.bounds.width / 2))\r\n                    return { source: Side.TOP, target: Side.TOP };\r\n            }\r\n        }\r\n\r\n        sourcePoint = sourceAnchors.get(Side.RIGHT);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint)) {\r\n            if ((sourcePoint.x - targetPoint.x) > 0) {\r\n                if (Math.abs(sourcePoint.y - targetPoint.y) > ((sourceAnchors.bounds.height + options.standardDistance) / 2))\r\n                    return { source: Side.RIGHT, target: Side.RIGHT };\r\n            } else if (Math.abs(sourcePoint.y - targetPoint.y) > (targetAnchors.bounds.height / 2))\r\n                return { source: Side.RIGHT, target: Side.RIGHT };\r\n        }\r\n\r\n        // Secondly, judge NE NW is available\r\n        sourcePoint = sourceAnchors.get(Side.TOP);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint))\r\n            return { source: Side.TOP, target: Side.RIGHT };\r\n\r\n        targetPoint = targetAnchors.get(Side.LEFT);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint))\r\n            return { source: Side.TOP, target: Side.LEFT };\r\n\r\n        // Finally, judge SE SW is available\r\n        sourcePoint = sourceAnchors.get(Side.BOTTOM);\r\n        targetPoint = targetAnchors.get(Side.RIGHT);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint))\r\n            return { source: Side.BOTTOM, target: Side.RIGHT };\r\n\r\n        targetPoint = targetAnchors.get(Side.LEFT);\r\n        if (!Bounds.includes(targetAnchors.bounds, sourcePoint) && !Bounds.includes(sourceAnchors.bounds, targetPoint))\r\n            return { source: Side.BOTTOM, target: Side.LEFT };\r\n\r\n        // Only to return to the\r\n        return { source: Side.RIGHT, target: Side.BOTTOM };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Bounds, Point } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { Line, PointToPointLine, intersection } from \"../../utils/geometry\";\r\nimport { RECTANGULAR_ANCHOR_KIND, IAnchorComputer, DIAMOND_ANCHOR_KIND, ELLIPTIC_ANCHOR_KIND } from \"./anchor\";\r\nimport { ManhattanEdgeRouter } from \"./manhattan-edge-router\";\r\nimport { SConnectableElementImpl } from \"./model\";\r\nimport { injectable } from \"inversify\";\r\n\r\n@injectable()\r\nexport class ManhattanRectangularAnchor implements IAnchorComputer {\r\n\r\n    static KIND = ManhattanEdgeRouter.KIND + ':' + RECTANGULAR_ANCHOR_KIND;\r\n\r\n    get kind() {\r\n        return ManhattanRectangularAnchor.KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number): Point {\r\n        const b = connectable.bounds;\r\n        if (b.width <= 0 || b.height <= 0) {\r\n            return b;\r\n        }\r\n        const bounds: Bounds = {\r\n            x: b.x - offset,\r\n            y: b.y - offset,\r\n            width: b.width + 2 * offset,\r\n            height: b.height + 2 * offset\r\n        };\r\n        if (refPoint.x >= bounds.x && bounds.x + bounds.width >= refPoint.x) {\r\n            if (refPoint.y < bounds.y + 0.5 * bounds.height)\r\n            return { x: refPoint.x, y: bounds.y };\r\n            else\r\n            return { x: refPoint.x, y: bounds.y + bounds.height };\r\n        }\r\n        if (refPoint.y >= bounds.y && bounds.y + bounds.height >= refPoint.y) {\r\n            if (refPoint.x < bounds.x + 0.5 * bounds.width)\r\n            return { x: bounds.x, y: refPoint.y };\r\n            else\r\n            return { x: bounds.x + bounds.width, y: refPoint.y };\r\n        }\r\n        return Bounds.center(bounds);\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class ManhattanDiamondAnchor implements IAnchorComputer {\r\n\r\n    static KIND = ManhattanEdgeRouter.KIND + ':' + DIAMOND_ANCHOR_KIND;\r\n\r\n    get kind() {\r\n        return ManhattanDiamondAnchor.KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number = 0): Point {\r\n        const b = connectable.bounds;\r\n        if (b.width <= 0 || b.height <= 0) {\r\n            return b;\r\n        }\r\n        const bounds = {\r\n            x: b.x - offset,\r\n            y: b.y - offset,\r\n            width: b.width + 2 * offset,\r\n            height: b.height + 2 * offset\r\n        };\r\n        const c = Bounds.center(bounds);\r\n\r\n        let outline: Line | undefined = undefined;\r\n        let refLine: Line | undefined = undefined;\r\n        if (refPoint.x >= bounds.x && refPoint.x <= bounds.x + bounds.width) {\r\n            if (bounds.x + 0.5 * bounds.width >= refPoint.x) {\r\n                refLine = new PointToPointLine(refPoint, { x: refPoint.x, y: c.y });\r\n                if (refPoint.y < c.y)\r\n                    outline = new PointToPointLine({ x: bounds.x, y: c.y }, { x: c.x, y: bounds.y });\r\n                else\r\n                    outline = new PointToPointLine({ x: bounds.x, y: c.y }, { x: c.x, y: bounds.y + bounds.height });\r\n            } else {\r\n                refLine = new PointToPointLine(refPoint, { x: refPoint.x, y: c.y });\r\n                if (refPoint.y < c.y)\r\n                    outline = new PointToPointLine({ x: bounds.x + bounds.width, y: c.y }, { x: c.x, y: bounds.y });\r\n                else\r\n                    outline = new PointToPointLine({ x: bounds.x + bounds.width, y: c.y }, { x: c.x, y: bounds.y + bounds.height });\r\n            }\r\n        } else if (refPoint.y >= bounds.y && refPoint.y <= bounds.y + bounds.height) {\r\n            if (bounds.y + 0.5 * bounds.height >= refPoint.y) {\r\n                refLine = new PointToPointLine(refPoint, { x: c.x , y: refPoint.y });\r\n                if (refPoint.x < c.x)\r\n                    outline = new PointToPointLine({ x: bounds.x, y: c.y }, { x: c.x, y: bounds.y });\r\n                else\r\n                    outline = new PointToPointLine({ x: bounds.x + bounds.width, y: c.y }, { x: c.x, y: bounds.y });\r\n            } else {\r\n                refLine = new PointToPointLine(refPoint, { x: c.x , y: refPoint.y });\r\n                if (refPoint.x < c.x)\r\n                    outline = new PointToPointLine({ x: bounds.x, y: c.y }, { x: c.x, y: bounds.y + bounds.height });\r\n                else\r\n                    outline = new PointToPointLine({ x: bounds.x + bounds.width, y: c.y }, { x: c.x, y: bounds.y + bounds.height });\r\n            }\r\n        }\r\n        if (!!refLine && !!outline)\r\n            return intersection(outline, refLine);\r\n        else\r\n            return c;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class ManhattanEllipticAnchor implements IAnchorComputer {\r\n\r\n    static KIND = ManhattanEdgeRouter.KIND + ':' + ELLIPTIC_ANCHOR_KIND;\r\n\r\n    get kind() {\r\n        return ManhattanEllipticAnchor.KIND;\r\n    }\r\n\r\n    getAnchor(connectable: SConnectableElementImpl, refPoint: Point, offset: number = 0): Point {\r\n        const b = connectable.bounds;\r\n        if (b.width <= 0 || b.height <= 0) {\r\n            return b;\r\n        }\r\n        const bounds = {\r\n            x: b.x - offset,\r\n            y: b.y - offset,\r\n            width: b.width + 2 * offset,\r\n            height: b.height + 2 * offset\r\n        };\r\n        const c = Bounds.center(bounds);\r\n        const refRelative = Point.subtract(refPoint, c);\r\n        let x = c.x;\r\n        let y = c.y;\r\n        if (refPoint.x >= bounds.x && bounds.x + bounds.width >= refPoint.x) {\r\n            x += refRelative.x;\r\n            const dy = 0.5 * bounds.height * Math.sqrt(1 - (refRelative.x * refRelative.x) / (0.25 * bounds.width * bounds.width));\r\n            if (refRelative.y < 0)\r\n                y -= dy;\r\n            else\r\n                y += dy;\r\n        } else if (refPoint.y >= bounds.y && bounds.y + bounds.height >= refPoint.y) {\r\n            y += refRelative.y;\r\n            const dx = 0.5 * bounds.width * Math.sqrt(1 - (refRelative.y * refRelative.y) / (0.25 * bounds.height * bounds.height));\r\n            if (refRelative.x < 0)\r\n                x -= dx;\r\n            else\r\n                x += dx;\r\n        }\r\n        return { x, y };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { IViewArgs, IView, RenderingContext } from '../../base/views/view';\r\nimport { SRoutableElementImpl, getAbsoluteRouteBounds } from './model';\r\n\r\n@injectable()\r\nexport abstract class RoutableView implements IView {\r\n    /**\r\n     * Check whether the given model element is in the current viewport. Use this method\r\n     * in your `render` implementation to skip rendering in case the element is not visible.\r\n     * This can greatly enhance performance for large models.\r\n     */\r\n    isVisible(model: Readonly<SRoutableElementImpl>, route: Point[], context: RenderingContext): boolean {\r\n        if (context.targetKind === 'hidden') {\r\n            // Don't hide any element for hidden rendering\r\n            return true;\r\n        }\r\n        if (route.length === 0) {\r\n            // We should hide only if we know the element's route\r\n            return true;\r\n        }\r\n        const ab = getAbsoluteRouteBounds(model, route);\r\n        const canvasBounds = model.root.canvasBounds;\r\n        return ab.x <= canvasBounds.width\r\n            && ab.x + ab.width >= 0\r\n            && ab.y <= canvasBounds.height\r\n            && ab.y + ab.height >= 0;\r\n    }\r\n\r\n    abstract render(model: Readonly<SRoutableElementImpl>, context: RenderingContext, args?: IViewArgs): VNode | undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from \"inversify\";\r\nimport { ResponseAction } from \"sprotty-protocol/lib/actions\";\r\nimport { TYPES } from \"../types\";\r\nimport { SystemCommand, CommandExecutionContext, CommandReturn } from \"./command\";\r\nimport { IActionDispatcher } from \"../actions/action-dispatcher\";\r\n\r\n/**\r\n * A command that does not modify the internal model, but retrieves information\r\n * from it by dispatching a response action.\r\n */\r\n@injectable()\r\nexport abstract class ModelRequestCommand extends SystemCommand {\r\n\r\n    @inject(TYPES.IActionDispatcher) protected actionDispatcher: IActionDispatcher;\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const result = this.retrieveResult(context);\r\n        this.actionDispatcher.dispatch(result);\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n\r\n    protected abstract retrieveResult(context: CommandExecutionContext): ResponseAction;\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return { model: context.root, modelChanged: false };\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject } from 'inversify';\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { Action, CenterAction, SetViewportAction } from 'sprotty-protocol/lib/actions';\r\nimport { almostEquals, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { isViewport } from './model';\r\nimport { isMoveable } from '../move/model';\r\nimport { SRoutingHandleImpl } from '../routing/model';\r\nimport { getModelBounds } from '../projection/model';\r\nimport { hitsMouseEvent } from '../../utils/browser';\r\nimport { TYPES } from '../../base/types';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\n\r\nexport class ScrollMouseListener extends MouseListener {\r\n\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n\r\n    protected lastScrollPosition: Point |undefined;\r\n    protected scrollbar: HTMLElement | undefined;\r\n    protected scrollbarMouseDownTimeout: number | undefined;\r\n    protected scrollbarMouseDownDelay = 200;\r\n\r\n    override mouseDown(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const moveable = findParentByFeature(target, isMoveable);\r\n        if (moveable === undefined && !(target instanceof SRoutingHandleImpl)) {\r\n            const viewport = findParentByFeature(target, isViewport);\r\n            if (viewport) {\r\n                this.lastScrollPosition = { x: event.pageX, y: event.pageY };\r\n                this.scrollbar = this.getScrollbar(event);\r\n                if (this.scrollbar) {\r\n                    window.clearTimeout(this.scrollbarMouseDownTimeout);\r\n                    return this.moveScrollBar(viewport, event, this.scrollbar, true)\r\n                        .map(action => new Promise(resolve => {\r\n                            this.scrollbarMouseDownTimeout = window.setTimeout(() => resolve(action), this.scrollbarMouseDownDelay);\r\n                        }));\r\n                }\r\n            } else {\r\n                this.lastScrollPosition = undefined;\r\n                this.scrollbar = undefined;\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    override mouseMove(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        if (event.buttons === 0) {\r\n            return this.mouseUp(target, event);\r\n        }\r\n        if (this.scrollbar) {\r\n            window.clearTimeout(this.scrollbarMouseDownTimeout);\r\n            const viewport = findParentByFeature(target, isViewport);\r\n            if (viewport) {\r\n                return this.moveScrollBar(viewport, event, this.scrollbar);\r\n            }\r\n        }\r\n        if (this.lastScrollPosition) {\r\n            const viewport = findParentByFeature(target, isViewport);\r\n            if (viewport) {\r\n                return this.dragCanvas(viewport, event, this.lastScrollPosition);\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    override mouseEnter(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        if (target instanceof SModelRootImpl && event.buttons === 0) {\r\n            this.mouseUp(target, event);\r\n        }\r\n        return [];\r\n    }\r\n\r\n    override mouseUp(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        this.lastScrollPosition = undefined;\r\n        this.scrollbar = undefined;\r\n        return [];\r\n    }\r\n\r\n    override doubleClick(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        const viewport = findParentByFeature(target, isViewport);\r\n        if (viewport) {\r\n            const scrollbar = this.getScrollbar(event);\r\n            if (scrollbar) {\r\n                window.clearTimeout(this.scrollbarMouseDownTimeout);\r\n                const targetElement = this.findClickTarget(scrollbar, event);\r\n                let elementId: string | undefined;\r\n                if (targetElement && targetElement.id.startsWith('horizontal-projection:')) {\r\n                    elementId = targetElement.id.substring('horizontal-projection:'.length);\r\n                } else if (targetElement && targetElement.id.startsWith('vertical-projection:')) {\r\n                    elementId = targetElement.id.substring('vertical-projection:'.length);\r\n                }\r\n                if (elementId) {\r\n                    return [CenterAction.create([elementId], { animate: true, retainZoom: true })];\r\n                }\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    protected dragCanvas(model: SModelRootImpl & Viewport, event: MouseEvent, lastScrollPosition: Point): Action[] {\r\n        let dx = (event.pageX - lastScrollPosition.x) / model.zoom;\r\n        if (dx > 0 && almostEquals(model.scroll.x, this.viewerOptions.horizontalScrollLimits.min)\r\n            || dx < 0 && almostEquals(model.scroll.x, this.viewerOptions.horizontalScrollLimits.max - model.canvasBounds.width / model.zoom)) {\r\n            dx = 0;\r\n        }\r\n        let dy = (event.pageY - lastScrollPosition.y) / model.zoom;\r\n        if (dy > 0 && almostEquals(model.scroll.y, this.viewerOptions.verticalScrollLimits.min)\r\n            || dy < 0 && almostEquals(model.scroll.y, this.viewerOptions.verticalScrollLimits.max - model.canvasBounds.height / model.zoom)) {\r\n            dy = 0;\r\n        }\r\n        if (dx === 0 && dy === 0) {\r\n            return [];\r\n        }\r\n        const newViewport: Viewport = {\r\n            scroll: {\r\n                x: model.scroll.x - dx,\r\n                y: model.scroll.y - dy,\r\n            },\r\n            zoom: model.zoom\r\n        };\r\n        this.lastScrollPosition = { x: event.pageX, y: event.pageY };\r\n        return [SetViewportAction.create(model.id, newViewport, { animate: false })];\r\n    }\r\n\r\n    protected moveScrollBar(model: SModelRootImpl & Viewport, event: MouseEvent, scrollbar: HTMLElement, animate: boolean = false): Action[] {\r\n        const modelBounds = getModelBounds(model);\r\n        if (!modelBounds || model.zoom <= 0) {\r\n            return [];\r\n        }\r\n        const scrollbarRect = scrollbar.getBoundingClientRect();\r\n        let newScroll: { x: number, y: number };\r\n        if (this.getScrollbarOrientation(scrollbar) === 'horizontal') {\r\n            if (scrollbarRect.width <= 0) {\r\n                return [];\r\n            }\r\n            const viewportSize = (model.canvasBounds.width / (model.zoom * modelBounds.width)) * scrollbarRect.width;\r\n            let position = event.clientX - scrollbarRect.x - viewportSize / 2;\r\n            if (position < 0) {\r\n                position = 0;\r\n            } else if (position > scrollbarRect.width - viewportSize) {\r\n                position = scrollbarRect.width - viewportSize;\r\n            }\r\n            newScroll = {\r\n                x: modelBounds.x + (position / scrollbarRect.width) * modelBounds.width,\r\n                y: model.scroll.y\r\n            };\r\n            if (newScroll.x < this.viewerOptions.horizontalScrollLimits.min) {\r\n                newScroll.x = this.viewerOptions.horizontalScrollLimits.min;\r\n            } else if (newScroll.x > this.viewerOptions.horizontalScrollLimits.max - model.canvasBounds.width / model.zoom) {\r\n                newScroll.x = this.viewerOptions.horizontalScrollLimits.max - model.canvasBounds.width / model.zoom;\r\n            }\r\n            if (almostEquals(newScroll.x, model.scroll.x)) {\r\n                return [];\r\n            }\r\n        } else {\r\n            if (scrollbarRect.height <= 0) {\r\n                return [];\r\n            }\r\n            const viewportSize = (model.canvasBounds.height / (model.zoom * modelBounds.height)) * scrollbarRect.height;\r\n            let position = event.clientY - scrollbarRect.y - viewportSize / 2;\r\n            if (position < 0) {\r\n                position = 0;\r\n            } else if (position > scrollbarRect.height - viewportSize) {\r\n                position = scrollbarRect.height - viewportSize;\r\n            }\r\n            newScroll = {\r\n                x: model.scroll.x,\r\n                y: modelBounds.y + (position / scrollbarRect.height) * modelBounds.height\r\n            };\r\n            if (newScroll.y < this.viewerOptions.verticalScrollLimits.min) {\r\n                newScroll.y = this.viewerOptions.verticalScrollLimits.min;\r\n            } else if (newScroll.y > this.viewerOptions.verticalScrollLimits.max - model.canvasBounds.height / model.zoom) {\r\n                newScroll.y = this.viewerOptions.verticalScrollLimits.max - model.canvasBounds.height / model.zoom;\r\n            }\r\n            if (almostEquals(newScroll.y, model.scroll.y)) {\r\n                return [];\r\n            }\r\n        }\r\n        return [SetViewportAction.create(model.id, { scroll: newScroll, zoom: model.zoom }, { animate })];\r\n    }\r\n\r\n    protected getScrollbar(event: MouseEvent): HTMLElement | undefined {\r\n        return findViewportScrollbar(event);\r\n    }\r\n\r\n    protected getScrollbarOrientation(scrollbar: HTMLElement): 'horizontal' | 'vertical' {\r\n        if (scrollbar.classList.contains('horizontal')) {\r\n            return 'horizontal';\r\n        } else {\r\n            return 'vertical';\r\n        }\r\n    }\r\n\r\n    protected findClickTarget(scrollbar: HTMLElement, event: MouseEvent): HTMLElement | undefined {\r\n        const matching = Array.from(scrollbar.children).filter(child =>\r\n            child.id && child.classList.contains('sprotty-projection') && hitsMouseEvent(child, event)\r\n        ) as HTMLElement[];\r\n        if (matching.length > 0) {\r\n            return matching[matching.length - 1];\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n}\r\n\r\nexport function findViewportScrollbar(event: MouseEvent): HTMLElement | undefined {\r\n    let element = event.target as HTMLElement | null;\r\n    while (element) {\r\n        if (element.classList && element.classList.contains('sprotty-projection-bar')) {\r\n            return element;\r\n        }\r\n        element = element.parentElement;\r\n    }\r\n    return undefined;\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable, optional } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport {\r\n    Action, BringToFrontAction, GetSelectionAction, ResponseAction, SelectAction, SelectAllAction, SelectionResult\r\n} from 'sprotty-protocol/lib/actions';\r\nimport { Selectable } from 'sprotty-protocol/lib/model';\r\nimport { Command, CommandExecutionContext } from '../../base/commands/command';\r\nimport { ModelRequestCommand } from '../../base/commands/request-command';\r\nimport { SChildElementImpl, SModelElementImpl, SModelRootImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { findParentByFeature } from '../../base/model/smodel-utils';\r\nimport { TYPES } from '../../base/types';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { MouseListener } from '../../base/views/mouse-tool';\r\nimport { setClass } from '../../base/views/vnode-utils';\r\nimport { isCtrlOrCmd } from '../../utils/browser';\r\nimport { toArray } from '../../utils/iterable';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { ButtonHandlerRegistry } from '../button/button-handler';\r\nimport { SButtonImpl } from '../button/model';\r\nimport { SwitchEditModeAction } from '../edit/edit-routing';\r\nimport { SRoutingHandleImpl } from '../routing/model';\r\nimport { SRoutableElementImpl } from '../routing/model';\r\nimport { findViewportScrollbar } from '../viewport/scroll';\r\nimport { isSelectable } from './model';\r\n\r\n@injectable()\r\nexport class SelectCommand extends Command {\r\n    static readonly KIND = SelectAction.KIND;\r\n\r\n    protected selected: (SChildElementImpl & Selectable)[] = [];\r\n    protected deselected: (SChildElementImpl & Selectable)[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) public action: SelectAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): SModelRootImpl {\r\n        const model = context.root;\r\n        this.action.selectedElementsIDs.forEach(id => {\r\n            const element = model.index.getById(id);\r\n            if (element instanceof SChildElementImpl && isSelectable(element)) {\r\n                this.selected.push(element);\r\n            }\r\n        });\r\n        this.action.deselectedElementsIDs.forEach(id => {\r\n            const element = model.index.getById(id);\r\n            if (element instanceof SChildElementImpl && isSelectable(element)) {\r\n                this.deselected.push(element);\r\n            }\r\n        });\r\n        return this.redo(context);\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): SModelRootImpl {\r\n        for (const element of this.selected) {\r\n            element.selected = false;\r\n        }\r\n        for (const element of this.deselected) {\r\n            element.selected = true;\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): SModelRootImpl {\r\n        for (const element of this.deselected) {\r\n            element.selected = false;\r\n        }\r\n        for (const element of this.selected) {\r\n            element.selected = true;\r\n        }\r\n        return context.root;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SelectAllCommand extends Command {\r\n    static readonly KIND = SelectAllAction.KIND;\r\n\r\n    protected previousSelection: Record<string, boolean> = {};\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SelectAllAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): SModelRootImpl {\r\n        this.selectAll(context.root, this.action.select);\r\n        return context.root;\r\n    }\r\n\r\n    protected selectAll(element: SParentElementImpl, newState: boolean): void {\r\n        if (isSelectable(element)) {\r\n            this.previousSelection[element.id] = element.selected;\r\n            element.selected = newState;\r\n        }\r\n        for (const child of element.children) {\r\n            this.selectAll(child, newState);\r\n        }\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): SModelRootImpl {\r\n        const index = context.root.index;\r\n        Object.keys(this.previousSelection).forEach(id => {\r\n            const element = index.getById(id);\r\n            if (element !== undefined && isSelectable(element))\r\n                element.selected = this.previousSelection[id];\r\n        });\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): SModelRootImpl {\r\n        this.selectAll(context.root, this.action.select);\r\n        return context.root;\r\n    }\r\n}\r\n\r\nexport class SelectMouseListener extends MouseListener {\r\n\r\n    @inject(ButtonHandlerRegistry) @optional() protected buttonHandlerRegistry: ButtonHandlerRegistry;\r\n\r\n    wasSelected = false;\r\n    hasDragged = false;\r\n    isMouseDown = false;\r\n\r\n    override mouseDown(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        if (event.button !== 0) {\r\n            return [];\r\n        }\r\n        this.isMouseDown = true;\r\n        const buttonHandled = this.handleButton(target, event);\r\n        if (buttonHandled) {\r\n            return buttonHandled;\r\n        }\r\n        const selectableTarget = findParentByFeature(target, isSelectable);\r\n        if (selectableTarget !== undefined || target instanceof SModelRootImpl) {\r\n            this.hasDragged = false;\r\n        }\r\n        if (selectableTarget !== undefined) {\r\n            let deselectedElements: SModelElementImpl[] = [];\r\n            // multi-selection?\r\n            if (!isCtrlOrCmd(event)) {\r\n                deselectedElements = this.collectElementsToDeselect(target, selectableTarget);\r\n            }\r\n            if (!selectableTarget.selected) {\r\n                this.wasSelected = false;\r\n                return this.handleSelectTarget(selectableTarget, deselectedElements, event);\r\n            } else if (isCtrlOrCmd(event)) {\r\n                this.wasSelected = false;\r\n                return this.handleDeselectTarget(selectableTarget, event);\r\n            } else {\r\n                this.wasSelected = true;\r\n            }\r\n        }\r\n        return [];\r\n    }\r\n\r\n    protected collectElementsToDeselect(target: SModelElementImpl, selectableTarget: (SModelElementImpl & Selectable) | undefined): SModelElementImpl[] {\r\n        return toArray(target.root.index.all()\r\n        .filter(element => isSelectable(element) && element.selected\r\n            && !(selectableTarget instanceof SRoutingHandleImpl && element === selectableTarget.parent as SModelElementImpl)));\r\n    }\r\n\r\n    protected handleButton(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] | undefined {\r\n        if (this.buttonHandlerRegistry !== undefined && target instanceof SButtonImpl && target.enabled) {\r\n            const buttonHandler = this.buttonHandlerRegistry.get(target.type);\r\n            if (buttonHandler !== undefined) {\r\n                return buttonHandler.buttonPressed(target);\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    protected handleSelectTarget(selectableTarget: SModelElementImpl & Selectable, deselectedElements: SModelElementImpl[], event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: Action[] = [];\r\n        result.push(SelectAction.create({ selectedElementsIDs: [selectableTarget.id], deselectedElementsIDs: deselectedElements.map(e => e.id) }));\r\n        result.push(BringToFrontAction.create([selectableTarget.id]));\r\n        const routableDeselect = deselectedElements.filter(e => e instanceof SRoutableElementImpl).map(e => e.id);\r\n        if (selectableTarget instanceof SRoutableElementImpl) {\r\n            result.push(SwitchEditModeAction.create({ elementsToActivate: [selectableTarget.id], elementsToDeactivate: routableDeselect }));\r\n        } else if (routableDeselect.length > 0) {\r\n            result.push(SwitchEditModeAction.create({ elementsToDeactivate: routableDeselect }));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected handleDeselectTarget(selectableTarget: SModelElementImpl & Selectable, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: Action[] = [];\r\n        result.push(SelectAction.create({ selectedElementsIDs: [], deselectedElementsIDs: [selectableTarget.id] }));\r\n        if (selectableTarget instanceof SRoutableElementImpl) {\r\n            result.push(SwitchEditModeAction.create({ elementsToDeactivate: [selectableTarget.id] }));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected handleDeselectAll(deselectedElements: SModelElementImpl[], event: MouseEvent): (Action | Promise<Action>)[] {\r\n        const result: Action[] = [];\r\n        result.push(SelectAction.create({ selectedElementsIDs: [], deselectedElementsIDs: deselectedElements.map(e => e.id) }));\r\n        const routableDeselect = deselectedElements.filter(e => e instanceof SRoutableElementImpl).map(e => e.id);\r\n        if (routableDeselect.length > 0) {\r\n            result.push(SwitchEditModeAction.create({ elementsToDeactivate: routableDeselect }));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    override mouseMove(target: SModelElementImpl, event: MouseEvent): Action[] {\r\n        this.hasDragged = this.isMouseDown;\r\n        return [];\r\n    }\r\n\r\n    override mouseUp(target: SModelElementImpl, event: MouseEvent): (Action | Promise<Action>)[] {\r\n        if (event.button === 0) {\r\n            if (!this.hasDragged) {\r\n                const selectableTarget = findParentByFeature(target, isSelectable);\r\n                if (selectableTarget !== undefined) {\r\n                    if (this.wasSelected) {\r\n                        return [SelectAction.create({ selectedElementsIDs: [selectableTarget.id], deselectedElementsIDs: [] })];\r\n                    }\r\n                } else if ((target instanceof SModelRootImpl && !findViewportScrollbar(event)) || !(target instanceof SModelRootImpl)) {\r\n                    // Mouse up on everything that's not root or root but not over ViewPort's scroll bars > deselect all\r\n                    return this.handleDeselectAll(this.collectElementsToDeselect(target, undefined), event);\r\n                }\r\n            }\r\n        }\r\n        this.isMouseDown = false;\r\n        this.hasDragged = false;\r\n        return [];\r\n    }\r\n\r\n    override decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        const selectableTarget = findParentByFeature(element, isSelectable);\r\n        if (selectableTarget !== undefined) {\r\n            setClass(vnode, 'selected', selectableTarget.selected);\r\n        }\r\n        return vnode;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class GetSelectionCommand extends ModelRequestCommand {\r\n    static readonly KIND = GetSelectionAction.KIND;\r\n\r\n    protected previousSelection: Record<string, boolean> = {};\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: GetSelectionAction) {\r\n        super();\r\n    }\r\n\r\n    protected retrieveResult(context: CommandExecutionContext): ResponseAction {\r\n        const selection = context.root.index.all()\r\n            .filter(e => isSelectable(e) && e.selected)\r\n            .map(e => e.id);\r\n        return SelectionResult.create(toArray(selection), this.action.requestId);\r\n    }\r\n\r\n}\r\n\r\nexport class SelectKeyboardListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'KeyA', 'ctrlCmd')) {\r\n            return [ SelectAllAction.create()];\r\n        }\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action, UndoAction, RedoAction } from 'sprotty-protocol/lib/actions';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { SModelElementImpl } from '../../base/model/smodel';\r\nimport { isMac } from '../../utils/browser';\r\n\r\nexport class UndoRedoKeyListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'KeyZ', 'ctrlCmd'))\r\n            return [UndoAction.create()];\r\n        if (matchesKeystroke(event, 'KeyZ', 'ctrlCmd', 'shift') || (!isMac() && matchesKeystroke(event, 'KeyY', 'ctrlCmd')))\r\n            return [RedoAction.create()];\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { SModelElement, SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { SModelRootImpl, SModelElementImpl, isParent, IModelIndex } from '../../base/model/smodel';\r\nimport { SModelIndex } from 'sprotty-protocol';\r\n\r\nexport interface Match {\r\n    left?: SModelElement\r\n    right?: SModelElement\r\n    leftParentId?: string\r\n    rightParentId?: string\r\n}\r\n\r\nexport interface MatchResult {\r\n    [id: string]: Match\r\n}\r\n\r\nexport function forEachMatch(matchResult: MatchResult, callback: (id: string, match: Match) => void): void {\r\n    Object.keys(matchResult).forEach(id => callback(id, matchResult[id]));\r\n}\r\n\r\nexport class ModelMatcher {\r\n    match(left: SModelRoot | SModelRootImpl, right: SModelRoot | SModelRootImpl): MatchResult {\r\n        const result: MatchResult = {};\r\n        this.matchLeft(left, result);\r\n        this.matchRight(right, result);\r\n        return result;\r\n    }\r\n\r\n    protected matchLeft(element: SModelElement | SModelElementImpl, result: MatchResult, parentId?: string): void {\r\n        let match = result[element.id];\r\n        if (match !== undefined) {\r\n            match.left = element;\r\n            match.leftParentId = parentId;\r\n        } else {\r\n            match = {\r\n                left: element,\r\n                leftParentId: parentId\r\n            };\r\n            result[element.id] = match;\r\n        }\r\n        if (isParent(element)) {\r\n            for (const child of element.children) {\r\n                this.matchLeft(child, result, element.id);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected matchRight(element: SModelElement | SModelElementImpl, result: MatchResult, parentId?: string) {\r\n        let match = result[element.id];\r\n        if (match !== undefined) {\r\n            match.right = element;\r\n            match.rightParentId = parentId;\r\n        } else {\r\n            match = {\r\n                right: element,\r\n                rightParentId: parentId\r\n            };\r\n            result[element.id] = match;\r\n        }\r\n        if (isParent(element)) {\r\n            for (const child of element.children) {\r\n                this.matchRight(child, result, element.id);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport function applyMatches(root: SModelRoot, matches: Match[], index?: IModelIndex): void {\r\n    if (root instanceof SModelRootImpl) {\r\n        index = root.index;\r\n    } else if (index === undefined) {\r\n        index = new SModelIndex();\r\n        index.add(root);\r\n    }\r\n    for (const match of matches) {\r\n        let newElementInserted = false;\r\n        if (match.left !== undefined && match.leftParentId !== undefined) {\r\n            const parent = index.getById(match.leftParentId);\r\n            if (parent !== undefined && parent.children !== undefined) {\r\n                const i = parent.children.indexOf(match.left);\r\n                if (i >= 0) {\r\n                    if (match.right !== undefined && match.leftParentId === match.rightParentId) {\r\n                        parent.children.splice(i, 1, match.right);\r\n                        newElementInserted = true;\r\n                    } else {\r\n                        parent.children.splice(i, 1);\r\n                    }\r\n                }\r\n                index.remove(match.left);\r\n            }\r\n        }\r\n        if (!newElementInserted && match.right !== undefined && match.rightParentId !== undefined) {\r\n            const parent = index.getById(match.rightParentId);\r\n            if (parent !== undefined) {\r\n                if (parent.children === undefined)\r\n                    parent.children = [];\r\n                parent.children.push(match.right);\r\n            }\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Dimension } from \"sprotty-protocol/lib/utils/geometry\";\r\nimport { Animation } from \"../../base/animations/animation\";\r\nimport { SModelRootImpl, SModelElementImpl } from \"../../base/model/smodel\";\r\nimport { CommandExecutionContext } from \"../../base/commands/command\";\r\nimport { InternalBoundsAware } from './model';\r\n\r\nexport interface ResolvedElementResize {\r\n    element: SModelElementImpl & InternalBoundsAware\r\n    fromDimension: Dimension\r\n    toDimension: Dimension\r\n}\r\n\r\nexport class ResizeAnimation extends Animation {\r\n    constructor(protected model: SModelRootImpl,\r\n        public elementResizes: Map<string, ResolvedElementResize>,\r\n        context: CommandExecutionContext,\r\n        protected reverse: boolean = false) {\r\n        super(context);\r\n    }\r\n\r\n    tween(t: number) {\r\n        this.elementResizes.forEach(\r\n            (elementResize) => {\r\n                const element = elementResize.element;\r\n                const newDimension: Dimension = (this.reverse) ? {\r\n                        width: (1 - t) * elementResize.toDimension.width + t * elementResize.fromDimension.width,\r\n                        height: (1 - t) * elementResize.toDimension.height + t * elementResize.fromDimension.height\r\n                    } : {\r\n                        width: (1 - t) * elementResize.fromDimension.width + t * elementResize.toDimension.width,\r\n                        height: (1 - t) * elementResize.fromDimension.height + t * elementResize.toDimension.height\r\n                    };\r\n                element.bounds = {\r\n                    x: element.bounds.x,\r\n                    y: element.bounds.y,\r\n                    width: newDimension.width,\r\n                    height: newDimension.height\r\n                };\r\n            }\r\n        );\r\n        return this.model;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2022 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject, optional } from 'inversify';\r\nimport { UpdateModelAction } from 'sprotty-protocol/lib/actions';\r\nimport { Fadeable } from 'sprotty-protocol/lib/model';\r\nimport { almostEquals, Dimension } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { Animation, CompoundAnimation } from '../../base/animations/animation';\r\nimport { CommandExecutionContext, CommandReturn, Command } from '../../base/commands/command';\r\nimport { FadeAnimation, ResolvedElementFade } from '../fade/fade';\r\nimport { SModelRootImpl, SChildElementImpl, SModelElementImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { MoveAnimation, ResolvedElementMove, MorphEdgesAnimation } from '../move/move';\r\nimport { isFadeable } from '../fade/model';\r\nimport { isLocateable } from '../move/model';\r\nimport { isSizeable } from '../bounds/model';\r\nimport { ViewportRootElementImpl } from '../viewport/viewport-root';\r\nimport { isSelectable } from '../select/model';\r\nimport { MatchResult, ModelMatcher, Match, forEachMatch } from './model-matching';\r\nimport { ResolvedElementResize, ResizeAnimation } from '../bounds/resize';\r\nimport { TYPES } from '../../base/types';\r\nimport { isViewport } from '../viewport/model';\r\nimport { EdgeRouterRegistry, EdgeSnapshot, EdgeMemento } from '../routing/routing';\r\nimport { SRoutableElementImpl } from '../routing/model';\r\nimport { containsSome } from '../../base/model/smodel-utils';\r\n\r\n\r\nexport interface UpdateAnimationData {\r\n    fades: ResolvedElementFade[]\r\n    moves?: ResolvedElementMove[]\r\n    resizes?: ResolvedElementResize[]\r\n    edgeMementi?: EdgeMemento[]\r\n}\r\n\r\n@injectable()\r\nexport class UpdateModelCommand extends Command {\r\n    static readonly KIND = UpdateModelAction.KIND;\r\n\r\n    oldRoot: SModelRootImpl;\r\n    newRoot: SModelRootImpl;\r\n\r\n    @inject(EdgeRouterRegistry) @optional() edgeRouterRegistry?: EdgeRouterRegistry;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: UpdateModelAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        let newRoot: SModelRootImpl;\r\n        if (this.action.newRoot !== undefined) {\r\n            newRoot = context.modelFactory.createRoot(this.action.newRoot);\r\n        } else {\r\n            newRoot = context.modelFactory.createRoot(context.root);\r\n            if (this.action.matches !== undefined)\r\n                this.applyMatches(newRoot, this.action.matches, context);\r\n        }\r\n        this.oldRoot = context.root;\r\n        this.newRoot = newRoot;\r\n        return this.performUpdate(this.oldRoot, this.newRoot, context);\r\n    }\r\n\r\n    protected performUpdate(oldRoot: SModelRootImpl, newRoot: SModelRootImpl, context: CommandExecutionContext): CommandReturn {\r\n        if ((this.action.animate === undefined || this.action.animate) && oldRoot.id === newRoot.id) {\r\n            let matchResult: MatchResult;\r\n            if (this.action.matches === undefined) {\r\n                const matcher = new ModelMatcher();\r\n                matchResult = matcher.match(oldRoot, newRoot);\r\n            } else {\r\n                matchResult = this.convertToMatchResult(this.action.matches, oldRoot, newRoot);\r\n            }\r\n            const animationOrRoot = this.computeAnimation(newRoot, matchResult, context);\r\n            if (animationOrRoot instanceof Animation)\r\n                return animationOrRoot.start();\r\n            else\r\n                return animationOrRoot;\r\n        } else {\r\n            if (oldRoot.type === newRoot.type && Dimension.isValid(oldRoot.canvasBounds))\r\n                newRoot.canvasBounds = oldRoot.canvasBounds;\r\n            if (isViewport(oldRoot) && isViewport(newRoot)) {\r\n                newRoot.zoom = oldRoot.zoom;\r\n                newRoot.scroll = oldRoot.scroll;\r\n            }\r\n            return newRoot;\r\n        }\r\n    }\r\n\r\n    protected applyMatches(root: SModelRootImpl, matches: Match[], context: CommandExecutionContext): void {\r\n        const index = root.index;\r\n        for (const match of matches) {\r\n            if (match.left !== undefined) {\r\n                const element = index.getById(match.left.id);\r\n                if (element instanceof SChildElementImpl)\r\n                    element.parent.remove(element);\r\n            }\r\n        }\r\n        for (const match of matches) {\r\n            if (match.right !== undefined) {\r\n                const element = context.modelFactory.createElement(match.right);\r\n                let parent: SModelElementImpl | undefined;\r\n                if (match.rightParentId !== undefined)\r\n                    parent = index.getById(match.rightParentId);\r\n                if (parent instanceof SParentElementImpl)\r\n                    parent.add(element);\r\n                else\r\n                    root.add(element);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected convertToMatchResult(matches: Match[], leftRoot: SModelRootImpl, rightRoot: SModelRootImpl): MatchResult {\r\n        const result: MatchResult = {};\r\n        for (const match of matches) {\r\n            const converted: Match = {};\r\n            let id: string | undefined = undefined;\r\n            if (match.left !== undefined) {\r\n                id = match.left.id;\r\n                converted.left = leftRoot.index.getById(id);\r\n                converted.leftParentId = match.leftParentId;\r\n            }\r\n            if (match.right !== undefined) {\r\n                id = match.right.id;\r\n                converted.right = rightRoot.index.getById(id);\r\n                converted.rightParentId = match.rightParentId;\r\n            }\r\n            if (id !== undefined)\r\n                result[id] = converted;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected computeAnimation(newRoot: SModelRootImpl, matchResult: MatchResult, context: CommandExecutionContext): SModelRootImpl | Animation {\r\n        const animationData: UpdateAnimationData = {\r\n            fades: [] as ResolvedElementFade[]\r\n        };\r\n        forEachMatch(matchResult, (id, match) => {\r\n            if (match.left !== undefined && match.right !== undefined) {\r\n                // The element is still there, but may have been moved\r\n                this.updateElement(match.left as SModelElementImpl, match.right as SModelElementImpl, animationData);\r\n            } else if (match.right !== undefined) {\r\n                // An element has been added\r\n                const right = match.right as SModelElementImpl;\r\n                if (isFadeable(right)) {\r\n                    right.opacity = 0;\r\n                    animationData.fades.push({\r\n                        element: right,\r\n                        type: 'in'\r\n                    });\r\n                }\r\n            } else if (match.left instanceof SChildElementImpl) {\r\n                // An element has been removed\r\n                const left = match.left;\r\n                if (isFadeable(left) && match.leftParentId !== undefined) {\r\n                    if (!containsSome(newRoot, left)) {\r\n                        const parent = newRoot.index.getById(match.leftParentId);\r\n                        if (parent instanceof SParentElementImpl) {\r\n                            const leftCopy = context.modelFactory.createElement(left) as SChildElementImpl & Fadeable;\r\n                            parent.add(leftCopy);\r\n                            animationData.fades.push({\r\n                                element: leftCopy,\r\n                                type: 'out'\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n\r\n        const animations = this.createAnimations(animationData, newRoot, context);\r\n        if (animations.length >= 2) {\r\n            return new CompoundAnimation(newRoot, context, animations);\r\n        } else if (animations.length === 1) {\r\n            return animations[0];\r\n        } else {\r\n            return newRoot;\r\n        }\r\n    }\r\n\r\n    protected updateElement(left: SModelElementImpl, right: SModelElementImpl, animationData: UpdateAnimationData): void {\r\n        if (isLocateable(left) && isLocateable(right)) {\r\n            const leftPos = left.position;\r\n            const rightPos = right.position;\r\n            if (!almostEquals(leftPos.x, rightPos.x) || !almostEquals(leftPos.y, rightPos.y)) {\r\n                if (animationData.moves === undefined)\r\n                    animationData.moves = [];\r\n                animationData.moves.push({\r\n                    element: right,\r\n                    fromPosition: leftPos,\r\n                    toPosition: rightPos\r\n                });\r\n                right.position = leftPos;\r\n            }\r\n        }\r\n        if (isSizeable(left) && isSizeable(right)) {\r\n            if (!Dimension.isValid(right.bounds)) {\r\n                right.bounds = {\r\n                    x: right.bounds.x,\r\n                    y: right.bounds.y,\r\n                    width: left.bounds.width,\r\n                    height: left.bounds.height\r\n                };\r\n            } else if (!almostEquals(left.bounds.width, right.bounds.width)\r\n                || !almostEquals(left.bounds.height, right.bounds.height)) {\r\n                if (animationData.resizes === undefined)\r\n                    animationData.resizes = [];\r\n                animationData.resizes.push({\r\n                    element: right,\r\n                    fromDimension: {\r\n                        width: left.bounds.width,\r\n                        height: left.bounds.height,\r\n                    },\r\n                    toDimension: {\r\n                        width: right.bounds.width,\r\n                        height: right.bounds.height,\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        if (left instanceof SRoutableElementImpl && right instanceof SRoutableElementImpl && this.edgeRouterRegistry) {\r\n            if (animationData.edgeMementi === undefined)\r\n                animationData.edgeMementi = [];\r\n            animationData.edgeMementi.push({\r\n                edge: right,\r\n                before: this.takeSnapshot(left),\r\n                after: this.takeSnapshot(right),\r\n            });\r\n        }\r\n        if (isSelectable(left) && isSelectable(right)) {\r\n            right.selected = left.selected;\r\n        }\r\n        if (left instanceof SModelRootImpl && right instanceof SModelRootImpl) {\r\n            right.canvasBounds = left.canvasBounds;\r\n        }\r\n        if (left instanceof ViewportRootElementImpl && right instanceof ViewportRootElementImpl) {\r\n            right.scroll = left.scroll;\r\n            right.zoom = left.zoom;\r\n        }\r\n    }\r\n\r\n    protected takeSnapshot(edge: SRoutableElementImpl): EdgeSnapshot {\r\n        const router = this.edgeRouterRegistry!.get(edge.routerKind);\r\n        return router.takeSnapshot(edge);\r\n    }\r\n\r\n    protected createAnimations(data: UpdateAnimationData, root: SModelRootImpl, context: CommandExecutionContext): Animation[] {\r\n        const animations: Animation[] = [];\r\n        if (data.fades.length > 0) {\r\n            animations.push(new FadeAnimation(root, data.fades, context, true));\r\n        }\r\n        if (data.moves !== undefined && data.moves.length > 0) {\r\n            const movesMap: Map<string, ResolvedElementMove> = new Map;\r\n            for (const move of data.moves) {\r\n                movesMap.set(move.element.id, move);\r\n            }\r\n            animations.push(new MoveAnimation(root, movesMap, context, false));\r\n        }\r\n        if (data.resizes !== undefined && data.resizes.length > 0) {\r\n            const resizesMap: Map<string, ResolvedElementResize> = new Map;\r\n            for (const resize of data.resizes) {\r\n                resizesMap.set(resize.element.id, resize);\r\n            }\r\n            animations.push(new ResizeAnimation(root, resizesMap, context, false));\r\n        }\r\n        if (data.edgeMementi !== undefined && data.edgeMementi.length > 0) {\r\n            animations.push(new MorphEdgesAnimation(root, data.edgeMementi, context, false));\r\n        }\r\n        return animations;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return this.performUpdate(this.newRoot, this.oldRoot, context);\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return this.performUpdate(this.oldRoot, this.newRoot, context);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from 'inversify';\r\nimport { GetViewportAction, ResponseAction, SetViewportAction, ViewportResult } from 'sprotty-protocol/lib/actions';\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { MergeableCommand, ICommand, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { Animation } from '../../base/animations/animation';\r\nimport { isViewport, limitViewport } from './model';\r\nimport { TYPES } from '../../base/types';\r\nimport { ModelRequestCommand } from '../../base/commands/request-command';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\n\r\n@injectable()\r\nexport class SetViewportCommand extends MergeableCommand {\r\n    static readonly KIND = SetViewportAction.KIND;\r\n\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n    protected element: SModelElementImpl & Viewport;\r\n    protected oldViewport: Viewport;\r\n    protected newViewport: Viewport;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: SetViewportAction) {\r\n        super();\r\n        this.newViewport = action.newViewport;\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        const model = context.root;\r\n        const element = model.index.getById(this.action.elementId);\r\n        if (element && isViewport(element)) {\r\n            this.element = element;\r\n            this.oldViewport = {\r\n                scroll: this.element.scroll,\r\n                zoom: this.element.zoom,\r\n            };\r\n            const { zoomLimits, horizontalScrollLimits, verticalScrollLimits } = this.viewerOptions;\r\n            this.newViewport = limitViewport(this.newViewport, model.canvasBounds, horizontalScrollLimits, verticalScrollLimits, zoomLimits);\r\n            return this.setViewport(element, this.oldViewport, this.newViewport, context);\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    protected setViewport(element: SModelElementImpl, oldViewport: Viewport, newViewport: Viewport, context: CommandExecutionContext): CommandReturn {\r\n        if (element && isViewport(element)) {\r\n            if (this.action.animate) {\r\n                return new ViewportAnimation(element, oldViewport, newViewport, context).start();\r\n            } else {\r\n                element.scroll = newViewport.scroll;\r\n                element.zoom = newViewport.zoom;\r\n            }\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        return this.setViewport(this.element, this.newViewport, this.oldViewport, context);\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        return this.setViewport(this.element, this.oldViewport, this.newViewport, context);\r\n    }\r\n\r\n    override merge(command: ICommand, context: CommandExecutionContext): boolean {\r\n        if (!this.action.animate && command instanceof SetViewportCommand && this.element === command.element) {\r\n            this.newViewport = command.newViewport;\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n}\r\n\r\nexport class GetViewportCommand extends ModelRequestCommand {\r\n    static readonly KIND = GetViewportAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: GetViewportAction) {\r\n        super();\r\n    }\r\n\r\n    protected retrieveResult(context: CommandExecutionContext): ResponseAction {\r\n        const elem = context.root;\r\n        let viewport: Viewport;\r\n        if (isViewport(elem)) {\r\n            viewport = { scroll: elem.scroll, zoom: elem.zoom };\r\n        } else {\r\n            viewport = { scroll: Point.ORIGIN, zoom: 1 };\r\n        }\r\n        return ViewportResult.create(viewport, elem.canvasBounds, this.action.requestId);\r\n    }\r\n}\r\n\r\nexport class ViewportAnimation extends Animation {\r\n\r\n    protected zoomFactor: number;\r\n\r\n    constructor(protected element: SModelElementImpl & Viewport,\r\n                protected oldViewport: Viewport,\r\n                protected newViewport: Viewport,\r\n                protected override context: CommandExecutionContext) {\r\n        super(context);\r\n        this.zoomFactor = Math.log(newViewport.zoom / oldViewport.zoom);\r\n    }\r\n\r\n    tween(t: number, context: CommandExecutionContext): SModelRootImpl {\r\n        this.element.scroll = {\r\n            x: (1 - t) * this.oldViewport.scroll.x + t * this.newViewport.scroll.x,\r\n            y: (1 - t) * this.oldViewport.scroll.y + t * this.newViewport.scroll.y\r\n        };\r\n        this.element.zoom = this.oldViewport.zoom * Math.exp(t * this.zoomFactor);\r\n        return context.root;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Action, CenterAction, FitToScreenAction } from 'sprotty-protocol/lib/actions';\r\nimport { Viewport } from 'sprotty-protocol/lib/model';\r\nimport { almostEquals, Bounds, Dimension } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { matchesKeystroke } from '../../utils/keyboard';\r\nimport { SChildElementImpl } from '../../base/model/smodel';\r\nimport { Command, CommandExecutionContext, CommandReturn } from '../../base/commands/command';\r\nimport { SModelElementImpl, SModelRootImpl } from '../../base/model/smodel';\r\nimport { KeyListener } from '../../base/views/key-tool';\r\nimport { isBoundsAware } from '../bounds/model';\r\nimport { isSelectable } from '../select/model';\r\nimport { ViewportAnimation } from './viewport';\r\nimport { isViewport, limitViewport } from './model';\r\nimport { injectable, inject } from 'inversify';\r\nimport { TYPES } from '../../base/types';\r\nimport { ViewerOptions } from '../../base/views/viewer-options';\r\n\r\n@injectable()\r\nexport abstract class BoundsAwareViewportCommand extends Command {\r\n\r\n    @inject(TYPES.ViewerOptions) protected viewerOptions: ViewerOptions;\r\n    oldViewport: Viewport;\r\n    newViewport?: Viewport;\r\n\r\n    constructor(protected readonly animate: boolean) {\r\n        super();\r\n    }\r\n\r\n    protected initialize(model: SModelRootImpl): void {\r\n        if (!isViewport(model)) {\r\n            return;\r\n        }\r\n        this.oldViewport = {\r\n            scroll: model.scroll,\r\n            zoom: model.zoom\r\n        };\r\n        const allBounds: Bounds[] = [];\r\n        this.getElementIds().forEach(id => {\r\n            const element = model.index.getById(id);\r\n            if (element && isBoundsAware(element)) {\r\n                allBounds.push(this.boundsInViewport(element, element.bounds, model));\r\n            }\r\n        });\r\n        if (allBounds.length === 0) {\r\n            model.index.all().forEach(element => {\r\n                if (isSelectable(element) && element.selected && isBoundsAware(element)) {\r\n                    allBounds.push(this.boundsInViewport(element, element.bounds, model));\r\n                }\r\n            });\r\n        }\r\n        if (allBounds.length === 0) {\r\n            model.index.all().forEach(element => {\r\n                if (isBoundsAware(element)) {\r\n                    allBounds.push(this.boundsInViewport(element, element.bounds, model));\r\n                }\r\n            });\r\n        }\r\n        if (allBounds.length !== 0) {\r\n            const bounds = allBounds.reduce((b0, b1) => Bounds.combine(b0, b1));\r\n            if (Dimension.isValid(bounds)) {\r\n                const newViewport = this.getNewViewport(bounds, model);\r\n                if (newViewport) {\r\n                    const { zoomLimits, horizontalScrollLimits, verticalScrollLimits } = this.viewerOptions;\r\n                    this.newViewport = limitViewport(newViewport, model.canvasBounds, horizontalScrollLimits, verticalScrollLimits, zoomLimits);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected boundsInViewport(element: SModelElementImpl, bounds: Bounds, viewport: SModelRootImpl & Viewport): Bounds {\r\n        if (element instanceof SChildElementImpl && element.parent !== viewport)\r\n            return this.boundsInViewport(element.parent, element.parent.localToParent(bounds) as Bounds, viewport);\r\n        else\r\n            return bounds;\r\n    }\r\n\r\n    protected abstract getNewViewport(bounds: Bounds, model: SModelRootImpl): Viewport | undefined;\r\n\r\n    protected abstract getElementIds(): string[];\r\n\r\n    execute(context: CommandExecutionContext): CommandReturn {\r\n        this.initialize(context.root);\r\n        return this.redo(context);\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): CommandReturn {\r\n        const model = context.root;\r\n        if (isViewport(model) && this.newViewport !== undefined && !this.equal(this.newViewport, this.oldViewport)) {\r\n            if (this.animate)\r\n                return new ViewportAnimation(model, this.newViewport, this.oldViewport, context).start();\r\n            else {\r\n                model.scroll = this.oldViewport.scroll;\r\n                model.zoom = this.oldViewport.zoom;\r\n            }\r\n        }\r\n        return model;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): CommandReturn {\r\n        const model = context.root;\r\n        if (isViewport(model) && this.newViewport !== undefined && !this.equal(this.newViewport, this.oldViewport)) {\r\n            if (this.animate) {\r\n               return new ViewportAnimation(model, this.oldViewport, this.newViewport, context).start();\r\n            } else {\r\n                model.scroll = this.newViewport.scroll;\r\n                model.zoom = this.newViewport.zoom;\r\n            }\r\n        }\r\n        return model;\r\n    }\r\n\r\n    protected equal(vp1: Viewport, vp2: Viewport): boolean {\r\n        return almostEquals(vp1.zoom, vp2.zoom) && almostEquals(vp1.scroll.x, vp2.scroll.x) && almostEquals(vp1.scroll.y, vp2.scroll.y);\r\n    }\r\n}\r\n\r\nexport class CenterCommand extends BoundsAwareViewportCommand {\r\n    static readonly KIND = CenterAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected action: CenterAction) {\r\n        super(action.animate);\r\n    }\r\n\r\n    getElementIds() {\r\n        return this.action.elementIds;\r\n    }\r\n\r\n    getNewViewport(bounds: Bounds, model: SModelRootImpl): Viewport | undefined {\r\n        if (!Dimension.isValid(model.canvasBounds)) {\r\n            return undefined;\r\n        }\r\n        let zoom = 1;\r\n        if (this.action.retainZoom && isViewport(model)) {\r\n            zoom = model.zoom;\r\n        } else if (this.action.zoomScale) {\r\n            zoom = this.action.zoomScale;\r\n        }\r\n        const c = Bounds.center(bounds);\r\n        return {\r\n            scroll: {\r\n                x: c.x - 0.5 * model.canvasBounds.width / zoom,\r\n                y: c.y - 0.5 * model.canvasBounds.height / zoom\r\n            },\r\n            zoom: zoom\r\n        };\r\n    }\r\n}\r\n\r\nexport class FitToScreenCommand extends BoundsAwareViewportCommand {\r\n    static readonly KIND = FitToScreenAction.KIND;\r\n\r\n    constructor(@inject(TYPES.Action) protected readonly action: FitToScreenAction) {\r\n        super(action.animate);\r\n    }\r\n\r\n    getElementIds() {\r\n        return this.action.elementIds;\r\n    }\r\n\r\n    getNewViewport(bounds: Bounds, model: SModelRootImpl): Viewport | undefined {\r\n        if (!Dimension.isValid(model.canvasBounds)) {\r\n            return undefined;\r\n        }\r\n        const c = Bounds.center(bounds);\r\n        const delta = this.action.padding === undefined\r\n            ? 0\r\n            : 2 *  this.action.padding;\r\n        let zoom = Math.min(\r\n            model.canvasBounds.width / (bounds.width + delta),\r\n            model.canvasBounds.height / (bounds.height + delta));\r\n        if (this.action.maxZoom !== undefined)\r\n           zoom = Math.min(zoom, this.action.maxZoom);\r\n        if (zoom === Infinity) {\r\n            zoom = 1;\r\n        }\r\n        return {\r\n            scroll: {\r\n                x: c.x - 0.5 * model.canvasBounds.width / zoom,\r\n                y: c.y - 0.5 * model.canvasBounds.height / zoom\r\n            },\r\n            zoom: zoom\r\n        };\r\n    }\r\n}\r\n\r\nexport class CenterKeyboardListener extends KeyListener {\r\n    override keyDown(element: SModelElementImpl, event: KeyboardEvent): Action[] {\r\n        if (matchesKeystroke(event, 'KeyC', 'ctrlCmd', 'shift'))\r\n            return [CenterAction.create([])];\r\n        if (matchesKeystroke(event, 'KeyF', 'ctrlCmd', 'shift'))\r\n            return [FitToScreenAction.create([])];\r\n        return [];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from 'inversify';\r\nimport { BringToFrontAction } from 'sprotty-protocol/lib/actions';\r\nimport { TYPES } from '../../base/types';\r\nimport { SModelRootImpl, SChildElementImpl, SModelElementImpl, SParentElementImpl } from '../../base/model/smodel';\r\nimport { Command, CommandExecutionContext } from '../../base/commands/command';\r\nimport { SRoutableElementImpl, SConnectableElementImpl } from '../routing/model';\r\n\r\nexport type ZOrderElement = {\r\n    element: SChildElementImpl\r\n    index: number\r\n};\r\n\r\n@injectable()\r\nexport class BringToFrontCommand extends Command {\r\n    static readonly KIND = BringToFrontAction.KIND;\r\n\r\n    protected selected: ZOrderElement[] = [];\r\n\r\n    constructor(@inject(TYPES.Action) public action: BringToFrontAction) {\r\n        super();\r\n    }\r\n\r\n    execute(context: CommandExecutionContext): SModelRootImpl {\r\n        const model = context.root;\r\n        this.action.elementIDs.forEach(id => {\r\n            const element = model.index.getById(id);\r\n            if (element instanceof SRoutableElementImpl) {\r\n                if (element.source)\r\n                    this.addToSelection(element.source);\r\n                if (element.target)\r\n                    this.addToSelection(element.target);\r\n            }\r\n            if (element instanceof SChildElementImpl) {\r\n                this.addToSelection(element);\r\n            }\r\n            this.includeConnectedEdges(element);\r\n        });\r\n        return this.redo(context);\r\n    }\r\n\r\n    protected includeConnectedEdges(element?: SModelElementImpl): void {\r\n        if (element instanceof SConnectableElementImpl) {\r\n            element.incomingEdges.forEach(edge => this.addToSelection(edge));\r\n            element.outgoingEdges.forEach(edge => this.addToSelection(edge));\r\n        }\r\n        if (element instanceof SParentElementImpl) {\r\n            for (const child of element.children) {\r\n                this.includeConnectedEdges(child);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected addToSelection(element: SChildElementImpl): void {\r\n        this.selected.push({\r\n            element: element,\r\n            index: element.parent.children.indexOf(element)\r\n        });\r\n    }\r\n\r\n    undo(context: CommandExecutionContext): SModelRootImpl {\r\n        for (let i = this.selected.length - 1; i >= 0; i--) {\r\n            const selection = this.selected[i];\r\n            const element = selection.element;\r\n            element.parent.move(element, selection.index);\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    redo(context: CommandExecutionContext): SModelRootImpl {\r\n        for (let i = 0; i < this.selected.length; i++) {\r\n            this.bringToFront(this.selected[i]);\r\n        }\r\n        return context.root;\r\n    }\r\n\r\n    protected bringToFront(selection: ZOrderElement) {\r\n        const element = selection.element;\r\n        const childrenLength = element.parent.children.length;\r\n        element.parent.move(element, childrenLength - 1);\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { SetBoundsCommand, RequestBoundsCommand } from \"./bounds-manipulation\";\r\nimport { HiddenBoundsUpdater } from './hidden-bounds-updater';\r\nimport { configureLayout, Layouter, LayoutRegistry } from \"./layout\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\nimport { HBoxLayouter } from \"./hbox-layout\";\r\nimport { VBoxLayouter } from \"./vbox-layout\";\r\nimport { StackLayouter} from \"./stack-layout\";\r\n\r\nconst boundsModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    configureCommand({ bind, isBound }, SetBoundsCommand);\r\n    configureCommand({ bind, isBound }, RequestBoundsCommand);\r\n    bind(HiddenBoundsUpdater).toSelf().inSingletonScope();\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(HiddenBoundsUpdater);\r\n    bind(TYPES.Layouter).to(Layouter).inSingletonScope();\r\n    bind(TYPES.LayoutRegistry).to(LayoutRegistry).inSingletonScope();\r\n\r\n    configureLayout({bind, isBound}, VBoxLayouter.KIND, VBoxLayouter);\r\n    configureLayout({bind, isBound}, HBoxLayouter.KIND, HBoxLayouter);\r\n    configureLayout({bind, isBound}, StackLayouter.KIND, StackLayouter);\r\n});\r\n\r\nexport default boundsModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { ButtonHandlerRegistry } from './button-handler';\r\n\r\nconst buttonModule = new ContainerModule(bind => {\r\n    bind(ButtonHandlerRegistry).toSelf().inSingletonScope();\r\n});\r\n\r\nexport default buttonModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { CommandPaletteActionProviderRegistry } from \"./action-providers\";\r\nimport { CommandPalette, CommandPaletteKeyListener } from \"./command-palette\";\r\n\r\nconst commandPaletteModule = new ContainerModule((bind) => {\r\n    bind(CommandPalette).toSelf().inSingletonScope();\r\n    bind(TYPES.IUIExtension).toService(CommandPalette);\r\n    bind(CommandPaletteKeyListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(CommandPaletteKeyListener);\r\n    bind(CommandPaletteActionProviderRegistry).toSelf().inSingletonScope();\r\n    bind(TYPES.ICommandPaletteActionProviderRegistry).toService(CommandPaletteActionProviderRegistry);\r\n});\r\n\r\nexport default commandPaletteModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\nimport { ContainerModule } from \"inversify\";\r\n\r\nimport { IContextMenuService } from \"./context-menu-service\";\r\nimport { ContextMenuProviderRegistry } from \"./menu-providers\";\r\nimport { ContextMenuMouseListener } from \"./mouse-listener\";\r\nimport { TYPES } from \"../../base/types\";\r\n\r\nconst contextMenuModule = new ContainerModule(bind => {\r\n    bind(TYPES.IContextMenuServiceProvider).toProvider<IContextMenuService>(ctx => {\r\n        return () => {\r\n            return new Promise<IContextMenuService>((resolve, reject) => {\r\n                if (ctx.container.isBound(TYPES.IContextMenuService)) {\r\n                    resolve(ctx.container.get<IContextMenuService>(TYPES.IContextMenuService));\r\n                } else {\r\n                    reject();\r\n                }\r\n            });\r\n        };\r\n    });\r\n    bind(ContextMenuMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(ContextMenuMouseListener);\r\n    bind(TYPES.IContextMenuProviderRegistry).to(ContextMenuProviderRegistry);\r\n});\r\n\r\nexport default contextMenuModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { configureModelElement } from \"../../base/views/view\";\r\nimport { ContainerModule } from \"inversify\";\r\nimport { SIssueMarkerImpl } from \"./model\";\r\nimport { IssueMarkerView } from \"./views\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { DecorationPlacer } from \"./decoration-placer\";\r\n\r\nconst decorationModule = new ContainerModule((bind, _unbind, isBound)  => {\r\n    configureModelElement({ bind, isBound }, 'marker', SIssueMarkerImpl, IssueMarkerView);\r\n    bind(DecorationPlacer).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(DecorationPlacer);\r\n});\r\n\r\nexport default decorationModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2021 EclipseSource and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { IntersectionFinder } from \"../edge-intersection/intersection-finder\";\r\n\r\nconst edgeIntersectionModule = new ContainerModule(bind => {\r\n    bind(IntersectionFinder).toSelf().inSingletonScope();\r\n    bind(TYPES.IEdgeRoutePostprocessor).toService(IntersectionFinder);\r\n});\r\n\r\nexport default edgeIntersectionModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { configureButtonHandler } from \"../button/button-handler\";\r\nimport { ExpandButtonHandler } from \"./expand\";\r\n\r\nconst expandModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    configureButtonHandler({bind, isBound}, ExpandButtonHandler.TYPE, ExpandButtonHandler);\r\n});\r\n\r\nexport default expandModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from '../../base/types';\r\nimport { ExportSvgPostprocessor, ExportSvgKeyListener, ExportSvgCommand } from './export';\r\nimport { SvgExporter } from './svg-exporter';\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\n\r\nconst exportSvgModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(ExportSvgKeyListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(ExportSvgKeyListener);\r\n    bind(ExportSvgPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(ExportSvgPostprocessor);\r\n    configureCommand({ bind, isBound }, ExportSvgCommand);\r\n    bind(TYPES.SvgExporter).to(SvgExporter).inSingletonScope();\r\n});\r\n\r\nexport default exportSvgModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { ElementFader } from \"./fade\";\r\n\r\nconst fadeModule = new ContainerModule(bind => {\r\n    bind(ElementFader).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(ElementFader);\r\n});\r\n\r\nexport default fadeModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { inject, injectable } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { IVNodePostprocessor } from \"../../base/views/vnode-postprocessor\";\r\nimport { ViewerOptions } from \"../../base/views/viewer-options\";\r\nimport { SModelElementImpl } from \"../../base/model/smodel\";\r\n\r\n@injectable()\r\nexport class PopupPositionUpdater implements IVNodePostprocessor {\r\n\r\n    @inject(TYPES.ViewerOptions) protected options: ViewerOptions;\r\n\r\n    decorate(vnode: VNode, element: SModelElementImpl): VNode {\r\n        return vnode;\r\n    }\r\n\r\n    postUpdate(): void {\r\n        const popupDiv = document.getElementById(this.options.popupDiv);\r\n        if (popupDiv !== null && typeof window !== 'undefined') {\r\n            const boundingClientRect = popupDiv.getBoundingClientRect();\r\n            if (window.innerHeight < boundingClientRect.height + boundingClientRect.top) {\r\n                popupDiv.style.top = (window.pageYOffset + window.innerHeight - boundingClientRect.height - 5) + 'px';\r\n            }\r\n\r\n            if (window.innerWidth < boundingClientRect.left + boundingClientRect.width) {\r\n                popupDiv.style.left = (window.pageXOffset + window.innerWidth - boundingClientRect.width - 5) + 'px';\r\n            }\r\n\r\n            if (boundingClientRect.left < 0) {\r\n                popupDiv.style.left = '0px';\r\n            }\r\n\r\n            if (boundingClientRect.top < 0) {\r\n                popupDiv.style.top = '0px';\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport {\r\n    HoverMouseListener, PopupHoverMouseListener, HoverFeedbackCommand, SetPopupModelCommand,\r\n    HoverKeyListener, HoverState, ClosePopupActionHandler\r\n} from \"./hover\";\r\nimport { PopupPositionUpdater } from \"./popup-position-updater\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\nimport { configureActionHandler } from \"../../base/actions/action-handler\";\r\nimport { FitToScreenCommand, CenterCommand } from \"../viewport/center-fit\";\r\nimport { SetViewportCommand } from \"../viewport/viewport\";\r\nimport { MoveCommand } from \"../move/move\";\r\n\r\nconst hoverModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(PopupPositionUpdater).toSelf().inSingletonScope();\r\n    bind(TYPES.PopupVNodePostprocessor).toService(PopupPositionUpdater);\r\n    bind(HoverMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(HoverMouseListener);\r\n    bind(PopupHoverMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.PopupMouseListener).toService(PopupHoverMouseListener);\r\n    bind(HoverKeyListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(HoverKeyListener);\r\n    bind<HoverState>(TYPES.HoverState).toConstantValue({\r\n        mouseOverTimer: undefined,\r\n        mouseOutTimer: undefined,\r\n        popupOpen: false,\r\n        previousPopupElement: undefined\r\n    });\r\n    bind(ClosePopupActionHandler).toSelf().inSingletonScope();\r\n\r\n    const context = { bind, isBound };\r\n    configureCommand(context, HoverFeedbackCommand);\r\n    configureCommand(context, SetPopupModelCommand);\r\n    configureActionHandler(context, SetPopupModelCommand.KIND, ClosePopupActionHandler);\r\n    configureActionHandler(context, FitToScreenCommand.KIND, ClosePopupActionHandler);\r\n    configureActionHandler(context, CenterCommand.KIND, ClosePopupActionHandler);\r\n    configureActionHandler(context, SetViewportCommand.KIND, ClosePopupActionHandler);\r\n    configureActionHandler(context, MoveCommand.KIND, ClosePopupActionHandler);\r\n});\r\n\r\nexport default hoverModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from '../../base/types';\r\nimport { MoveCommand, MoveMouseListener, LocationPostprocessor } from './move';\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\n\r\nconst moveModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(MoveMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(MoveMouseListener);\r\n    configureCommand({ bind, isBound }, MoveCommand);\r\n    bind(LocationPostprocessor).toSelf().inSingletonScope();\r\n    bind(TYPES.IVNodePostprocessor).toService(LocationPostprocessor);\r\n    bind(TYPES.HiddenVNodePostprocessor).toService(LocationPostprocessor);\r\n});\r\n\r\nexport default moveModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { OpenMouseListener } from \"./open\";\r\n\r\nconst openModule = new ContainerModule(bind => {\r\n    bind(OpenMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(OpenMouseListener);\r\n});\r\n\r\nexport default openModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { ManhattanEdgeRouter } from \"./manhattan-edge-router\";\r\nimport { PolylineEdgeRouter } from \"./polyline-edge-router\";\r\nimport { ManhattanRectangularAnchor, ManhattanEllipticAnchor, ManhattanDiamondAnchor } from \"./manhattan-anchors\";\r\nimport { RectangleAnchor, EllipseAnchor, DiamondAnchor } from \"./polyline-anchors\";\r\nimport { AnchorComputerRegistry } from \"./anchor\";\r\nimport { EdgeRouterRegistry } from \"./routing\";\r\nimport { AddRemoveBezierSegmentCommand, BezierEdgeRouter } from './bezier-edge-router';\r\nimport { BezierDiamondAnchor, BezierEllipseAnchor, BezierRectangleAnchor } from './bezier-anchors';\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\n\r\nconst routingModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(EdgeRouterRegistry).toSelf().inSingletonScope();\r\n\r\n    bind(AnchorComputerRegistry).toSelf().inSingletonScope();\r\n\r\n    bind(ManhattanEdgeRouter).toSelf().inSingletonScope();\r\n    bind(TYPES.IEdgeRouter).toService(ManhattanEdgeRouter);\r\n    bind(ManhattanEllipticAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(ManhattanEllipticAnchor);\r\n    bind(ManhattanRectangularAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(ManhattanRectangularAnchor);\r\n    bind(ManhattanDiamondAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(ManhattanDiamondAnchor);\r\n\r\n    bind(PolylineEdgeRouter).toSelf().inSingletonScope();\r\n    bind(TYPES.IEdgeRouter).toService(PolylineEdgeRouter);\r\n    bind(EllipseAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(EllipseAnchor);\r\n    bind(RectangleAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(RectangleAnchor);\r\n    bind(DiamondAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(DiamondAnchor);\r\n\r\n    bind(BezierEdgeRouter).toSelf().inSingletonScope();\r\n    bind(TYPES.IEdgeRouter).toService(BezierEdgeRouter);\r\n    bind(BezierEllipseAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(BezierEllipseAnchor);\r\n    bind(BezierRectangleAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(BezierRectangleAnchor);\r\n    bind(BezierDiamondAnchor).toSelf().inSingletonScope();\r\n    bind(TYPES.IAnchorComputer).toService(BezierDiamondAnchor);\r\n\r\n    configureCommand({ bind, isBound }, AddRemoveBezierSegmentCommand);\r\n});\r\n\r\nexport default routingModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { SelectCommand, SelectAllCommand, SelectKeyboardListener, SelectMouseListener, GetSelectionCommand } from \"./select\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\n\r\nconst selectModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    configureCommand({ bind, isBound }, SelectCommand);\r\n    configureCommand({ bind, isBound }, SelectAllCommand);\r\n    configureCommand({ bind, isBound }, GetSelectionCommand);\r\n    bind(SelectKeyboardListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(SelectKeyboardListener);\r\n    bind(SelectMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(SelectMouseListener);\r\n});\r\n\r\nexport default selectModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { UndoRedoKeyListener } from \"./undo-redo\";\r\n\r\nconst undoRedoModule = new ContainerModule(bind => {\r\n    bind(UndoRedoKeyListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(UndoRedoKeyListener);\r\n});\r\n\r\nexport default undoRedoModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\nimport { UpdateModelCommand } from \"./update-model\";\r\n\r\nconst updateModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    configureCommand({ bind, isBound }, UpdateModelCommand);\r\n});\r\n\r\nexport default updateModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { TYPES } from \"../../base/types\";\r\nimport { CenterCommand, CenterKeyboardListener, FitToScreenCommand } from \"./center-fit\";\r\nimport { SetViewportCommand, GetViewportCommand } from \"./viewport\";\r\nimport { ScrollMouseListener } from \"./scroll\";\r\nimport { ZoomMouseListener } from \"./zoom\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\n\r\nconst viewportModule = new ContainerModule((bind , _unbind, isBound) => {\r\n    configureCommand({ bind, isBound }, CenterCommand);\r\n    configureCommand({ bind, isBound }, FitToScreenCommand);\r\n    configureCommand({ bind, isBound }, SetViewportCommand);\r\n    configureCommand({ bind, isBound }, GetViewportCommand);\r\n    bind(CenterKeyboardListener).toSelf().inSingletonScope();\r\n    bind(TYPES.KeyListener).toService(CenterKeyboardListener);\r\n    bind(ScrollMouseListener).toSelf().inSingletonScope();\r\n    bind(ZoomMouseListener).toSelf().inSingletonScope();\r\n    bind(TYPES.MouseListener).toService(ScrollMouseListener);\r\n    bind(TYPES.MouseListener).toService(ZoomMouseListener);\r\n});\r\n\r\nexport default viewportModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { configureCommand } from \"../../base/commands/command-registration\";\r\nimport { BringToFrontCommand } from './zorder';\r\n\r\nconst zorderModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    configureCommand({ bind, isBound }, BringToFrontCommand);\r\n});\r\n\r\nexport default zorderModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2022 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { inject, injectable } from 'inversify';\r\nimport { VNode } from \"snabbdom\";\r\nimport { Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { getSubType } from 'sprotty-protocol/lib/utils/model-utils';\r\nimport { IView, IViewArgs, RenderingContext } from \"../base/views/view\";\r\nimport { setAttr } from '../base/views/vnode-utils';\r\nimport { ShapeView } from '../features/bounds/views';\r\nimport {\r\n    BY_DESCENDING_X_THEN_DESCENDING_Y,\r\n    BY_DESCENDING_X_THEN_Y,\r\n    BY_X_THEN_DESCENDING_Y,\r\n    BY_X_THEN_Y,\r\n    IntersectingRoutedPoint,\r\n    Intersection,\r\n    isIntersectingRoutedPoint\r\n} from '../features/edge-intersection/intersection-finder';\r\nimport { isEdgeLayoutable } from '../features/edge-layout/model';\r\nimport { SRoutableElementImpl, SRoutingHandleImpl } from '../features/routing/model';\r\nimport { EdgeRouterRegistry, RoutedPoint } from '../features/routing/routing';\r\nimport { RoutableView } from '../features/routing/views';\r\nimport { svg } from '../lib/jsx';\r\nimport { PointToPointLine } from '../utils/geometry';\r\nimport { SCompartmentImpl, SEdgeImpl, SGraphImpl, SLabelImpl } from \"./sgraph\";\r\n\r\n/**\r\n * IView component that turns an SGraph element and its children into a tree of virtual DOM elements.\r\n */\r\n@injectable()\r\nexport class SGraphView implements IView {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    render(model: Readonly<SGraphImpl>, context: RenderingContext): VNode {\r\n        const edgeRouting = this.edgeRouterRegistry.routeAllChildren(model);\r\n        const transform = `scale(${model.zoom}) translate(${-model.scroll.x},${-model.scroll.y})`;\r\n        return <svg class-sprotty-graph={true}>\r\n            <g transform={transform}>\r\n                {context.renderChildren(model, { edgeRouting })}\r\n            </g>\r\n        </svg>;\r\n    }\r\n\r\n}\r\n\r\n@injectable()\r\nexport class PolylineEdgeView extends RoutableView {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    render(edge: Readonly<SEdgeImpl>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        const route = this.edgeRouterRegistry.route(edge, args);\r\n        if (route.length === 0) {\r\n            return this.renderDanglingEdge(\"Cannot compute route\", edge, context);\r\n        }\r\n        if (!this.isVisible(edge, route, context)) {\r\n            if (edge.children.length === 0) {\r\n                return undefined;\r\n            }\r\n            // The children of an edge are not necessarily inside the bounding box of the route,\r\n            // so we need to render a group to ensure the children have a chance to be rendered.\r\n            return <g>{context.renderChildren(edge, { route })}</g>;\r\n        }\r\n\r\n        return <g class-sprotty-edge={true} class-mouseover={edge.hoverFeedback}>\r\n            {this.renderLine(edge, route, context, args)}\r\n            {this.renderAdditionals(edge, route, context)}\r\n            {context.renderChildren(edge, { route })}\r\n        </g>;\r\n    }\r\n\r\n    protected renderLine(edge: SEdgeImpl, segments: Point[], context: RenderingContext, args?: IViewArgs): VNode {\r\n        const firstPoint = segments[0];\r\n        let path = `M ${firstPoint.x},${firstPoint.y}`;\r\n        for (let i = 1; i < segments.length; i++) {\r\n            const p = segments[i];\r\n            path += ` L ${p.x},${p.y}`;\r\n        }\r\n        return <path d={path} />;\r\n    }\r\n\r\n    protected renderAdditionals(edge: SEdgeImpl, segments: Point[], context: RenderingContext): VNode[] {\r\n        // here we need to render the control points?\r\n        return [];\r\n    }\r\n\r\n    protected renderDanglingEdge(message: string, edge: SEdgeImpl, context: RenderingContext): VNode {\r\n        return <text class-sprotty-edge-dangling={true} title={message}>?</text>;\r\n    }\r\n}\r\n\r\n/**\r\n * A `PolylineEdgeView` that renders jumps over intersections.\r\n *\r\n * In order to find intersections, `IntersectionFinder` needs to be configured as a `TYPES.IEdgeRoutePostprocessor`\r\n * so that that intersections are declared as `IntersectingRoutedPoint` in the computed routes.\r\n *\r\n * This view only draws correct line jumps for intersections among straight line segments and doesn't work with bezier curves.\r\n *\r\n * @see IntersectionFinder\r\n * @see IntersectingRoutedPoint\r\n * @see EdgeRouterRegistry\r\n */\r\n@injectable()\r\nexport class JumpingPolylineEdgeView extends PolylineEdgeView {\r\n\r\n    protected jumpOffsetBefore = 5;\r\n    protected jumpOffsetAfter = 5;\r\n    protected skipOffsetBefore = 3;\r\n    protected skipOffsetAfter = 2;\r\n\r\n    protected override renderLine(edge: SEdgeImpl, segments: Point[], context: RenderingContext, args?: IViewArgs): VNode {\r\n        let path = '';\r\n        for (let i = 0; i < segments.length; i++) {\r\n            const p = segments[i];\r\n            if (i === 0) {\r\n                path = `M ${p.x},${p.y}`;\r\n            }\r\n            if (isIntersectingRoutedPoint(p)) {\r\n                path += this.intersectionPath(edge, segments, p, args);\r\n            }\r\n            if (i !== 0) {\r\n                path += ` L ${p.x},${p.y}`;\r\n            }\r\n        }\r\n        return <path d={path} />;\r\n    }\r\n\r\n    /**\r\n     * Returns a path that takes the intersections into account by drawing a line jump or a gap for intersections on that path.\r\n     */\r\n    protected intersectionPath(edge: SEdgeImpl, segments: Point[], intersectingPoint: IntersectingRoutedPoint, args?: IViewArgs): string {\r\n        if (intersectingPoint.intersections.length < 1) {\r\n            return '';\r\n        }\r\n\r\n        const segment = this.getLineSegment(edge, intersectingPoint.intersections[0], args, segments);\r\n        const intersections = this.getIntersectionsSortedBySegmentDirection(segment, intersectingPoint);\r\n\r\n        let path = '';\r\n        for (const intersection of intersections) {\r\n            const otherLineSegment = this.getOtherLineSegment(edge, intersection, args);\r\n            if (otherLineSegment === undefined) {\r\n                continue;\r\n            }\r\n            const currentLineSegment = this.getLineSegment(edge, intersection, args, segments);\r\n            const intersectionPoint = intersection.intersectionPoint;\r\n            if (this.shouldDrawLineJumpOnIntersection(currentLineSegment, otherLineSegment)) {\r\n                path += this.createJumpPath(intersectionPoint, currentLineSegment);\r\n            } else if (this.shouldDrawLineGapOnIntersection(currentLineSegment, otherLineSegment)) {\r\n                path += this.createGapPath(intersectionPoint, currentLineSegment);\r\n            }\r\n        }\r\n\r\n        return path;\r\n    }\r\n\r\n    /**\r\n     * Returns the intersections sorted by the direction of the `lineSegment`.\r\n     *\r\n     * The coordinate system goes from left to right and top to bottom.\r\n     * Thus, x increases to the right and y increases downwards.\r\n     *\r\n     * We need to draw the intersections in the order of the direction of the line segment.\r\n     * To draw a line pointing north, we need to order intersections by Y in a descending order.\r\n     * To draw a line pointing south, we need to order intersections by Y in an ascending order.\r\n     */\r\n    protected getIntersectionsSortedBySegmentDirection(lineSegment: PointToPointLine, intersectingPoint: IntersectingRoutedPoint) {\r\n        switch (lineSegment.direction) {\r\n            case 'north':\r\n            case 'north-east':\r\n                return intersectingPoint.intersections.sort(BY_X_THEN_DESCENDING_Y);\r\n\r\n            case 'south':\r\n            case 'south-east':\r\n            case 'east':\r\n                return intersectingPoint.intersections.sort(BY_X_THEN_Y);\r\n\r\n            case 'south-west':\r\n            case 'west':\r\n                return intersectingPoint.intersections.sort(BY_DESCENDING_X_THEN_Y);\r\n\r\n            case 'north-west':\r\n                return intersectingPoint.intersections.sort(BY_DESCENDING_X_THEN_DESCENDING_Y);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Whether or not to draw a line jump on an intersection for the `currentLineSegment`.\r\n     * This should usually be inverse of `shouldDrawLineGapOnIntersection()`.\r\n     */\r\n    protected shouldDrawLineJumpOnIntersection(currentLineSegment: PointToPointLine, otherLineSegment: PointToPointLine) {\r\n        return Math.abs(currentLineSegment.slopeOrMax) < Math.abs(otherLineSegment.slopeOrMax);\r\n    }\r\n\r\n    /**\r\n     * Whether or not to draw a line gap on an intersection for the `currentLineSegment`.\r\n     * This should usually be inverse of `shouldDrawLineJumpOnIntersection()`.\r\n     */\r\n    protected shouldDrawLineGapOnIntersection(currentLineSegment: PointToPointLine, otherLineSegment: PointToPointLine) {\r\n        return !this.shouldDrawLineJumpOnIntersection(currentLineSegment, otherLineSegment);\r\n    }\r\n\r\n    protected getLineSegment(edge: SRoutableElementImpl, intersection: Intersection, args?: IViewArgs, segments?: Point[]): PointToPointLine {\r\n        const route = segments ? segments : this.edgeRouterRegistry.route(edge, args);\r\n        const index = intersection.routable1 === edge.id ? intersection.segmentIndex1 : intersection.segmentIndex2;\r\n        return new PointToPointLine(route[index], route[index + 1]);\r\n    }\r\n\r\n    protected getOtherLineSegment(currentEdge: SEdgeImpl, intersection: Intersection, args?: IViewArgs): PointToPointLine | undefined {\r\n        const otherEdgeId = intersection.routable1 === currentEdge.id ? intersection.routable2 : intersection.routable1;\r\n        const otherEdge = currentEdge.index.getById(otherEdgeId);\r\n        if (!(otherEdge instanceof SRoutableElementImpl)) {\r\n            return undefined;\r\n        }\r\n        return this.getLineSegment(otherEdge, intersection, args);\r\n    }\r\n\r\n    protected createJumpPath(intersectionPoint: Point, lineSegment: PointToPointLine): string {\r\n        const anchorBefore = Point.shiftTowards(intersectionPoint, lineSegment.p1, this.jumpOffsetBefore);\r\n        const anchorAfter = Point.shiftTowards(intersectionPoint, lineSegment.p2, this.jumpOffsetAfter);\r\n        const rotation = lineSegment.p1.x < lineSegment.p2.x ? 1 : 0;\r\n        return ` L ${anchorBefore.x},${anchorBefore.y} A 1,1 0,0 ${rotation} ${anchorAfter.x},${anchorAfter.y}`;\r\n    }\r\n\r\n    protected createGapPath(intersectionPoint: Point, lineSegment: PointToPointLine): string {\r\n        let offsetBefore;\r\n        let offsetAfter;\r\n        if (intersectionPoint.y < lineSegment.p1.y) {\r\n            offsetBefore = -this.skipOffsetBefore;\r\n            offsetAfter = this.jumpOffsetAfter + this.skipOffsetAfter;\r\n        } else {\r\n            offsetBefore = this.jumpOffsetBefore + this.skipOffsetAfter;\r\n            offsetAfter = -this.skipOffsetBefore;\r\n        }\r\n        const anchorBefore = Point.shiftTowards(intersectionPoint, lineSegment.p1, offsetBefore);\r\n        const anchorAfter = Point.shiftTowards(intersectionPoint, lineSegment.p2, offsetAfter);\r\n        return ` L ${anchorBefore.x},${anchorBefore.y} M ${anchorAfter.x},${anchorAfter.y}`;\r\n    }\r\n\r\n}\r\n\r\n/**\r\n * A `PolylineEdgeView` that renders gaps on intersections.\r\n *\r\n * In order to find intersections, `IntersectionFinder` needs to be configured as a `TYPES.IEdgeRoutePostprocessor`\r\n * so that that intersections are declared as `IntersectingRoutedPoint` in the computed routes.\r\n *\r\n * This view only draws correct gaps for intersections among straight line segments and doesn't work with bezier curves.\r\n *\r\n * @see IntersectionFinder\r\n * @see IntersectingRoutedPoint\r\n * @see EdgeRouterRegistry\r\n */\r\n@injectable()\r\nexport class PolylineEdgeViewWithGapsOnIntersections extends JumpingPolylineEdgeView {\r\n\r\n    protected override skipOffsetBefore = 3;\r\n    protected override skipOffsetAfter = 3;\r\n\r\n    protected override shouldDrawLineJumpOnIntersection(currentLineSegment: PointToPointLine, otherLineSegment: PointToPointLine) {\r\n        return false;\r\n    }\r\n\r\n    protected override shouldDrawLineGapOnIntersection(currentLineSegment: PointToPointLine, otherLineSegment: PointToPointLine) {\r\n        return Math.abs(currentLineSegment.slopeOrMax) >= Math.abs(otherLineSegment.slopeOrMax);\r\n    }\r\n\r\n    protected override createGapPath(intersectionPoint: Point, lineSegment: PointToPointLine): string {\r\n        const anchorBefore = Point.shiftTowards(intersectionPoint, lineSegment.p1, this.skipOffsetBefore);\r\n        const anchorAfter = Point.shiftTowards(intersectionPoint, lineSegment.p2, this.skipOffsetAfter);\r\n        return ` L ${anchorBefore.x},${anchorBefore.y} M ${anchorAfter.x},${anchorAfter.y}`;\r\n    }\r\n\r\n}\r\n\r\n@injectable()\r\nexport class BezierCurveEdgeView extends RoutableView {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    render(edge: Readonly<SEdgeImpl>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        const route = this.edgeRouterRegistry.route(edge, args);\r\n        if (route.length === 0) {\r\n            return this.renderDanglingEdge(\"Cannot compute route\", edge, context);\r\n        }\r\n        if (!this.isVisible(edge, route, context)) {\r\n            if (edge.children.length === 0) {\r\n                return undefined;\r\n            }\r\n            // The children of an edge are not necessarily inside the bounding box of the route,\r\n            // so we need to render a group to ensure the children have a chance to be rendered.\r\n            return <g>{context.renderChildren(edge, { route })}</g>;\r\n        }\r\n\r\n        return <g class-sprotty-edge={true} class-mouseover={edge.hoverFeedback}>\r\n            {this.renderLine(edge, route, context, args)}\r\n            {this.renderAdditionals(edge, route, context)}\r\n            {context.renderChildren(edge, { route })}\r\n        </g>;\r\n    }\r\n\r\n    protected renderLine(edge: SEdgeImpl, segments: Point[], context: RenderingContext, args?: IViewArgs): VNode {\r\n        /**\r\n         * Example for two splines:\r\n         * SVG:\r\n         * <path d=\"M0,300 C0,150 300,150 300,300 S600,450 600,300\" />\r\n         *\r\n         * Segments input layout:\r\n         * routingPoints[0] = source;\r\n         * routingPoints[1] = controlForSource;\r\n         * routingPoints[2] = controlForSegment1;\r\n         * routingPoints[3] = segment;\r\n         * routingPoints[4] = controlForSegment2;\r\n         * routingPoints[5] = controlForTarget;\r\n         * routingPoints[6] = target;\r\n         */\r\n        let path = '';\r\n        if (segments.length >= 4) {\r\n            path += this.buildMainSegment(segments);\r\n            const pointsLeft = segments.length - 4;\r\n            if (pointsLeft > 0 && pointsLeft % 3 === 0) {\r\n                for (let i = 4; i < segments.length; i += 3) {\r\n                    path += this.addSpline(segments, i);\r\n                }\r\n            }\r\n        }\r\n        return <path d={path} />;\r\n    }\r\n\r\n    private buildMainSegment(segments: Point[]) {\r\n        const s = segments[0];\r\n        const h1 = segments[1];\r\n        const h2 = segments[2];\r\n        const t = segments[3];\r\n        return `M${s.x},${s.y} C${h1.x},${h1.y} ${h2.x},${h2.y} ${t.x},${t.y}`;\r\n    }\r\n\r\n    private addSpline(segments: Point[], index: number) {\r\n        // We have two controls for each junction, but SVG does not therefore index is jumped over\r\n        const c = segments[index + 1];\r\n        const p = segments[index + 2];\r\n        return ` S${c.x},${c.y} ${p.x},${p.y}`;\r\n    }\r\n\r\n    protected renderAdditionals(edge: SEdgeImpl, segments: Point[], context: RenderingContext): VNode[] {\r\n        return [];\r\n    }\r\n\r\n    protected renderDanglingEdge(message: string, edge: SEdgeImpl, context: RenderingContext): VNode {\r\n        return <text class-sprotty-edge-dangling={true} title={message}>?</text>;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SRoutingHandleView implements IView {\r\n\r\n    @inject(EdgeRouterRegistry) edgeRouterRegistry: EdgeRouterRegistry;\r\n\r\n    minimalPointDistance: number = 10;\r\n\r\n    render(handle: Readonly<SRoutingHandleImpl>, context: RenderingContext, args?: { route?: RoutedPoint[] }): VNode {\r\n        if (args && args.route) {\r\n            if (handle.parent instanceof SRoutableElementImpl) {\r\n                const router = this.edgeRouterRegistry.get(handle.parent.routerKind);\r\n                const theRoute = args.route === undefined ? this.edgeRouterRegistry.route(handle.parent, args) : args.route;\r\n                const position = router.getHandlePosition(handle.parent, theRoute, handle);\r\n                if (position !== undefined) {\r\n                    const node = <circle class-sprotty-routing-handle={true}\r\n                        class-selected={handle.selected} class-mouseover={handle.hoverFeedback}\r\n                        cx={position.x} cy={position.y} r={this.getRadius()} />;\r\n                    setAttr(node, 'data-kind', handle.kind);\r\n                    return node;\r\n                }\r\n            }\r\n        }\r\n        // Fallback: Create an empty group\r\n        return <g />;\r\n    }\r\n\r\n    getRadius(): number {\r\n        return 7;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SLabelView extends ShapeView {\r\n    render(label: Readonly<SLabelImpl>, context: RenderingContext): VNode | undefined {\r\n        if (!isEdgeLayoutable(label) && !this.isVisible(label, context)) {\r\n            return undefined;\r\n        }\r\n        const vnode = <text class-sprotty-label={true}>{label.text}</text>;\r\n        const subType = getSubType(label);\r\n        if (subType) {\r\n            setAttr(vnode, 'class', subType);\r\n        }\r\n        return vnode;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SCompartmentView implements IView {\r\n    render(compartment: Readonly<SCompartmentImpl>, context: RenderingContext, args?: IViewArgs): VNode | undefined {\r\n        const translate = `translate(${compartment.bounds.x}, ${compartment.bounds.y})`;\r\n        const vnode = <g transform={translate} class-sprotty-comp=\"{true}\">\r\n            {context.renderChildren(compartment)}\r\n        </g>;\r\n        const subType = getSubType(compartment);\r\n        if (subType)\r\n            setAttr(vnode, 'class', subType);\r\n        return vnode;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SBezierCreateHandleView extends SRoutingHandleView {\r\n\r\n    override render(handle: Readonly<SRoutingHandleImpl>, context: RenderingContext, args?: { route?: RoutedPoint[] }): VNode {\r\n        if (args) {\r\n            const theRoute = args.route;\r\n            if (theRoute && handle.parent instanceof SRoutableElementImpl) {\r\n                const router = this.edgeRouterRegistry.get(handle.parent.routerKind);\r\n                const position = router.getHandlePosition(handle.parent, theRoute, handle);\r\n                if (position !== undefined) {\r\n\r\n                    const translation = \"translate(\" + position.x + \", \" + position.y + \")\";\r\n                    const textOffsetX = -5.5;\r\n                    const textOffsetY = 5.5;\r\n                    const text = (handle.kind === \"bezier-add\") ? \"+\" : \"-\";\r\n                    const node =\r\n                        <g transform={translation} class-sprotty-routing-handle={true}\r\n                            class-selected={handle.selected} class-mouseover={handle.hoverFeedback}>\r\n                            <circle r={this.getRadius()} />\r\n                            <text x={textOffsetX} y={textOffsetY} attrs-text-align=\"middle\"\r\n                                style-font-family=\"monospace\" style-pointer-events=\"none\" style-fill=\"white\">{text}</text>\r\n                        </g>;\r\n                    setAttr(node, 'data-kind', handle.kind);\r\n                    return node;\r\n                }\r\n            }\r\n        }\r\n        // Fallback: Create an empty group\r\n        return <g />;\r\n    }\r\n}\r\n\r\n@injectable()\r\nexport class SBezierControlHandleView extends SRoutingHandleView {\r\n\r\n    override render(handle: Readonly<SRoutingHandleImpl>, context: RenderingContext, args?: { route?: RoutedPoint[] }): VNode {\r\n        if (args) {\r\n            const theRoute = args.route;\r\n            if (theRoute && handle.parent instanceof SRoutableElementImpl) {\r\n                const router = this.edgeRouterRegistry.get(handle.parent.routerKind);\r\n                const position = router.getHandlePosition(handle.parent, theRoute, handle) as any;\r\n                if (position !== undefined) {\r\n\r\n                    let pathEndPos: Point | undefined;\r\n                    for (let i = 0; i < theRoute.length; i++) {\r\n                        const elem = theRoute[i];\r\n                        if (elem.kind === position.kind && elem.pointIndex === position.pointIndex) {\r\n                            if (handle.kind === 'bezier-control-before') {\r\n                                pathEndPos = theRoute[i + 1];\r\n                            } else {\r\n                                pathEndPos = theRoute[i - 1];\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    let node;\r\n                    if (pathEndPos) {\r\n                        const coords = `M ${position.x}, ${position.y} L ${pathEndPos.x}, ${pathEndPos.y}`;\r\n                        node =\r\n                            <g class-sprotty-routing-handle={true} class-selected={handle.selected} class-mouseover={handle.hoverFeedback}>\r\n                                <path d={coords} stroke=\"grey\" style-stroke-width=\"2px\"></path>\r\n                                <circle cx={position.x} cy={position.y} r={this.getRadius()} />\r\n                            </g>;\r\n                    } else {\r\n                        node = <circle class-sprotty-routing-handle={true} class-selected={handle.selected} class-mouseover={handle.hoverFeedback}\r\n                            cx={position.x} cy={position.y} r={this.getRadius()} />;\r\n                    }\r\n\r\n                    setAttr(node, 'data-kind', handle.kind);\r\n                    return node;\r\n                }\r\n            }\r\n        }\r\n        // Fallback: Create an empty group\r\n        return <g />;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { ContainerModule } from \"inversify\";\r\nimport { configureCommand } from \"../base/commands/command-registration\";\r\nimport { TYPES } from \"../base/types\";\r\nimport { CommitModelCommand } from \"./commit-model\";\r\nimport { ComputedBoundsApplicator, ModelSource } from \"./model-source\";\r\n\r\n/**\r\n * This container module does NOT provide any binding for TYPES.ModelSource because that needs to be\r\n * done according to the needs of the application. You can choose between a local (LocalModelSource)\r\n * and a remote (e.g. WebSocketDiagramServer) implementation.\r\n */\r\nconst modelSourceModule = new ContainerModule((bind, _unbind, isBound) => {\r\n    bind(TYPES.ModelSourceProvider).toProvider<ModelSource>((context) => {\r\n        return () => {\r\n            return new Promise<ModelSource>((resolve) => {\r\n                resolve(context.container.get<ModelSource>(TYPES.ModelSource));\r\n            });\r\n        };\r\n    });\r\n    configureCommand({bind, isBound}, CommitModelCommand);\r\n    bind(TYPES.IActionHandlerInitializer).toService(TYPES.ModelSource);\r\n    bind(ComputedBoundsApplicator).toSelf().inSingletonScope();\r\n});\r\n\r\nexport default modelSourceModule;\r\n", "/********************************************************************************\r\n * Copyright (c) 2019 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Container, ContainerModule } from 'inversify';\r\nimport defaultModule from '../base/di.config';\r\nimport modelSourceModule from '../model-source/di.config';\r\nimport boundsModule from '../features/bounds/di.config';\r\nimport buttonModule from '../features/button/di.config';\r\nimport commandPaletteModule from '../features/command-palette/di.config';\r\nimport contextMenuModule from '../features/context-menu/di.config';\r\nimport decorationModule from '../features/decoration/di.config';\r\nimport edgeLayoutModule from '../features/edge-layout/di.config';\r\nimport { edgeEditModule, labelEditModule, labelEditUiModule } from '../features/edit/di.config';\r\nimport expandModule from '../features/expand/di.config';\r\nimport exportModule from '../features/export/di.config';\r\nimport fadeModule from '../features/fade/di.config';\r\nimport hoverModule from '../features/hover/di.config';\r\nimport moveModule from '../features/move/di.config';\r\nimport openModule from '../features/open/di.config';\r\nimport routingModule from '../features/routing/di.config';\r\nimport selectModule from '../features/select/di.config';\r\nimport undoRedoModule from '../features/undo-redo/di.config';\r\nimport updateModule from '../features/update/di.config';\r\nimport viewportModule from '../features/viewport/di.config';\r\nimport zorderModule from '../features/zorder/di.config';\r\n\r\nexport interface LoadModuleOptions {\r\n    exclude?: ContainerModule[]\r\n}\r\n\r\n/**\r\n * Load the default set of container modules provided by Sprotty.\r\n */\r\nexport function loadDefaultModules(container: Container, options?: LoadModuleOptions) {\r\n    const modules = [\r\n        defaultModule, modelSourceModule, boundsModule, buttonModule,\r\n        commandPaletteModule, contextMenuModule, decorationModule, edgeEditModule,\r\n        edgeLayoutModule, expandModule, exportModule, fadeModule,\r\n        hoverModule, labelEditModule, labelEditUiModule, moveModule,\r\n        openModule, routingModule, selectModule, undoRedoModule,\r\n        updateModule, viewportModule, zorderModule\r\n    ];\r\n    if (options && options.exclude) {\r\n        for (const mod of options.exclude) {\r\n            const index = modules.indexOf(mod);\r\n            if (index >= 0)\r\n                modules.splice(index, 1);\r\n        }\r\n    }\r\n    container.load(...modules);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { h, vnode, VNode, VNodeData } from 'snabbdom';\r\n\r\nfunction buildVNodeData(attrs: { [key: string]: string }) {\r\n    const data: VNodeData = {};\r\n    const addData = (memo: Record<string, string> | null, name: string) => {\r\n        if (name !== 'style' && name !== 'class') {\r\n            const val = unescapeEntities(attrs[name]);\r\n            memo ? memo[name] = val : memo = { [name]: val };\r\n        }\r\n        return memo;\r\n    };\r\n    const _attrs = Object.keys(attrs).reduce(addData, null);\r\n\r\n    if (_attrs) {\r\n        data.attrs = _attrs;\r\n    }\r\n\r\n    const style = parseStyle(attrs);\r\n    if (style) {\r\n        data.style = style;\r\n    }\r\n\r\n    const classes = parseClass(attrs);\r\n    if (classes) {\r\n        data.class = classes;\r\n    }\r\n    return data;\r\n}\r\n\r\nfunction parseStyle(attrs: { [key: string]: string }) {\r\n    const addStyle = (memo: Record<string, string> | null, styleProp: string) => {\r\n        const res = styleProp.split(':');\r\n        const name = transformName(res[0].trim());\r\n        if (name) {\r\n            const val = res[1].replace('!important', '').trim();\r\n            memo ? memo[name] = val : memo = { [name]: val };\r\n        }\r\n        return memo;\r\n    };\r\n    try {\r\n        return attrs.style.split(';').reduce(addStyle, null);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction parseClass(attrs: { [key: string]: string }) {\r\n    const addClass = (memo: Record<string, boolean> | null, className: string) => {\r\n        className = className.trim();\r\n        if (className) {\r\n            memo ? memo[className] = true : memo = { [className]: true };\r\n        }\r\n        return memo;\r\n    };\r\n    try {\r\n        return attrs.class.split(' ').reduce(addClass, null);\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction transformName(name: string) {\r\n    // Replace -a with A to help camel case style property names.\r\n    name = name.replace(/-(\\w)/g, function _replace($1, $2) {\r\n        return $2.toUpperCase();\r\n    });\r\n    // Handle properties that start with a -.\r\n    const firstChar = name.charAt(0).toLowerCase();\r\n    return `${firstChar}${name.substring(1)}`;\r\n}\r\n\r\n// Regex for matching HTML entities.\r\nconst entityRegex = new RegExp('&[a-z0-9#]+;', 'gi');\r\n// Element for setting innerHTML for transforming entities.\r\nlet el: HTMLDivElement | null = null;\r\n\r\nfunction unescapeEntities(text: string) {\r\n    // Create the element using the context if it doesn't exist.\r\n    if (!el) {\r\n        el = document.createElement('div');\r\n    }\r\n    return text.replace(entityRegex, (entity) => {\r\n        if (el === null) return '';\r\n        el.innerHTML = entity;\r\n        return el.textContent === null ? '' : el.textContent;\r\n    });\r\n}\r\n\r\nfunction recurse(doc: Node, func: (node: Node, parent: Node | null) => void) {\r\n    let node: Node | null = doc;\r\n    let parent: Node | null = null;\r\n    const stack: Node[] = [];\r\n\r\n    const setChild = (n: Node) => {\r\n        const child = n.firstChild;\r\n        if (child !== null) {\r\n            parent = n;\r\n        }\r\n        node = child;\r\n    };\r\n    func(node, parent);\r\n    setChild(node);\r\n\r\n    while (true) {\r\n        while (node) {\r\n            stack.push(node);\r\n            func(node, parent);\r\n            setChild(node);\r\n        }\r\n        const _node = stack.pop();\r\n        node = _node ? _node : null;\r\n        if (!stack.length) break;\r\n        parent = stack[stack.length - 1];\r\n        if (node) {\r\n            const sibling = node.nextSibling;\r\n            if (sibling == null) {\r\n                parent = stack[stack.length - 1];\r\n            }\r\n            node = sibling;\r\n        }\r\n    }\r\n}\r\n\r\nlet vdom: VNode | null = null;\r\nconst vnodeMap = new Map<Node, VNode>();\r\nlet delimited = false;\r\n\r\nfunction toVNode(node: Node, parent: Node | null) {\r\n\r\n    let current: VNode | undefined;\r\n    if (parent !== null) {\r\n        current = vnodeMap.get(parent);\r\n    }\r\n\r\n    switch (node?.nodeType) {\r\n        // element\r\n        case 1: {\r\n            if (current === undefined) return;\r\n            current.children = current.children ? current.children : [];\r\n            const children = current.children;\r\n            const attributes = (node as Element).attributes;\r\n            const attrs: { [key: string]: string } = {};\r\n            for (let i = 0; i < attributes.length; i++) {\r\n                const attr = attributes.item(i);\r\n                if (attr) {\r\n                    attrs[attr.name] = attr.value;\r\n                }\r\n            }\r\n            const vn = h(node.nodeName, buildVNodeData(attrs));\r\n            children.push(vn);\r\n            vnodeMap.set(node, vn);\r\n            break;\r\n        }\r\n        // text\r\n        case 3: {\r\n            const text = node.textContent;\r\n            if (text !== null && current !== undefined) {\r\n                current.children = current.children ? current.children : [];\r\n                const children = current.children;\r\n                const lastData = children.length > 0 ? children[children.length - 1] : null;\r\n                if (!delimited && typeof lastData !== 'string' && lastData !== null && lastData.sel === undefined) {\r\n                    lastData.text = lastData.text + text;\r\n                } else {\r\n                    children.push(vnode(undefined, undefined, undefined, text, undefined));\r\n                }\r\n                delimited = false;\r\n            }\r\n            break;\r\n        }\r\n        case 8: {\r\n            delimited = true;\r\n            break;\r\n        }\r\n        // document\r\n        case 9: {\r\n            vdom = vnode(undefined, undefined, [], undefined, undefined);\r\n            vnodeMap.set(node, vdom);\r\n            break;\r\n        }\r\n        default:\r\n            break;\r\n    }\r\n}\r\n\r\nfunction stripVNode(vnodes: VNode | null) {\r\n    const children = vnodes?.children;\r\n    if (typeof children === 'undefined') return null;\r\n    if (children.length === 1 && typeof children[0] !== 'string') return children[0];\r\n    return null;\r\n}\r\n\r\nexport default function virtualizeString(html?: string) {\r\n\r\n    const parser = new window.DOMParser();\r\n    if (parser === undefined || html === undefined || html === '') return null;\r\n\r\n    const doc = parser.parseFromString(html, \"application/xml\");\r\n\r\n    if (doc?.firstChild?.nodeName === 'parsererror') {\r\n        const error = `${doc?.firstChild?.textContent}`;\r\n        return h('parsererror', [error]);\r\n    }\r\n\r\n    delimited = false;\r\n    vdom = null;\r\n    recurse(doc, toVNode);\r\n\r\n    if (vdom === null) return null;\r\n    return stripVNode(vdom);\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { Alignable, Locateable, Selectable, SModelElement, SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { Bounds, Dimension, Point } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelRootImpl, SChildElementImpl } from '../base/model/smodel';\r\nimport { InternalBoundsAware, boundsFeature, alignFeature, isBoundsAware } from '../features/bounds/model';\r\nimport { moveFeature } from '../features/move/model';\r\nimport { selectFeature } from '../features/select/model';\r\nimport { SNodeImpl, SPortImpl } from '../graph/sgraph';\r\nimport { RECTANGULAR_ANCHOR_KIND, DIAMOND_ANCHOR_KIND, ELLIPTIC_ANCHOR_KIND } from '../features/routing/anchor';\r\n\r\n/**\r\n * A node that is represented by a circle.\r\n */\r\nexport class CircularNode extends SNodeImpl {\r\n    override get anchorKind() {\r\n        return ELLIPTIC_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n/**\r\n * A node that is represented by a rectangle.\r\n */\r\nexport class RectangularNode extends SNodeImpl {\r\n    override get anchorKind() {\r\n        return RECTANGULAR_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n/**\r\n * A node that is represented by a diamond.\r\n */\r\nexport class DiamondNode extends SNodeImpl {\r\n    override get anchorKind() {\r\n        return DIAMOND_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n/**\r\n * A port that is represented by a circle.\r\n */\r\nexport class CircularPort extends SPortImpl {\r\n    override get anchorKind() {\r\n        return ELLIPTIC_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n/**\r\n * A port that is represented by a rectangle.\r\n */\r\nexport class RectangularPort extends SPortImpl {\r\n    override get anchorKind() {\r\n        return RECTANGULAR_ANCHOR_KIND;\r\n    }\r\n}\r\n\r\n/**\r\n * Serializable schema for HtmlRoot.\r\n *\r\n * @deprecated Use `HtmlRoot` from `sprotty-protocol` instead.\r\n */\r\nexport interface HtmlRootSchema extends SModelRoot {\r\n    classes?: string[]\r\n}\r\n\r\n/**\r\n * Root model element class for HTML content. Usually this is rendered with a `div` DOM element.\r\n */\r\nexport class HtmlRootImpl extends SModelRootImpl {\r\n    classes: string[] = [];\r\n}\r\n\r\n/** @deprecated Use `HtmlRootImpl` instead. */\r\nexport const HtmlRoot = HtmlRootImpl;\r\n\r\n/**\r\n * Serializable schema for PreRenderedElement.\r\n *\r\n * @deprecated Use `PreRenderedElement` from `sprotty-protocol` instead.\r\n */\r\nexport interface PreRenderedElementSchema extends SModelElement {\r\n    code: string\r\n}\r\n\r\n/**\r\n * Pre-rendered elements contain HTML or SVG code to be transferred to the DOM. This can be useful to\r\n * render complex figures or to compute the view on the server instead of the client code.\r\n */\r\nexport class PreRenderedElementImpl extends SChildElementImpl {\r\n    code: string;\r\n}\r\n\r\n/** @deprecated Use `PreRenderedElementImpl` instead. */\r\nexport const PreRenderedElement = PreRenderedElementImpl;\r\n\r\n/**\r\n * Serializable schema for ShapedPreRenderedElement.\r\n *\r\n * @deprecated Use `ShapedPreRenderedElement` from `sprotty-protocol` instead.\r\n */\r\nexport interface ShapedPreRenderedElementSchema extends PreRenderedElementSchema {\r\n    position?: Point\r\n    size?: Dimension\r\n}\r\n\r\n/**\r\n * Same as PreRenderedElement, but with a position and a size.\r\n */\r\nexport class ShapedPreRenderedElementImpl extends PreRenderedElementImpl implements InternalBoundsAware, Locateable, Selectable, Alignable {\r\n    static readonly DEFAULT_FEATURES = [moveFeature, boundsFeature, selectFeature, alignFeature];\r\n\r\n    position: Point = Point.ORIGIN;\r\n    size: Dimension = Dimension.EMPTY;\r\n    selected: boolean = false;\r\n    alignment: Point = Point.ORIGIN;\r\n\r\n    get bounds(): Bounds {\r\n        return {\r\n            x: this.position.x,\r\n            y: this.position.y,\r\n            width: this.size.width,\r\n            height: this.size.height\r\n        };\r\n    }\r\n\r\n    set bounds(newBounds: Bounds) {\r\n        this.position = {\r\n            x: newBounds.x,\r\n            y: newBounds.y\r\n        };\r\n        this.size = {\r\n            width: newBounds.width,\r\n            height: newBounds.height\r\n        };\r\n    }\r\n\r\n}\r\n\r\n/** @deprecated Use `ShapedPreRenderedElementImpl` instead. */\r\nexport const ShapedPreRenderedElement = ShapedPreRenderedElementImpl;\r\n\r\n/**\r\n * A `foreignObject` element to be transferred to the DOM within the SVG.\r\n *\r\n * This can be useful to to benefit from e.g. HTML rendering features, such as line wrapping, inside of\r\n * the SVG diagram.  Note that `foreignObject` is not supported by all browsers and SVG viewers may not\r\n * support rendering the `foreignObject` content.\r\n *\r\n * If no dimensions are specified in the schema element, this element will obtain the dimension of\r\n * its parent to fill the entire available room. Thus, this element requires specified bounds itself\r\n * or bounds to be available for its parent.\r\n */\r\nexport class ForeignObjectElementImpl extends ShapedPreRenderedElementImpl {\r\n    namespace: string;\r\n    override get bounds(): Bounds {\r\n        if (Dimension.isValid(this.size)) {\r\n            return {\r\n                x: this.position.x,\r\n                y: this.position.y,\r\n                width: this.size.width,\r\n                height: this.size.height\r\n            };\r\n        } else if (isBoundsAware(this.parent)) {\r\n            return {\r\n                x: this.position.x,\r\n                y: this.position.y,\r\n                width: this.parent.bounds.width,\r\n                height: this.parent.bounds.height\r\n            };\r\n        }\r\n        return Bounds.EMPTY;\r\n    }\r\n}\r\n\r\n/** @deprecated Use `ForeignObjectElementImpl` instead. */\r\nexport const ForeignObjectElement = ForeignObjectElementImpl;\r\n\r\n/**\r\n * Serializable schema for ForeignObjectElement.\r\n *\r\n * @deprecated Use `ForeignObjectElement` from `sprotty-protocol` instead.\r\n */\r\nexport interface ForeignObjectElementSchema extends ShapedPreRenderedElementSchema {\r\n    /** The namespace to be assigned to the elements inside of the `foreignObject`. */\r\n    namespace: string\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2020 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { svg }\u00A0from './jsx';\r\nimport { injectable } from \"inversify\";\r\nimport virtualize from \"./virtualize\";\r\nimport { VNode } from \"snabbdom\";\r\nimport { IView, RenderingContext } from \"../base/views/view\";\r\nimport { setNamespace, setAttr } from \"../base/views/vnode-utils\";\r\nimport { ShapeView } from \"../features/bounds/views\";\r\nimport { ForeignObjectElementImpl, PreRenderedElementImpl, ShapedPreRenderedElementImpl } from \"./model\";\r\n\r\n@injectable()\r\nexport class PreRenderedView extends ShapeView {\r\n    render(model: Readonly<PreRenderedElementImpl>, context: RenderingContext): VNode | undefined {\r\n        if (model instanceof ShapedPreRenderedElementImpl && !this.isVisible(model, context)) {\r\n            return undefined;\r\n        }\r\n        const node = virtualize(model.code);\r\n        if (node === null) return undefined;\r\n        this.correctNamespace(node);\r\n        return node;\r\n    }\r\n\r\n    protected correctNamespace(node: VNode) {\r\n        if (node.sel === 'svg' || node.sel === 'g')\r\n            setNamespace(node, 'http://www.w3.org/2000/svg');\r\n    }\r\n}\r\n\r\n/**\r\n * An SVG `foreignObject` view with a namespace specified by the provided `ForeignObjectElement`.\r\n * Note that `foreignObject` may not be supported by all browsers or SVG viewers.\r\n */\r\n@injectable()\r\nexport class ForeignObjectView implements IView {\r\n    render(model: ForeignObjectElementImpl, context: RenderingContext): VNode | undefined{\r\n        const foreignObjectContents = virtualize(model.code);\r\n        if (foreignObjectContents === null) return undefined;\r\n        const node = <g>\r\n            <foreignObject requiredFeatures='http://www.w3.org/TR/SVG11/feature#Extensibility'\r\n                height={model.bounds.height} width={model.bounds.width} x={0} y={0}>\r\n                {foreignObjectContents}\r\n            </foreignObject>\r\n            {context.renderChildren(model)}\r\n        </g>;\r\n        setAttr(node, 'class', model.type);\r\n        setNamespace(foreignObjectContents, model.namespace);\r\n        return node;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n /** @jsx html */\r\nimport { html }\u00A0from './jsx';\r\n\r\nimport { injectable } from 'inversify';\r\nimport { VNode } from 'snabbdom';\r\nimport { IView, RenderingContext } from '../base/views/view';\r\nimport { setClass } from '../base/views/vnode-utils';\r\nimport { HtmlRootImpl } from './model';\r\n\r\n/**\r\n * View for `HtmlRoot` elements. Typically this is used in hover popup boxes.\r\n */\r\n@injectable()\r\nexport class HtmlRootView implements IView {\r\n    render(model: HtmlRootImpl, context: RenderingContext): VNode {\r\n        const root = <div>\r\n            { context.renderChildren(model) }\r\n        </div>;\r\n        for (const c of model.classes) {\r\n            setClass(root, c, true);\r\n        }\r\n        return root;\r\n    }\r\n}\r\n", "/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\n// Detect WebView inside a native macOS app by ruling out all browsers\n// We just need to check for 'Safari' because all other browsers (besides Firefox) include that too\n// https://www.whatismybrowser.com/guides/the-latest-user-agent/macos\nvar isMacOSWebView = _global.navigator && /Macintosh/.test(navigator.userAgent) && /AppleWebKit/.test(navigator.userAgent) && !/Safari/.test(navigator.userAgent)\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile) unless this is a macOS WebView\n  : ('download' in HTMLAnchorElement.prototype && !isMacOSWebView)\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari) || isMacOSWebView) && typeof FileReader !== 'undefined') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n", "/********************************************************************************\r\n * Copyright (c) 2017-2021 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { saveAs } from 'file-saver';\r\nimport { inject, injectable } from 'inversify';\r\nimport {\r\n    Action, OpenAction, ActionMessage, isActionMessage, CollapseExpandAction, CollapseExpandAllAction,\r\n    ComputedBoundsAction, RequestModelAction, RequestPopupModelAction, SetModelAction, UpdateModelAction\r\n} from 'sprotty-protocol/lib/actions';\r\nimport { SModelRoot } from 'sprotty-protocol/lib/model';\r\nimport { ActionHandlerRegistry } from '../base/actions/action-handler';\r\nimport { ICommand } from '../base/commands/command';\r\nimport { SetModelCommand } from '../base/features/set-model';\r\nimport { TYPES } from '../base/types';\r\nimport { RequestBoundsCommand } from '../features/bounds/bounds-manipulation';\r\nimport { ExportSvgAction } from '../features/export/svg-exporter';\r\nimport { UpdateModelCommand } from '../features/update/update-model';\r\nimport { ILogger } from '../utils/logging';\r\nimport { ComputedBoundsApplicator, ModelSource } from './model-source';\r\n\r\n/**\r\n * Sent by the external server when to signal a state change.\r\n */\r\nexport class ServerStatusAction {\r\n    static KIND = 'serverStatus';\r\n    kind = ServerStatusAction.KIND;\r\n    severity: string;\r\n    message: string;\r\n}\r\n\r\nconst receivedFromServerProperty = '__receivedFromServer';\r\n\r\n/**\r\n * A ModelSource that communicates with an external model provider, e.g.\r\n * a model editor.\r\n *\r\n * This class defines which actions are sent to and received from the\r\n * external model source.\r\n */\r\n@injectable()\r\nexport abstract class DiagramServerProxy extends ModelSource {\r\n\r\n    @inject(TYPES.ILogger) protected logger: ILogger;\r\n    @inject(ComputedBoundsApplicator) protected readonly computedBoundsApplicator: ComputedBoundsApplicator;\r\n\r\n    clientId: string;\r\n\r\n    protected currentRoot: SModelRoot = {\r\n        type: 'NONE',\r\n        id: 'ROOT'\r\n    };\r\n\r\n    protected lastSubmittedModelType: string;\r\n\r\n    override get model(): SModelRoot {\r\n        return this.currentRoot;\r\n    }\r\n\r\n    override initialize(registry: ActionHandlerRegistry): void {\r\n        super.initialize(registry);\r\n\r\n        // Register actions to be sent to the remote server\r\n        registry.register(ComputedBoundsAction.KIND, this);\r\n        registry.register(RequestBoundsCommand.KIND, this);\r\n        registry.register(RequestPopupModelAction.KIND, this);\r\n        registry.register(CollapseExpandAction.KIND, this);\r\n        registry.register(CollapseExpandAllAction.KIND, this);\r\n        registry.register(OpenAction.KIND, this);\r\n        registry.register(ServerStatusAction.KIND, this);\r\n\r\n        if (!this.clientId) {\r\n            this.clientId = this.viewerOptions.baseDiv;\r\n        }\r\n    }\r\n\r\n    handle(action: Action): void | ICommand | Action {\r\n        const forwardToServer = this.handleLocally(action);\r\n        if (forwardToServer) {\r\n            this.forwardToServer(action);\r\n        }\r\n    }\r\n\r\n    protected forwardToServer(action: Action): void {\r\n        const message: ActionMessage = {\r\n            clientId: this.clientId,\r\n            action: action\r\n        };\r\n        this.logger.log(this, 'sending', message);\r\n        this.sendMessage(message);\r\n    }\r\n\r\n    /**\r\n     * Send a message to the remote diagram server.\r\n     */\r\n    protected abstract sendMessage(message: ActionMessage): void;\r\n\r\n    /**\r\n     * Called when a message is received from the remote diagram server.\r\n     */\r\n    protected messageReceived(data: any): void {\r\n        const object = typeof(data) === 'string' ? JSON.parse(data) : data;\r\n        if (isActionMessage(object) && object.action) {\r\n            if (!object.clientId || object.clientId === this.clientId) {\r\n                (object.action as any)[receivedFromServerProperty] = true;\r\n                this.logger.log(this, 'receiving', object);\r\n                this.actionDispatcher.dispatch(object.action).then(() => {\r\n                    this.storeNewModel(object.action);\r\n                });\r\n            }\r\n        } else {\r\n            this.logger.error(this, 'received data is not an action message', object);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Check whether the given action should be handled locally. Returns true if the action should\r\n     * still be sent to the server, and false if it's only handled locally.\r\n     */\r\n    protected handleLocally(action: Action): boolean {\r\n        this.storeNewModel(action);\r\n        switch (action.kind) {\r\n            case ComputedBoundsAction.KIND:\r\n                return this.handleComputedBounds(action as ComputedBoundsAction);\r\n            case RequestModelAction.KIND:\r\n                return this.handleRequestModel(action as RequestModelAction);\r\n            case RequestBoundsCommand.KIND:\r\n                return false;\r\n            case ExportSvgAction.KIND:\r\n                return this.handleExportSvgAction(action as ExportSvgAction);\r\n            case ServerStatusAction.KIND:\r\n                return this.handleServerStateAction(action as ServerStatusAction);\r\n        }\r\n        return !(action as any)[receivedFromServerProperty];\r\n    }\r\n\r\n    /**\r\n     * Put the new model contained in the given action into the model storage, if there is any.\r\n     */\r\n    protected storeNewModel(action: Action): void {\r\n        if (action.kind === SetModelCommand.KIND\r\n            || action.kind === UpdateModelCommand.KIND\r\n            || action.kind === RequestBoundsCommand.KIND) {\r\n            const newRoot = (action as any).newRoot;\r\n            if (newRoot) {\r\n                this.currentRoot = newRoot as SModelRoot;\r\n                if (action.kind === SetModelCommand.KIND || action.kind === UpdateModelCommand.KIND) {\r\n                    this.lastSubmittedModelType = newRoot.type;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected handleRequestModel(action: RequestModelAction): boolean {\r\n        const newOptions = {\r\n            needsClientLayout: this.viewerOptions.needsClientLayout,\r\n            needsServerLayout: this.viewerOptions.needsServerLayout,\r\n            ...action.options\r\n        };\r\n        const newAction = {\r\n            ...action,\r\n            options: newOptions\r\n        };\r\n        this.forwardToServer(newAction);\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * If the server requires to compute a layout, the computed bounds are forwarded. Otherwise they\r\n     * are applied to the current model locally and a model update is triggered.\r\n     */\r\n    protected handleComputedBounds(action: ComputedBoundsAction): boolean {\r\n        if (this.viewerOptions.needsServerLayout) {\r\n            return true;\r\n        } else {\r\n            const root = this.currentRoot;\r\n            this.computedBoundsApplicator.apply(root, action);\r\n            if (root.type === this.lastSubmittedModelType) {\r\n                this.actionDispatcher.dispatch(UpdateModelAction.create(root));\r\n            } else {\r\n                this.actionDispatcher.dispatch(SetModelAction.create(root));\r\n            }\r\n            this.lastSubmittedModelType = root.type;\r\n            return false;\r\n        }\r\n    }\r\n\r\n    protected handleExportSvgAction(action: ExportSvgAction): boolean {\r\n        const blob = new Blob([action.svg], { type: 'text/plain;charset=utf-8' });\r\n        saveAs(blob, 'diagram.svg');\r\n        return false;\r\n    }\r\n\r\n    protected handleServerStateAction(action: ServerStatusAction): boolean {\r\n        return false;\r\n    }\r\n\r\n    commitModel(newRoot: SModelRoot): Promise<SModelRoot> | SModelRoot {\r\n        const previousRoot = this.currentRoot;\r\n        this.currentRoot = newRoot;\r\n        return previousRoot;\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { saveAs } from 'file-saver';\r\nimport { inject, injectable, optional } from 'inversify';\r\nimport {\r\n    Action, ComputedBoundsAction, RequestBoundsAction, RequestModelAction, RequestPopupModelAction,\r\n    SetModelAction, SetPopupModelAction, UpdateModelAction\r\n} from 'sprotty-protocol/lib/actions';\r\nimport { SModelElement, SModelRoot, Viewport} from 'sprotty-protocol/lib/model';\r\nimport { IModelLayoutEngine, GetViewportAction, ViewportResult, GetSelectionAction, SelectionResult } from 'sprotty-protocol';\r\nimport { Bounds } from 'sprotty-protocol/lib/utils/geometry';\r\nimport { SModelIndex, findElement } from 'sprotty-protocol/lib/utils/model-utils';\r\nimport { ILogger } from '../utils/logging';\r\nimport { FluentIterable } from '../utils/iterable';\r\nimport { TYPES } from '../base/types';\r\nimport { ActionHandlerRegistry } from '../base/actions/action-handler';\r\nimport { EMPTY_ROOT } from '../base/model/smodel-factory';\r\nimport { ExportSvgAction } from '../features/export/svg-exporter';\r\nimport { applyMatches, Match } from '../features/update/model-matching';\r\nimport { ModelSource, ComputedBoundsApplicator } from './model-source';\r\n\r\nexport interface IPopupModelProvider {\r\n    getPopupModel(request: RequestPopupModelAction, element?: SModelElement): SModelRoot | undefined;\r\n}\r\n\r\n/**\r\n * A model source that allows to set and modify the model through function calls.\r\n * This class can be used as a facade over the action-based API of sprotty. It handles\r\n * actions for bounds calculation and model updates.\r\n */\r\n@injectable()\r\nexport class LocalModelSource extends ModelSource {\r\n\r\n    @inject(TYPES.ILogger) protected readonly logger: ILogger;\r\n    @inject(ComputedBoundsApplicator) protected readonly computedBoundsApplicator: ComputedBoundsApplicator;\r\n    @inject(TYPES.IPopupModelProvider)@optional() protected popupModelProvider?: IPopupModelProvider;\r\n    @inject(TYPES.IModelLayoutEngine)@optional() protected layoutEngine?: IModelLayoutEngine;\r\n\r\n    protected currentRoot: SModelRoot = EMPTY_ROOT;\r\n\r\n    /**\r\n     * The `type` property of the model root is used to determine whether a model update\r\n     * is a change of the previous model or a totally new one.\r\n     */\r\n    protected lastSubmittedModelType: string;\r\n\r\n    override get model(): SModelRoot {\r\n        return this.currentRoot;\r\n    }\r\n\r\n    set model(root: SModelRoot) {\r\n        this.setModel(root);\r\n    }\r\n\r\n    override initialize(registry: ActionHandlerRegistry): void {\r\n        super.initialize(registry);\r\n\r\n        // Register actions to be handled by the `handle` method\r\n        registry.register(ComputedBoundsAction.KIND, this);\r\n        registry.register(RequestPopupModelAction.KIND, this);\r\n    }\r\n\r\n    /**\r\n     * Set the model without incremental update.\r\n     */\r\n    setModel(newRoot: SModelRoot): Promise<void> {\r\n        this.currentRoot = newRoot;\r\n        return this.submitModel(newRoot, false);\r\n    }\r\n\r\n    commitModel(newRoot: SModelRoot): Promise<SModelRoot> | SModelRoot {\r\n        const previousRoot = this.currentRoot;\r\n        this.currentRoot = newRoot;\r\n        return previousRoot;\r\n    }\r\n\r\n    /**\r\n     * Apply an incremental update to the model with an animation showing the transition to\r\n     * the new state. If `newRoot` is undefined, the current root is submitted; in that case\r\n     * it is assumed that it has been modified before.\r\n     */\r\n    updateModel(newRoot?: SModelRoot): Promise<void> {\r\n        if (newRoot === undefined) {\r\n            return this.submitModel(this.currentRoot, true);\r\n        } else {\r\n            this.currentRoot = newRoot;\r\n            return this.submitModel(newRoot, true);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current selection from the model.\r\n     */\r\n    async getSelection(): Promise<FluentIterable<SModelElement>> {\r\n        const res = await this.actionDispatcher.request<SelectionResult>(GetSelectionAction.create());\r\n        const result: SModelElement[] = [];\r\n        this.gatherSelectedElements(this.currentRoot, new Set(res.selectedElementsIDs), result);\r\n        return result;\r\n    }\r\n\r\n    private gatherSelectedElements(element: SModelElement, selected: Set<string>, result: SModelElement[]): void {\r\n        if (selected.has(element.id)) {\r\n            result.push(element);\r\n        }\r\n        if (element.children) {\r\n            for (const child of element.children) {\r\n                this.gatherSelectedElements(child, selected, result);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the current viewport from the model.\r\n     */\r\n    async getViewport(): Promise<Viewport & { canvasBounds: Bounds }> {\r\n        const res = await this.actionDispatcher.request<ViewportResult>(GetViewportAction.create());\r\n        return {\r\n            scroll: res.viewport.scroll,\r\n            zoom: res.viewport.zoom,\r\n            canvasBounds: res.canvasBounds\r\n        };\r\n    }\r\n\r\n    /**\r\n     * If client layout is active, run a `RequestBoundsAction` and wait for the resulting\r\n     * `ComputedBoundsAction`, otherwise call `doSubmitModel(\u2026)` directly.\r\n     */\r\n    protected async submitModel(newRoot: SModelRoot, update: boolean | Match[], cause?: Action): Promise<void> {\r\n        if (this.viewerOptions.needsClientLayout) {\r\n            const computedBounds = await this.actionDispatcher.request<ComputedBoundsAction>(RequestBoundsAction.create(newRoot));\r\n            const index = this.computedBoundsApplicator.apply(this.currentRoot, computedBounds);\r\n            await this.doSubmitModel(newRoot, true, cause, index);\r\n        } else {\r\n            await this.doSubmitModel(newRoot, update, cause);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Submit the given model with an `UpdateModelAction` or a `SetModelAction` depending on the\r\n     * `update` argument. If available, the model layout engine is invoked first.\r\n     */\r\n    protected async doSubmitModel(newRoot: SModelRoot, update: boolean | Match[],\r\n            cause?: Action, index?: SModelIndex): Promise<void> {\r\n        if (this.layoutEngine !== undefined) {\r\n            try {\r\n                const layoutResult = this.layoutEngine.layout(newRoot, index);\r\n                if (layoutResult instanceof Promise)\r\n                    newRoot = await layoutResult;\r\n                else if (layoutResult !== undefined)\r\n                    newRoot = layoutResult;\r\n            } catch (error) {\r\n                this.logger.error(this, error.toString(), error.stack);\r\n            }\r\n        }\r\n\r\n        const lastSubmittedModelType = this.lastSubmittedModelType;\r\n        this.lastSubmittedModelType = newRoot.type;\r\n        if (cause && cause.kind === RequestModelAction.KIND && (cause as RequestModelAction).requestId) {\r\n            const request = cause as RequestModelAction;\r\n            await this.actionDispatcher.dispatch(SetModelAction.create(newRoot, request.requestId));\r\n        } else if (update && newRoot.type === lastSubmittedModelType) {\r\n            const input = Array.isArray(update) ? update : newRoot;\r\n            await this.actionDispatcher.dispatch(UpdateModelAction.create(input, { animate: true, cause }));\r\n        } else {\r\n            await this.actionDispatcher.dispatch(SetModelAction.create(newRoot));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Modify the current model with an array of matches.\r\n     */\r\n    applyMatches(matches: Match[]): Promise<void> {\r\n        const root = this.currentRoot;\r\n        applyMatches(root, matches);\r\n        return this.submitModel(root, matches);\r\n    }\r\n\r\n    /**\r\n     * Modify the current model by adding new elements.\r\n     */\r\n    addElements(elements: (SModelElement | { element: SModelElement, parentId: string })[]): Promise<void> {\r\n        const matches: Match[] = [];\r\n        for (const e of elements) {\r\n            const anye: any = e;\r\n            if (typeof anye.element === 'object' && typeof anye.parentId === 'string') {\r\n                matches.push({\r\n                    right: anye.element,\r\n                    rightParentId: anye.parentId\r\n                });\r\n            } else if (typeof anye.id === 'string') {\r\n                matches.push({\r\n                    right: anye,\r\n                    rightParentId: this.currentRoot.id\r\n                });\r\n            }\r\n        }\r\n        return this.applyMatches(matches);\r\n    }\r\n\r\n    /**\r\n     * Modify the current model by removing elements.\r\n     */\r\n    removeElements(elements: (string | { elementId: string, parentId: string })[]): Promise<void> {\r\n        const matches: Match[] = [];\r\n        const index = new SModelIndex();\r\n        index.add(this.currentRoot);\r\n        for (const e of elements) {\r\n            const anye: any = e;\r\n            if (anye.elementId !== undefined && anye.parentId !== undefined) {\r\n                const element = index.getById(anye.elementId);\r\n                if (element !== undefined) {\r\n                    matches.push({\r\n                        left: element,\r\n                        leftParentId: anye.parentId\r\n                    });\r\n                }\r\n            } else {\r\n                const element = index.getById(anye);\r\n                if (element !== undefined) {\r\n                    matches.push({\r\n                        left: element,\r\n                        leftParentId: this.currentRoot.id\r\n                    });\r\n                }\r\n            }\r\n        }\r\n        return this.applyMatches(matches);\r\n    }\r\n\r\n\r\n    // ----- Methods for handling incoming actions ----------------------------\r\n\r\n    handle(action: Action): void {\r\n        switch (action.kind) {\r\n            case RequestModelAction.KIND:\r\n                this.handleRequestModel(action as RequestModelAction);\r\n                break;\r\n            case ComputedBoundsAction.KIND:\r\n                this.computedBoundsApplicator.apply(this.currentRoot, action as ComputedBoundsAction);\r\n                break;\r\n            case RequestPopupModelAction.KIND:\r\n                this.handleRequestPopupModel(action as RequestPopupModelAction);\r\n                break;\r\n            case ExportSvgAction.KIND:\r\n                this.handleExportSvgAction(action as ExportSvgAction);\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected handleRequestModel(action: RequestModelAction): void {\r\n        this.submitModel(this.currentRoot, false, action);\r\n    }\r\n\r\n    protected handleRequestPopupModel(action: RequestPopupModelAction): void {\r\n        if (this.popupModelProvider !== undefined) {\r\n            const element = findElement(this.currentRoot, action.elementId);\r\n            const popupRoot = this.popupModelProvider.getPopupModel(action, element);\r\n            if (popupRoot !== undefined) {\r\n                popupRoot.canvasBounds = action.bounds;\r\n                this.actionDispatcher.dispatch(SetPopupModelAction.create(popupRoot, action.requestId));\r\n            }\r\n        }\r\n    }\r\n\r\n    protected handleExportSvgAction(action: ExportSvgAction): void {\r\n        const blob = new Blob([action.svg], { type: 'text/plain;charset=utf-8' });\r\n        saveAs(blob, 'diagram.svg');\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable, inject } from 'inversify';\r\nimport { LoggingAction } from 'sprotty-protocol/lib/actions';\r\nimport { ILogger, LogLevel } from '../utils/logging';\r\nimport { TYPES } from '../base/types';\r\nimport { ModelSource } from './model-source';\r\n\r\n/**\r\n * A logger that forwards messages of type 'error', 'warn', and 'info' to the model source.\r\n */\r\n@injectable()\r\nexport class ForwardingLogger implements ILogger {\r\n\r\n    @inject(TYPES.ModelSourceProvider) protected modelSourceProvider: () => Promise<ModelSource>;\r\n    @inject(TYPES.LogLevel) public logLevel: LogLevel;\r\n\r\n    error(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.error)\r\n            this.forward(thisArg, message, LogLevel.error, params);\r\n    }\r\n\r\n    warn(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.warn)\r\n            this.forward(thisArg, message, LogLevel.warn, params);\r\n    }\r\n\r\n    info(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.info)\r\n            this.forward(thisArg, message, LogLevel.info, params);\r\n    }\r\n\r\n    log(thisArg: any, message: string, ...params: any[]): void {\r\n        if (this.logLevel >= LogLevel.log) {\r\n            // We cannot forward 'log' level messages since that would lead to endless loops\r\n            try {\r\n                const caller = typeof thisArg === 'object' ? thisArg.constructor.name : String(thisArg);\r\n                console.log.apply(thisArg, [caller + ': ' + message, ...params]);\r\n            } catch (error) {}\r\n        }\r\n    }\r\n\r\n    protected forward(thisArg: any, message: string, logLevel: LogLevel, params: any[]) {\r\n        const date = new Date();\r\n        const action = LoggingAction.create({\r\n            message,\r\n            severity: LogLevel[logLevel],\r\n            time: date.toLocaleTimeString(),\r\n            caller: typeof thisArg === 'object' ? thisArg.constructor.name : String(thisArg),\r\n            params: params.map(p => JSON.stringify(p))\r\n        });\r\n        this.modelSourceProvider().then(modelSource => {\r\n            try {\r\n                modelSource.handle(action);\r\n            } catch (error) {\r\n                try {\r\n                    console.log.apply(thisArg, [message, action, error]);\r\n                } catch (e) {}\r\n            }\r\n        });\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nimport { injectable } from 'inversify';\r\nimport { ActionMessage } from 'sprotty-protocol/lib/actions';\r\nimport { DiagramServerProxy } from './diagram-server';\r\n\r\n/**\r\n * An external ModelSource that connects to the model provider using a websocket.\r\n */\r\n@injectable()\r\nexport class WebSocketDiagramServerProxy extends DiagramServerProxy {\r\n\r\n    protected webSocket?: WebSocket;\r\n\r\n    listen(webSocket: WebSocket): void {\r\n        webSocket.addEventListener('message', event => {\r\n            this.messageReceived(event.data);\r\n        });\r\n        webSocket.addEventListener('error', event => {\r\n            this.logger.error(this, 'error event received', event);\r\n        });\r\n        this.webSocket = webSocket;\r\n    }\r\n\r\n    disconnect() {\r\n        if (this.webSocket) {\r\n            this.webSocket.close();\r\n            this.webSocket = undefined;\r\n        }\r\n    }\r\n\r\n    protected sendMessage(message: ActionMessage): void {\r\n        if (this.webSocket) {\r\n            this.webSocket.send(JSON.stringify(message));\r\n        } else {\r\n            throw new Error('WebSocket is not connected');\r\n        }\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\nexport interface RGBColor {\r\n    red: number\r\n    green: number\r\n    blue: number\r\n}\r\n\r\nexport function rgb(red: number, green: number, blue: number): RGBColor {\r\n    return {\r\n        red: red,\r\n        green: green,\r\n        blue: blue\r\n    };\r\n}\r\n\r\nexport function toSVG(c: RGBColor): string {\r\n    return 'rgb(' + c.red + ',' + c.green + ',' + c.blue + ')';\r\n}\r\n\r\nexport class ColorMap {\r\n\r\n    constructor(protected stops: RGBColor[]) {\r\n    }\r\n\r\n    getColor(t: number): RGBColor {\r\n        t = Math.max(0, Math.min(0.99999999, t));\r\n        const i = Math.floor(t * this.stops.length);\r\n        return this.stops[i];\r\n    }\r\n}\r\n", "/********************************************************************************\r\n * Copyright (c) 2017-2018 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n// ------------------ Base ------------------\r\n\r\nexport * from './base/actions/action';\r\nexport * from './base/actions/action-dispatcher';\r\nexport * from './base/actions/action-handler';\r\nexport * from './base/actions/diagram-locker';\r\n\r\nexport * from './base/animations/animation-frame-syncer';\r\nexport * from './base/animations/animation';\r\nexport * from './base/animations/easing';\r\n\r\nexport * from './base/commands/command';\r\nexport * from './base/commands/command-registration';\r\nexport * from './base/commands/command-stack-options';\r\nexport * from './base/commands/command-stack';\r\n\r\nexport * from './base/features/initialize-canvas';\r\nexport * from './base/features/set-model';\r\n\r\nexport * from './base/model/smodel-factory';\r\nexport * from './base/model/smodel-utils';\r\nexport * from './base/model/smodel';\r\n\r\nexport * from './base/ui-extensions/ui-extension-registry';\r\nexport * from './base/ui-extensions/ui-extension';\r\n\r\nexport * from './base/views/key-tool';\r\nexport * from './base/views/mouse-tool';\r\nexport * from './base/views/thunk-view';\r\nexport * from './base/views/view';\r\nexport * from './base/views/viewer-cache';\r\nexport * from './base/views/viewer-options';\r\nexport * from './base/views/viewer';\r\nexport * from './base/views/vnode-postprocessor';\r\nexport * from './base/views/vnode-utils';\r\n\r\nexport * from './base/types';\r\n\r\nimport defaultModule from './base/di.config';\r\nexport { defaultModule };\r\n\r\n\r\n// ------------------ Features ------------------\r\n\r\nexport * from './features/bounds/bounds-manipulation';\r\nexport * from './features/bounds/hidden-bounds-updater';\r\nexport * from './features/bounds/layout';\r\nexport * from './features/bounds/model';\r\nexport * from './features/bounds/vbox-layout';\r\nexport * from './features/bounds/hbox-layout';\r\nexport * from './features/bounds/stack-layout';\r\nexport * from './features/bounds/views';\r\n\r\nexport * from './features/button/button-handler';\r\nexport * from './features/button/model';\r\n\r\nexport * from './features/command-palette/action-providers';\r\nexport * from './features/command-palette/command-palette';\r\n\r\nexport * from './features/context-menu/context-menu-service';\r\nexport * from './features/context-menu/menu-providers';\r\nexport * from './features/context-menu/mouse-listener';\r\n\r\nexport * from './features/edge-layout/di.config';\r\nexport * from './features/edge-layout/edge-layout';\r\nexport * from './features/edge-layout/model';\r\n\r\nexport * from './features/edit/create';\r\nexport * from './features/edit/create-on-drag';\r\nexport * from './features/edit/di.config';\r\nexport * from './features/edit/delete';\r\nexport * from './features/edit/edit-label';\r\nexport * from './features/edit/edit-label-ui';\r\nexport * from './features/edit/edit-routing';\r\nexport * from './features/edit/model';\r\nexport * from './features/edit/reconnect';\r\n\r\nexport * from './features/expand/expand';\r\nexport * from './features/expand/model';\r\nexport * from './features/expand/views';\r\n\r\nexport * from './features/export/export';\r\nexport * from './features/export/model';\r\nexport * from './features/export/svg-exporter';\r\n\r\nexport * from './features/fade/fade';\r\nexport * from './features/fade/model';\r\n\r\nexport * from './features/hover/hover';\r\nexport * from './features/hover/model';\r\n\r\nexport * from './features/decoration/model';\r\nexport * from './features/decoration/views';\r\nexport * from './features/decoration/decoration-placer';\r\n\r\nexport * from './features/edge-intersection/intersection-finder';\r\nexport * from './features/edge-intersection/sweepline';\r\n\r\nexport * from './features/move/model';\r\nexport * from './features/move/move';\r\nexport * from './features/move/snap';\r\n\r\nexport * from './features/nameable/model';\r\n\r\nexport * from './features/open/open';\r\nexport * from './features/open/model';\r\n\r\nexport * from './features/projection/model';\r\nexport * from './features/projection/views';\r\n\r\nexport * from './features/routing/anchor';\r\nexport * from './features/routing/abstract-edge-router';\r\nexport * from './features/routing/bezier-anchors';\r\nexport * from './features/routing/bezier-edge-router';\r\nexport * from './features/routing/manhattan-anchors';\r\nexport * from './features/routing/manhattan-edge-router';\r\nexport * from './features/routing/model';\r\nexport * from './features/routing/polyline-anchors';\r\nexport * from './features/routing/polyline-edge-router';\r\nexport * from './features/routing/routing';\r\nexport * from './features/routing/views';\r\n\r\nexport * from './features/select/model';\r\nexport * from './features/select/select';\r\n\r\nexport * from './features/undo-redo/undo-redo';\r\n\r\nexport * from './features/update/model-matching';\r\nexport * from './features/update/update-model';\r\n\r\nexport * from './features/viewport/center-fit';\r\nexport * from './features/viewport/model';\r\nexport * from './features/viewport/scroll';\r\nexport * from './features/viewport/viewport-root';\r\nexport * from './features/viewport/viewport';\r\nexport * from './features/viewport/zoom';\r\n\r\nexport * from './features/zorder/zorder';\r\n\r\nimport boundsModule from './features/bounds/di.config';\r\nimport buttonModule from './features/button/di.config';\r\nimport commandPaletteModule from './features/command-palette/di.config';\r\nimport contextMenuModule from './features/context-menu/di.config';\r\nimport decorationModule from './features/decoration/di.config';\r\nimport edgeIntersectionModule from './features/edge-intersection/di.config';\r\nimport edgeLayoutModule from './features/edge-layout/di.config';\r\nimport expandModule from './features/expand/di.config';\r\nimport exportModule from './features/export/di.config';\r\nimport fadeModule from './features/fade/di.config';\r\nimport hoverModule from './features/hover/di.config';\r\nimport moveModule from './features/move/di.config';\r\nimport openModule from './features/open/di.config';\r\nimport routingModule from './features/routing/di.config';\r\nimport selectModule from './features/select/di.config';\r\nimport undoRedoModule from './features/undo-redo/di.config';\r\nimport updateModule from './features/update/di.config';\r\nimport viewportModule from './features/viewport/di.config';\r\nimport zorderModule from './features/zorder/di.config';\r\n\r\nexport {\r\n    boundsModule, buttonModule, commandPaletteModule, contextMenuModule, decorationModule,\r\n    edgeIntersectionModule, edgeLayoutModule, expandModule, exportModule, fadeModule, hoverModule, moveModule,\r\n    openModule, routingModule, selectModule, undoRedoModule, updateModule, viewportModule, zorderModule\r\n};\r\n\r\n// ------------------ Graph ------------------\r\n\r\nexport * from './graph/sgraph';\r\nexport * from './graph/views';\r\n\r\n\r\n// ------------------ Library ------------------\r\n\r\nexport * from './lib/modules';\r\nexport * from './lib/generic-views';\r\nexport * from './lib/html-views';\r\nexport * from './lib/jsx';\r\nexport * from './lib/model';\r\nexport * from './lib/svg-views';\r\n\r\n\r\n// ------------------ Model Source ------------------\r\n\r\nexport * from './model-source/commit-model';\r\nexport * from './model-source/diagram-server';\r\nexport * from './model-source/local-model-source';\r\nexport * from './model-source/logging';\r\nexport * from './model-source/model-source';\r\nexport * from './model-source/websocket';\r\n\r\nimport modelSourceModule from './model-source/di.config';\r\nexport { modelSourceModule };\r\n\r\n\r\n// ------------------ Utilities ------------------\r\n\r\nexport * from './utils/browser';\r\nexport * from './utils/codicon';\r\nexport * from './utils/color';\r\nexport * from './utils/geometry';\r\nexport * from './utils/inversify';\r\nexport * from './utils/logging';\r\nexport * from './utils/registry';\r\n", "import \"reflect-metadata\";\r\nimport { LocalModelSource, TYPES } from \"sprotty\";\r\nimport { createContainer } from \"./di.config\";\r\nimport { graph } from \"./model-source\";\r\n\r\nimport addNode from \"./util/addNode\";\r\nimport drawEdge from \"./util/drawEdge\";\r\nexport default function run() {\r\n  const addNode1Btn = document.getElementById(\"add-node-1\");\r\n  const addNode2Btn = document.getElementById(\"add-node-2\");\r\n  const addNode3Btn = document.getElementById(\"add-node-3\");\r\n  const addNode4Btn = document.getElementById(\"add-node-4\");\r\n  const drawEdgeBtn = document.getElementById(\"draw-edge\");\r\n  const deleteEdgeBtn = document.getElementById(\"delete-edge\");\r\n  const cancelBtn = document.getElementById(\"cancel\");\r\n  const tipElement = document.querySelector(\".tip-container\");\r\n\r\n  const container = createContainer(\"sprotty-container\");\r\n  const modelSource = container.get<LocalModelSource>(TYPES.ModelSource);\r\n\r\n  const defaultNodeWidth: number = 100;\r\n  const defaultNodeHeight: number = 100;\r\n  const defaultPortWidth: number = 20;\r\n  const defaultPortHeight: number = 20;\r\n  const defaultDummyWidth: number = 10;\r\n  const defaultDummyHeight: number = 10;\r\n\r\n  let dummyEdgeArray = [];\r\n  let dummyNodeArray = [];\r\n\r\n  let sourceId: any;\r\n\r\n  let node1Number: any = 1;\r\n  let node2Number: any = 1;\r\n  let node3Number: any = 1;\r\n  let node4Number: any = 1;\r\n\r\n  let label1Id: any = 1;\r\n  let label2Id: any = 1;\r\n  let label3Id: any = 1;\r\n  let label4Id: any = 1;\r\n\r\n  let drawMode: boolean = false;\r\n  let dummyMode: boolean = false;\r\n  console.log(modelSource);\r\n  const drawMainEdge = (event) => {\r\n    drawEdge(\r\n      modelSource,\r\n      sourceId,\r\n      (event.target as HTMLElement).parentElement.id.replace(\r\n        \"sprotty-container_port-\",\r\n        \"\"\r\n      )\r\n    );\r\n    cancelDrawMode();\r\n  };\r\n\r\n  function cancelDrawMode() {\r\n    dummyMode = false;\r\n    addNode1Btn.removeAttribute(\"disabled\");\r\n    addNode2Btn.removeAttribute(\"disabled\");\r\n    addNode3Btn.removeAttribute(\"disabled\");\r\n    addNode4Btn.removeAttribute(\"disabled\");\r\n    drawEdgeBtn.classList.remove(\"btn-active\");\r\n    deleteEdgeBtn.removeAttribute(\"disabled\");\r\n    cancelBtn.classList.add(\"hide\");\r\n    tipElement.classList.add(\"hide\");\r\n    document.querySelectorAll(\".sprotty-node\").forEach((e) => {\r\n      (e as HTMLElement).removeAttribute(\"style\");\r\n    });\r\n    document.querySelectorAll(\".port\").forEach((port) => {\r\n      port.removeEventListener(\"click\", drawMainEdge);\r\n    });\r\n    console.log(dummyNodeArray);\r\n    modelSource.removeElements([\r\n      {\r\n        elementId: dummyNodeArray[0],\r\n        parentId: \"graph\",\r\n      },\r\n    ]);\r\n    modelSource.removeElements([\r\n      {\r\n        elementId: dummyEdgeArray[0],\r\n        parentId: \"graph\",\r\n      },\r\n    ]);\r\n    console.log(modelSource);\r\n    Array.from(document.getElementsByClassName(\"ready-draw\")).forEach((e) => {\r\n      e.classList.remove(\"ready-draw\");\r\n    });\r\n    dummyNodeArray = [];\r\n    dummyEdgeArray = [];\r\n    console.log(dummyEdgeArray);\r\n    sourceId = \"\";\r\n    drawMode = false;\r\n  }\r\n\r\n  modelSource.setModel(graph);\r\n\r\n  const drawLogic = () => {\r\n    setTimeout(() => {\r\n      document.querySelectorAll(\".port\").forEach((port) => {\r\n        port.addEventListener(\"click\", () => {\r\n          if (drawMode && !dummyMode) {\r\n            // TAO DUMMY\r\n            console.log(\"click dummy\");\r\n            dummyMode = true;\r\n            port.classList.add(\"ready-draw\");\r\n            sourceId = port.id.replace(\"sprotty-container_port-\", \"\");\r\n            const transformAttribute =\r\n              port.parentElement.getAttribute(\"transform\");\r\n            const coordinate = transformAttribute\r\n              ? transformAttribute\r\n                  .replace(\"translate(\", \"\")\r\n                  .replace(\")\", \"\")\r\n                  .trim()\r\n                  .split(\",\")\r\n              : [0, 0];\r\n\r\n            addNode(\r\n              modelSource,\r\n              \"dummy\",\r\n              defaultDummyWidth,\r\n              defaultDummyHeight,\r\n              \"dummy\",\r\n              1,\r\n              2,\r\n              2,\r\n              [\"nodes\", \"dummy\"],\r\n              \"\",\r\n              Number(coordinate[0]) + 1.5 * defaultNodeWidth,\r\n              Number(coordinate[1])\r\n            );\r\n            dummyNodeArray.push(\"node-dummy\");\r\n            console.log(\"after push\", modelSource);\r\n            console.log(\"source\", sourceId);\r\n            drawEdge(modelSource, sourceId, \"dummy-1\", [\"dummy-edge\"]);\r\n            dummyEdgeArray.push(`edge-between-node${sourceId}-to-nodedummy-1`);\r\n            console.log(dummyEdgeArray);\r\n            dummyMode = false;\r\n          }\r\n          // Ve EDGE\r\n          if (drawMode) {\r\n            setTimeout(() => {\r\n              const dummyElement = document.getElementById(\r\n                \"sprotty-container_node-dummy\"\r\n              );\r\n\r\n              dummyElement.addEventListener(\"mouseup\", () => {\r\n                const dummyCoordinate = dummyElement\r\n                  .getAttribute(\"transform\")\r\n                  .replace(\"translate(\", \"\")\r\n                  .replace(\")\", \"\")\r\n                  .trim()\r\n                  .split(\",\")\r\n                  .map((e) => {\r\n                    return Number(e);\r\n                  });\r\n\r\n                const nodeElements = document.querySelectorAll(\".node\");\r\n                let nodeElementsArr = [];\r\n                nodeElements.forEach((node) => {\r\n                  nodeElementsArr.push({\r\n                    id: node.id,\r\n                    coordinate: node.getAttribute(\"transform\")\r\n                      ? node\r\n                          .getAttribute(\"transform\")\r\n                          .replace(\"translate(\", \"\")\r\n                          .replace(\")\", \"\")\r\n                          .trim()\r\n                          .split(\",\")\r\n                          .map((e) => {\r\n                            return Number(e);\r\n                          })\r\n                      : [0, 0],\r\n                  });\r\n                });\r\n                const filteredNode = nodeElementsArr.filter((node) => {\r\n                  return (\r\n                    node.coordinate[0] <= dummyCoordinate[0] &&\r\n                    dummyCoordinate[0] <=\r\n                      node.coordinate[0] + defaultNodeWidth &&\r\n                    node.coordinate[1] <= dummyCoordinate[1] &&\r\n                    dummyCoordinate[1] <= node.coordinate[1] + defaultNodeHeight\r\n                  );\r\n                });\r\n\r\n                // const nodeCoordinate = document\r\n                //   .getElementById(filteredNode[0].id)\r\n                //   .getAttribute(\"transform\")\r\n                //   .replace(\"translate(\", \"\")\r\n                //   .replace(\")\", \"\")\r\n                //   .trim()\r\n                //   .split(\",\")\r\n                //   .map((e) => {\r\n                //     return Number(e);\r\n                //   });\r\n                // console.log(nodeCoordinate);\r\n\r\n                // const portElements = document.querySelectorAll(\".port\");\r\n                // let portElementsArr = [];\r\n                // portElements.forEach((port) => {\r\n                //   portElementsArr.push({\r\n                //     id: port.id.replace(\"sprotty-container_port-\", \"\"),\r\n                //     coordinate: port.getAttribute(\"transform\")\r\n                //       ? port\r\n                //           .getAttribute(\"transform\")\r\n                //           .replace(\"translate(\", \"\")\r\n                //           .replace(\")\", \"\")\r\n                //           .trim()\r\n                //           .split(\",\")\r\n                //           .map((e) => {\r\n                //             return Number(e);\r\n                //           })\r\n                //       : [0, 0],\r\n                //   });\r\n                // });\r\n                // const portElementsArrFiltered = portElementsArr.filter((e) => {\r\n                //   return (\r\n                //     !e.id.includes(\"dummy\") &&\r\n                //     e.id.includes(\r\n                //       filteredNode[0].id.replace(\"sprotty-container_node-\", \"\")\r\n                //     )\r\n                //   );\r\n                // });\r\n                // console.log(portElementsArrFiltered);\r\n\r\n                const idPortArr = [];\r\n                const portElements = document.querySelectorAll(\".port\");\r\n                portElements.forEach((port) => {\r\n                  idPortArr.push(\r\n                    port.id.replace(\"sprotty-container_node-\", \"\")\r\n                  );\r\n                });\r\n\r\n                const idPortArrFiltered = idPortArr.filter((id) => {\r\n                  return id.includes(\r\n                    filteredNode[0].id.replace(\"sprotty-container_node-\", \"\")\r\n                  );\r\n                });\r\n\r\n                idPortArrFiltered.forEach((portId) => {\r\n                  const portSelected = document.getElementById(portId);\r\n\r\n                  portSelected.classList.add(\"ready-draw\");\r\n\r\n                  portSelected.addEventListener(\"click\", drawMainEdge);\r\n                });\r\n              });\r\n            }, 100);\r\n          }\r\n        });\r\n      });\r\n    }, 100);\r\n  };\r\n\r\n  // add node\r\n  addNode1Btn.addEventListener(\"click\", () => {\r\n    addNode(\r\n      modelSource,\r\n\r\n      `type-1-${node1Number}`,\r\n      defaultNodeWidth,\r\n      defaultNodeHeight,\r\n      label1Id,\r\n      1,\r\n      defaultPortWidth,\r\n      defaultPortHeight\r\n    );\r\n    node1Number++;\r\n    label1Id++;\r\n    drawLogic();\r\n  });\r\n\r\n  addNode2Btn.addEventListener(\"click\", () => {\r\n    addNode(\r\n      modelSource,\r\n\r\n      `type-2-${node2Number}`,\r\n      defaultNodeWidth,\r\n      defaultNodeHeight,\r\n      label2Id,\r\n      2,\r\n      defaultPortWidth,\r\n      defaultPortHeight\r\n    );\r\n    node2Number++;\r\n    label2Id++;\r\n    drawLogic();\r\n  });\r\n  addNode3Btn.addEventListener(\"click\", () => {\r\n    console.log(graph.children);\r\n    addNode(\r\n      modelSource,\r\n\r\n      `type-3-${node3Number}`,\r\n      defaultNodeWidth,\r\n      defaultNodeHeight,\r\n      label3Id,\r\n      3,\r\n      defaultPortWidth,\r\n      defaultPortHeight\r\n    );\r\n    node3Number++;\r\n    label3Id++;\r\n    drawLogic();\r\n  });\r\n  addNode4Btn.addEventListener(\"click\", () => {\r\n    addNode(\r\n      modelSource,\r\n\r\n      `type-4-${node4Number}`,\r\n      defaultNodeWidth,\r\n      defaultNodeHeight,\r\n      label4Id,\r\n      4,\r\n      defaultPortWidth,\r\n      defaultPortHeight\r\n    );\r\n    node4Number++;\r\n    label4Id++;\r\n    drawLogic();\r\n  });\r\n  // draw mode\r\n  drawEdgeBtn.addEventListener(\"click\", () => {\r\n    if (drawMode === false) {\r\n      addNode1Btn.setAttribute(\"disabled\", \"\");\r\n      addNode2Btn.setAttribute(\"disabled\", \"\");\r\n      addNode3Btn.setAttribute(\"disabled\", \"\");\r\n      addNode4Btn.setAttribute(\"disabled\", \"\");\r\n      drawEdgeBtn.classList.add(\"btn-active\");\r\n      deleteEdgeBtn.setAttribute(\"disabled\", \"\");\r\n      cancelBtn.classList.remove(\"hide\");\r\n      drawMode = true;\r\n      tipElement.classList.remove(\"hide\");\r\n    } else {\r\n      cancelDrawMode();\r\n    }\r\n  });\r\n  // delete mode\r\n  deleteEdgeBtn.addEventListener(\"click\", () => {\r\n    const edgeElements = document.querySelectorAll(\".sprotty-edge\");\r\n    const selectedEdgeElements = Array.from(edgeElements).filter((e) => {\r\n      return e.classList.contains(\"selected\");\r\n    });\r\n    selectedEdgeElements.forEach((element) => {\r\n      modelSource.removeElements([\r\n        {\r\n          parentId: \"graph\",\r\n          elementId: element.id.replace(\"sprotty-container_\", \"\"),\r\n        },\r\n      ]);\r\n    });\r\n  });\r\n  // cancel btn\r\n  cancelBtn.addEventListener(\"click\", () => {\r\n    if (drawMode === true) {\r\n      cancelDrawMode();\r\n    }\r\n  });\r\n}\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", () => run());\r\n", "import { Container, ContainerModule } from \"inversify\";\r\n\r\nimport {\r\n  configureModelElement,\r\n  configureViewerOptions,\r\n  loadDefaultModules,\r\n  LocalModelSource,\r\n  PolylineEdgeView,\r\n  RectangularNodeView,\r\n  SEdgeImpl,\r\n  SGraphImpl,\r\n  SGraphView,\r\n  SNodeImpl,\r\n  TYPES,\r\n  SLabelView,\r\n  SRoutingHandleImpl,\r\n  SRoutingHandleView,\r\n  BezierCurveEdgeView,\r\n  SBezierControlHandleView,\r\n  SBezierCreateHandleView,\r\n  SPortImpl,\r\n  SLabelImpl,\r\n} from \"sprotty\";\r\n\r\nimport { PortViewWithExternalLabel } from \"./view/portView\";\r\n\r\nexport const createContainer = (containerId: string) => {\r\n  const myModule = new ContainerModule((bind, unbind, isBound, rebind) => {\r\n    bind(TYPES.ModelSource).to(LocalModelSource).inSingletonScope();\r\n\r\n    const context = { bind, unbind, isBound, rebind };\r\n    configureModelElement(context, \"graph\", SGraphImpl, SGraphView);\r\n    configureModelElement(\r\n      context,\r\n      \"port\",\r\n      SPortImpl,\r\n      PortViewWithExternalLabel\r\n    );\r\n    configureModelElement(container, \"label:port\", SLabelImpl, SLabelView);\r\n    configureModelElement(container, \"label:node\", SLabelImpl, SLabelView);\r\n    configureModelElement(context, \"node\", SNodeImpl, RectangularNodeView);\r\n    configureModelElement(\r\n      context,\r\n      \"edge:straight\",\r\n      SEdgeImpl,\r\n      PolylineEdgeView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"edge:bezier\",\r\n      SEdgeImpl,\r\n      BezierCurveEdgeView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"routing-point\",\r\n      SRoutingHandleImpl,\r\n      SRoutingHandleView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"volatile-routing-point\",\r\n      SRoutingHandleImpl,\r\n      SRoutingHandleView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"bezier-create-routing-point\",\r\n      SRoutingHandleImpl,\r\n      SBezierCreateHandleView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"bezier-remove-routing-point\",\r\n      SRoutingHandleImpl,\r\n      SBezierCreateHandleView\r\n    );\r\n    configureModelElement(\r\n      context,\r\n      \"bezier-routing-point\",\r\n      SRoutingHandleImpl,\r\n      SBezierControlHandleView\r\n    );\r\n\r\n    configureViewerOptions(context, {\r\n      needsClientLayout: false,\r\n      baseDiv: containerId,\r\n    });\r\n  });\r\n\r\n  const container = new Container();\r\n  loadDefaultModules(container);\r\n  container.load(myModule);\r\n  return container;\r\n};\r\n", "/********************************************************************************\r\n * Copyright (c) 2023 TypeFox and others.\r\n *\r\n * This program and the accompanying materials are made available under the\r\n * terms of the Eclipse Public License v. 2.0 which is available at\r\n * http://www.eclipse.org/legal/epl-2.0.\r\n *\r\n * This Source Code may also be made available under the following Secondary\r\n * Licenses when the conditions for such availability set forth in the Eclipse\r\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\r\n * with the GNU Classpath Exception which is available at\r\n * https://www.gnu.org/software/classpath/license.html.\r\n *\r\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\r\n ********************************************************************************/\r\n\r\n/** @jsx svg */\r\nimport { svg } from \"sprotty/lib/lib/jsx\";\r\n\r\nimport { injectable } from \"inversify\";\r\nimport { VNode } from \"snabbdom\";\r\nimport {\r\n  ATTR_BBOX_ELEMENT,\r\n  RenderingContext,\r\n  setAttr,\r\n  ShapeView,\r\n  SPortImpl,\r\n} from \"sprotty\";\r\n\r\n@injectable()\r\nexport class PortViewWithExternalLabel extends ShapeView {\r\n  render(\r\n    node: Readonly<SPortImpl>,\r\n    context: RenderingContext\r\n  ): VNode | undefined {\r\n    if (!this.isVisible(node, context)) {\r\n      return undefined;\r\n    }\r\n    const bboxElement = (\r\n      <rect\r\n        class-sprotty-port={true}\r\n        class-mouseover={node.hoverFeedback}\r\n        class-selected={node.selected}\r\n        x=\"0\"\r\n        y=\"0\"\r\n        width={Math.max(node.size.width, 0)}\r\n        height={Math.max(node.size.height, 0)}\r\n      ></rect>\r\n    );\r\n    setAttr(bboxElement, ATTR_BBOX_ELEMENT, true);\r\n    return (\r\n      <g>\r\n        {bboxElement}\r\n        {context.renderChildren(node)}\r\n      </g>\r\n    );\r\n  }\r\n}\r\n", "import { SGraph, SPort, SNode, SLabel } from \"sprotty-protocol\";\r\n\r\nlet nw = 100;\r\nlet nh = 100;\r\n\r\nlet nx = 100;\r\nlet ny = 100;\r\n\r\nlet pw = 20;\r\nlet ph = 20;\r\n\r\nexport const graph: SGraph = {\r\n  type: \"graph\",\r\n  id: \"graph\",\r\n\r\n  children: [\r\n    // <SNode>{\r\n    //   type: \"node\",\r\n    //   id: \"node-1\",\r\n    //   name: \"node-1\",\r\n    //   position: { x: nx, y: ny },\r\n    //   size: { width: nw, height: nh },\r\n    //   children: [\r\n    //     <SLabel>{\r\n    //       type: \"label:node\",\r\n    //       id: \"label-1\",\r\n    //       text: \"abc\",\r\n    //       position: { x: nx / 2, y: nw / 2 },\r\n    //     },\r\n    //     <SPort>{\r\n    //       type: \"port\",\r\n    //       id: \"port-1\",\r\n    //       size: { width: pw, height: ph },\r\n    //       position: { x: nw, y: nh / 2 - ph / 2 },\r\n    //     },\r\n    //     <SPort>{\r\n    //       type: \"port\",\r\n    //       id: \"port-2\",\r\n    //       size: { width: pw, height: ph },\r\n    //       position: { x: nw / 2 - pw / 2, y: nh },\r\n    //     },\r\n    //     <SPort>{\r\n    //       type: \"port\",\r\n    //       id: \"port-3\",\r\n    //       size: { width: pw, height: ph },\r\n    //       position: { x: 0 - pw, y: nh / 2 - ph / 2 },\r\n    //     },\r\n    //     <SPort>{\r\n    //       type: \"port\",\r\n    //       id: \"port-4\",\r\n    //       size: { width: pw, height: ph },\r\n    //       position: { x: nw / 2 - pw / 2, y: 0 - ph },\r\n    //     },\r\n    //   ],\r\n    // },\r\n  ],\r\n};\r\n", "import { SNode, SLabel, SPort } from \"sprotty-protocol\";\r\n\r\nexport default function addNode(\r\n  source: any,\r\n  nodeId: any,\r\n  nodeWidth: number,\r\n  nodeHeight: number,\r\n  labelId,\r\n  portQuantity: number,\r\n  portWidth,\r\n  portHeight,\r\n  cssClasses = [\"node\"],\r\n  name: string = `node-${nodeId}`,\r\n  x = Math.floor(Math.random() * 500),\r\n  y = Math.floor(Math.random() * 500)\r\n) {\r\n  let portArr = [];\r\n  let positionPortArr = [\r\n    { x: nodeWidth, y: nodeHeight / 2 - portHeight / 2 },\r\n    { x: nodeWidth / 2 - portWidth / 2, y: nodeHeight },\r\n    { x: 0 - portWidth, y: nodeHeight / 2 - portHeight / 2 },\r\n    { x: nodeWidth / 2 - portWidth / 2, y: 0 - portHeight },\r\n  ];\r\n\r\n  source.addElements([\r\n    {\r\n      parentId: \"graph\",\r\n      element: <SNode>{\r\n        type: \"node\",\r\n\r\n        id: `node-${nodeId}`,\r\n        cssClasses,\r\n        position: {\r\n          x,\r\n          y,\r\n        },\r\n        size: { width: nodeWidth, height: nodeHeight },\r\n        children: [\r\n          <SLabel>{\r\n            type: \"label:node\",\r\n            id: `label-${nodeId}-${labelId}`,\r\n            text: name,\r\n            position: { x: nodeWidth / 2, y: nodeHeight / 2 },\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  ]);\r\n  for (let i = 0; i < portQuantity; i++) {\r\n    source.addElements([\r\n      {\r\n        parentId: `node-${nodeId}`,\r\n        element: <SPort>{\r\n          type: \"port\",\r\n          id: `port-${nodeId}-${i + 1}`,\r\n          size: { width: portWidth, height: portHeight },\r\n          position: positionPortArr[i],\r\n          cssClasses: [\"port\"],\r\n        },\r\n      },\r\n    ]);\r\n  }\r\n}\r\n", "import { SEdge } from \"sprotty-protocol\";\r\n\r\nexport default function drawEdge(\r\n  source,\r\n  sourceNumb,\r\n  targetNumb,\r\n  cssClasses = []\r\n) {\r\n  source.addElements([\r\n    {\r\n      parentId: \"graph\",\r\n      element: (<SEdge>{\r\n        type: \"edge:straight\",\r\n        id: `edge-between-node${sourceNumb}-to-node${targetNumb}`,\r\n        sourceId: `port-${sourceNumb}`,\r\n        targetId: `port-${targetNumb}`,\r\n        cssClasses,\r\n        routerKind: \"manhattan\",\r\n      }) as SEdge,\r\n    },\r\n  ]);\r\n}\r\n"],
  "mappings": "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",
  "names": ["Reflect", "hasOwn", "MapIterator", "Map", "Set", "WeakMap", "create", "Binding", "MetadataReader", "Context", "Metadata", "Plan", "LazyServiceIdentifier", "QueryableString", "Target", "Request", "FactoryType", "resolve", "BindingWhenSyntax", "BindingOnSyntax", "BindingWhenOnSyntax", "BindingInSyntax", "BindingInWhenOnSyntax", "BindingToSyntax", "self", "ContainerSnapshot", "Lookup", "ModuleActivationStore", "Container", "module", "ContainerModule", "AsyncContainerModule", "array", "m", "injectable", "interfaces", "RejectAction", "create", "RequestModelAction", "SetModelAction", "UpdateModelAction", "RequestPopupModelAction", "SetPopupModelAction", "SetBoundsAction", "RequestBoundsAction", "ComputedBoundsAction", "LoggingAction", "SelectAction", "SelectAllAction", "GetSelectionAction", "SelectionResult", "CollapseExpandAction", "CollapseExpandAllAction", "OpenAction", "LayoutAction", "CenterAction", "FitToScreenAction", "SetViewportAction", "GetViewportAction", "ViewportResult", "BringToFrontAction", "UndoAction", "RedoAction", "MoveAction", "HoverFeedbackAction", "CreateElementAction", "DeleteElementAction", "ApplyLabelEditAction", "ReconnectAction", "Point", "Dimension", "Bounds", "array", "h", "_a", "vnode", "InitializeCanvasBoundsAction", "create", "SetUIExtensionVisibilityAction", "create", "setAttr", "vnode", "vnode", "vnode", "tagName", "parentNode", "fragment", "isElement", "vnode", "isDocumentFragment", "init", "vnode", "thunk", "init", "vnode", "vnode", "vnode", "vnode", "vnode", "vnode", "vnode", "vnode", "thunk", "svg", "configureModelElement", "configureViewerOptions", "vnode", "vnode", "LogLevel", "vnode", "vnode", "vnode", "ShapeView", "fragment", "destroy", "fragment", "SRoutingHandleImpl", "SGraphImpl", "SNodeImpl", "SPortImpl", "SEdgeImpl", "SLabelImpl", "Side", "vnode", "RectangularNodeView", "EditLabelAction", "create", "ExportSvgAction", "create", "svg", "CommitModelAction", "create", "SwitchEditModeAction", "create", "RequestExportSvgAction", "create", "vnode", "vnode", "vnode", "global", "TinyQueue", "vnode", "AddRemoveBezierSegmentAction", "create", "vnode", "vnode", "SGraphView", "PolylineEdgeView", "BezierCurveEdgeView", "SRoutingHandleView", "SLabelView", "vnode", "SBezierCreateHandleView", "SBezierControlHandleView", "loadDefaultModules", "toVNode", "a", "b", "c", "d", "g", "h", "f", "e", "LocalModelSource", "import_sprotty", "import_inversify", "import_sprotty", "import_jsx", "port"]
}
